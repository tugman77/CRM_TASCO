<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RelaCRM â€” ìŠ¤ë§ˆíŠ¸ ê³ ê°ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
<meta name="description" content="ëª…í•¨Â·PDFÂ·CSVë¥¼ AIë¡œ ìë™ ë¶„ì„í•´ ì—°ë½ì²˜ë¥¼ ì €ì¥í•˜ëŠ” ìŠ¤ë§ˆíŠ¸ ê³ ê°ê´€ë¦¬ ì‹œìŠ¤í…œ">
<meta name="author" content="RelaCRM">
<meta property="og:title" content="RelaCRM â€” ìŠ¤ë§ˆíŠ¸ ê³ ê°ê´€ë¦¬ ì‹œìŠ¤í…œ">
<meta property="og:description" content="ëª…í•¨Â·PDFÂ·CSVë¥¼ AIë¡œ ìë™ ë¶„ì„í•´ ì—°ë½ì²˜ë¥¼ ì €ì¥í•˜ëŠ” ìŠ¤ë§ˆíŠ¸ ê³ ê°ê´€ë¦¬ ì‹œìŠ¤í…œ">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0f1117;
    --surface: #1a1d27;
    --surface2: #22263a;
    --border: #2d3250;
    --accent: #4f7cff;
    --accent2: #ff6b6b;
    --accent3: #43e97b;
    --accent4: #f7971e;
    --text: #e8eaf6;
    --muted: #7986cb;
    --danger: #ef5350;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; display: flex; flex-direction: column; overflow-x: hidden; -webkit-text-size-adjust: 100%; }

  /* â”€â”€ SIDEBAR (PC) â”€â”€ */
  .sidebar {
    width: 220px; min-height: 100vh; background: var(--surface);
    border-right: 1px solid var(--border); display: flex; flex-direction: column;
    padding: 20px 0; position: fixed; left: 0; top: 0; bottom: 0; z-index: 200;
    transition: transform 0.25s ease;
  }
  .logo { padding: 0 20px 16px; border-bottom: 1px solid var(--border); margin-bottom: 10px; }
  .logo h1 { font-size: 18px; font-weight: 700; color: var(--accent); }
  .logo span { font-size: 11px; color: var(--muted); font-family: 'IBM Plex Mono', monospace; }
  .sidebar-btn {
    margin: 2px 10px; padding: 9px 14px; border-radius: 8px; border: none;
    background: transparent; color: var(--text); font-family: 'Noto Sans KR', sans-serif;
    font-size: 13px; cursor: pointer; text-align: left; transition: all 0.15s;
    display: flex; align-items: center; gap: 9px; width: calc(100% - 20px);
  }
  .sidebar-btn:hover { background: var(--surface2); }
  .sidebar-btn.active { background: var(--accent); color: #fff; }
  .today-badge {
    margin-left: auto; background: #ff6b6b; color: #fff;
    font-size: 10px; font-weight: 700; font-family: 'IBM Plex Mono', monospace;
    padding: 1px 6px; border-radius: 10px; min-width: 18px; text-align: center;
    line-height: 16px; height: 16px; display: inline-block; flex-shrink: 0;
  }
  .sidebar-btn.active .today-badge { background: rgba(255,255,255,0.3); color: #fff; }
  .sidebar-stats { padding: 0 4px 8px; font-size: 11px; color: var(--muted); font-family: 'IBM Plex Mono', monospace; }
  .stat-row { display: flex; justify-content: space-between; margin: 3px 0; }
  .stat-row span:last-child { color: var(--accent); }

  /* â”€â”€ MAIN (PC) â”€â”€ */
  .main { margin-left: 220px; flex: 1; display: flex; flex-direction: column; min-height: 100vh; }
  .topbar { padding: 12px 20px; border-bottom: 1px solid var(--border); background: var(--surface); display: flex; align-items: center; gap: 10px; position: sticky; top: 0; z-index: 100; }
  .search-wrap { position: relative; flex: 1; min-width: 0; }
  .search-wrap input { width: 100%; padding: 8px 12px 8px 34px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 13px; font-family: 'Noto Sans KR', sans-serif; outline: none; transition: border-color 0.2s; }
  .search-wrap input:focus { border-color: var(--accent); }
  .search-icon { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: var(--muted); font-size: 14px; }
  .view-toggle { display: flex; gap: 3px; flex-shrink: 0; }
  .toggle-btn { padding: 6px 10px; border-radius: 6px; border: 1px solid var(--border); background: transparent; color: var(--muted); cursor: pointer; font-size: 14px; transition: all 0.15s; }
  .toggle-btn.active { background: var(--accent); border-color: var(--accent); color: #fff; }
  .btn { padding: 8px 16px; border-radius: 8px; border: none; cursor: pointer; font-family: 'Noto Sans KR', sans-serif; font-size: 13px; font-weight: 500; transition: all 0.15s; display: inline-flex; align-items: center; gap: 5px; white-space: nowrap; flex-shrink: 0; }
  .btn-primary { background: var(--accent); color: #fff; }
  .btn-primary:hover { background: #3d6bef; }
  .btn-outline { background: transparent; color: var(--text); border: 1px solid var(--border); }
  .btn-outline:hover { background: var(--surface2); }
  .btn-danger { background: var(--danger); color: #fff; }
  .btn-sm { padding: 5px 10px; font-size: 12px; }
  .btn-xs { padding: 3px 7px; font-size: 11px; border-radius: 5px; }

  /* â”€â”€ ëª¨ë°”ì¼ í•˜ë‹¨ íƒ­ë°” â”€â”€ */
  .mobile-tabbar {
    display: none;
    position: fixed; bottom: 0; left: 0; right: 0; z-index: 300;
    background: var(--surface); border-top: 1px solid var(--border);
    padding: 6px 0 calc(6px + env(safe-area-inset-bottom));
    grid-template-columns: repeat(5, 1fr);
  }
  .mobile-tab {
    display: flex; flex-direction: column; align-items: center; gap: 3px;
    padding: 6px 4px; border: none; background: transparent; color: var(--muted);
    font-family: 'Noto Sans KR', sans-serif; font-size: 10px; cursor: pointer;
    position: relative; transition: color 0.15s;
  }
  .mobile-tab .tab-icon { font-size: 20px; line-height: 1; }
  .mobile-tab.active { color: var(--accent); }
  .mobile-tab .today-badge { position: absolute; top: 4px; right: calc(50% - 18px); }

  /* ëª¨ë°”ì¼ í—¤ë” */
  .mobile-header {
    display: none; position: fixed; top: 0; left: 0; right: 0; z-index: 200;
    background: var(--surface); border-bottom: 1px solid var(--border);
    padding: 10px 14px; align-items: center; gap: 10px; height: 52px;
  }
  .mobile-header h1 { font-size: 16px; font-weight: 700; color: var(--accent); flex: 1; }

  .content { padding: 20px 24px; flex: 1; }
  .section-title { font-size: 17px; font-weight: 700; margin-bottom: 4px; }
  .section-sub { font-size: 12px; color: var(--muted); margin-bottom: 12px; }
  .filter-bar { display: flex; gap: 6px; margin-bottom: 16px; flex-wrap: wrap; }
  .filter-chip { padding: 4px 12px; border-radius: 20px; border: 1px solid var(--border); background: transparent; color: var(--muted); font-size: 12px; cursor: pointer; font-family: 'Noto Sans KR', sans-serif; transition: all 0.15s; }
  .filter-chip:hover { border-color: var(--accent); color: var(--text); }
  .filter-chip.active { background: var(--accent); border-color: var(--accent); color: #fff; }
  .filter-bar-label { font-size: 10px; color: var(--muted); font-family: 'IBM Plex Mono', monospace; align-self: center; margin-right: 4px; white-space: nowrap; }
  /* íŒ€ í•„í„°ë°” êµ¬ë¶„ì„  */
  .filter-bar + .filter-bar { padding-top: 8px; border-top: 1px solid var(--border); }

  /* â”€â”€ ëª¨ë°”ì¼ ë°˜ì‘í˜• â”€â”€ */
  .modal { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; width: 640px; max-width: 95vw; max-height: 92vh; overflow-y: auto; padding: 26px; position: relative; }
  @media (max-width: 768px) {
  /* ì‚¬ìš©ì ê´€ë¦¬ ëª¨ë‹¬ ëª¨ë°”ì¼ */
  .user-row {
    grid-template-columns: 28px 1fr 60px 50px 34px 34px;
    gap: 6px;
    font-size: 12px;
  }

  /* ë¡œê·¸ì¸ ì¹´ë“œ ëª¨ë°”ì¼ ìµœì í™” */
  #loginOverlay {
    align-items: flex-start;
    padding: 20px 0;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  .login-card {
    width: calc(100% - 32px);
    max-width: 100%;
    margin: auto;
    padding: 32px 24px;
  }

  /* í„°ì¹˜ íƒ€ê¹ƒ ìµœì†Œí™” ë°©ì§€ */
  button, .sidebar-btn, .mobile-tab, .btn {
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
  }
  .mobile-tab {
    min-height: 48px;
  }
  /* ëª¨ë°”ì¼ ìŠ¤í¬ë¡¤ ê´€ì„± */
  .content, .modal, .detail-panel {
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
  }

  /* iOS input ìë™ ì¤Œ ë°©ì§€ (font-size 16px ë¯¸ë§Œ ì‹œ ì¤Œ ë°œìƒ) */
  input, select, textarea {
    font-size: 16px !important;
  }
  /* ë‹¨, íŠ¹ë³„íˆ ì‘ì€ ë³´ì¡° inputì€ ì˜ˆì™¸ */
  .login-input { font-size: 16px !important; }

    body { flex-direction: column; }
    .sidebar { display: none !important; }
    .main { margin-left: 0 !important; padding-top: 52px; padding-bottom: 70px; }
    .mobile-header { display: flex; }
    .mobile-tabbar { display: grid; }
    .topbar {
      padding: 8px 12px; gap: 8px;
      position: sticky; top: 52px;
    }
    .pc-only { display: none !important; }
    .content { padding: 14px 12px; }
    .section-title { font-size: 15px; }
    .members-row { grid-template-columns: 1fr !important; }
    .modal { width: 100% !important; max-width: 100vw !important; max-height: 92vh; border-radius: 16px 16px 0 0 !important; margin: auto 0 0 0 !important; }
    .modal-overlay { align-items: flex-end !important; }
    .list-wrap { overflow-x: auto; }
    .shared-bar { flex-wrap: wrap; gap: 6px; }
    .fin-summary { gap: 12px; }
    .view-toggle .toggle-btn { padding: 6px 8px; font-size: 13px; }
  }

  @media (max-width: 480px) {
    .topbar { flex-wrap: wrap; }
    .search-wrap { order: -1; width: 100%; flex-basis: 100%; }
    .view-toggle { gap: 2px; }
  }

  /* Company Group */
  .company-group { background: #12151f; border: 1px solid var(--border); border-radius: 14px; margin-bottom: 18px; overflow: hidden; }
  .company-header { padding: 14px 18px; display: flex; align-items: center; gap: 12px; cursor: pointer; user-select: none; background: var(--surface); border-bottom: 1px solid var(--border); transition: background 0.15s; }
  .company-header:hover { background: var(--surface2); }
  .company-logo { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 17px; font-weight: 700; color: #fff; flex-shrink: 0; }
  .company-info { flex: 1; min-width: 0; }
  .company-name { font-size: 15px; font-weight: 700; }
  .company-meta { font-size: 11px; color: var(--muted); margin-top: 3px; display: flex; gap: 12px; flex-wrap: wrap; }
  .company-badges { display: flex; gap: 5px; flex-wrap: wrap; }
  .company-toggle { color: var(--muted); font-size: 13px; transition: transform 0.2s; flex-shrink: 0; margin-left: 8px; }
  .company-group.collapsed .company-toggle { transform: rotate(-90deg); }
  .company-body { }
  .company-group.collapsed .company-body { display: none; }

  /* Shared bar */
  .shared-bar { padding: 8px 18px; background: rgba(79,124,255,0.06); border-bottom: 1px solid var(--border); display: flex; gap: 16px; flex-wrap: wrap; font-size: 12px; color: var(--muted); align-items: center; }
  .shared-tag { font-family: 'IBM Plex Mono', monospace; font-size: 10px; background: rgba(79,124,255,0.15); color: var(--accent); padding: 1px 6px; border-radius: 4px; }
  .shared-edit-btn { margin-left: auto; background: none; border: 1px solid var(--border); color: var(--muted); border-radius: 5px; padding: 2px 8px; font-size: 11px; cursor: pointer; font-family: 'Noto Sans KR', sans-serif; transition: all 0.15s; }
  .shared-edit-btn:hover { color: var(--text); border-color: var(--accent); }

  /* Members row */
  .members-row { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 10px; padding: 14px 18px; border-bottom: 1px solid var(--border); }
  .person-card { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 12px; cursor: pointer; transition: all 0.15s; position: relative; }
  .person-card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px; background: var(--accent); border-radius: 10px 0 0 10px; }
  .person-card:hover { border-color: var(--accent); transform: translateY(-1px); box-shadow: 0 4px 14px rgba(79,124,255,0.12); }
  .person-head { display: flex; align-items: center; gap: 9px; margin-bottom: 8px; }
  .avatar { width: 34px; height: 34px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 700; color: #fff; flex-shrink: 0; }
  .person-name { font-size: 14px; font-weight: 600; }
  .person-dept { font-size: 11px; color: var(--muted); margin-top: 1px; }
  .person-contacts { font-size: 12px; color: var(--text); line-height: 2; }
  .person-contacts span { display: block; }
  .pc-label { display: inline-block; font-size: 10px; font-family: 'IBM Plex Mono', monospace; color: var(--muted); background: var(--surface2); border: 1px solid var(--border); border-radius: 3px; padding: 0 5px; margin-right: 5px; vertical-align: middle; }
  .person-badges { display: flex; gap: 4px; flex-wrap: wrap; margin-top: 7px; }
  .add-card { background: transparent; border: 1px dashed var(--border); border-radius: 10px; padding: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 7px; color: var(--muted); font-size: 12px; transition: all 0.15s; font-family: 'Noto Sans KR', sans-serif; }
  .add-card:hover { border-color: var(--accent); color: var(--accent); }

  /* Activity badge - dynamically injected via JS */
  .co-timeline-section { padding: 14px 18px; }
  .co-timeline-head { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
  .co-timeline-label { font-size: 11px; font-family: 'IBM Plex Mono', monospace; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; }
  .timeline { position: relative; }
  .timeline::before { content: ''; position: absolute; left: 14px; top: 6px; bottom: 6px; width: 1px; background: var(--border); }
  .timeline-item { display: flex; gap: 12px; margin-bottom: 8px; }
  .timeline-dot { width: 28px; height: 28px; border-radius: 50%; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 12px; position: relative; z-index: 1; }
  .dot-call { background: rgba(79,124,255,0.15); color: var(--accent); border: 1px solid var(--accent); }
  .tl-body { background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; flex: 1; overflow: hidden; transition: border-color 0.15s; }
  .tl-body:hover { border-color: var(--accent); }
  .tl-summary { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; cursor: pointer; user-select: none; gap: 8px; }
  .tl-summary-left { display: flex; align-items: center; gap: 8px; flex: 1; min-width: 0; }
  .tl-type { font-size: 12px; font-weight: 600; white-space: nowrap; }
  .tl-title-preview { font-size: 12px; color: var(--muted); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .tl-summary-right { display: flex; align-items: center; gap: 6px; flex-shrink: 0; }
  .tl-date { font-size: 11px; color: var(--muted); font-family: 'IBM Plex Mono', monospace; }
  .tl-amount-badge { font-size: 11px; color: var(--accent3); font-family: 'IBM Plex Mono', monospace; font-weight: 600; }
  .tl-chevron { font-size: 10px; color: var(--muted); transition: transform 0.2s; }
  .tl-detail { display: none; padding: 0 12px 10px; border-top: 1px solid var(--border); }
  .tl-detail.open { display: block; }
  .tl-who { font-size: 11px; color: var(--accent); margin: 6px 0 4px; cursor: pointer; }
  .tl-who:hover { text-decoration: underline; }
  .tl-text { font-size: 12px; color: var(--muted); line-height: 1.6; }
  .tl-amount { font-size: 12px; color: var(--accent3); font-family: 'IBM Plex Mono', monospace; margin-top: 4px; font-weight: 600; }
  .tl-actions { display: flex; gap: 4px; margin-top: 8px; justify-content: flex-end; }
  .tl-act-btn { background: none; border: 1px solid var(--border); color: var(--muted); cursor: pointer; font-size: 11px; padding: 3px 8px; border-radius: 5px; font-family: 'Noto Sans KR', sans-serif; transition: all 0.1s; }
  .tl-act-btn:hover { border-color: var(--accent); color: var(--accent); }
  .tl-act-btn.danger:hover { border-color: var(--danger); color: var(--danger); }
  .show-more-btn { width: 100%; padding: 7px; background: none; border: 1px dashed var(--border); border-radius: 6px; color: var(--muted); font-size: 12px; cursor: pointer; font-family: 'Noto Sans KR', sans-serif; margin-top: 4px; transition: all 0.15s; }
  .show-more-btn:hover { border-color: var(--accent); color: var(--accent); }
  /* í™œë™ í•„í„°ë°” (ê°œì¸/íšŒì‚¬ ìƒì„¸) */
  .acts-filter { display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 10px; }

  /* Ungrouped */
  .ungrouped-label { font-size: 12px; color: var(--muted); font-family: 'IBM Plex Mono', monospace; margin-bottom: 10px; }
  .ungrouped-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 10px; }

  /* Modal */
  .modal-overlay { display: none; position: fixed; top:0;right:0;bottom:0;left:0; background: rgba(0,0,0,0.72); z-index: 1000; align-items: center; justify-content: center; backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px); }
  .modal-overlay.open { display: flex; }
    .modal-title { font-size: 17px; font-weight: 700; margin-bottom: 20px; }
  .modal-close { position: absolute; top: 13px; right: 13px; background: var(--surface2); border: none; color: var(--text); width: 28px; height: 28px; border-radius: 6px; cursor: pointer; font-size: 15px; display: flex; align-items: center; justify-content: center; }
  .modal-close:hover { background: var(--danger); }
  .form-section { margin-bottom: 18px; }
  .form-section-title { font-size: 10px; font-family: 'IBM Plex Mono', monospace; color: var(--accent); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 9px; padding-bottom: 7px; border-bottom: 1px solid var(--border); }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
  .form-row.three { grid-template-columns: 1fr 1fr 1fr; }
  .form-row.single { grid-template-columns: 1fr; }
  .form-group { display: flex; flex-direction: column; gap: 5px; }
  .form-group label { font-size: 11px; color: var(--muted); }
  .form-group input, .form-group textarea, .form-group select { padding: 8px 10px; background: var(--bg); border: 1px solid var(--border); border-radius: 7px; color: var(--text); font-size: 13px; font-family: 'Noto Sans KR', sans-serif; outline: none; transition: border-color 0.2s; width: 100%; }
  .form-group input:focus, .form-group textarea:focus, .form-group select:focus { border-color: var(--accent); }
  .form-group select option { background: var(--surface); }
  .form-group textarea { resize: vertical; min-height: 68px; }
  .modal-actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: 18px; }

  /* Detail view */
  .detail-view { display: none; padding: 24px 28px; }
  .detail-view.open { display: block; }
  .detail-header { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 22px; margin-bottom: 16px; display: flex; align-items: center; gap: 18px; flex-wrap: wrap; }
  .detail-avatar { width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700; color: #fff; flex-shrink: 0; }
  .detail-name { font-size: 20px; font-weight: 700; }
  .detail-sub { font-size: 13px; color: var(--muted); margin-top: 3px; }
  .detail-actions { margin-left: auto; display: flex; gap: 7px; flex-wrap: wrap; }
  .info-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 16px; }
  .info-grid .info-card.wide { grid-column: span 2; }
  .info-grid .info-card.full { grid-column: 1 / -1; }
  .info-card { background: var(--surface); border: 1px solid var(--border); border-radius: 9px; padding: 12px; }
  .info-card-label { font-size: 10px; color: var(--muted); font-family: 'IBM Plex Mono', monospace; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px; }
  .info-card-value { font-size: 13px; }
  .acts-section { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 18px; }
  .acts-head { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
  .acts-title { font-size: 14px; font-weight: 600; }
  .empty-state { text-align: center; padding: 36px 20px; color: var(--muted); }
  .empty-icon { font-size: 36px; margin-bottom: 10px; }

  /* List view */
  .list-wrap { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
  .list-table { width: 100%; border-collapse: collapse; }
  .list-table th { text-align: left; padding: 9px 13px; font-size: 10px; color: var(--muted); font-family: 'IBM Plex Mono', monospace; text-transform: uppercase; border-bottom: 1px solid var(--border); background: var(--surface2); white-space: nowrap; }
  .list-table td { padding: 10px 13px; font-size: 13px; border-bottom: 1px solid var(--border); vertical-align: middle; }
  .list-table tr:last-child td { border-bottom: none; }
  .list-table tbody tr:not(.co-row):hover td { background: var(--surface2); }
  .co-row td { background: rgba(79,124,255,0.06); font-weight: 600; font-size: 13px; cursor: pointer; }
  .co-row:hover td { background: rgba(79,124,255,0.12) !important; }

  ::-webkit-scrollbar { width: 5px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

  /* Company tabs */
  .co-tabs { display:flex; gap:4px; margin-bottom:20px; border-bottom:1px solid var(--border); padding-bottom:0; }
  .co-tab { padding:8px 18px; border:none; background:transparent; color:var(--muted); font-family:'Noto Sans KR',sans-serif; font-size:13px; cursor:pointer; border-bottom:2px solid transparent; margin-bottom:-1px; transition:all 0.15s; }
  .co-tab:hover { color:var(--text); }
  .co-tab.active { color:var(--accent); border-bottom-color:var(--accent); font-weight:600; }
  .co-panel { }

  /* Finance table */
  .fin-table { width:100%; border-collapse:collapse; font-size:13px; }
  .fin-table th { text-align:center; padding:8px 6px; font-size:10px; color:var(--muted); font-family:IBM Plex Mono,monospace; text-transform:uppercase; border-bottom:1px solid var(--border); background:var(--surface2); white-space:nowrap; }
  .fin-table td { padding:5px 4px; border-bottom:1px solid var(--border); vertical-align:middle; }
  .fin-table tr:last-child td { border-bottom:none; }
  .fin-input { width:100%; padding:5px 7px; background:var(--bg); border:1px solid var(--border); border-radius:5px; color:var(--text); font-size:12px; font-family:IBM Plex Mono,monospace; outline:none; text-align:right; }
  .fin-input:focus { border-color:var(--accent); }
  .fin-year { width:72px; padding:5px 7px; background:var(--bg); border:1px solid var(--border); border-radius:5px; color:var(--accent); font-size:12px; font-family:IBM Plex Mono,monospace; outline:none; text-align:center; font-weight:600; }
  .fin-year:focus { border-color:var(--accent); }
  .fin-del { background:none; border:none; color:var(--muted); cursor:pointer; font-size:14px; padding:2px 6px; border-radius:4px; transition:all 0.1s; }
  .fin-del:hover { background:var(--danger); color:#fff; }

  /* CEO history */
  .ceo-row { display:grid; grid-template-columns:100px 1fr 1fr 1fr 32px; gap:8px; align-items:center; margin-bottom:8px; }
  .ceo-input { padding:7px 9px; background:var(--bg); border:1px solid var(--border); border-radius:6px; color:var(--text); font-size:13px; font-family:'Noto Sans KR',sans-serif; outline:none; width:100%; }
  .ceo-input:focus { border-color:var(--accent); }
  .ceo-del { background:none; border:none; color:var(--muted); cursor:pointer; font-size:14px; padding:4px 6px; border-radius:4px; transition:all 0.1s; width:32px; }
  .ceo-del:hover { background:var(--danger); color:#fff; }
  .ceo-header { display:grid; grid-template-columns:100px 1fr 1fr 1fr 32px; gap:8px; margin-bottom:6px; font-size:10px; color:var(--muted); font-family:IBM Plex Mono,monospace; text-transform:uppercase; }

  /* Finance summary in company card */
  .fin-summary { padding:0 18px; background:rgba(67,233,123,0.04); border-bottom:1px solid var(--border); display:flex; gap:0; flex-wrap:nowrap; font-size:12px; align-items:stretch; overflow:hidden; }
  .fin-summary-preview { display:flex; align-items:center; gap:0; flex:1; overflow:hidden; cursor:pointer; padding:7px 0; }
  .fin-summary-preview:hover { opacity:.8; }
  .fin-summary-preview:hover ~ .fin-expand-btn, .fin-summary:hover .fin-expand-btn { opacity:1; }
  .fin-chip { display:flex; align-items:center; gap:4px; padding:0 10px; border-right:1px solid var(--border); white-space:nowrap; flex-shrink:0; }
  .fin-chip:first-child { padding-left:0; }
  .fin-chip-label { font-size:10px; color:var(--muted); font-family:IBM Plex Mono,monospace; }
  .fin-chip-value { font-size:12px; font-weight:600; font-family:IBM Plex Mono,monospace; }
  .fin-chip-value.pos { color:var(--accent3); }
  .fin-chip-value.neg { color:var(--accent2); }
  .fin-chip-value.neu { color:var(--text); }
  .fin-expand-btn { padding:0 14px; background:none; border:none; color:var(--muted); cursor:pointer; font-size:11px; font-family:IBM Plex Mono,monospace; border-left:1px solid var(--border); white-space:nowrap; flex-shrink:0; transition:all 0.15s; }
  .fin-expand-btn:hover { color:var(--accent3); background:rgba(67,233,123,0.08); }
  .fin-detail { display:none; padding:10px 18px; border-bottom:1px solid var(--border); background:rgba(67,233,123,0.02); }
  .fin-detail.open { display:block; }
  .fin-table { width:100%; border-collapse:collapse; font-size:12px; font-family:IBM Plex Mono,monospace; }
  .fin-table th { font-size:10px; color:var(--muted); font-weight:500; padding:4px 8px; text-align:right; border-bottom:1px solid var(--border); }
  .fin-table th:first-child { text-align:left; }
  .fin-table td { padding:5px 8px; text-align:right; border-bottom:1px solid rgba(45,50,80,0.5); }
  .fin-table td:first-child { text-align:left; color:var(--accent); font-weight:600; }
  /* CEO expandable */
  .ceo-bar { padding:6px 18px; border-bottom:1px solid var(--border); display:flex; align-items:center; gap:10px; font-size:12px; color:var(--muted); background:rgba(79,124,255,0.03); cursor:pointer; user-select:none; transition:background 0.15s; }
  .ceo-bar:hover { background:rgba(79,124,255,0.10); }
  .ceo-bar-name { color:var(--text); font-weight:600; }
  .ceo-bar-arrow { margin-left:auto; font-size:11px; color:var(--muted); transition:transform 0.2s; display:inline-block; }
  .ceo-bar.open .ceo-bar-arrow { transform: rotate(180deg); }
  .ceo-detail { display:none; padding:8px 18px; border-bottom:1px solid var(--border); background:rgba(79,124,255,0.02); }
  .ceo-detail.open { display:block; }
  .ceo-row-item { display:flex; gap:10px; font-size:12px; padding:4px 0; border-bottom:1px solid rgba(45,50,80,0.4); align-items:center; }
  .ceo-row-item:last-child { border-bottom:none; }
  .ceo-row-name { font-weight:600; color:var(--text); min-width:80px; }
  .ceo-row-period { color:var(--accent); font-family:IBM Plex Mono,monospace; font-size:11px; }
  .ceo-row-memo { color:var(--muted); font-size:11px; flex:1; }

  /* PDF Import */
  .pdf-dropzone {
    border: 2px dashed var(--border); border-radius: 10px; padding: 36px 20px;
    text-align: center; cursor: pointer; transition: all 0.2s;
  }
  .pdf-dropzone:hover, .pdf-dropzone.drag { border-color: var(--accent); background: rgba(79,124,255,0.05); }
  .pdf-drop-icon { font-size: 36px; margin-bottom: 10px; }
  .pdf-drop-text { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
  .pdf-drop-sub { font-size: 12px; color: var(--muted); }
  .pdf-spinner {
    width: 44px; height: 44px; border: 3px solid var(--border);
    border-top-color: var(--accent); border-radius: 50%;
    animation: spin 0.8s linear infinite; margin: 0 auto;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .pdf-contact-card {
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 10px; padding: 14px 16px; margin-bottom: 10px;
  }
  .pdf-contact-card.checked { border-color: var(--accent); }
  .pdf-card-header { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
  .pdf-card-check { width: 18px; height: 18px; accent-color: var(--accent); cursor: pointer; flex-shrink: 0; }
  .pdf-card-name { font-size: 14px; font-weight: 700; flex: 1; }
  .pdf-fields { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  .pdf-field { display: flex; flex-direction: column; gap: 3px; }
  .pdf-field label { font-size: 10px; color: var(--muted); font-family: 'IBM Plex Mono', monospace; text-transform: uppercase; }
  .pdf-field input { padding: 6px 9px; background: var(--bg); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-size: 12px; font-family: 'Noto Sans KR', sans-serif; outline: none; }
  .pdf-field input:focus { border-color: var(--accent); }
  .pdf-field.full { grid-column: 1 / -1; }

  /* â”€â”€ PIN LOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #pinOverlay {
    position: fixed; top:0;right:0;bottom:0;left:0; z-index: 99000;
    background: var(--bg);
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    padding: 24px;
    transition: opacity 0.35s;
  }
  #pinOverlay.hiding { opacity: 0; pointer-events: none; }
  #pinOverlay.hidden { display: none; }

  .pin-logo {
    font-size: 22px; font-weight: 700; color: var(--accent);
    letter-spacing: -0.5px; margin-bottom: 6px;
  }
  .pin-subtitle {
    font-size: 12px; color: var(--muted); margin-bottom: 32px;
    font-family: 'IBM Plex Mono', monospace;
  }
  .pin-dots {
    display: flex; gap: 14px; margin-bottom: 32px;
  }
  .pin-dot {
    width: 16px; height: 16px; border-radius: 50%;
    border: 2px solid var(--border);
    background: transparent;
    transition: background 0.15s, border-color 0.15s, transform 0.12s;
  }
  .pin-dot.filled {
    background: var(--accent);
    border-color: var(--accent);
    transform: scale(1.15);
  }
  .pin-dot.error {
    background: var(--accent2);
    border-color: var(--accent2);
    animation: pinShake 0.4s ease;
  }
  @keyframes pinShake {
    0%,100%{ transform: translateX(0); }
    20%{ transform: translateX(-6px); }
    40%{ transform: translateX(6px); }
    60%{ transform: translateX(-4px); }
    80%{ transform: translateX(4px); }
  }
  .pin-pad {
    display: grid; grid-template-columns: repeat(3, 72px);
    gap: 12px; margin-bottom: 20px;
  }
  .pin-btn {
    width: 72px; height: 72px; border-radius: 50%;
    background: var(--surface); border: 1px solid var(--border);
    color: var(--text); font-size: 22px; font-weight: 600;
    cursor: pointer; transition: background 0.12s, transform 0.1s;
    display: flex; align-items: center; justify-content: center;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
  }
  .pin-btn:active { background: var(--surface2); transform: scale(0.93); }
  .pin-btn.del { font-size: 18px; color: var(--muted); }
  .pin-btn.empty { background: transparent; border-color: transparent; pointer-events: none; }
  .pin-msg {
    height: 20px; font-size: 12px; text-align: center;
    font-family: 'IBM Plex Mono', monospace;
    transition: color 0.2s;
  }
  .pin-msg.ok  { color: var(--accent3); }
  .pin-msg.err { color: var(--accent2); }
  .pin-msg.warn{ color: var(--accent4); }
  .pin-locked-msg {
    font-size: 13px; color: var(--accent2); text-align: center;
    font-family: 'IBM Plex Mono', monospace; line-height: 1.7;
  }
  .pin-link {
    font-size: 11px; color: var(--muted); text-decoration: underline;
    cursor: pointer; margin-top: 16px; font-family: 'IBM Plex Mono', monospace;
  }
  .pin-link:hover { color: var(--accent); }

  /* ì‚¬ì´ë“œë°” PIN ì„¤ì • ë²„íŠ¼ */
  .pin-setting-row {
    display: flex; align-items: center; justify-content: space-between;
    padding: 7px 4px; font-size: 11px; color: var(--muted);
    font-family: 'IBM Plex Mono', monospace;
  }
  .pin-toggle {
    width: 34px; height: 18px; border-radius: 9px;
    background: var(--border); border: none; cursor: pointer;
    position: relative; transition: background 0.2s; flex-shrink: 0;
  }
  .pin-toggle::after {
    content:''; position:absolute; width:12px; height:12px;
    border-radius: 50%; background: #fff; top: 3px; left: 3px;
    transition: transform 0.2s;
  }
  .pin-toggle.on { background: var(--accent); }
  .pin-toggle.on::after { transform: translateX(16px); }


  /* â”€â”€ ë¡œê·¸ì¸ í™”ë©´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #loginOverlay {
    position: fixed; top:0;right:0;bottom:0;left:0; background: var(--bg);
    display: flex; align-items: center; justify-content: center;
    z-index: 10000;
  }
  #loginOverlay.hidden { display: none; }
  .login-card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 20px; padding: 40px 36px; width: 360px;
    box-shadow: 0 24px 60px rgba(0,0,0,0.5);
  }
  .login-logo { font-size: 22px; font-weight: 700; color: var(--accent); margin-bottom: 4px; }
  .login-sub  { font-size: 11px; color: var(--muted); font-family: 'IBM Plex Mono',monospace; margin-bottom: 28px; }
  .login-field { margin-bottom: 14px; }
  .login-field label { display:block; font-size:11px; color:var(--muted); font-family:IBM Plex Mono,monospace; margin-bottom:5px; text-transform:uppercase; letter-spacing:.5px; }
  .login-input {
    width:100%; padding:11px 14px; background:var(--bg);
    border:1px solid var(--border); border-radius:8px;
    color:var(--text); font-size:14px; font-family:'Noto Sans KR',sans-serif;
    outline:none; transition:border-color .2s;
  }
  .login-input:focus { border-color:var(--accent); }
  .login-btn {
    width:100%; padding:12px; background:var(--accent);
    border:none; border-radius:10px; color:#fff;
    font-size:15px; font-weight:600; font-family:'Noto Sans KR',sans-serif;
    cursor:pointer; margin-top:8px; transition:opacity .15s;
  }
  .login-btn:hover { opacity:.85; }
  .login-btn:disabled { opacity:.4; cursor:not-allowed; }
  .login-msg { font-size:12px; text-align:center; margin-top:12px; min-height:18px; color:var(--accent2); }
  .login-msg.ok { color:var(--accent3); }
  /* ì‚¬ì´ë“œë°” ì‚¬ìš©ì ë°” */
  .login-user-bar {
    display:flex; align-items:center; gap:8px;
    padding:7px 12px; background:rgba(79,124,255,.1);
    border-radius:8px; margin:0 10px 6px; font-size:12px;
  }
  .login-user-avatar {
    width:26px; height:26px; border-radius:50%;
    display:flex; align-items:center; justify-content:center;
    font-size:11px; font-weight:700; color:#fff; flex-shrink:0;
  }
  /* ì‚¬ìš©ì ê´€ë¦¬ ëª¨ë‹¬ */
  .user-row {
    display:grid; grid-template-columns:30px 1fr 72px 62px 38px 38px;
    gap:8px; align-items:center; padding:9px 0;
    border-bottom:1px solid var(--border); font-size:13px;
  }
  .user-row:last-child { border-bottom:none; }
  .user-av {
    width:28px; height:28px; border-radius:50%;
    display:flex; align-items:center; justify-content:center;
    font-size:11px; font-weight:700; color:#fff;
  }
  .role-badge { font-size:10px; padding:2px 7px; border-radius:10px; font-family:IBM Plex Mono,monospace; text-align:center; }
  .role-badge.admin { background:rgba(79,124,255,.2); color:var(--accent); }
  .role-badge.user  { background:rgba(121,134,203,.15); color:var(--muted); }
  /* í™œë™ ì…ë ¥ì */
  .tl-creator { font-size:10px; color:var(--muted); font-family:IBM Plex Mono,monospace; margin-top:3px; }


  @keyframes slideUp {
    from { transform: translateY(100%); }
    to   { transform: translateY(0); }
  }
</style>
</head>
<body>

<!-- â”€â”€ ëª¨ë°”ì¼ í—¤ë” â”€â”€ -->
<header class="mobile-header">
  <h1>â–¸ CRM</h1>
  <div style="display:flex;gap:6px;margin-left:auto;align-items:center">
    <button class="btn btn-outline btn-sm" onclick="openPdfModal()" style="padding:5px 8px;font-size:12px">ğŸ—‚</button>
    <button class="btn btn-primary btn-sm" onclick="openAddContact(null)" style="padding:5px 10px;font-size:12px">ï¼‹</button>
  </div>
</header>

<aside class="sidebar">
  <div class="logo">
    <h1 style="font-size:20px;letter-spacing:-0.5px">â–¸ Rela<span style="color:var(--text);font-weight:400">CRM</span></h1>
    <span><span data-i18n="ìŠ¤ë§ˆíŠ¸ ê³ ê°ê´€ë¦¬ ì‹œìŠ¤í…œ">ìŠ¤ë§ˆíŠ¸ ê³ ê°ê´€ë¦¬ ì‹œìŠ¤í…œ</span></span>
  </div>
  <button class="sidebar-btn active" id="navContacts" onclick="nav('contacts')"><span>ğŸ¢</span> <span data-i18n="ì—°ë½ì²˜">ì—°ë½ì²˜</span> <span class="today-badge" id="todayContacts" style="display:none"></span></button>
  <button class="sidebar-btn" id="navActivities" onclick="nav('activities')"><span>ğŸ“‹</span> <span data-i18n="ì „ì²´ í™œë™">ì „ì²´ í™œë™</span> <span class="today-badge" id="todayActivities" style="display:none"></span></button>
  <button class="sidebar-btn" id="navAdmin" onclick="nav('admin')" style="display:none"><span>ğŸ“Š</span> <span data-i18n="ì…ë ¥ì í˜„í™©">ì…ë ¥ì í˜„í™©</span></button>
  <button class="sidebar-btn" onclick="openTypeModal()"><span>ğŸ·</span> <span data-i18n="í™œë™ ìœ í˜• ê´€ë¦¬">í™œë™ ìœ í˜• ê´€ë¦¬</span></button>
  <button class="sidebar-btn" onclick="openGsModal()"><span>ğŸ—„</span> <span data-i18n="Supabase ì—°ë™">Supabase ì—°ë™</span></button>
  <div id="gsSyncStatus" style="font-size:10px;padding:6px 20px;color:var(--muted);font-family:IBM Plex Mono,monospace;line-height:1.5"></div>
  <div style="margin-top:auto;padding:12px 16px 16px;border-top:1px solid var(--border)">
    <div class="sidebar-stats" id="sidebarStats"></div>
    <div style="border-top:1px solid var(--border);margin:8px 0 10px;opacity:.4"></div>
    <button class="sidebar-btn" onclick="openHelpModal()" style="font-size:11px;color:var(--muted)"><span>â“</span> <span data-i18n="ì‚¬ìš© ê°€ì´ë“œ">ì‚¬ìš© ê°€ì´ë“œ</span></button>
    <button class="sidebar-btn" onclick="openLicenseModal()" style="font-size:11px;color:var(--muted)"><span>ğŸ“„</span> <span data-i18n="ë¼ì´ì„ ìŠ¤ ì •ë³´">ë¼ì´ì„ ìŠ¤ ì •ë³´</span></button>
    <div class="pin-setting-row">
      <span>ğŸ” <span data-i18n="PIN ì ê¸ˆ">PIN ì ê¸ˆ</span></span>
      <button class="pin-toggle" id="pinToggleBtn" onclick="openPinSetup()" title="PIN ì„¤ì •/ë³€ê²½"></button>
    </div>
    <!-- ë¡œê·¸ì¸ ì‚¬ìš©ì í‘œì‹œ -->
    <div class="login-user-bar" id="loginUserBar" style="display:none"></div>
    <button class="sidebar-btn" id="userMgmtBtn" onclick="openUserMgmt()" style="display:none;font-size:12px;color:var(--accent)"><span>ğŸ‘¥</span> <span data-i18n="ì‚¬ìš©ì ê´€ë¦¬">ì‚¬ìš©ì ê´€ë¦¬</span></button>
    <div style="font-size:10px;color:var(--border);text-align:center;margin-top:8px;font-family:IBM Plex Mono,monospace">RelaCRM v1.0</div>
    <div style="margin-top:10px;border-top:1px solid var(--border);padding-top:10px">
      <select id="langSelect" onchange="setLang(this.value)"
        style="width:100%;background:var(--surface2);border:1px solid var(--border);color:var(--muted);
               font-size:11px;padding:5px 8px;border-radius:6px;cursor:pointer;outline:none;font-family:IBM Plex Mono,monospace">
        <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
        <option value="en">ğŸ‡ºğŸ‡¸ English</option>
        <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
        <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
      </select>
    </div>
  </div>
</aside>

<main class="main">
  <div class="topbar" id="mainTopbar">
    <div class="search-wrap">
      <span class="search-icon">ğŸ”</span>
      <input type="text" id="searchInput" placeholder="ì´ë¦„, íšŒì‚¬ ê²€ìƒ‰..." data-i18n-placeholder="ì´ë¦„, íšŒì‚¬ ê²€ìƒ‰..." oninput="_debouncedRender()">
    </div>
    <div class="view-toggle">
      <button class="toggle-btn active" id="vBtn-group" title="íšŒì‚¬ë³„ ì¹´ë“œ" onclick="setViewMode('group')">âŠ</button>
      <button class="toggle-btn" id="vBtn-glist" title="íšŒì‚¬ë³„ ëª©ë¡" onclick="setViewMode('glist')">â–¤</button>
      <button class="toggle-btn" id="vBtn-list" title="ì „ì²´ ëª©ë¡" onclick="setViewMode('list')">â˜°</button>
    </div>
    <button class="btn btn-outline pc-only" onclick="openPdfModal()" title="íŒŒì¼ì—ì„œ ì—°ë½ì²˜ ìë™ ì¶”ì¶œ">ğŸ—‚ <span data-i18n="íŒŒì¼ ê°€ì ¸ì˜¤ê¸°">íŒŒì¼ ê°€ì ¸ì˜¤ê¸°</span></button>
    <button class="btn btn-primary pc-only" onclick="openAddContact(null)">ï¼‹ <span data-i18n="ì—°ë½ì²˜">ì—°ë½ì²˜</span></button>
  </div>

  <!-- Contacts View -->
  <div class="content" id="contactsView">
    <div class="section-title" data-i18n="ì—°ë½ì²˜">ì—°ë½ì²˜</div>
    <div class="section-sub" id="viewSub"></div>
    <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:14px">
      <div class="filter-bar" id="teamFilterBar"></div>
    </div>
    <div id="mainGrid"></div>
  </div>

  <!-- Detail View -->
  <div id="detailView" class="detail-view">
    <div style="display:flex;gap:8px;margin-bottom:14px">
      <button class="btn btn-outline btn-sm" onclick="backToList()"><span data-i18n="â† ëª©ë¡ìœ¼ë¡œ">â† ëª©ë¡ìœ¼ë¡œ</span></button>
      <button class="btn btn-outline btn-sm" id="detailCoBtn" style="display:none">ğŸ¢ <span data-i18n="íšŒì‚¬ ë³´ê¸°">íšŒì‚¬ ë³´ê¸°</span></button>
    </div>
    <div id="detailContent"></div>
  </div>

  <!-- Activities View -->
  <div id="activitiesView" style="display:none">
    <div class="section-title" data-i18n="ì „ì²´ í™œë™">ì „ì²´ í™œë™</div>
    <div class="section-sub" id="actsSub" data-i18n="ëª¨ë“  í™œë™ ë‚´ì—­"></div>
    <div style="display:flex;flex-direction:column;gap:6px;margin-bottom:16px">
      <div class="filter-bar" id="actFilterBar" style="margin-bottom:0"></div>
      <div class="filter-bar" id="actTeamFilterBar" style="margin-bottom:0"></div>
    </div>
    <div id="allActsContent"></div>
  </div>

  <!-- ê´€ë¦¬ì ì „ìš©: ì…ë ¥ì í˜„í™© ë·° -->
  <div id="adminView" style="display:none">
    <div class="content" style="max-width:900px">
      <div class="section-title" style="display:flex;align-items:center;gap:10px;margin-bottom:20px">
        <span>ğŸ‘‘ ì…ë ¥ì í˜„í™©</span>
        <span style="font-size:12px;color:var(--muted);font-weight:400">íŒ€ì›ë³„ ì…ë ¥ í†µê³„</span>
        <button onclick="renderAdminView()" style="margin-left:auto;background:none;border:1px solid var(--border);border-radius:6px;padding:4px 10px;color:var(--muted);cursor:pointer;font-size:12px">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
      </div>
  
      <!-- ìš”ì•½ ì¹´ë“œ -->
      <div id="adminStatCards" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-bottom:24px"></div>
  
      <!-- íŒ€ì›ë³„ ìƒì„¸ í…Œì´ë¸” -->
      <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;overflow:hidden">
        <div style="padding:14px 18px;border-bottom:1px solid var(--border);font-size:13px;font-weight:600;display:flex;align-items:center;gap:8px">
          <span>íŒ€ì›ë³„ ì…ë ¥ í˜„í™©</span>
          <span id="adminTablePeriod" style="font-size:11px;color:var(--muted);font-weight:400"></span>
        </div>
        <div id="adminUserTable" style="overflow-x:auto"></div>
      </div>
  
      <!-- ìµœê·¼ ì…ë ¥ í™œë™ ëª©ë¡ -->
      <div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;overflow:hidden;margin-top:16px">
        <div style="padding:14px 18px;border-bottom:1px solid var(--border);font-size:13px;font-weight:600;display:flex;align-items:center;gap:8px">
          <span>ìµœê·¼ ì…ë ¥ í™œë™</span>
          <select id="adminFilterUser" onchange="renderAdminView()" style="margin-left:auto;background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:4px 8px;border-radius:6px;font-size:12px;outline:none">
            <option value="">ì „ì²´ íŒ€ì›</option>
          </select>
        </div>
        <div id="adminRecentList" style="padding:12px"></div>
      </div>
    </div>
  </div>
  <nav class="mobile-tabbar">
    <button class="mobile-tab active" id="mTabContacts" onclick="nav('contacts')">
      <span class="tab-icon">ğŸ¢</span>
      <span data-i18n="ì—°ë½ì²˜">ì—°ë½ì²˜</span>
      <span class="today-badge" id="mTodayContacts" style="display:none"></span>
    </button>
    <button class="mobile-tab" id="mTabActivities" onclick="nav('activities')">
      <span class="tab-icon">ğŸ“‹</span>
      <span data-i18n="ì „ì²´ í™œë™">í™œë™</span>
      <span class="today-badge" id="mTodayActivities" style="display:none"></span>
    </button>
    <button class="mobile-tab" id="mTabImport" onclick="openPdfModal()">
      <span class="tab-icon">ğŸ—‚</span>
      <span data-i18n="íŒŒì¼ ê°€ì ¸ì˜¤ê¸°">ê°€ì ¸ì˜¤ê¸°</span>
    </button>
    <button class="mobile-tab" id="mTabGs" onclick="openGsModal()">
      <span class="tab-icon" id="mTabGsIcon">ğŸ—„</span>
      <span data-i18n="Supabase ì—°ë™">ì—°ë™ì„¤ì •</span>
    </button>
    <button class="mobile-tab" id="mTabUser" onclick="_mobileUserMenu()">
      <span class="tab-icon" id="mTabUserIcon">ğŸ‘¤</span>
      <span id="mTabUserLabel" data-i18n="ê³„ì •">ê³„ì •</span>
    </button>
  </nav>
  
  <!-- Contact Modal -->
  <div class="modal-overlay" id="contactModal">
    <div class="modal">
      <button class="modal-close" onclick="closeModal('contactModal')">âœ•</button>
      <div class="modal-title" id="cModalTitle" data-i18n="ìƒˆ ì—°ë½ì²˜">ìƒˆ ì—°ë½ì²˜</div>
      <div class="form-section">
        <div class="form-section-title" data-i18n="ì†Œì† íšŒì‚¬">ì†Œì† íšŒì‚¬</div>
        <div class="form-row single">
          <div class="form-group">
            <label data-i18n="íšŒì‚¬ëª… ë¼ë²¨">íšŒì‚¬ëª… (ê°™ì€ íšŒì‚¬ ì§ì›ì€ ë™ì¼ ì´ë¦„ ì…ë ¥)</label>
            <input type="text" id="f_company" placeholder="(ì£¼)ì˜ˆì‹œê¸°ì—…" list="coSuggestions" oninput="onCompanyInput()">
            <datalist id="coSuggestions"></datalist>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group"><label data-i18n='ë¶€ì„œ'>ë¶€ì„œ</label><input type="text" id="f_dept" placeholder="ì˜ì—…íŒ€"></div>
          <div class="form-group"><label data-i18n='ì§ì±…'>ì§ì±…</label><input type="text" id="f_position" placeholder="ê³¼ì¥"></div>
        </div>
      </div>
      <div class="form-section">
        <div class="form-section-title" data-i18n="ê°œì¸ ì •ë³´">ê°œì¸ ì •ë³´</div>
        <div class="form-row">
          <div class="form-group"><label data-i18n="ì„± *">ì„± *</label><input type="text" id="f_last" placeholder="ê¹€"></div>
          <div class="form-group"><label data-i18n="ì´ë¦„ *">ì´ë¦„ *</label><input type="text" id="f_first" placeholder="ì² ìˆ˜"></div>
        </div>
        <div class="form-row single">
          <div class="form-group"><label data-i18n='ì´ë©”ì¼'>ì´ë©”ì¼</label><input type="email" id="f_email" placeholder="example@email.com"></div>
        </div>
      </div>
      <div class="form-section">
        <div class="form-section-title" data-i18n="ê°œì¸ ì—°ë½ì²˜">ê°œì¸ ì—°ë½ì²˜</div>
        <div class="form-row three">
          <div class="form-group"><label data-i18n='ì‚¬ë¬´ì‹¤'>ì‚¬ë¬´ì‹¤</label><input type="tel" id="f_office" placeholder="02-0000-0000"></div>
          <div class="form-group"><label data-i18n='íœ´ëŒ€í°'>íœ´ëŒ€í°</label><input type="tel" id="f_mobile" placeholder="010-0000-0000"></div>
          <div class="form-group"><label data-i18n="ì¶”ê°€ì—°ë½ì²˜">ì¶”ê°€</label><input type="tel" id="f_extra" placeholder="íŒ©ìŠ¤ ë“±"></div>
        </div>
      </div>
      <div class="form-section">
        <div class="form-section-title" data-i18n="ì£¼ì†Œ (íšŒì‚¬ ê³µìœ )">ì£¼ì†Œ (íšŒì‚¬ ê³µìœ )</div>
        <div id="addrNotice" style="font-size:11px;color:var(--accent);margin-bottom:7px;display:none" data-i18n="ì£¼ì†Œ ì•ˆë‚´">â„¹ ë“±ë¡ëœ íšŒì‚¬ ì£¼ì†Œê°€ ì ìš©ë©ë‹ˆë‹¤. ë³€ê²½í•˜ë©´ íšŒì‚¬ ì „ì²´ì— ë°˜ì˜ë©ë‹ˆë‹¤.</div>
        <div class="form-row single">
          <div class="form-group"><label data-i18n='ì£¼ì†Œ'>ì£¼ì†Œ</label><input type="text" id="f_address" placeholder="ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123"></div>
        </div>
      </div>
      <div class="form-section">
        <div class="form-section-title" data-i18n="ë©”ëª¨">ë©”ëª¨</div>
        <div class="form-row single">
          <div class="form-group"><textarea id="f_memo" placeholder="íŠ¹ì´ì‚¬í•­, ê´€ê³„ ë“±"></textarea></div>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-outline" onclick="closeModal('contactModal')"><span data-i18n="ì·¨ì†Œ">ì·¨ì†Œ</span></button>
        <button class="btn btn-primary" onclick="saveContact()"><span data-i18n="ì €ì¥">ì €ì¥</span></button>
      </div>
    </div>
  </div>
  
  <!-- Company Modal -->
  <div class="modal-overlay" id="companyModal">
    <div class="modal" style="width:680px">
      <button class="modal-close" onclick="closeModal('companyModal')">âœ•</button>
      <div class="modal-title" id="coModalTitle" data-i18n="íšŒì‚¬ ì •ë³´">íšŒì‚¬ ì •ë³´</div>
  
      <!-- íƒ­ -->
      <div class="co-tabs">
        <button class="co-tab active" id="coTab-basic" onclick="switchCoTab('basic')" data-i18n="ê¸°ë³¸ ì •ë³´">ê¸°ë³¸ ì •ë³´</button>
        <button class="co-tab" id="coTab-finance" onclick="switchCoTab('finance')" data-i18n="ì¬ë¬´ í˜„í™©">ì¬ë¬´ í˜„í™©</button>
        <button class="co-tab" id="coTab-ceo" onclick="switchCoTab('ceo')" data-i18n="ëŒ€í‘œì´ì‚¬ ì´ë ¥">ëŒ€í‘œì´ì‚¬ ì´ë ¥</button>
      </div>
  
      <!-- íƒ­: ê¸°ë³¸ ì •ë³´ -->
      <div id="coPanel-basic" class="co-panel">
        <div class="form-section">
          <div class="form-section-title" data-i18n="íšŒì‚¬ëª…">íšŒì‚¬ëª…</div>
          <div class="form-row single">
            <div class="form-group">
              <label data-i18n="íšŒì‚¬ëª… ìˆ˜ì • ë¼ë²¨">íšŒì‚¬ëª… (ìˆ˜ì • ì‹œ ì†Œì† ì§ì› ì „ì²´ì— ìë™ ë°˜ì˜)</label>
              <input type="text" id="co_name" placeholder="íšŒì‚¬ëª…">
            </div>
          </div>
        </div>
        <div class="form-section">
          <div class="form-section-title" data-i18n="ìš°ë¦¬ íŒ€ ë‹´ë‹¹ì">ìš°ë¦¬ íŒ€ ë‹´ë‹¹ì</div>
          <p style="font-size:11px;color:var(--muted);margin-bottom:8px;line-height:1.6" data-i18n="ìš°ë¦¬íŒ€ ì„¤ëª…">ì´ íšŒì‚¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” ìš°ë¦¬ íŒ€ ì •ë³´ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤.</p>
          <div class="form-row">
            <div class="form-group"><label data-i18n="íŒ€ëª…">íŒ€ëª…</label><input type="text" id="co_our_team" placeholder="ì˜ì—…1íŒ€" data-i18n-placeholder="íŒ€ëª… placeholder"></div>
            <div class="form-group"><label data-i18n="ë‹´ë‹¹ì ì´ë¦„">ë‹´ë‹¹ì ì´ë¦„</label><input type="text" id="co_our_name" placeholder="í™ê¸¸ë™" data-i18n-placeholder="CEO placeholder ì´ë¦„"></div>
          </div>
          <div class="form-row single">
            <div class="form-group"><label data-i18n='ë©”ëª¨'>ë©”ëª¨</label><input type="text" id="co_our_memo" placeholder="ì£¼ë‹´ë‹¹ì / 2024.01 ì¸ìˆ˜ì¸ê³„"></div>
          </div>
        </div>
  
        <div class="form-section">
          <div class="form-section-title" data-i18n="ë‹¤ë¥¸ íšŒì‚¬ì™€ ë³‘í•©">ë‹¤ë¥¸ íšŒì‚¬ì™€ ë³‘í•©</div>
          <p style="font-size:11px;color:var(--muted);margin-bottom:8px;line-height:1.6" data-i18n="ë³‘í•© ì„¤ëª…">ê°™ì€ íšŒì‚¬ê°€ ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ë“±ë¡ëœ ê²½ìš° ë³‘í•©í•©ë‹ˆë‹¤. ë³‘í•© ëŒ€ìƒì˜ ëª¨ë“  ì§ì›ì´ í˜„ì¬ íšŒì‚¬ë¡œ ì´ë™ë©ë‹ˆë‹¤.</p>
          <div class="form-row single">
            <div class="form-group">
              <label data-i18n="ë³‘í•© ë¼ë²¨">ë³‘í•©í•  íšŒì‚¬ ì„ íƒ (ì—†ì• ê³  ì‹¶ì€ ìª½)</label>
              <select id="co_merge_target" style="background:var(--bg);border:1px solid var(--border);border-radius:7px;color:var(--text);padding:8px 10px;font-size:13px;font-family:inherit;outline:none;width:100%">
                <option value="" data-i18n="ë³‘í•© ì•ˆ í•¨">â€” ë³‘í•© ì•ˆ í•¨ â€”</option>
              </select>
            </div>
          </div>
          <div id="co_merge_preview" style="display:none;font-size:12px;color:var(--accent);margin-top:6px;padding:8px 12px;background:rgba(79,124,255,0.08);border-radius:6px;border:1px solid rgba(79,124,255,0.2)"></div>
        </div>
        <div class="form-section">
          <div class="form-section-title" data-i18n="ëŒ€í‘œ ì—°ë½ì²˜">ëŒ€í‘œ ì—°ë½ì²˜</div>
          <div class="form-row">
            <div class="form-group"><label data-i18n="ëŒ€í‘œ ì „í™”">ëŒ€í‘œ ì „í™”</label><input type="tel" id="co_phone" placeholder="02-0000-0000"></div>
            <div class="form-group"><label data-i18n="íŒ©ìŠ¤">íŒ©ìŠ¤</label><input type="tel" id="co_fax" placeholder="02-0000-0001"></div>
          </div>
        </div>
        <div class="form-section">
          <div class="form-section-title" data-i18n="ì£¼ì†Œ">ì£¼ì†Œ</div>
          <div class="form-row single">
            <div class="form-group"><label data-i18n='ì£¼ì†Œ'>ì£¼ì†Œ</label><input type="text" id="co_address" placeholder="ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123"></div>
          </div>
        </div>
        <div class="form-section">
          <div class="form-section-title" data-i18n="ë©”ëª¨">ë©”ëª¨</div>
          <div class="form-row single">
            <div class="form-group"><textarea id="co_memo" placeholder="íšŒì‚¬ ê´€ë ¨ ë©”ëª¨"></textarea></div>
          </div>
        </div>
      </div>
  
      <!-- íƒ­: ì¬ë¬´ í˜„í™© -->
      <div id="coPanel-finance" class="co-panel" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
          <p style="font-size:12px;color:var(--muted)" data-i18n="ì¬ë¬´ ì•ˆë‚´">ì—°ë„ë³„ ì¬ë¬´ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì„¸ìš”. ë‹¨ìœ„: ë°±ë§Œì›</p>
          <button class="btn btn-primary btn-sm" onclick="addFinanceRow()" data-i18n="ì—°ë„ ì¶”ê°€">ï¼‹ ì—°ë„ ì¶”ê°€</button>
        </div>
        <div style="overflow-x:auto">
          <table class="fin-table" id="finTable">
            <thead>
              <tr>
                <th style="width:80px" data-i18n="ì—°ë„">ì—°ë„</th>
                <th data-i18n="ì¸ì›(ëª…)">ì¸ì›(ëª…)</th>
                <th data-i18n="ë§¤ì¶œ">ë§¤ì¶œ</th>
                <th data-i18n="ì˜ì—…ì´ìµ">ì˜ì—…ì´ìµ</th>
                <th data-i18n="ìˆœì´ìµ">ìˆœì´ìµ</th>
                <th data-i18n="ìì‚°">ìì‚°</th>
                <th data-i18n="ë¶€ì±„">ë¶€ì±„</th>
                <th style="width:36px"></th>
              </tr>
            </thead>
            <tbody id="finBody"></tbody>
          </table>
        </div>
        <p style="font-size:11px;color:var(--muted);margin-top:10px" data-i18n="ì¬ë¬´ ë‹¨ìœ„ ì•ˆë‚´">* ê¸ˆì•¡ ë‹¨ìœ„: ë°±ë§Œì› / ë¹ˆì¹¸ì€ ë¯¸ì…ë ¥ìœ¼ë¡œ ì²˜ë¦¬</p>
      </div>
  
      <!-- íƒ­: ëŒ€í‘œì´ì‚¬ ì´ë ¥ -->
      <div id="coPanel-ceo" class="co-panel" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
          <p style="font-size:12px;color:var(--muted)" data-i18n="CEO ì•ˆë‚´">ëŒ€í‘œì´ì‚¬ ë³€ê²½ ì´ë ¥ì„ ìµœì‹ ìˆœìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
          <button class="btn btn-primary btn-sm" onclick="addCeoRow()" data-i18n="ï¼‹ ì¶”ê°€">ï¼‹ ì¶”ê°€</button>
        </div>
        <div id="ceoList"></div>
      </div>
  
      <div class="modal-actions">
        <button class="btn btn-outline" onclick="closeModal('companyModal')"><span data-i18n="ì·¨ì†Œ">ì·¨ì†Œ</span></button>
        <button class="btn btn-primary" onclick="saveCompany()"><span data-i18n="ì €ì¥">ì €ì¥</span></button>
      </div>
    </div>
  </div>
  
  <!-- Supabase ì—°ë™ Modal -->
  <div class="modal-overlay" id="gsModal">
    <div class="modal" style="width:540px">
      <button class="modal-close" onclick="closeModal('gsModal')">âœ•</button>
      <div class="modal-title" data-i18n="Supabase ì—°ë™ ëª¨ë‹¬">ğŸ—„ Supabase ì—°ë™</div>
  
      <div style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:16px;margin-bottom:16px;font-size:12px;line-height:2.1;color:var(--muted)">
        <div style="font-size:13px;font-weight:700;color:var(--text);margin-bottom:8px">ğŸ“‹ ìµœì´ˆ ì„¤ì • ë°©ë²• (í•œ ë²ˆë§Œ)</div>
        <div><span style="color:var(--accent);font-weight:600">1.</span> <a href="https://supabase.com" target="_blank" style="color:var(--accent)">supabase.com</a> â†’ ë¬´ë£Œ ê°€ì… â†’ ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±</div>
        <div><span style="color:var(--accent);font-weight:600">2.</span> í”„ë¡œì íŠ¸ ëŒ€ì‹œë³´ë“œ â†’ ì™¼ìª½ <b>SQL Editor</b> í´ë¦­</div>
        <div><span style="color:var(--accent);font-weight:600">3.</span> ì•„ë˜ <b>SQL ë³µì‚¬</b> ë²„íŠ¼ í´ë¦­ â†’ ë¶™ì—¬ë„£ê¸° â†’ <b>Run</b></div>
        <div><span style="color:var(--accent);font-weight:600">4.</span> ì™¼ìª½ <b>Project Settings â†’ API</b></div>
        <div><span style="color:var(--accent);font-weight:600">5.</span> <b>Project URL</b> ê³¼ <b>anon public key</b> ë³µì‚¬ í›„ ì•„ë˜ ì…ë ¥</div>
      </div>
  
      <!-- SQL ë³µì‚¬ ë²„íŠ¼ -->
      <div style="margin-bottom:14px">
        <div style="font-size:11px;color:var(--muted);margin-bottom:6px;font-family:IBM Plex Mono,monospace">SQL Editorì— ì‹¤í–‰í•  í…Œì´ë¸” ìƒì„± ì½”ë“œ</div>
        <div style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:10px 12px;font-size:11px;font-family:IBM Plex Mono,monospace;color:var(--muted);line-height:1.7;max-height:120px;overflow-y:auto" id="sbSqlBlock">create table if not exists contacts (id text primary key, company text, dept text, position text, last text, first text, email text, office text, mobile text, extra text, address text, memo text, created_at text);
  create table if not exists activities (id text primary key, contact_id text, type text, date text, title text, content text, amount text, created_at text);
  create table if not exists companies (name text primary key, data text);
  create table if not exists types (id int primary key, data text);
  alter table contacts enable row level security;
  alter table activities enable row level security;
  alter table companies enable row level security;
  alter table types enable row level security;
  create policy "allow all" on contacts for all using (true) with check (true);
  create policy "allow all" on activities for all using (true) with check (true);
  create policy "allow all" on companies for all using (true) with check (true);
  create policy "allow all" on types for all using (true) with check (true);
  -- ê²€ìƒ‰ ì„±ëŠ¥ ì¸ë±ìŠ¤ (3ë§Œëª… ì´ìƒ ê¶Œì¥)
  create index if not exists idx_contacts_company on contacts(company);
  create index if not exists idx_contacts_email on contacts(email);
  create index if not exists idx_activities_contact on activities(contact_id);
  create index if not exists idx_activities_date on activities(date desc);
  -- Realtime í™œì„±í™” (30ëª… ë™ì‹œì ‘ì†)
  alter publication supabase_realtime add table contacts;
  alter publication supabase_realtime add table activities;
  alter publication supabase_realtime add table companies;
  -- ì‚¬ìš©ì ê³„ì • í…Œì´ë¸”
  create table if not exists crm_users (id text primary key, name text unique not null, pw_hash text not null, role text default 'user', is_active boolean default true, last_login text, created_at text);
  alter table crm_users enable row level security;
  create policy "allow all" on crm_users for all using (true) with check (true);
  -- activitiesì— ì…ë ¥ì ì»¬ëŸ¼ ì¶”ê°€
  alter table activities add column if not exists created_by text default '';
  -- contactsì— ì…ë ¥ì ì»¬ëŸ¼ ì¶”ê°€
  alter table contacts add column if not exists created_by text default '';</div>
        <button class="btn btn-outline btn-sm" style="margin-top:6px;width:100%" onclick="
          var _sqlTxt=document.getElementById('sbSqlBlock').textContent;
          if(navigator.clipboard&&window.isSecureContext){
            navigator.clipboard.writeText(_sqlTxt);
          } else {
            var ta=document.createElement('textarea');
            ta.value=_sqlTxt; ta.style.cssText='position:fixed;opacity:0';
            document.body.appendChild(ta); ta.select();
            document.execCommand('copy'); document.body.removeChild(ta);
          }
          this.textContent=i18n('ë³µì‚¬ë¨');
          setTimeout(()=>this.textContent=i18n('SQL ë³µì‚¬'),1500)
        " data-i18n="SQL ë³µì‚¬">ğŸ“‹ SQL ì „ì²´ ë³µì‚¬</button>
      </div>
  
      <!-- URL / Key ì…ë ¥ -->
      <div style="display:grid;gap:10px;margin-bottom:14px">
        <div class="form-group" style="margin:0">
          <label style="font-size:11px;color:var(--muted);margin-bottom:4px;display:block">Project URL</label>
          <input type="text" id="sbUrlInput" placeholder="https://xxxxxxxxxxx.supabase.co"
            style="width:100%;padding:9px 12px;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:12px;font-family:IBM Plex Mono,monospace;outline:none">
        </div>
        <div class="form-group" style="margin:0">
          <label style="font-size:11px;color:var(--muted);margin-bottom:4px;display:block">anon public key</label>
          <div style="position:relative">
            <input type="password" id="sbKeyInput" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
              style="width:100%;padding:9px 38px 9px 12px;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:12px;font-family:IBM Plex Mono,monospace;outline:none">
            <button onclick="const i=document.getElementById('sbKeyInput');i.type=i.type==='password'?'text':'password'"
              style="position:absolute;right:8px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--muted);cursor:pointer">ğŸ‘</button>
          </div>
        </div>
      </div>
  
      <!-- í˜„ì¬ ì—°ë™ ìƒíƒœ -->
      <div id="sbCurrentStatus" style="display:none;background:rgba(67,233,123,0.08);border:1px solid rgba(67,233,123,0.25);border-radius:8px;padding:10px 14px;font-size:12px;margin-bottom:12px">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px">
          <span style="color:var(--accent3);font-weight:600">âœ… í˜„ì¬ ì—°ë™ë¨</span>
          <span class="sb-rt-badge" style="font-size:11px;color:var(--muted)">â—‹ ì‹¤ì‹œê°„ ëŒ€ê¸°</span>
        </div>
        <div id="sbCurrentUrl" style="color:var(--muted);font-family:IBM Plex Mono,monospace;font-size:10px;word-break:break-all"></div>
        <div id="sbLastSyncInfo" style="color:var(--muted);font-size:11px;margin-top:4px"></div>
      </div>
  
      <div id="sbStatusMsg" style="font-size:11px;min-height:16px;margin-bottom:10px;word-break:break-all;line-height:1.6"></div>
  
      <div class="modal-actions" style="flex-wrap:wrap;gap:8px">
        <button class="btn btn-outline btn-sm" onclick="closeModal('gsModal')"><span data-i18n="ë‹«ê¸°">ë‹«ê¸°</span></button>
        <button class="btn btn-outline btn-sm" id="sbDisconnectBtn" style="display:none;color:var(--danger);border-color:var(--danger)" onclick="sbDisconnect()" data-i18n="ì—°ë™ í•´ì œ">ì—°ë™ í•´ì œ</button>
        <button class="btn btn-outline btn-sm" onclick="sbDiagnose()">ğŸ” ì—°ê²° ì§„ë‹¨</button>
        <button class="btn btn-outline btn-sm" onclick="sbManualLoad()">â˜ ì§€ê¸ˆ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <button class="btn btn-primary btn-sm" onclick="sbSaveSettings()">âœ… ì—°ê²° ì €ì¥</button>
      </div>
    </div>
  </div>
  
  <!-- Contact Delete Confirm Modal -->
  <div class="modal-overlay" id="delContactModal">
    <div class="modal" style="width:380px;text-align:center">
      <div style="font-size:40px;margin-bottom:14px">ğŸ—‘</div>
      <div class="modal-title" style="text-align:center;margin-bottom:8px" data-i18n="ì—°ë½ì²˜ ì‚­ì œ">ì—°ë½ì²˜ ì‚­ì œ</div>
      <div id="delContactInfo" style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:14px 16px;margin-bottom:16px;font-size:13px"></div>
      <p style="font-size:12px;color:var(--muted);margin-bottom:20px" data-i18n="ì—°ë½ì²˜ ì‚­ì œ ê²½ê³ ">ì´ ì—°ë½ì²˜ì™€ ê´€ë ¨ í™œë™ì´ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤. ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
      <div style="display:flex;gap:10px;justify-content:center">
        <button class="btn btn-outline" onclick="closeModal('delContactModal')" style="min-width:100px"><span data-i18n="ì·¨ì†Œ">ì·¨ì†Œ</span></button>
        <button class="btn btn-danger" id="delContactConfirmBtn" style="min-width:100px"><span data-i18n="ì‚­ì œ">ì‚­ì œ</span></button>
      </div>
    </div>
  </div>
  
  <!-- Merge Confirm Modal -->
  <div class="modal-overlay" id="mergeConfirmModal">
    <div class="modal" style="width:420px;text-align:center">
      <div style="font-size:40px;margin-bottom:14px">ğŸ”€</div>
      <div class="modal-title" style="text-align:center;margin-bottom:8px" data-i18n="íšŒì‚¬ ë³‘í•©">íšŒì‚¬ ë³‘í•©</div>
      <div id="mergeConfirmInfo" style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:14px 16px;margin-bottom:16px;text-align:left;font-size:13px;line-height:2"></div>
      <p style="font-size:12px;color:var(--muted);margin-bottom:20px" data-i18n="ë³‘í•© ê²½ê³ ">ë³‘í•© í›„ì—ëŠ” ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
      <div style="display:flex;gap:10px;justify-content:center">
        <button class="btn btn-outline" onclick="closeModal('mergeConfirmModal')" style="min-width:100px"><span data-i18n="ì·¨ì†Œ">ì·¨ì†Œ</span></button>
        <button class="btn btn-primary" id="mergeConfirmBtn" style="min-width:100px" data-i18n="ë³‘í•© ì‹¤í–‰">ë³‘í•© ì‹¤í–‰</button>
      </div>
    </div>
  </div>
  
  <!-- Activity Modal -->
  <div class="modal-overlay" id="activityModal">
    <div class="modal" style="width:480px">
      <button class="modal-close" onclick="closeModal('activityModal')">âœ•</button>
      <div class="modal-title" id="actModalTitle" data-i18n="í™œë™ ì¶”ê°€">í™œë™ ì¶”ê°€</div>
      <div class="form-section" id="actWhoSection">
        <div class="form-section-title" data-i18n="ë‹´ë‹¹ì">ë‹´ë‹¹ì</div>
        <div id="actWho" style="font-size:14px;font-weight:600;color:var(--accent);padding:4px 0"></div>
      </div>
      <div class="form-row single">
        <div class="form-group"><label data-i18n="ìœ í˜• *">ìœ í˜• *</label>
          <select id="a_type"></select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group"><label data-i18n="ë‚ ì§œ *">ë‚ ì§œ *</label><input type="date" id="a_date"></div>
        <div class="form-group"><label data-i18n="ê¸ˆì•¡">ê¸ˆì•¡</label><input type="text" id="a_amount" placeholder="â‚©"></div>
      </div>
      <div class="form-row single">
        <div class="form-group"><label data-i18n="ì œëª©">ì œëª©</label><input type="text" id="a_title" placeholder="ê°„ë‹¨í•œ ì œëª©"></div>
      </div>
      <div class="form-row single">
        <div class="form-group"><label data-i18n="ë‚´ìš©">ë‚´ìš©</label><textarea id="a_content" placeholder="ìƒì„¸ ë‚´ìš©"></textarea></div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-outline" onclick="closeModal('activityModal')"><span data-i18n="ì·¨ì†Œ">ì·¨ì†Œ</span></button>
        <button class="btn btn-primary" id="actSaveBtn" onclick="saveActivity()"><span data-i18n="ì €ì¥">ì €ì¥</span></button>
      </div>
    </div>
  </div>
  
  <!-- Type Manager Modal -->
  <div class="modal-overlay" id="typeModal">
    <div class="modal" style="width:480px">
      <button class="modal-close" onclick="closeModal('typeModal')">âœ•</button>
      <div class="modal-title" data-i18n="í™œë™ ìœ í˜• ê´€ë¦¬">í™œë™ ìœ í˜• ê´€ë¦¬</div>
      <p style="font-size:12px;color:var(--muted);margin-bottom:14px;line-height:1.7" data-i18n="ìœ í˜• ê´€ë¦¬ ì•ˆë‚´">ìœ í˜•ì„ ì¶”ê°€í•˜ê±°ë‚˜ ìˆœì„œë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br><span data-i18n="ê¸°ë³¸ ìœ í˜• ì•ˆë‚´">ê¸°ë³¸ ìœ í˜•(ë°œì£¼Â·ê²¬ì Â·ë°©ë¬¸Â·í†µí™”Â·ê¸°íƒ€)ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</span></p>
      <div id="typeList"></div>
      <div style="margin-top:14px;padding-top:14px;border-top:1px solid var(--border)">
        <div class="form-section-title" data-i18n="ìƒˆ ìœ í˜• ì¶”ê°€" style="margin-bottom:10px">ìƒˆ ìœ í˜• ì¶”ê°€</div>
        <div style="display:grid;grid-template-columns:60px 1fr 120px auto;gap:8px;align-items:center">
          <input id="newTypeEmoji" placeholder="ğŸ”–" maxlength="2" style="padding:8px;background:var(--bg);border:1px solid var(--border);border-radius:7px;color:var(--text);font-size:18px;text-align:center;outline:none;width:100%">
          <input id="newTypeLabel" placeholder="ìœ í˜• ì´ë¦„" style="padding:8px 10px;background:var(--bg);border:1px solid var(--border);border-radius:7px;color:var(--text);font-size:13px;font-family:inherit;outline:none;width:100%">
          <div style="display:flex;align-items:center;gap:6px">
            <input type="color" id="newTypeColor" value="#4f7cff" style="width:32px;height:32px;border:1px solid var(--border);border-radius:6px;background:var(--bg);cursor:pointer;padding:2px">
            <span style="font-size:11px;color:var(--muted)" data-i18n="ìƒ‰ìƒ">ìƒ‰ìƒ</span>
          </div>
          <button class="btn btn-primary btn-sm" onclick="addCustomType()" data-i18n="ì¶”ê°€">ì¶”ê°€</button>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-outline" onclick="closeModal('typeModal')"><span data-i18n="ì·¨ì†Œ">ì·¨ì†Œ</span></button>
        <button class="btn btn-primary" onclick="saveTypes_modal()"><span data-i18n="ì €ì¥">ì €ì¥</span></button>
      </div>
    </div>
  </div>
  
  <!-- Delete Confirm Modal -->
  <div class="modal-overlay" id="delActModal">
    <div class="modal" style="width:400px;text-align:center">
      <div style="font-size:40px;margin-bottom:14px">ğŸ—‘</div>
      <div class="modal-title" style="text-align:center;margin-bottom:8px" data-i18n="í™œë™ ì‚­ì œ">í™œë™ ì‚­ì œ</div>
      <div id="delActInfo" style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:14px 16px;margin-bottom:20px;text-align:left;font-size:13px;line-height:1.8"></div>
      <p style="font-size:13px;color:var(--muted);margin-bottom:20px" data-i18n="í™œë™ ì‚­ì œ ê²½ê³ ">ì´ í™œë™ì„ ì‚­ì œí•˜ë©´ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
      <div style="display:flex;gap:10px;justify-content:center">
        <button class="btn btn-outline" onclick="closeModal('delActModal')" style="min-width:100px"><span data-i18n="ì·¨ì†Œ">ì·¨ì†Œ</span></button>
        <button class="btn btn-danger" id="delActConfirmBtn" style="min-width:100px"><span data-i18n="ì‚­ì œ">ì‚­ì œ</span></button>
      </div>
    </div>
  </div>
  
  <!-- PDF Import Modal -->
  <div class="modal-overlay" id="pdfModal">
    <div class="modal" style="width:640px">
      <button class="modal-close" onclick="closeModal('pdfModal')">âœ•</button>
      <div class="modal-title" data-i18n="íŒŒì¼ ëª¨ë‹¬ ì œëª©">ğŸ—‚ íŒŒì¼ì—ì„œ ì—°ë½ì²˜ ìë™ ì¶”ì¶œ</div>
  
      <!-- Step 1: API Key -->
      <div id="pdfStep0" class="pdf-step">
        <div class="form-section">
          <div class="form-section-title" data-i18n="Claude API í‚¤ ì„¤ì •">Claude API í‚¤ ì„¤ì •</div>
          <p style="font-size:12px;color:var(--muted);margin-bottom:10px;line-height:1.7">
            íŒŒì¼ ë¶„ì„ì—ëŠ” Claude APIê°€ ì‚¬ìš©ë©ë‹ˆë‹¤.<br>
            <a href="https://console.anthropic.com" target="_blank" style="color:var(--accent)">console.anthropic.com</a> â†’ API Keys ë©”ë‰´ì—ì„œ ë°œê¸‰í•˜ì„¸ìš”.<br>
            í‚¤ëŠ” ì´ ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ë©° ì™¸ë¶€ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
          </p>
          <div class="form-row single">
            <div class="form-group">
              <label>Anthropic API Key <span id="keyPreview" style="font-size:10px;color:var(--accent3);font-family:IBM Plex Mono,monospace"></span></label>
              <div style="position:relative">
                <input type="password" id="pdfApiKey" placeholder="sk-ant-api03-..."
                  style="padding-right:44px"
                  oninput="const v=this.value.trim();document.getElementById('pdfKeyValidMsg').textContent=v&&!v.startsWith('sk-')?i18n('sk- ì‹œì‘ ì˜¤ë¥˜'):''">
                <button onclick="const i=document.getElementById('pdfApiKey');i.type=i.type==='password'?'text':'password'"
                  style="position:absolute;right:8px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--muted);cursor:pointer;font-size:13px">ğŸ‘</button>
              </div>
              <div id="pdfKeyValidMsg" style="font-size:11px;color:var(--accent2);margin-top:4px"></div>
            </div>
          </div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-outline" onclick="closeModal('pdfModal')"><span data-i18n="ì·¨ì†Œ">ì·¨ì†Œ</span></button>
          <button class="btn btn-primary" onclick="pdfSaveKey()" data-i18n="ì €ì¥ í›„ ê³„ì†">ì €ì¥ í›„ ê³„ì†</button>
        </div>
      </div>
  
      <!-- Step 2: Upload -->
      <div id="pdfStep1" class="pdf-step" style="display:none">
        <div class="form-section">
          <div class="form-section-title" data-i18n="íŒŒì¼ ì—…ë¡œë“œ">íŒŒì¼ ì—…ë¡œë“œ</div>
          <p style="font-size:12px;color:var(--muted);margin-bottom:12px;line-height:1.8">
            ëª…í•¨ ì‚¬ì§„, PDF, Word, í…ìŠ¤íŠ¸ íŒŒì¼, ê·¸ë¦¬ê³  OutlookÂ·Gmail ë“±ì˜ <strong style="color:var(--accent3)" data-i18n="ëŒ€ìš©ëŸ‰ CSV">ëŒ€ìš©ëŸ‰ CSV</strong><span data-i18n="ë„ ì§€ì›í•©ë‹ˆë‹¤">ë„ ì§€ì›í•©ë‹ˆë‹¤.</span><br>
            <span style="color:var(--accent)">ğŸ“„ PDF</span> &nbsp;
            <span style="color:var(--accent)">ğŸ–¼ ì‚¬ì§„ (JPGÂ·PNGÂ·WEBP)</span> &nbsp;
            <span style="color:var(--accent)">ğŸ“ í…ìŠ¤íŠ¸ (TXT)</span> &nbsp;
            <span style="color:var(--accent3)">ğŸ“Š CSV (í¬ê¸° ì œí•œ ì—†ìŒ)</span>
          </p>
          <div id="pdfDropzone" class="pdf-dropzone" onclick="document.getElementById('pdfFileInput').click()">
            <div class="pdf-drop-icon" id="dropIcon">ğŸ—‚</div>
            <div class="pdf-drop-text" data-i18n="í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œ">í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œ</div>
            <div class="pdf-drop-sub">PDF Â· JPG Â· PNG Â· WEBP Â· TXT Â· CSV (CSVëŠ” í¬ê¸° ì œí•œ ì—†ìŒ / ê¸°íƒ€ ìµœëŒ€ 10MB)</div>
            <input type="file" id="pdfFileInput"
              accept=".pdf,.jpg,.jpeg,.png,.webp,.txt,.csv,.xls,.xlsx,.doc,.docx"
              multiple style="display:none" onchange="onPdfSelected(this)">
          </div>
          <div id="pdfFileName" style="font-size:12px;color:var(--accent);margin-top:8px;display:none"></div>
          <div id="pdfFileTypeNote" style="font-size:11px;color:var(--muted);margin-top:6px;display:none"></div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-outline" onclick="pdfChangeKey()">ğŸ”‘ í‚¤ ë³€ê²½</button>
          <button class="btn btn-outline" onclick="closeModal('pdfModal')"><span data-i18n="ì·¨ì†Œ">ì·¨ì†Œ</span></button>
          <button class="btn btn-primary" id="pdfAnalyzeBtn" onclick="pdfAnalyze()" disabled>ğŸ” ë¶„ì„ ì‹œì‘</button>
        </div>
      </div>
  
      <!-- Step 3: Loading -->
      <div id="pdfStep2" class="pdf-step" style="display:none">
        <div style="text-align:center;padding:48px 20px">
          <div class="pdf-spinner"></div>
          <div style="font-size:15px;font-weight:600;margin-top:20px" id="pdfLoadingMsg"></div>
          <div style="font-size:13px;color:var(--muted);margin-top:8px" data-i18n="AI ë¶„ì„ ì¤‘ ì•ˆë‚´">Claude AIê°€ ì—°ë½ì²˜ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤</div>
        </div>
      </div>
  
      <!-- Step 4: Results -->
      <div id="pdfStep3" class="pdf-step" style="display:none">
        <div class="form-section">
          <div class="form-section-title" data-i18n="ì¶”ì¶œëœ ì—°ë½ì²˜ í™•ì¸ ë° ìˆ˜ì •">ì¶”ì¶œëœ ì—°ë½ì²˜ í™•ì¸ ë° ìˆ˜ì •</div>
          <p style="font-size:12px;color:var(--muted);margin-bottom:12px" data-i18n="PDF ê²°ê³¼ ì•ˆë‚´">ë‚´ìš©ì„ í™•ì¸í•˜ê³  í•„ìš”í•˜ë©´ ìˆ˜ì • í›„ ì €ì¥í•˜ì„¸ìš”. ì²´í¬ëœ í•­ëª©ë§Œ CRMì— ì¶”ê°€ë©ë‹ˆë‹¤.</p>
        </div>
        <div id="pdfResults"></div>
        <div class="modal-actions" style="margin-top:16px">
          <button class="btn btn-outline" onclick="pdfRetry()">â† ë‹¤ì‹œ ì—…ë¡œë“œ</button>
          <button class="btn btn-primary" onclick="pdfImportAll()">âœ… ì„ íƒ í•­ëª© ëª¨ë‘ ì €ì¥</button>
        </div>
      </div>
  
      <!-- Step 5: Error -->
      <div id="pdfStep4" class="pdf-step" style="display:none">
        <div style="text-align:center;padding:40px 20px">
          <div style="font-size:40px;margin-bottom:16px">âš ï¸</div>
          <div style="font-size:15px;font-weight:600;margin-bottom:8px">ë¶„ì„ ì‹¤íŒ¨</div>
          <div id="pdfErrorMsg" style="font-size:13px;color:var(--muted);line-height:1.7"></div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-outline" onclick="pdfRetry()">â† ë‹¤ì‹œ ì‹œë„</button>
          <button class="btn btn-outline" onclick="closeModal('pdfModal')"><span data-i18n="ë‹«ê¸°">ë‹«ê¸°</span></button>
        </div>
      </div>
  
      <!-- Step 6 (CSV): ì»¬ëŸ¼ ë§¤í•‘ -->
      <div id="pdfStep5" class="pdf-step" style="display:none">
        <div class="form-section">
          <div class="form-section-title" data-i18n="ğŸ“Š CSV ì»¬ëŸ¼ ë§¤í•‘ í™•ì¸">ğŸ“Š CSV ì»¬ëŸ¼ ë§¤í•‘ í™•ì¸</div>
          <p style="font-size:12px;color:var(--muted);margin-bottom:10px" data-i18n="CSV ë§¤í•‘ ì•ˆë‚´">ìë™ìœ¼ë¡œ ê°ì§€ëœ ë§¤í•‘ì…ë‹ˆë‹¤. í•„ìš”í•˜ë©´ ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš”.</p>
          <div id="csvMappingArea" style="overflow:auto;max-height:300px"></div>
          <div id="csvPreviewInfo" style="font-size:12px;color:var(--muted);margin-top:8px"></div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-outline" onclick="pdfShowStep(1)">â† ë‹¤ì‹œ ì„ íƒ</button>
          <button class="btn btn-primary" onclick="csvImport()">âœ… ì´ ì„¤ì •ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°</button>
        </div>
      </div>
  
      <!-- Step 7 (CSV): ì§„í–‰ ì¤‘ -->
      <div id="pdfStep6" class="pdf-step" style="display:none">
        <div style="text-align:center;padding:48px 20px">
          <div class="pdf-spinner"></div>
          <div style="font-size:15px;font-weight:600;margin-top:20px" id="csvProgressMsg">ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div>
          <div style="margin:16px auto;max-width:320px;background:var(--surface2);border-radius:8px;overflow:hidden;height:10px">
            <div id="csvProgressBar" style="height:10px;background:var(--accent3);width:0%;transition:width 0.15s;border-radius:8px"></div>
          </div>
          <div id="csvProgressSub" style="font-size:12px;color:var(--muted);margin-top:6px"></div>
        </div>
      </div>
  
      <!-- Step 8 (CSV): ì™„ë£Œ -->
      <div id="pdfStep7" class="pdf-step" style="display:none">
        <div style="text-align:center;padding:44px 20px">
          <div style="font-size:52px;margin-bottom:14px">âœ…</div>
          <div style="font-size:17px;font-weight:700;margin-bottom:10px" id="csvDoneMsg"></div>
          <div id="csvDoneSub" style="font-size:13px;color:var(--muted);line-height:1.9"></div>
        </div>
        <div class="modal-actions">
          <button class="btn btn-outline" onclick="pdfShowStep(1)" data-i18n="ì¶”ê°€ íŒŒì¼ ê°€ì ¸ì˜¤ê¸°">ì¶”ê°€ íŒŒì¼ ê°€ì ¸ì˜¤ê¸°</button>
          <button class="btn btn-primary" onclick="closeModal('pdfModal')"><span data-i18n="ë‹«ê¸°">ë‹«ê¸°</span></button>
        </div>
      </div>
  
    </div>
  </div>
  
  
  <script>
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ì‚¬ìš©ì ì¸ì¦ ì‹œìŠ¤í…œ (ê°œì¸ ê³„ì • ë¡œê·¸ì¸)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  var _curUser = null; // { id, name, role }
  
  function _pwHash(pw){
    var salt='RelaCRM_AUTH_v2';
    var str=salt+pw+salt.split('').reverse().join('');
    var h=5381;
    for(var i=0;i<str.length;i++){h=((h<<5)+h)^str.charCodeAt(i);h=h>>>0;}
    return 'pw_'+('00000000'+h.toString(16)).slice(-8);
  }
  
  function _userColor(name){
    var c=['#4f7cff','#ff6b6b','#43e97b','#f7971e','#a855f7','#06b6d4'];
    var h=0;for(var ch of(name||''))h=(h*31+ch.charCodeAt(0))%c.length;
    return c[h];
  }
  
  async function _doLogin(){
    var name=(document.getElementById('loginName').value||'').trim();
    var pw=(document.getElementById('loginPw').value||'');
    var msg=document.getElementById('loginMsg');
    var btn=document.getElementById('loginBtn');
    if(!name){msg.textContent='ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.';return;}
    if(!pw){msg.textContent='ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.';return;}
    if(!sbIsConnected()){msg.textContent='ë¨¼ì € Supabaseë¥¼ ì—°ë™í•´ì£¼ì„¸ìš”.';return;}
    btn.disabled=true;
    msg.style.color='';
    msg.textContent='í™•ì¸ ì¤‘...';msg.className='login-msg';
    try{
      var enc=encodeURIComponent(name);
      var myHash=_pwHash(pw);
      // is_active í•„í„° ì—†ì´ ì¡°íšŒ (boolean íƒ€ì… ì´ìŠˆ ìš°íšŒ)
      var res=await fetch(
        sbUrl+'/rest/v1/crm_users?select=*&name=eq.'+enc+'&limit=1',
        {headers:{'apikey':sbKey,'Authorization':'Bearer '+sbKey}}
      );
      if(!res.ok){
        var errBody=await res.text().catch(function(){return '';});
        throw new Error('ì„œë²„ ì˜¤ë¥˜ ('+res.status+') â€” '+errBody.slice(0,80));
      }
      var rows=await res.json();
      if(!rows.length){
        msg.textContent='ë“±ë¡ë˜ì§€ ì•Šì€ ì‚¬ìš©ìì…ë‹ˆë‹¤.';
        btn.disabled=false;return;
      }
      var user=rows[0];
      if(user.is_active===false||user.is_active==='false'){
        msg.textContent='ë¹„í™œì„±í™”ëœ ê³„ì •ì…ë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.';
        btn.disabled=false;return;
      }
      if(user.pw_hash!==myHash){
        msg.textContent='ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.';
        btn.disabled=false;return;
      }
      _curUser={id:user.id,name:user.name,role:user.role};
      safeStorage.setItem('crm_session',JSON.stringify(_curUser));
      fetch(sbUrl+'/rest/v1/crm_users?id=eq.'+user.id,{
        method:'PATCH',
        headers:{'Content-Type':'application/json','apikey':sbKey,'Authorization':'Bearer '+sbKey,'Prefer':'return=minimal'},
        body:JSON.stringify({last_login:new Date().toISOString()})
      }).catch(function(){});
      msg.textContent='âœ“ í™˜ì˜í•©ë‹ˆë‹¤, '+_curUser.name+'!';msg.className='login-msg ok';
      setTimeout(function(){
        document.getElementById('loginOverlay').classList.add('hidden');
        _afterLogin();
      },600);
    }catch(e){
      var errMsg=e.message||'';
      if(errMsg.toLowerCase().indexOf('fetch')>=0||errMsg.toLowerCase().indexOf('network')>=0||errMsg.indexOf('Failed')>=0){
        msg.innerHTML='âš  ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ â€” Supabaseì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>'+
          '<span style="font-size:11px">ì¸í„°ë„· ì—°ê²° ë° Supabase URL/Keyë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.</span>';
      } else if(errMsg.indexOf('404')>=0){
        msg.innerHTML='âš  crm_users í…Œì´ë¸”ì´ ì—†ìŠµë‹ˆë‹¤.<br>'+
          '<span style="font-size:11px">â–¸ ë¡œê·¸ì¸ ë¬¸ì œ í•´ê²° â†’ ì§„ë‹¨ ì‹¤í–‰</span>';
      } else if(errMsg.indexOf('401')>=0){
        msg.innerHTML='âš  API Key ì˜¤ë¥˜ (401) â€” anon keyë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
      } else {
        msg.textContent='ì˜¤ë¥˜: '+errMsg;
      }
      msg.style.color='var(--accent2)';
      btn.disabled=false;
    }
  }
  
  function _afterLogin(){
    _updateUserBar();
    _updateMobUserTab();
    var mb=document.getElementById('userMgmtBtn');
    if(mb) mb.style.display=(_curUser&&_curUser.role==='admin')?'':'none';
    var na=document.getElementById('navAdmin');
    if(na) na.style.display=(_curUser&&_curUser.role==='admin')?'':'none';
    _crmInit();
  }
  
  function _logout(){
    if(!confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    _sbStopRealtime();
    _curUser=null;
    safeStorage.removeItem('crm_session');
    contacts=[];activities=[];companies={};_idxDirty=true;
    var ov=document.getElementById('loginOverlay');
    if(ov) ov.classList.remove('hidden');
    document.getElementById('loginName').value='';
    document.getElementById('loginPw').value='';
    document.getElementById('loginMsg').textContent='';
    document.getElementById('loginBtn').disabled=false;
    var bar=document.getElementById('loginUserBar');
    if(bar) bar.style.display='none';
    var mb=document.getElementById('userMgmtBtn');
    if(mb) mb.style.display='none';
    _updateMobUserTab();
  }
  
  function _restoreSession(){
    try{
      var s=safeStorage.getItem('crm_session');
      if(!s) return false;
      var u=JSON.parse(s);
      if(!u||!u.name||!sbIsConnected()) return false;
      _curUser=u; return true;
    }catch(e){return false;}
  }
  
  function _updateUserBar(){
    var bar=document.getElementById('loginUserBar');
    if(!bar||!_curUser) return;
    var init=(_curUser.name||'?')[0];
    var col=_userColor(_curUser.name);
    bar.innerHTML=
      '<div class="login-user-avatar" style="background:'+col+'">'+init+'</div>'+
      '<div style="flex:1;min-width:0">'+
        '<div style="font-weight:600;font-size:12px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">'+_curUser.name+'</div>'+
        '<div style="font-size:10px;color:var(--muted);font-family:IBM Plex Mono,monospace">'+(_curUser.role==='admin'?'ğŸ‘‘ ê´€ë¦¬ì':'ì‚¬ìš©ì')+'</div>'+
      '</div>'+
      '<button onclick="_logout()" title="ë¡œê·¸ì•„ì›ƒ" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:15px;flex-shrink:0;padding:2px 4px">â»</button>';
    bar.style.display='flex';
  }
  
  async function openUserMgmt(){
    if(!_curUser||_curUser.role!=='admin'){alert('ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.');return;}
    await _loadUserList();
    ['newUserName','newUserPw'].forEach(function(id){document.getElementById(id).value='';});
    ['userMgmtMsg','pwChangeCur','pwChangeNew','pwChangeMsg'].forEach(function(id){
      var el=document.getElementById(id);
      if(el) el.value!==undefined?el.value='':el.textContent='';
    });
    document.getElementById('userMgmtModal').classList.add('open');
  }
  
  async function _loadUserList(){
    var div=document.getElementById('userMgmtList');
    div.innerHTML='<div style="padding:12px;color:var(--muted);font-size:12px;text-align:center">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
    try{
      var res=await fetch(sbUrl+'/rest/v1/crm_users?select=*&order=created_at.asc',
        {headers:{'apikey':sbKey,'Authorization':'Bearer '+sbKey}});
      var users=res.ok?await res.json():[];
      if(!users.length){div.innerHTML='<div style="padding:12px;color:var(--muted);font-size:12px">ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.</div>';return;}
      div.innerHTML='';
      users.forEach(function(u){
        var row=document.createElement('div');
        row.className='user-row';
        var col=_userColor(u.name);
        var init=(u.name||'?')[0];
        var isSelf=_curUser&&u.name===_curUser.name;
        var last=u.last_login?new Date(u.last_login).toLocaleDateString('ko-KR'):'ì—†ìŒ';
        // ì•„ë°”íƒ€
        var av=document.createElement('div');
        av.className='user-av';
        av.style.background=col;
        av.textContent=init;
        // ì´ë¦„+ë‚ ì§œ
        var info=document.createElement('div');
        var nm=document.createElement('div');
        nm.style.fontWeight='500';
        nm.textContent=u.name;
        if(isSelf){var badge=document.createElement('span');badge.style.cssText='font-size:10px;color:var(--accent)';badge.textContent=' (ë‚˜)';nm.appendChild(badge);}
        var dt=document.createElement('div');
        dt.style.cssText='font-size:10px;color:var(--border)';
        dt.textContent='ìµœê·¼: '+last;
        info.appendChild(nm); info.appendChild(dt);
        // ì—­í•  ë°°ì§€
        var rb=document.createElement('span');
        rb.className='role-badge '+u.role;
        rb.textContent=u.role==='admin'?'ê´€ë¦¬ì':'ì‚¬ìš©ì';
        // í™œì„± ìƒíƒœ
        var st=document.createElement('span');
        st.style.cssText='font-size:10px;color:'+(u.is_active?'var(--accent3)':'var(--accent2)');
        st.textContent=u.is_active?'â— í™œì„±':'â—‹ ë¹„í™œì„±';
        // ì°¨ë‹¨/ë³µì› ë²„íŠ¼
        var btn=document.createElement(isSelf?'span':'button');
        if(!isSelf){
          btn.textContent=u.is_active?'ì°¨ë‹¨':'ë³µì›';
          btn.style.cssText='background:none;border:1px solid var(--border);border-radius:5px;padding:3px 7px;color:var(--muted);cursor:pointer;font-size:11px';
          (function(uid,active){
            btn.onclick=function(){_toggleUser(uid,active);};
          })(u.id, u.is_active);
        }
        // ì‚­ì œ ë²„íŠ¼ (ë³¸ì¸ ë° ë§ˆì§€ë§‰ ê´€ë¦¬ìëŠ” ë¹„í™œì„±)
        var delBtn=document.createElement(isSelf?'span':'button');
        if(!isSelf){
          delBtn.textContent='ğŸ—‘';
          delBtn.title='ê³„ì • ì‚­ì œ (ê¸°ì¡´ ë¡œê·¸ ìœ ì§€)';
          delBtn.style.cssText='background:none;border:1px solid var(--accent2);border-radius:5px;padding:3px 7px;color:var(--accent2);cursor:pointer;font-size:11px';
          (function(uid,uname){ delBtn.onclick=function(){_deleteUser(uid,uname);}; })(u.id,u.name);
        }
        row.appendChild(av); row.appendChild(info); row.appendChild(rb); row.appendChild(st); row.appendChild(btn); row.appendChild(delBtn||document.createElement('span'));
        div.appendChild(row);
      });
    }catch(e){div.innerHTML='<div style="color:var(--accent2);padding:8px;font-size:12px">ì˜¤ë¥˜: '+e.message+'</div>';}
  }
  
  async function _addUser(){
    var name=(document.getElementById('newUserName').value||'').trim();
    var pw=(document.getElementById('newUserPw').value||'').trim();
    var role=document.getElementById('newUserRole').value;
    var msg=document.getElementById('userMgmtMsg');
    if(!name){msg.textContent='ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.';msg.style.color='var(--accent2)';return;}
    if(pw.length<4){msg.textContent='ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.';msg.style.color='var(--accent2)';return;}
    msg.textContent='ì¶”ê°€ ì¤‘...';msg.style.color='var(--muted)';
    try{
      var res=await fetch(sbUrl+'/rest/v1/crm_users',{
        method:'POST',
        headers:{'Content-Type':'application/json','apikey':sbKey,'Authorization':'Bearer '+sbKey,'Prefer':'return=minimal'},
        body:JSON.stringify([{id:'u'+Date.now().toString(36)+Math.random().toString(36).slice(2,5),
          name:name,pw_hash:_pwHash(pw),role:role,is_active:true,created_at:new Date().toISOString()}])
      });
      if(!res.ok){var t=await res.text();throw new Error(t.slice(0,120));}
      msg.textContent='âœ“ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.';msg.style.color='var(--accent3)';
      document.getElementById('newUserName').value='';
      document.getElementById('newUserPw').value='';
      await _loadUserList();
    }catch(e){msg.textContent='ì˜¤ë¥˜: '+e.message;msg.style.color='var(--accent2)';}
  }
  
  async function _toggleUser(id,isActive){
    try{
      await fetch(sbUrl+'/rest/v1/crm_users?id=eq.'+id,{
        method:'PATCH',
        headers:{'Content-Type':'application/json','apikey':sbKey,'Authorization':'Bearer '+sbKey,'Prefer':'return=minimal'},
        body:JSON.stringify({is_active:!isActive})
      });
      await _loadUserList();
    }catch(e){alert('ì˜¤ë¥˜: '+e.message);}
  }
  
  // â”€â”€ ì‚¬ìš©ì ì‚­ì œ (ê¸°ì¡´ ë¡œê·¸ created_by ê°’ì€ ìœ ì§€)
  async function _deleteUser(id, name){
    // ë§ˆì§€ë§‰ ê´€ë¦¬ì ë³´í˜¸ ì²´í¬
    try{
      var res=await fetch(sbUrl+'/rest/v1/crm_users?select=id,role&is_active=eq.true',
        {headers:{'apikey':sbKey,'Authorization':'Bearer '+sbKey}});
      var all=res.ok?await res.json():[];
      var admins=all.filter(function(u){return u.role==='admin';});
      var target=all.find(function(u){return u.id===id;});
      if(target&&target.role==='admin'&&admins.length<=1){
        alert('ë§ˆì§€ë§‰ ê´€ë¦¬ì ê³„ì •ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\në‹¤ë¥¸ ê´€ë¦¬ìë¥¼ ë¨¼ì € ì§€ì •í•´ì£¼ì„¸ìš”.');
        return;
      }
    }catch(e){ /* ì²´í¬ ì‹¤íŒ¨ ì‹œ ê·¸ëƒ¥ ì§„í–‰ */ }
  
    if(!confirm(
      '[ '+name+' ] ê³„ì •ì„ ì‚­ì œí•©ë‹ˆê¹Œ?\n\n'+
      'âœ“ ê³„ì •(ë¡œê·¸ì¸ ì •ë³´)ì€ ì‚­ì œë©ë‹ˆë‹¤.\n'+
      'âœ“ ì´ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì—°ë½ì²˜/í™œë™ ê¸°ë¡ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.\n'+
      '  (ì…ë ¥ì ì´ë¦„ "'+name+'"ì€ ê¸°ë¡ì— ê³„ì† í‘œì‹œë©ë‹ˆë‹¤.)'
    )) return;
  
    try{
      var delRes=await fetch(sbUrl+'/rest/v1/crm_users?id=eq.'+encodeURIComponent(id),{
        method:'DELETE',
        headers:{'apikey':sbKey,'Authorization':'Bearer '+sbKey,'Prefer':'return=minimal'}
      });
      if(!delRes.ok){
        var t=await delRes.text().catch(function(){return '';});
        throw new Error('ì‚­ì œ ì‹¤íŒ¨ ('+delRes.status+'): '+t.slice(0,80));
      }
      var msg=document.getElementById('userMgmtMsg');
      if(msg){
        msg.textContent='âœ“ '+name+' ê³„ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. ê¸°ì¡´ ë¡œê·¸ëŠ” ìœ ì§€ë©ë‹ˆë‹¤.';
        msg.style.color='var(--accent3)';
      }
      await _loadUserList();
    }catch(e){
      var msg=document.getElementById('userMgmtMsg');
      if(msg){ msg.textContent='ì˜¤ë¥˜: '+e.message; msg.style.color='var(--accent2)'; }
      else alert('ì˜¤ë¥˜: '+e.message);
    }
  }
  
  
  async function _changeMyPw(){
    var cur=(document.getElementById('pwChangeCur').value||'');
    var nw=(document.getElementById('pwChangeNew').value||'');
    var msg=document.getElementById('pwChangeMsg');
    if(!cur){msg.textContent='í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.';msg.style.color='var(--accent2)';return;}
    if(nw.length<4){msg.textContent='ìƒˆ ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.';msg.style.color='var(--accent2)';return;}
    try{
      var enc=encodeURIComponent(_curUser.name);
      var res=await fetch(sbUrl+'/rest/v1/crm_users?name=eq.'+enc+'&pw_hash=eq.'+_pwHash(cur)+'&select=id',
        {headers:{'apikey':sbKey,'Authorization':'Bearer '+sbKey}});
      var rows=await res.json();
      if(!rows.length){msg.textContent='í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.';msg.style.color='var(--accent2)';return;}
      await fetch(sbUrl+'/rest/v1/crm_users?id=eq.'+_curUser.id,{
        method:'PATCH',
        headers:{'Content-Type':'application/json','apikey':sbKey,'Authorization':'Bearer '+sbKey,'Prefer':'return=minimal'},
        body:JSON.stringify({pw_hash:_pwHash(nw)})
      });
      msg.textContent='âœ“ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.';msg.style.color='var(--accent3)';
      document.getElementById('pwChangeCur').value='';
      document.getElementById('pwChangeNew').value='';
    }catch(e){msg.textContent='ì˜¤ë¥˜: '+e.message;msg.style.color='var(--accent2)';}
  }
  
  function _curUserName(){return _curUser?_curUser.name:'';}
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ê´€ë¦¬ì ì „ìš© : ì…ë ¥ì í˜„í™© ë·°
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function renderAdminView(){
    if(!_curUser || _curUser.role!=='admin') return;
  
    // â”€â”€ íŒ€ì›ë³„ ì§‘ê³„
    var userStats = {}; // { name: { contacts:N, activities:N, lastDate:'' } }
  
    contacts.forEach(function(c){
      var who = c.createdBy || '(ë¯¸ì„¤ì •)';
      if(!userStats[who]) userStats[who] = {contacts:0, activities:0, lastDate:''};
      userStats[who].contacts++;
      if(c.createdAt && c.createdAt > (userStats[who].lastDate||''))
        userStats[who].lastDate = c.createdAt;
    });
  
    activities.forEach(function(a){
      var who = a.createdBy || '(ë¯¸ì„¤ì •)';
      if(!userStats[who]) userStats[who] = {contacts:0, activities:0, lastDate:''};
      userStats[who].activities++;
      if(a.date && a.date > (userStats[who].lastDate||''))
        userStats[who].lastDate = a.date;
    });
  
    var users = Object.keys(userStats).sort(function(a,b){
      return (userStats[b].contacts + userStats[b].activities)
           - (userStats[a].contacts + userStats[a].activities);
    });
  
    // â”€â”€ ìš”ì•½ ì¹´ë“œ
    var totalC = contacts.length;
    var totalA = activities.length;
    var taggedC = contacts.filter(function(c){return c.createdBy;}).length;
    var taggedA = activities.filter(function(a){return a.createdBy;}).length;
    var memberCount = users.filter(function(u){return u!=='(ë¯¸ì„¤ì •)';}).length;
  
    var cards = [
      { icon:'ğŸ‘¥', label:'í™œë™ íŒ€ì›', value: memberCount+'ëª…', color:'var(--accent)' },
      { icon:'ğŸ¢', label:'ì „ì²´ ì—°ë½ì²˜', value: totalC.toLocaleString(), sub: taggedC+'ê°œ ì…ë ¥ì í™•ì¸', color:'var(--accent3)' },
      { icon:'ğŸ“‹', label:'ì „ì²´ í™œë™', value: totalA.toLocaleString(), sub: taggedA+'ê°œ ì…ë ¥ì í™•ì¸', color:'#a855f7' },
      { icon:'ğŸ“Š', label:'ì…ë ¥ì íƒœê¹…ë¥ ', value: totalC+totalA>0 ? Math.round((taggedC+taggedA)/(totalC+totalA)*100)+'%':'â€”', color:'var(--accent)' },
    ];
  
    document.getElementById('adminStatCards').innerHTML = cards.map(function(c){
      return '<div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px 18px">'
        +'<div style="font-size:20px;margin-bottom:6px">'+c.icon+'</div>'
        +'<div style="font-size:22px;font-weight:700;color:'+c.color+'">'+c.value+'</div>'
        +'<div style="font-size:12px;color:var(--muted);margin-top:2px">'+c.label+'</div>'
        +(c.sub?'<div style="font-size:10px;color:var(--border);margin-top:3px">'+c.sub+'</div>':'')
        +'</div>';
    }).join('');
  
    // â”€â”€ íŒ€ì›ë³„ í…Œì´ë¸”
    var tableHtml = '<table style="width:100%;border-collapse:collapse;font-size:13px">'
      +'<thead><tr style="border-bottom:2px solid var(--border)">'
      +'<th style="padding:10px 16px;text-align:left;color:var(--muted);font-weight:600;font-size:11px;text-transform:uppercase">íŒ€ì›</th>'
      +'<th style="padding:10px 12px;text-align:right;color:var(--muted);font-weight:600;font-size:11px">ì—°ë½ì²˜</th>'
      +'<th style="padding:10px 12px;text-align:right;color:var(--muted);font-weight:600;font-size:11px">í™œë™</th>'
      +'<th style="padding:10px 12px;text-align:right;color:var(--muted);font-weight:600;font-size:11px">í•©ê³„</th>'
      +'<th style="padding:10px 16px;text-align:right;color:var(--muted);font-weight:600;font-size:11px">ìµœê·¼ ì…ë ¥ì¼</th>'
      +'</tr></thead><tbody>';
  
    users.forEach(function(name, idx){
      var s = userStats[name];
      var total = s.contacts + s.activities;
      var maxTotal = userStats[users[0]].contacts + userStats[users[0]].activities;
      var pct = maxTotal > 0 ? Math.round(total/maxTotal*100) : 0;
      var col = _userColor(name);
      var init = (name||'?')[0];
      var lastDate = s.lastDate ? new Date(s.lastDate).toLocaleDateString('ko-KR') : 'â€”';
      var isUnset = name === '(ë¯¸ì„¤ì •)';
  
      tableHtml += '<tr style="border-bottom:1px solid var(--border);'+(idx%2===0?'':'background:rgba(255,255,255,.02)')+'">'
        +'<td style="padding:12px 16px">'
          +'<div style="display:flex;align-items:center;gap:10px">'
            +(isUnset
              ? '<div style="width:28px;height:28px;border-radius:50%;background:var(--border);display:flex;align-items:center;justify-content:center;font-size:12px">?</div>'
              : '<div style="width:28px;height:28px;border-radius:50%;background:'+col+';display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#fff">'+init+'</div>'
            )
            +'<div>'
              +'<div style="font-weight:500'+(isUnset?';color:var(--muted)':'')+'">'+(isUnset?'ì…ë ¥ì ë¯¸ì„¤ì •':name)+'</div>'
              +'<div style="width:'+pct+'px;max-width:120px;height:3px;background:'+col+';border-radius:2px;margin-top:4px;opacity:.7"></div>'
            +'</div>'
          +'</div>'
        +'</td>'
        +'<td style="padding:12px;text-align:right;font-weight:600;color:var(--accent3)">'+s.contacts.toLocaleString()+'</td>'
        +'<td style="padding:12px;text-align:right;font-weight:600;color:#a855f7">'+s.activities.toLocaleString()+'</td>'
        +'<td style="padding:12px;text-align:right;font-weight:700">'+total.toLocaleString()+'</td>'
        +'<td style="padding:12px 16px;text-align:right;font-size:11px;color:var(--muted)">'+lastDate+'</td>'
        +'</tr>';
    });
  
    if(!users.length){
      tableHtml += '<tr><td colspan="5" style="padding:24px;text-align:center;color:var(--muted);font-size:13px">'
        +'ì•„ì§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
    }
    tableHtml += '</tbody></table>';
    document.getElementById('adminUserTable').innerHTML = tableHtml;
    document.getElementById('adminTablePeriod').textContent = 'ì „ì²´ ê¸°ê°„';
  
    // â”€â”€ íŒ€ì› í•„í„° ì…€ë ‰íŠ¸ ì—…ë°ì´íŠ¸
    var sel = document.getElementById('adminFilterUser');
    if(sel){
      var cur = sel.value;
      sel.innerHTML = '<option value="">ì „ì²´ íŒ€ì›</option>'
        + users.filter(function(u){return u!=='(ë¯¸ì„¤ì •)';}).map(function(u){
            return '<option value="'+u+'"'+(cur===u?' selected':'')+'>'+u+'</option>';
          }).join('');
    }
  
    // â”€â”€ ìµœê·¼ ì…ë ¥ í™œë™ ëª©ë¡
    _renderAdminRecentList();
  }
  
  function _renderAdminRecentList(){
    var filterUser = (document.getElementById('adminFilterUser')||{}).value || '';
    var listEl = document.getElementById('adminRecentList');
    if(!listEl) return;
  
    // ì—°ë½ì²˜ + í™œë™ í†µí•©, ìµœì‹ ìˆœ 50ê°œ
    var items = [];
    contacts.forEach(function(c){
      if(filterUser && c.createdBy !== filterUser) return;
      items.push({
        type:'contact', date: c.createdAt||'', who: c.createdBy||'(ë¯¸ì„¤ì •)',
        label: (c.last||'')+(c.first||''), sub: c.company||'', id: c.id
      });
    });
    activities.forEach(function(a){
      if(filterUser && a.createdBy !== filterUser) return;
      var con = contacts.find(function(c){return c.id===a.contactId;});
      items.push({
        type:'activity', date: a.date||a.createdAt||'', who: a.createdBy||'(ë¯¸ì„¤ì •)',
        label: a.title||a.content||'í™œë™', sub: con?(con.last||'')+(con.first||''):'',
        actType: a.type, id: a.id
      });
    });
  
    items.sort(function(a,b){ return b.date.localeCompare(a.date); });
    items = items.slice(0,50);
  
    if(!items.length){
      listEl.innerHTML = '<div style="text-align:center;padding:20px;color:var(--muted);font-size:13px">í‘œì‹œí•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
      return;
    }
  
    listEl.innerHTML = items.map(function(item){
      var col = _userColor(item.who);
      var init = (item.who||'?')[0];
      var typeIcon = item.type==='contact' ? 'ğŸ¢' : (_typeIcon(item.actType)||'ğŸ“‹');
      var dateStr = item.date ? item.date.slice(0,10) : 'â€”';
      return '<div style="display:flex;align-items:center;gap:10px;padding:9px 4px;border-bottom:1px solid var(--border)">'
        +'<div style="width:26px;height:26px;border-radius:50%;background:'+col+';display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:#fff;flex-shrink:0">'+init+'</div>'
        +'<div style="flex:1;min-width:0">'
          +'<div style="font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">'+typeIcon+' '+item.label+'</div>'
          +(item.sub?'<div style="font-size:11px;color:var(--muted)">'+item.sub+'</div>':'')
        +'</div>'
        +'<div style="text-align:right;flex-shrink:0">'
          +'<div style="font-size:11px;font-weight:600;color:'+col+'">'+item.who+'</div>'
          +'<div style="font-size:10px;color:var(--border)">'+dateStr+'</div>'
        +'</div>'
      +'</div>';
    }).join('');
  }
  
  function _typeIcon(type){
    var icons = {call:'ğŸ“',meeting:'ğŸ¤',email:'ğŸ“§',order:'ğŸ›’',quote:'ğŸ“„',visit:'ğŸš—',other:'ğŸ“Œ'};
    return icons[type]||'ğŸ“Œ';
  }
  
  
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // ë¡œê·¸ì¸ ì§„ë‹¨ í•¨ìˆ˜
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  async function _runLoginDiag(){
    var out=document.getElementById('loginDiagResult');
    out.style.display='block';
    out.textContent='ì§„ë‹¨ ì¤‘...\n';
    var log=function(s){out.textContent+=s+'\n';};
  
    // 1. Supabase ì—°ê²° ìƒíƒœ
    log('â‘  Supabase ì—°ê²°: '+(sbIsConnected()?'âœ“ ì—°ê²°ë¨':'âœ— ë¯¸ì—°ê²°'));
    if(!sbIsConnected()){log('â†’ Supabase ì—°ë™ ì„¤ì •ì„ ë¨¼ì € í•´ì£¼ì„¸ìš”.');return;}
    log('   URL: '+sbUrl.slice(0,40)+'...');
  
    // 2. crm_users í…Œì´ë¸” ì¡´ì¬ ì—¬ë¶€
    try{
      var r1=await fetch(sbUrl+'/rest/v1/crm_users?select=id,name,role,is_active&limit=10',
        {headers:{'apikey':sbKey,'Authorization':'Bearer '+sbKey}});
      if(!r1.ok){
        log('â‘¡ crm_users í…Œì´ë¸”: âœ— ì—†ìŒ ('+r1.status+')');
        log('â†’ Supabase SQL Editorì—ì„œ SQLì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.');
        log('   (ëª¨ë‹¬ í•˜ë‹¨ "SQL ë³µì‚¬" ë²„íŠ¼ â†’ SQL Editor ë¶™ì—¬ë„£ê¸°)');
        return;
      }
      var users=await r1.json();
      log('â‘¡ crm_users í…Œì´ë¸”: âœ“ ì¡´ì¬ ('+users.length+'ëª…)');
  
      if(!users.length){
        log('   â†’ ê³„ì •ì´ ì—†ìŠµë‹ˆë‹¤. admin ê³„ì •ì„ ìƒì„±í•©ë‹ˆë‹¤...');
        await _resetAdminAccount();
        return;
      }
  
      // 3. admin ê³„ì • ì¡´ì¬ ì—¬ë¶€
      var admin=users.find(function(u){return u.name==='admin';});
      if(!admin){
        log('â‘¢ admin ê³„ì •: âœ— ì—†ìŒ');
        log('   í˜„ì¬ ë“±ë¡ëœ ê³„ì •: '+users.map(function(u){return u.name;}).join(', '));
        log('â†’ ì•„ë˜ "admin ì´ˆê¸°í™”" ë²„íŠ¼ìœ¼ë¡œ ê³„ì •ì„ ìƒì„±í•˜ì„¸ìš”.');
      } else {
        log('â‘¢ admin ê³„ì •: âœ“ ì¡´ì¬');
        log('   is_active = '+JSON.stringify(admin.is_active));
        log('   role = '+admin.role);
  
        // 4. ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ í™•ì¸
        var r2=await fetch(sbUrl+'/rest/v1/crm_users?select=pw_hash&name=eq.admin&limit=1',
          {headers:{'apikey':sbKey,'Authorization':'Bearer '+sbKey}});
        var hr=await r2.json();
        if(hr.length){
          var storedHash=hr[0].pw_hash;
          var expected=_pwHash('admin1234');
          log('â‘£ ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ í™•ì¸:');
          log('   ì €ì¥ëœ ê°’: '+storedHash);
          log('   admin1234 í•´ì‹œ: '+expected);
          if(storedHash===expected){
            log('   âœ“ ì¼ì¹˜ â€” ë¹„ë°€ë²ˆí˜¸ admin1234ë¡œ ë¡œê·¸ì¸ ê°€ëŠ¥');
          } else {
            log('   âœ— ë¶ˆì¼ì¹˜ â€” ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆê±°ë‚˜ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ì €ì¥ë¨');
            log('â†’ ì•„ë˜ "admin ì´ˆê¸°í™”" ë²„íŠ¼ìœ¼ë¡œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¬ì„¤ì •í•˜ì„¸ìš”.');
          }
        }
      }
  
      // ì´ˆê¸°í™” ë²„íŠ¼ í‘œì‹œ
      var diagArea=document.getElementById('loginDiagArea');
      if(diagArea&&!document.getElementById('resetAdminBtn')){
        var btn=document.createElement('button');
        btn.id='resetAdminBtn';
        btn.textContent='ğŸ”‘ admin ê³„ì • ì´ˆê¸°í™” (PW: admin1234)';
        btn.style.cssText='width:100%;margin-top:8px;padding:8px;background:var(--accent);border:none;'+
          'border-radius:8px;color:#fff;font-size:12px;cursor:pointer;font-family:IBM Plex Mono,monospace';
        btn.onclick=_resetAdminAccount;
        diagArea.appendChild(btn);
      }
    }catch(e){
      log('ì˜¤ë¥˜: '+e.message);
    }
  }
  
  
  // â”€â”€ ëª¨ë°”ì¼ ê³„ì • íƒ­ ë©”ë‰´
  function _mobileUserMenu(){
    if(!_curUser){
      // ë¡œê·¸ì¸ ì•ˆ ëœ ìƒíƒœ â†’ ë¡œê·¸ì¸ í™”ë©´
      var ov=document.getElementById('loginOverlay');
      if(ov) ov.classList.remove('hidden');
      return;
    }
    // ë¡œê·¸ì¸ëœ ìƒíƒœ â†’ ì˜µì…˜ ì‹œíŠ¸
    var opts=[
      { label:'ğŸ‘‘ ì‚¬ìš©ì ê´€ë¦¬', show:_curUser.role==='admin', fn:openUserMgmt },
      { label:'ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½', show:true, fn:function(){ openUserMgmt(); } },
      { label:'â» ë¡œê·¸ì•„ì›ƒ', show:true, fn:_logout },
    ].filter(function(o){return o.show;});
  
    // ê°„ë‹¨í•œ ë°”í…€ì‹œíŠ¸ ìƒì„±
    var existing=document.getElementById('_mobUserSheet');
    if(existing) existing.remove();
    var sheet=document.createElement('div');
    sheet.id='_mobUserSheet';
    sheet.style.cssText='position:fixed;bottom:0;left:0;right:0;z-index:5000;'+
      'background:var(--surface);border-radius:16px 16px 0 0;border-top:1px solid var(--border);'+
      'padding:16px 0 calc(16px + env(safe-area-inset-bottom));'+
      'animation:slideUp .2s ease';
  
    // ì‚¬ìš©ì ì •ë³´
    var header=document.createElement('div');
    header.style.cssText='padding:10px 20px 14px;display:flex;align-items:center;gap:10px;border-bottom:1px solid var(--border);margin-bottom:8px';
    var col=_userColor(_curUser.name);
    var init=(_curUser.name||'?')[0];
    header.innerHTML=
      '<div style="width:36px;height:36px;border-radius:50%;background:'+col+';display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff">'+init+'</div>'+
      '<div><div style="font-weight:600">'+_curUser.name+'</div>'+
      '<div style="font-size:11px;color:var(--muted)">'+(_curUser.role==='admin'?'ğŸ‘‘ ê´€ë¦¬ì':'ì‚¬ìš©ì')+'</div></div>';
    sheet.appendChild(header);
  
    opts.forEach(function(o){
      var btn=document.createElement('button');
      btn.textContent=o.label;
      btn.style.cssText='display:block;width:100%;padding:14px 20px;background:none;border:none;'+
        'color:var(--text);font-size:15px;font-family:Noto Sans KR,sans-serif;text-align:left;cursor:pointer;';
      if(o.label.includes('ë¡œê·¸ì•„ì›ƒ')) btn.style.color='var(--accent2)';
      btn.onclick=function(){ sheet.remove(); overlay.remove(); o.fn(); };
      sheet.appendChild(btn);
    });
  
    var overlay=document.createElement('div');
    overlay.style.cssText='position:fixed;inset:0;z-index:4999;background:rgba(0,0,0,.5)';
    overlay.onclick=function(){ sheet.remove(); overlay.remove(); };
  
    document.body.appendChild(overlay);
    document.body.appendChild(sheet);
  }
  
  // â”€â”€ íƒ­ë°” ê³„ì • ì•„ì´ì½˜ ê°±ì‹ 
  function _updateMobUserTab(){
    var icon=document.getElementById('mTabUserIcon');
    var label=document.getElementById('mTabUserLabel');
    if(!icon||!label) return;
    if(_curUser){
      var init=(_curUser.name||'?')[0];
      var col=_userColor(_curUser.name);
      icon.innerHTML='<span style="display:inline-flex;width:22px;height:22px;border-radius:50%;background:'+col+
        ';align-items:center;justify-content:center;font-size:11px;font-weight:700;color:#fff">'+init+'</span>';
      label.textContent=_curUser.name.length>4?_curUser.name.slice(0,4)+'â€¦':_curUser.name;
    } else {
      icon.textContent='ğŸ‘¤';
      label.textContent='ê³„ì •';
    }
  }
  
  
  // â”€â”€ ìµœì´ˆ ê´€ë¦¬ì ê³„ì • ìë™ ìƒì„± (crm_users ë¹„ì–´ìˆì„ ë•Œ)
  async function _initFirstAdmin(){
    if(!sbIsConnected()) return;
    // íƒ€ì´ë° ì´ìŠˆ ë°©ì§€: URL/Key ì¬í™•ì¸
    var url=safeStorage.getItem('crm_sb_url')||sbUrl;
    var key=safeStorage.getItem('crm_sb_key')||sbKey;
    if(!url||!key) return;

    // ì¬ì‹œë„ í—¬í¼
    async function _fetchWithRetry(fetchFn, maxTry){
      for(var t=0; t<maxTry; t++){
        try{ return await fetchFn(); }
        catch(e){
          if(t===maxTry-1) throw e;
          await new Promise(function(r){setTimeout(r,1200*(t+1));});
        }
      }
    }

    try{
      var res=await _fetchWithRetry(function(){
        return fetch(url+'/rest/v1/crm_users?select=id&limit=1',
          {headers:{'apikey':key,'Authorization':'Bearer '+key}});
      }, 3);

      if(!res.ok){
        var status=res.status;
        if(status===404||status===400){
          // crm_users í…Œì´ë¸” ì—†ìŒ
          _setLoginMsg('âš  crm_users í…Œì´ë¸”ì´ ì—†ìŠµë‹ˆë‹¤. SQL Editorì—ì„œ SQLì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.','warn');
        } else if(status===401){
          _setLoginMsg('âš  API Keyê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤. Supabase ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.','warn');
        }
        return;
      }

      var rows=await res.json();
      if(rows.length>0) return; // ì´ë¯¸ ì‚¬ìš©ì ìˆìŒ

      // ìµœì´ˆ ê´€ë¦¬ì ìƒì„±: admin / admin1234
      var createRes=await _fetchWithRetry(function(){
        return fetch(url+'/rest/v1/crm_users',{
          method:'POST',
          headers:{'Content-Type':'application/json','apikey':key,
                   'Authorization':'Bearer '+key,'Prefer':'return=minimal'},
          body:JSON.stringify([{id:'admin_init',name:'admin',pw_hash:_pwHash('admin1234'),
            role:'admin',is_active:true,created_at:new Date().toISOString()}])
        });
      }, 3);

      if(createRes.ok){
        _setLoginMsg('ğŸ‰ ê´€ë¦¬ì ê³„ì • ìƒì„±! ID: admin / PW: admin1234','ok');
        var nameEl=document.getElementById('loginName');
        if(nameEl) nameEl.value='admin';
      } else {
        var errTxt=await createRes.text().catch(function(){return '';});
        _setLoginMsg('âš  ê´€ë¦¬ì ê³„ì • ìƒì„± ì‹¤íŒ¨ ('+createRes.status+') '+errTxt.slice(0,60),'warn');
      }
    }catch(e){
      // Failed to fetch = ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ (CORS, ì˜¤í”„ë¼ì¸ ë“±)
      // ë¡œê·¸ì¸ í™”ë©´ì— ì˜¤ë¥˜ í‘œì‹œí•˜ì§€ ì•ŠìŒ â€” ì‚¬ìš©ìê°€ ì§ì ‘ ë¡œê·¸ì¸ ì‹œë„í•˜ë©´ ë¨
      console.warn('_initFirstAdmin ì˜¤ë¥˜:', e.message);
    }
  }

  // ë¡œê·¸ì¸ ë©”ì‹œì§€ í—¬í¼
  function _setLoginMsg(text, type){
    var msg=document.getElementById('loginMsg');
    if(!msg) return;
    msg.textContent=text;
    msg.className='login-msg'+(type==='ok'?' ok':'');
    msg.style.color=type==='warn'?'var(--accent2)':type==='ok'?'':'';
  }
  
  // ìˆ˜ë™ìœ¼ë¡œ admin ê³„ì • ì¬ìƒì„± (ë¡œê·¸ì¸ í™”ë©´ì—ì„œ í˜¸ì¶œ)
  async function _resetAdminAccount(){
    if(!sbIsConnected()){alert('Supabase ì—°ë™ í›„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.');return;}
    if(!confirm('admin ê³„ì •ì„ admin1234 ë¹„ë°€ë²ˆí˜¸ë¡œ ì´ˆê¸°í™”í•©ë‹ˆê¹Œ?')) return;
    try{
      // upsert (ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸, ì—†ìœ¼ë©´ ì‚½ì…)
      var res=await fetch(sbUrl+'/rest/v1/crm_users',{
        method:'POST',
        headers:{'Content-Type':'application/json','apikey':sbKey,'Authorization':'Bearer '+sbKey,
                 'Prefer':'resolution=merge-duplicates,return=minimal'},
        body:JSON.stringify([{id:'admin_init',name:'admin',pw_hash:_pwHash('admin1234'),
          role:'admin',is_active:true,created_at:new Date().toISOString()}])
      });
      var msg=document.getElementById('loginMsg');
      if(res.ok){
        msg.innerHTML='âœ“ admin ê³„ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!<br>'+
          '<span style="font-family:monospace;font-size:13px;color:var(--accent);font-weight:700">ID: admin / PW: admin1234</span>';
        msg.className='login-msg ok'; msg.style.color='';
        document.getElementById('loginName').value='admin';
        document.getElementById('loginPw').value='';
        document.getElementById('loginPw').focus();
      } else {
        var t=await res.text().catch(function(){return '';});
        msg.textContent='ì‹¤íŒ¨: '+t.slice(0,100);
        msg.style.color='var(--accent2)';
      }
    }catch(e){ alert('ì˜¤ë¥˜: '+e.message); }
  }
  
  
  
  // â”€â”€ ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬ (cross-origin "Script error." ëŒ€ì‹  ì‹¤ì œ ì—ëŸ¬ í‘œì‹œ) â”€â”€
  window.addEventListener('error', function(e){
    var msg = e.message || 'Unknown error';
    var src  = (e.filename||'').split('/').pop();
    var info = msg + (src ? ' [' + src + ':' + (e.lineno||'?') + ']' : '');
    var el = document.getElementById('_crmErrBox');
    if(!el){
      el = document.createElement('div');
      el.id = '_crmErrBox';
      el.style.cssText = 'position:fixed;bottom:60px;left:0;right:0;background:#c0392b;color:#fff;padding:10px 14px;font-size:12px;font-family:monospace;z-index:99999;white-space:pre-wrap;word-break:break-all;max-height:120px;overflow:auto';
      if(document.body) document.body.appendChild(el);
    }
    el.textContent = 'âš  ' + info;
  });
  window.addEventListener('unhandledrejection', function(e){
    var msg = e.reason && e.reason.message ? e.reason.message : String(e.reason);
    console.error('Unhandled Promise:', msg);
  });// CSS.escape polyfill (iOS Safari í˜¸í™˜)
  if(typeof CSS==='undefined'||!CSS.escape){
    (typeof CSS==='undefined'?window.CSS={}:CSS).escape=function(v){
      var s=String(v),r='',c;
      for(var i=0;i<s.length;i++){
        c=s.charCodeAt(i);
        if(c===0){r+='\uFFFD';}
        else if(c<32||(c>=127&&c<160)){r+='\\'+c.toString(16)+' ';}
        else if(i===0&&c>=48&&c<=57){r+='\\'+c.toString(16)+' ';}
        else if(i===1&&c>=48&&c<=57&&s.charCodeAt(0)===45){r+='\\'+c.toString(16)+' ';}
        else if(c>=128||c===45||c===95||(c>=48&&c<=57)||(c>=65&&c<=90)||(c>=97&&c<=122)){r+=s[i];}
        else{r+='\\'+s[i];}
      }
      return r;
    };
  }
  
  const I18N = {
    ko: {
      'ìŠ¤ë§ˆíŠ¸ ê³ ê°ê´€ë¦¬ ì‹œìŠ¤í…œ':'ìŠ¤ë§ˆíŠ¸ ê³ ê°ê´€ë¦¬ ì‹œìŠ¤í…œ',
      'ì—°ë½ì²˜':'ì—°ë½ì²˜','ì „ì²´ í™œë™':'ì „ì²´ í™œë™','íŒŒì¼ ê°€ì ¸ì˜¤ê¸°':'íŒŒì¼ ê°€ì ¸ì˜¤ê¸°',
      'í™œë™ ìœ í˜• ê´€ë¦¬':'í™œë™ ìœ í˜• ê´€ë¦¬','Supabase ì—°ë™':'Supabase ì—°ë™',
      'ì‚¬ìš© ê°€ì´ë“œ':'ì‚¬ìš© ê°€ì´ë“œ','ë¼ì´ì„ ìŠ¤ ì •ë³´':'ë¼ì´ì„ ìŠ¤ ì •ë³´',
      'íšŒì‚¬':'íšŒì‚¬','í™œë™':'í™œë™','ì´ë¦„, íšŒì‚¬ ê²€ìƒ‰...':'ì´ë¦„, íšŒì‚¬ ê²€ìƒ‰...',
      'ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.':'ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.','íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.':'íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.',
      'ë¨¼ì € ë‹´ë‹¹ìë¥¼ ì¶”ê°€í•˜ì„¸ìš”.':'ë¨¼ì € ë‹´ë‹¹ìë¥¼ ì¶”ê°€í•˜ì„¸ìš”.',
      'ë‹´ë‹¹ìë¥¼ ì„ íƒí•˜ì„¸ìš”.':'ë‹´ë‹¹ìë¥¼ ì„ íƒí•˜ì„¸ìš”.',
      'ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš”.':'ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš”.',
      'API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤.':'API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤.','API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.':'API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.',
      'ì˜¬ë°”ë¥¸ API í‚¤':'ì˜¬ë°”ë¥¸ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.',
      'íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.':'íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.',
      'CSV íŒŒì¼ì€ 1ê°œì”©':'CSV íŒŒì¼ì€ 1ê°œì”© ì²˜ë¦¬ë©ë‹ˆë‹¤. ë‹¤ë¥¸ íŒŒì¼ì€ ë¬´ì‹œë©ë‹ˆë‹¤.',
      'íŒŒì¼ ì´ˆê³¼':'íŒŒì¼ì´ 10MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.',
      'í™œë™ ì—°ê²° ì˜¤ë¥˜':'í™œë™ì„ ì—°ê²°í•  ì—°ë½ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤. ì—°ë½ì²˜ë¥¼ ë¨¼ì € ì²´í¬í•´ì£¼ì„¸ìš”.',
      'ì¶”ì¶œëœ ì •ë³´ ì—†ìŒ':'ì¶”ì¶œëœ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.',
      'ì¶”ì¶œëœ ì—°ë½ì²˜ ì—†ìŒ':'ì¶”ì¶œëœ ì—°ë½ì²˜ë‚˜ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤.',
      'ë³‘í•© ì•ˆ í•¨':'â€” ë³‘í•© ì•ˆ í•¨ â€”','ë™ê¸°í™” ì™„ë£Œ':'ë™ê¸°í™” ì™„ë£Œ Â· ',
      'ì•„ì§ ë™ê¸°í™” ì•ˆ ë¨':'ì•„ì§ ë™ê¸°í™” ì•ˆ ë¨','ê°œ íŒŒì¼':'ê°œ íŒŒì¼',
      'í˜„ì¬í‚¤':'(í˜„ì¬: ','ì´ë¦„ ì—†ìŒ':'ì´ë¦„ ì—†ìŒ',
      'ì‹ ê·œ':'ì‹ ê·œ','ì´':'ì´','ëª…':'ëª…','ê±´':'ê±´',
      'ë‹´ë‹¹ì ì¶”ê°€':'ë‹´ë‹¹ì ì¶”ê°€','í™œë™ ì—†ìŒ':'í™œë™ ì—†ìŒ',
      'ì—°ë½ì²˜ ì—†ìŒ':'ì—°ë½ì²˜ ì—†ìŒ','íšŒì‚¬ ì „ì²´ í™œë™':'íšŒì‚¬ ì „ì²´ í™œë™',
      'íŒ€ ë¯¸ë“±ë¡':'íŒ€ ë¯¸ë“±ë¡ â€” íšŒì‚¬ ìˆ˜ì •ì—ì„œ ìš°ë¦¬ íŒ€ ë‹´ë‹¹ìë¥¼ ì…ë ¥í•˜ë©´ í•„í„°ê°€ ìƒê¹ë‹ˆë‹¤',
      'ëŒ€í‘œì´ì‚¬':'ëŒ€í‘œì´ì‚¬','ìƒˆ ì—°ë½ì²˜':'ìƒˆ ì—°ë½ì²˜','ì—°ë½ì²˜ ìˆ˜ì •':'ì—°ë½ì²˜ ìˆ˜ì •',
      'í™œë™ ì¶”ê°€':'í™œë™ ì¶”ê°€','í™œë™ ìˆ˜ì •':'í™œë™ ìˆ˜ì •',
      'ì €ì¥':'ì €ì¥','ì·¨ì†Œ':'ì·¨ì†Œ','ìˆ˜ì •':'ìˆ˜ì •','ì‚­ì œ':'ì‚­ì œ','í™•ì¸':'í™•ì¸','ë‹«ê¸°':'ë‹«ê¸°',
      'ì—°ë„':'ì—°ë„','ì¸ì›':'ì¸ì›','ë§¤ì¶œ':'ë§¤ì¶œ','ì˜ì—…ì´ìµ':'ì˜ì—…ì´ìµ',
      'ìˆœì´ìµ':'ìˆœì´ìµ','ìì‚°':'ìì‚°','ë¶€ì±„':'ë¶€ì±„',
      'ì¸ì›(ëª…)':'ì¸ì›(ëª…)','ë§¤ì¶œ(M)':'ë§¤ì¶œ(M)',
      'ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...':'ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...','ì €ì¥ ì¤‘...':'ì €ì¥ ì¤‘...',
      'ì €ì¥ë¨':'ì €ì¥ë¨','ë¡œì»¬ ì €ì¥ ëª¨ë“œ':'ë¡œì»¬ ì €ì¥ ëª¨ë“œ',
      'ë¡œì»¬ ì €ì¥ ëª¨ë“œ_sync':'ë¡œì»¬ ì €ì¥ ëª¨ë“œ Â· ğŸ—„ í´ë¦­í•´ì„œ Supabase ì—°ë™',
      'íŒŒì¼ ë¶„ì„ ì¤‘...':'íŒŒì¼ ë¶„ì„ ì¤‘...',
      'ë¶„ì„ ì‹œì‘':'ğŸ” ë¶„ì„ ì‹œì‘','CSV ë¶„ì„í•˜ê¸°':'â¡ CSV ë¶„ì„í•˜ê¸°',
      'CSV ì½ëŠ” ì¤‘':'ğŸ“Š CSV íŒŒì¼ ì½ëŠ” ì¤‘...','CSV íŒŒì‹± ì¤‘':'ğŸ“Š CSV íŒŒì‹± ì¤‘...',
      'ëª… ì¶”ê°€ ì™„ë£Œ':'ëª… ì¶”ê°€ ì™„ë£Œ!',
      'ì¶”ê°€':'ì¶”ê°€','ì¤‘ë³µ ê±´ë„ˆëœ€':'ì¤‘ë³µ ê±´ë„ˆëœ€','ë¹ˆ í–‰ ê±´ë„ˆëœ€':'ë¹ˆ í–‰ ê±´ë„ˆëœ€',
      'í–‰ ê°ì§€ ë©”ì‹œì§€':'í–‰ ê°ì§€ Â· ì•„ë˜ì—ì„œ ì»¬ëŸ¼ ë§¤í•‘ì„ í™•ì¸í•˜ì„¸ìš”.',
      'ì €ì¥ëìŠµë‹ˆë‹¤':'âœ… ì €ì¥ëìŠµë‹ˆë‹¤. Supabaseì—ì„œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...',
      'URLê³¼ Key ì…ë ¥':'ë¨¼ì € URLê³¼ Keyë¥¼ ì…ë ¥í•˜ê³  ì €ì¥í•´ì£¼ì„¸ìš”.',
      'ë‚ ì§œ':'ë‚ ì§œ','ìœ í˜•':'ìœ í˜•','ë‚´ìš©':'ë‚´ìš©','ê¸ˆì•¡':'ê¸ˆì•¡','ë‹´ë‹¹ì':'ë‹´ë‹¹ì',
      'í™œë™ì´ ì—†ìŠµë‹ˆë‹¤':'í™œë™ì´ ì—†ìŠµë‹ˆë‹¤',
      'ì˜¤ëŠ˜':'ì˜¤ëŠ˜','ì´ë™ë©ë‹ˆë‹¤':'ì´ë™ë©ë‹ˆë‹¤. ì €ì¥ ì‹œ ì ìš©ë©ë‹ˆë‹¤.',
      'ì „ì²´ Në…„':'ì „ì²´ {n}ë…„','ì´ Nëª…':'ì´ {n}ëª…',
      '+ ì—°ë½ì²˜':'+ ì—°ë½ì²˜',
      'ì—°ë½ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤':'ì—°ë½ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤\n+ ë²„íŠ¼ìœ¼ë¡œ ì¶”ê°€í•˜ê±°ë‚˜ íŒŒì¼ì„ ê°€ì ¸ì˜¤ì„¸ìš”.',
      'ê°œ íŒŒì¼ ì„ íƒë¨':'ê°œ íŒŒì¼ ì„ íƒë¨',
      'ê°€ì ¸ì˜¤ëŠ” ì¤‘...':'ê°€ì ¸ì˜¤ëŠ” ì¤‘...',
      'í–‰ ì²˜ë¦¬ ì‹œì‘':'í–‰ ì²˜ë¦¬ ì‹œì‘',
      'CSV íŒŒì‹± ì˜¤ë¥˜':'CSV íŒŒì‹± ì˜¤ë¥˜',
      'íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤':'íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
      'ìœ í˜• ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”':'ìœ í˜• ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.',
      'ì „ì²´ í•„í„°':'ì „ì²´',
      'ë§ˆì§€ë§‰ ë™ê¸°í™”':'ë§ˆì§€ë§‰ ë™ê¸°í™”: ',
      'URL Key ì…ë ¥ ê²½ê³ ':'âš  URLê³¼ API Keyë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.',
      'Supabase URL ê²½ê³ ':'âš  Supabase Project URLì´ ì•„ë‹Œ ê²ƒ ê°™ìŠµë‹ˆë‹¤.',
      'URL Key ë¨¼ì €':'âš  URLê³¼ Keyë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.',
      'ì§„ë‹¨ ì¤‘':'ğŸ” ì§„ë‹¨ ì¤‘...',
      'ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤':'ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!',
      'íŒŒì¼ í¬ê¸°':'íŒŒì¼ í¬ê¸°',
      'CEO placeholder ì´ë¦„':'í™ê¸¸ë™',
      'CEO placeholder í˜„ì¬':'í˜„ì¬',
      'CEO placeholder ë©”ëª¨':'ë©”ëª¨',
      'â† ëª©ë¡ìœ¼ë¡œ':'â† ëª©ë¡ìœ¼ë¡œ',
      'íšŒì‚¬ ë³´ê¸°':'íšŒì‚¬ ë³´ê¸°',
      'ëª¨ë“  í™œë™ ë‚´ì—­':'ëª¨ë“  í™œë™ ë‚´ì—­ (ìµœì‹ ìˆœ)',
      'ì†Œì† íšŒì‚¬':'ì†Œì† íšŒì‚¬',
      'ê°œì¸ ì •ë³´':'ê°œì¸ ì •ë³´',
      'ê°œì¸ ì—°ë½ì²˜':'ê°œì¸ ì—°ë½ì²˜',
      'ì£¼ì†Œ (íšŒì‚¬ ê³µìœ )':'ì£¼ì†Œ (íšŒì‚¬ ê³µìœ )',
      'ë©”ëª¨':'ë©”ëª¨',
      'íšŒì‚¬ëª…':'íšŒì‚¬ëª…',
      'ìš°ë¦¬ íŒ€ ë‹´ë‹¹ì':'ìš°ë¦¬ íŒ€ ë‹´ë‹¹ì',
      'ë‹¤ë¥¸ íšŒì‚¬ì™€ ë³‘í•©':'ë‹¤ë¥¸ íšŒì‚¬ì™€ ë³‘í•©',
      'ëŒ€í‘œ ì—°ë½ì²˜':'ëŒ€í‘œ ì—°ë½ì²˜',
      'ì£¼ì†Œ':'ì£¼ì†Œ',
      'ìƒˆ ìœ í˜• ì¶”ê°€':'ìƒˆ ìœ í˜• ì¶”ê°€',
      'ë°œì£¼':'ë°œì£¼','ê²¬ì ':'ê²¬ì ','ë°©ë¬¸':'ë°©ë¬¸','í†µí™”':'í†µí™”','ê¸°íƒ€':'ê¸°íƒ€',
      'ì´ë©”ì¼':'ì´ë©”ì¼','ë¶€ì„œ':'ë¶€ì„œ','ì§ì±…':'ì§ì±…','ì„±':'ì„±','ì´ë¦„':'ì´ë¦„',
      'ì‚¬ë¬´ì‹¤':'ì‚¬ë¬´ì‹¤','íœ´ëŒ€í°':'íœ´ëŒ€í°','ì¶”ê°€ì—°ë½ì²˜':'ì¶”ê°€ì—°ë½ì²˜',
      'ì·¨ì„ì—°ë„':'ì·¨ì„ì—°ë„','í‡´ì„ì—°ë„':'í‡´ì„ì—°ë„','ë¹„ê³ ':'ë¹„ê³ ',
      'ì—†ì•¨ íšŒì‚¬':'ì—†ì•¨ íšŒì‚¬','í•©ì¹  íšŒì‚¬':'í•©ì¹  íšŒì‚¬',
      'í™œë™ í•¨ê»˜ ì‚­ì œ':'ê´€ë ¨ í™œë™ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤',
      'Supabase ìë™ë™ê¸°í™” ì•ˆë‚´':'Supabase ì—°ë™ ì‹œ ìë™ ë™ê¸°í™”ë©ë‹ˆë‹¤.',
      'ìˆœì°¨ ë¶„ì„':'ìˆœì°¨ ë¶„ì„í•©ë‹ˆë‹¤','ê°ì§€ ìœ í˜•':'ê°ì§€ëœ ìœ í˜•',
      'ëŒ€ìš©ëŸ‰ íŒŒì‹± ëª¨ë“œ':'ëŒ€ìš©ëŸ‰ ì§ì ‘ íŒŒì‹± ëª¨ë“œ',
      'í–‰ ì²˜ë¦¬ ì‹œì‘':'í–‰ ì²˜ë¦¬ ì‹œì‘','PDF ë¬¸ì„œ':'PDF ë¬¸ì„œ',
      'ì´ë¯¸ì§€':'ì´ë¯¸ì§€ (ëª…í•¨Â·ì‚¬ì§„)','í…ìŠ¤íŠ¸ íŒŒì¼':'í…ìŠ¤íŠ¸ íŒŒì¼',
      'ì‚¬ìš© ì•ˆ í•¨':'â€” ì‚¬ìš© ì•ˆ í•¨ â€”','CRM í•„ë“œ':'CRM í•„ë“œ','ë¯¸ë¦¬ë³´ê¸°':'ë¯¸ë¦¬ë³´ê¸°',
      'ì—†ìŒ':'ì—†ìŒ',
      'Claude API í‚¤ ì„¤ì •':'Claude API í‚¤ ì„¤ì •',
      'íŒŒì¼ ì—…ë¡œë“œ':'íŒŒì¼ ì—…ë¡œë“œ',
      'ì¶”ì¶œëœ ì—°ë½ì²˜ í™•ì¸ ë° ìˆ˜ì •':'ì¶”ì¶œëœ ì—°ë½ì²˜ í™•ì¸ ë° ìˆ˜ì •',
      'ğŸ“Š CSV ì»¬ëŸ¼ ë§¤í•‘ í™•ì¸':'ğŸ“Š CSV ì»¬ëŸ¼ ë§¤í•‘ í™•ì¸',
      'ê³µí†µ':'ê³µí†µ','ë‹´ë‹¹':'ë‹´ë‹¹','âœ ìˆ˜ì •':'âœ ìˆ˜ì •',
      'ë…„':'ë…„','ì „ì²´':'ì „ì²´','í˜„ì¬':'í˜„ì¬',
  
      'ğŸ‘¥ íŒ€':'ğŸ‘¥ íŒ€',
      'ì €ì¥ ì‹¤íŒ¨':'ì €ì¥ ì‹¤íŒ¨',
      'íšŒì‚¬ ë¯¸ì§€ì •':'íšŒì‚¬ ë¯¸ì§€ì •',
      'ğŸ—‘ ì‚­ì œ':'ğŸ—‘ ì‚­ì œ',
      'ï¼‹ ì¶”ê°€':'ï¼‹ ì¶”ê°€',
      'ï¼‹ í™œë™':'ï¼‹ í™œë™',
      'í–‰':'í–‰',
      'ì²˜ë¦¬ ì‹œì‘':'ì²˜ë¦¬ ì‹œì‘',
      'ìë™ ì—°ê²° ì•ˆë‚´':'(í™œë™ì€ ì—°ë½ì²˜ ì €ì¥ í›„ ìë™ ì—°ê²°)',
          'PINì„ ì…ë ¥í•˜ì„¸ìš”':'PINì„ ì…ë ¥í•˜ì„¸ìš”',
      'ì ê¸ˆ ìƒíƒœ':'ì ê¸ˆ ìƒíƒœ',
      'ë¶„ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”':'ë¶„ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”',
      'PIN ì˜¤ë¥˜':'PIN ì˜¤ë¥˜',
      'íšŒ ë‚¨ìŒ':'íšŒ ë‚¨ìŒ',
      'PIN ì´ˆê¸°í™” í™•ì¸':'PINì„ ì´ˆê¸°í™”í•˜ë©´ ì ê¸ˆì´ í•´ì œë©ë‹ˆë‹¤.\në°ì´í„°ëŠ” ìœ ì§€ë©ë‹ˆë‹¤. ê³„ì†í• ê¹Œìš”?',
      'PIN ë³€ê²½':'PIN ë³€ê²½',
      'PIN ì„¤ì •':'PIN ì„¤ì •',
      'í˜„ì¬ PINì„ ì…ë ¥í•˜ì„¸ìš”':'í˜„ì¬ PINì„ ì…ë ¥í•˜ì„¸ìš”',
      'ìƒˆ PIN 4ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”':'ìƒˆ PIN 4ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”',
      'PINì„ í•œ ë²ˆ ë” ì…ë ¥í•˜ì„¸ìš”':'í™•ì¸ì„ ìœ„í•´ í•œ ë²ˆ ë” ì…ë ¥í•˜ì„¸ìš”',
      'í˜„ì¬ PINì´ í‹€ë ¸ìŠµë‹ˆë‹¤':'í˜„ì¬ PINì´ í‹€ë ¸ìŠµë‹ˆë‹¤',
      'PINì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤':'PINì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤',
      'PINì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤':'âœ“ PINì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤',
      'PIN ì ê¸ˆì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?':'PIN ì ê¸ˆì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\në°ì´í„°ëŠ” ìœ ì§€ë©ë‹ˆë‹¤.',
      'PIN ì ê¸ˆ':'PIN ì ê¸ˆ',
      'ì…ë ¥ì í˜„í™©':'ì…ë ¥ì í˜„í™©',
      'ì‚¬ìš©ì ê´€ë¦¬':'ì‚¬ìš©ì ê´€ë¦¬',
      'ê³„ì •':'ê³„ì •',
      'AI ë¶„ì„ ì¤‘ ì•ˆë‚´':'Claude AIê°€ ì—°ë½ì²˜ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤',
      'PDF ê²°ê³¼ ì•ˆë‚´':'ë‚´ìš©ì„ í™•ì¸í•˜ê³  í•„ìš”í•˜ë©´ ìˆ˜ì • í›„ ì €ì¥í•˜ì„¸ìš”. ì²´í¬ëœ í•­ëª©ë§Œ CRMì— ì¶”ê°€ë©ë‹ˆë‹¤.',
      'sk- ì‹œì‘ ì˜¤ë¥˜':'âš  sk- ë¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤',
      'ë³µì‚¬ë¨':'âœ… ë³µì‚¬ë¨!',
      'SQL ë³µì‚¬':'ğŸ“‹ SQL ì „ì²´ ë³µì‚¬',
      'ì•„ë˜ëŠ” íŒŒì¼ ë‚´ìš©ì…ë‹ˆë‹¤':'ì•„ë˜ëŠ” íŒŒì¼ ë‚´ìš©ì…ë‹ˆë‹¤:',
      'í™•ì¸ ì‚¬í•­':'í™•ì¸ ì‚¬í•­',
      'APIí‚¤ ì‹œì‘ í™•ì¸':'API í‚¤ê°€ sk-ant- ë¡œ ì‹œì‘í•˜ëŠ”ì§€ í™•ì¸',
      'ëŒ€í‘œì „í™” ì—†ìŒ':'ëŒ€í‘œì „í™” ì—†ìŒ',
      'ì—°ë½ì²˜ ì‚­ì œ ê²½ê³ ':'ì´ ì—°ë½ì²˜ì™€ ê´€ë ¨ í™œë™ì´ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤. ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
      'ë³‘í•© ê²½ê³ ':'ë³‘í•© í›„ì—ëŠ” ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
      'ë³‘í•© ì‹¤í–‰':'ë³‘í•© ì‹¤í–‰',
      'ë‚ ì§œ *':'ë‚ ì§œ *','ê¸ˆì•¡':'ê¸ˆì•¡','ì œëª©':'ì œëª©','ë‚´ìš©':'ë‚´ìš©',
      'ìœ í˜• ê´€ë¦¬ ì•ˆë‚´':'ìœ í˜•ì„ ì¶”ê°€í•˜ê±°ë‚˜ ìˆœì„œë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      'ê¸°ë³¸ ìœ í˜• ì•ˆë‚´':'ê¸°ë³¸ ìœ í˜•(ë°œì£¼Â·ê²¬ì Â·ë°©ë¬¸Â·í†µí™”Â·ê¸°íƒ€)ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
      'ìƒ‰ìƒ':'ìƒ‰ìƒ',
      'í™œë™ ì‚­ì œ ê²½ê³ ':'ì´ í™œë™ì„ ì‚­ì œí•˜ë©´ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
      'ì €ì¥ í›„ ê³„ì†':'ì €ì¥ í›„ ê³„ì†',
      'ëŒ€ìš©ëŸ‰ CSV':'ëŒ€ìš©ëŸ‰ CSV','ë„ ì§€ì›í•©ë‹ˆë‹¤':'ë„ ì§€ì›í•©ë‹ˆë‹¤.',
      'í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œ':'í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œ',
      'ë¶„ì„ ì‹¤íŒ¨':'ë¶„ì„ ì‹¤íŒ¨',
      'CSV ë§¤í•‘ ì•ˆë‚´':'ìë™ìœ¼ë¡œ ê°ì§€ëœ ë§¤í•‘ì…ë‹ˆë‹¤. í•„ìš”í•˜ë©´ ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš”.',
      'ì¶”ê°€ íŒŒì¼ ê°€ì ¸ì˜¤ê¸°':'ì¶”ê°€ íŒŒì¼ ê°€ì ¸ì˜¤ê¸°',
      'ì‹œì‘í•˜ê¸° â†’':'ì‹œì‘í•˜ê¸° â†’',
      'ì—°ë™ í•´ì œ':'ì—°ë™ í•´ì œ',
      'ì´ë©”ì¼ ë¼ë²¨':'ì´ë©”ì¼',
      // ì‹ ê·œ ì¶”ê°€
      'íšŒì‚¬ ì •ë³´':'íšŒì‚¬ ì •ë³´',
      'ê¸°ë³¸ ì •ë³´':'ê¸°ë³¸ ì •ë³´','ì¬ë¬´ í˜„í™©':'ì¬ë¬´ í˜„í™©','ëŒ€í‘œì´ì‚¬ ì´ë ¥':'ëŒ€í‘œì´ì‚¬ ì´ë ¥',
      'íšŒì‚¬ëª… ë¼ë²¨':'íšŒì‚¬ëª… (ê°™ì€ íšŒì‚¬ ì§ì›ì€ ë™ì¼ ì´ë¦„ ì…ë ¥)',
      'íšŒì‚¬ëª… ìˆ˜ì • ë¼ë²¨':'íšŒì‚¬ëª… (ìˆ˜ì • ì‹œ ì†Œì† ì§ì› ì „ì²´ì— ìë™ ë°˜ì˜)',
      'ì„± *':'ì„± *','ì´ë¦„ *':'ì´ë¦„ *',
      'íŒ€ëª…':'íŒ€ëª…','ë‹´ë‹¹ì ì´ë¦„':'ë‹´ë‹¹ì ì´ë¦„',
      'íŒ€ëª… placeholder':'ì˜ì—…1íŒ€',
      'ë³‘í•© ë¼ë²¨':'ë³‘í•©í•  íšŒì‚¬ ì„ íƒ (ì—†ì• ê³  ì‹¶ì€ ìª½)',
      'ëŒ€í‘œ ì „í™”':'ëŒ€í‘œ ì „í™”','íŒ©ìŠ¤':'íŒ©ìŠ¤',
      'ì¬ë¬´ ì•ˆë‚´':'ì—°ë„ë³„ ì¬ë¬´ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì„¸ìš”. ë‹¨ìœ„: ë°±ë§Œì›',
      'ì¬ë¬´ ë‹¨ìœ„ ì•ˆë‚´':'* ê¸ˆì•¡ ë‹¨ìœ„: ë°±ë§Œì› / ë¹ˆì¹¸ì€ ë¯¸ì…ë ¥ìœ¼ë¡œ ì²˜ë¦¬',
      'ì—°ë„ ì¶”ê°€':'ï¼‹ ì—°ë„ ì¶”ê°€',
      'CEO ì•ˆë‚´':'ëŒ€í‘œì´ì‚¬ ë³€ê²½ ì´ë ¥ì„ ìµœì‹ ìˆœìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.',
      'Supabase ì—°ë™ ëª¨ë‹¬':'ğŸ—„ Supabase ì—°ë™',
      'íŒŒì¼ ëª¨ë‹¬ ì œëª©':'ğŸ—‚ íŒŒì¼ì—ì„œ ì—°ë½ì²˜ ìë™ ì¶”ì¶œ',
      'ì—°ë½ì²˜ ì‚­ì œ':'ì—°ë½ì²˜ ì‚­ì œ','íšŒì‚¬ ë³‘í•©':'íšŒì‚¬ ë³‘í•©','í™œë™ ì‚­ì œ':'í™œë™ ì‚­ì œ',
      'ìš°ë¦¬íŒ€ ì„¤ëª…':'ì´ íšŒì‚¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” ìš°ë¦¬ íŒ€ ì •ë³´ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤.',
      'ë³‘í•© ì„¤ëª…':'ê°™ì€ íšŒì‚¬ê°€ ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ë“±ë¡ëœ ê²½ìš° ë³‘í•©í•©ë‹ˆë‹¤. ë³‘í•© ëŒ€ìƒì˜ ëª¨ë“  ì§ì›ì´ í˜„ì¬ íšŒì‚¬ë¡œ ì´ë™ë©ë‹ˆë‹¤.',
      'ì£¼ì†Œ ì•ˆë‚´':'â„¹ ë“±ë¡ëœ íšŒì‚¬ ì£¼ì†Œê°€ ì ìš©ë©ë‹ˆë‹¤. ë³€ê²½í•˜ë©´ íšŒì‚¬ ì „ì²´ì— ë°˜ì˜ë©ë‹ˆë‹¤.',
      'ìœ í˜• *':'ìœ í˜• *',
      'ì´ë©”ì¼ th':'ì´ë©”ì¼',
    },
    en: {
      'ìŠ¤ë§ˆíŠ¸ ê³ ê°ê´€ë¦¬ ì‹œìŠ¤í…œ':'Smart CRM System',
      'ì—°ë½ì²˜':'Contacts','ì „ì²´ í™œë™':'All Activities','íŒŒì¼ ê°€ì ¸ì˜¤ê¸°':'Import File',
      'í™œë™ ìœ í˜• ê´€ë¦¬':'Activity Types','Supabase ì—°ë™':'Supabase Sync',
      'ì‚¬ìš© ê°€ì´ë“œ':'User Guide','ë¼ì´ì„ ìŠ¤ ì •ë³´':'License',
      'íšŒì‚¬':'Companies','í™œë™':'Activities','ì´ë¦„, íšŒì‚¬ ê²€ìƒ‰...':'Search name, company...',
      'ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.':'Please enter a name.','íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.':'Please enter a company name.',
      'ë¨¼ì € ë‹´ë‹¹ìë¥¼ ì¶”ê°€í•˜ì„¸ìš”.':'Please add a contact first.',
      'ë‹´ë‹¹ìë¥¼ ì„ íƒí•˜ì„¸ìš”.':'Please select a contact.',
      'ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš”.':'Please enter a date.',
      'API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤.':'No API key found.','API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.':'Please enter your API key.',
      'ì˜¬ë°”ë¥¸ API í‚¤':'Please enter a valid API key.',
      'íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.':'Please select a file first.',
      'CSV íŒŒì¼ì€ 1ê°œì”©':'CSV files are processed one at a time.',
      'íŒŒì¼ ì´ˆê³¼':'File exceeds 10MB.',
      'í™œë™ ì—°ê²° ì˜¤ë¥˜':'No contacts selected. Please check contacts first.',
      'ì¶”ì¶œëœ ì •ë³´ ì—†ìŒ':'No information extracted.',
      'ì¶”ì¶œëœ ì—°ë½ì²˜ ì—†ìŒ':'No contacts or activities found.',
      'ë³‘í•© ì•ˆ í•¨':'â€” No merge â€”','ë™ê¸°í™” ì™„ë£Œ':'Synced Â· ',
      'ì•„ì§ ë™ê¸°í™” ì•ˆ ë¨':'Not synced yet','ê°œ íŒŒì¼':' files',
      'í˜„ì¬í‚¤':'(current: ','ì´ë¦„ ì—†ìŒ':'Unnamed',
      'ì‹ ê·œ':'new','ì´':'','ëª…':'contacts','ê±´':'activities',
      'ë‹´ë‹¹ì ì¶”ê°€':'+ Add Contact','í™œë™ ì—†ìŒ':'No activities',
      'ì—°ë½ì²˜ ì—†ìŒ':'No contact info','íšŒì‚¬ ì „ì²´ í™œë™':'Company Activities',
      'íŒ€ ë¯¸ë“±ë¡':'No team â€” add members in Company settings',
      'ëŒ€í‘œì´ì‚¬':'CEO','ìƒˆ ì—°ë½ì²˜':'New Contact','ì—°ë½ì²˜ ìˆ˜ì •':'Edit Contact',
      'í™œë™ ì¶”ê°€':'Add Activity','í™œë™ ìˆ˜ì •':'Edit Activity',
      'ì €ì¥':'Save','ì·¨ì†Œ':'Cancel','ìˆ˜ì •':'Edit','ì‚­ì œ':'Delete','í™•ì¸':'OK','ë‹«ê¸°':'Close',
      'ì—°ë„':'Year','ì¸ì›':'Staff','ë§¤ì¶œ':'Revenue','ì˜ì—…ì´ìµ':'Op.Profit',
      'ìˆœì´ìµ':'Net Profit','ìì‚°':'Assets','ë¶€ì±„':'Liabilities',
      'ì¸ì›(ëª…)':'Employees','ë§¤ì¶œ(M)':'Revenue(M)',
      'ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...':'Loading...','ì €ì¥ ì¤‘...':'Saving...',
      'ì €ì¥ë¨':'Saved','ë¡œì»¬ ì €ì¥ ëª¨ë“œ':'Local mode',
      'ë¡œì»¬ ì €ì¥ ëª¨ë“œ_sync':'Local mode Â· Click ğŸ—„ to sync',
      'íŒŒì¼ ë¶„ì„ ì¤‘...':'Analyzing...',
      'ë¶„ì„ ì‹œì‘':'ğŸ” Analyze','CSV ë¶„ì„í•˜ê¸°':'â¡ Parse CSV',
      'CSV ì½ëŠ” ì¤‘':'ğŸ“Š Reading CSV...','CSV íŒŒì‹± ì¤‘':'ğŸ“Š Parsing CSV...',
      'ëª… ì¶”ê°€ ì™„ë£Œ':' contacts added!',
      'ì¶”ê°€':'Added','ì¤‘ë³µ ê±´ë„ˆëœ€':'Duplicates skipped','ë¹ˆ í–‰ ê±´ë„ˆëœ€':'Empty rows skipped',
      'í–‰ ê°ì§€ ë©”ì‹œì§€':' rows detected Â· Check column mapping below.',
      'ì €ì¥ëìŠµë‹ˆë‹¤':'âœ… Saved. Loading from Supabase...',
      'URLê³¼ Key ì…ë ¥':'Please enter URL and Key first.',
      'ë‚ ì§œ':'Date','ìœ í˜•':'Type','ë‚´ìš©':'Content','ê¸ˆì•¡':'Amount','ë‹´ë‹¹ì':'Contact',
      'í™œë™ì´ ì—†ìŠµë‹ˆë‹¤':'No activities found',
      'ì˜¤ëŠ˜':'today','ì´ë™ë©ë‹ˆë‹¤':'will be moved. Applied on save.',
      'ì „ì²´ Në…„':'All {n} yr','ì´ Nëª…':'{n} total',
      '+ ì—°ë½ì²˜':'+ Contact',
      'ì—°ë½ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤':'No contacts yet.\nClick ï¼‹ to add or import a file.',
      'ê°œ íŒŒì¼ ì„ íƒë¨':' files selected',
      'ê°€ì ¸ì˜¤ëŠ” ì¤‘...':'Importing...',
      'í–‰ ì²˜ë¦¬ ì‹œì‘':'rows to process',
      'CSV íŒŒì‹± ì˜¤ë¥˜':'CSV parse error',
      'íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤':'Unable to read file.',
      'ìœ í˜• ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”':'Please enter a type name.',
      'ì „ì²´ í•„í„°':'All',
      'ë§ˆì§€ë§‰ ë™ê¸°í™”':'Last sync: ',
      'URL Key ì…ë ¥ ê²½ê³ ':'âš  Please enter both URL and API Key.',
      'Supabase URL ê²½ê³ ':'âš  This does not appear to be a Supabase URL.',
      'URL Key ë¨¼ì €':'âš  Please enter URL and Key first.',
      'ì§„ë‹¨ ì¤‘':'ğŸ” Diagnosing...',
      'ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤':'added!',
      'íŒŒì¼ í¬ê¸°':'File size',
      'CEO placeholder ì´ë¦„':'John Doe',
      'CEO placeholder í˜„ì¬':'present',
      'CEO placeholder ë©”ëª¨':'note',
      'â† ëª©ë¡ìœ¼ë¡œ':'â† Back',
      'íšŒì‚¬ ë³´ê¸°':'View Company',
      'ëª¨ë“  í™œë™ ë‚´ì—­':'All Activities (latest first)',
      'ì†Œì† íšŒì‚¬':'Company',
      'ê°œì¸ ì •ë³´':'Personal Info',
      'ê°œì¸ ì—°ë½ì²˜':'Contact Info',
      'ì£¼ì†Œ (íšŒì‚¬ ê³µìœ )':'Address (shared)',
      'ë©”ëª¨':'Memo',
      'íšŒì‚¬ëª…':'Company Name',
      'ìš°ë¦¬ íŒ€ ë‹´ë‹¹ì':'Our Team Members',
      'ë‹¤ë¥¸ íšŒì‚¬ì™€ ë³‘í•©':'Merge with Another Company',
      'ëŒ€í‘œ ì—°ë½ì²˜':'Main Contact',
      'ì£¼ì†Œ':'Address',
      'ìƒˆ ìœ í˜• ì¶”ê°€':'Add New Type',
      'ë°œì£¼':'Order','ê²¬ì ':'Quote','ë°©ë¬¸':'Visit','í†µí™”':'Call','ê¸°íƒ€':'Other',
      'ì´ë©”ì¼':'Email','ë¶€ì„œ':'Dept','ì§ì±…':'Title','ì„±':'Last','ì´ë¦„':'First',
      'ì‚¬ë¬´ì‹¤':'Office','íœ´ëŒ€í°':'Mobile','ì¶”ê°€ì—°ë½ì²˜':'Extra',
      'ì·¨ì„ì—°ë„':'From','í‡´ì„ì—°ë„':'To','ë¹„ê³ ':'Note',
      'ì—†ì•¨ íšŒì‚¬':'Remove','í•©ì¹  íšŒì‚¬':'Keep',
      'í™œë™ í•¨ê»˜ ì‚­ì œ':'activities will also be deleted',
      'Supabase ìë™ë™ê¸°í™” ì•ˆë‚´':'Auto-synced if Supabase is connected.',
      'ìˆœì°¨ ë¶„ì„':'Processing sequentially','ê°ì§€ ìœ í˜•':'Detected type',
      'ëŒ€ìš©ëŸ‰ íŒŒì‹± ëª¨ë“œ':'Large file direct parse mode',
      'í–‰ ì²˜ë¦¬ ì‹œì‘':'rows to process','PDF ë¬¸ì„œ':'PDF',
      'ì´ë¯¸ì§€':'Image','í…ìŠ¤íŠ¸ íŒŒì¼':'Text file',
      'ì‚¬ìš© ì•ˆ í•¨':'â€” None â€”','CRM í•„ë“œ':'CRM Field','ë¯¸ë¦¬ë³´ê¸°':'Preview',
      'ì—†ìŒ':'None',
      'Claude API í‚¤ ì„¤ì •':'Claude API Key Setup',
      'íŒŒì¼ ì—…ë¡œë“œ':'File Upload',
      'ì¶”ì¶œëœ ì—°ë½ì²˜ í™•ì¸ ë° ìˆ˜ì •':'Review & Edit Extracted Contacts',
      'ğŸ“Š CSV ì»¬ëŸ¼ ë§¤í•‘ í™•ì¸':'ğŸ“Š CSV Column Mapping',
      'ê³µí†µ':'Shared','ë‹´ë‹¹':'In charge','âœ ìˆ˜ì •':'âœ Edit',
      'ë…„':' yr','ì „ì²´':'All','í˜„ì¬':'present',
  
      'ğŸ‘¥ íŒ€':'ğŸ‘¥ Team',
      'ì €ì¥ ì‹¤íŒ¨':'Save failed',
      'ëŒ€í‘œì „í™” ì—†ìŒ':'No main phone',
      'íšŒì‚¬ ë¯¸ì§€ì •':'No Company',
      'ğŸ—‘ ì‚­ì œ':'ğŸ—‘ Del',
      'ï¼‹ ì¶”ê°€':'ï¼‹ Add',
      'ï¼‹ í™œë™':'ï¼‹ Activity',
      'í–‰':' rows',
      'ì²˜ë¦¬ ì‹œì‘':'to process',
      'ìë™ ì—°ê²° ì•ˆë‚´':'(activities auto-linked after saving contacts)',
          'PINì„ ì…ë ¥í•˜ì„¸ìš”':'Enter your PIN',
      'ì ê¸ˆ ìƒíƒœ':'Locked',
      'ë¶„ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”':' min remaining',
      'PIN ì˜¤ë¥˜':'Wrong PIN',
      'íšŒ ë‚¨ìŒ':' tries left',
      'PIN ì´ˆê¸°í™” í™•ì¸':'Reset PIN? This will disable the lock.\nYour data will be kept.',
      'PIN ë³€ê²½':'Change PIN',
      'PIN ì„¤ì •':'Set PIN',
      'í˜„ì¬ PINì„ ì…ë ¥í•˜ì„¸ìš”':'Enter current PIN',
      'ìƒˆ PIN 4ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”':'Enter new 4-digit PIN',
      'PINì„ í•œ ë²ˆ ë” ì…ë ¥í•˜ì„¸ìš”':'Confirm your new PIN',
      'í˜„ì¬ PINì´ í‹€ë ¸ìŠµë‹ˆë‹¤':'Wrong current PIN',
      'PINì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤':'PINs do not match',
      'PINì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤':'âœ“ PIN set successfully',
      'PIN ì ê¸ˆì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?':'Disable PIN lock?\nYour data will be kept.',
      'PIN ì ê¸ˆ':'PIN Lock',
      'ì…ë ¥ì í˜„í™©':'Input Stats',
      'ì‚¬ìš©ì ê´€ë¦¬':'User Management',
      'ê³„ì •':'Account',
      'AI ë¶„ì„ ì¤‘ ì•ˆë‚´':'Claude AI is extracting contact info',
      'PDF ê²°ê³¼ ì•ˆë‚´':'Review extracted info and edit if needed. Only checked items will be added.',
      'sk- ì‹œì‘ ì˜¤ë¥˜':'âš  Key must start with sk-',
      'ë³µì‚¬ë¨':'âœ… Copied!',
      'SQL ë³µì‚¬':'ğŸ“‹ Copy SQL',
      'ì•„ë˜ëŠ” íŒŒì¼ ë‚´ìš©ì…ë‹ˆë‹¤':'Here is the file content:',
      'í™•ì¸ ì‚¬í•­':'Check these:',
      'APIí‚¤ ì‹œì‘ í™•ì¸':'Confirm API key starts with sk-ant-',
      'ì—°ë½ì²˜ ì‚­ì œ ê²½ê³ ':'This contact and all related activities will be permanently deleted.',
      'ë³‘í•© ê²½ê³ ':'This cannot be undone after merging.',
      'ë³‘í•© ì‹¤í–‰':'Merge Now',
      'ë‚ ì§œ *':'Date *','ê¸ˆì•¡':'Amount','ì œëª©':'Title','ë‚´ìš©':'Content',
      'ìœ í˜• ê´€ë¦¬ ì•ˆë‚´':'Add types or reorder them.',
      'ê¸°ë³¸ ìœ í˜• ì•ˆë‚´':'Default types (Order/Quote/Visit/Call/Other) cannot be deleted.',
      'ìƒ‰ìƒ':'Color',
      'í™œë™ ì‚­ì œ ê²½ê³ ':'This activity will be permanently deleted.',
      'ì €ì¥ í›„ ê³„ì†':'Save & Continue',
      'ëŒ€ìš©ëŸ‰ CSV':'Large CSV','ë„ ì§€ì›í•©ë‹ˆë‹¤':' supported.',
      'í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œ':'Click or drag file to upload',
      'ë¶„ì„ ì‹¤íŒ¨':'Analysis Failed',
      'CSV ë§¤í•‘ ì•ˆë‚´':'Auto-detected mapping. Change via dropdown if needed.',
      'ì¶”ê°€ íŒŒì¼ ê°€ì ¸ì˜¤ê¸°':'Import More Files',
      'ì‹œì‘í•˜ê¸° â†’':'Get Started â†’',
      'ì—°ë™ í•´ì œ':'Disconnect',
      'ì´ë©”ì¼ ë¼ë²¨':'Email',
      // ì‹ ê·œ ì¶”ê°€
      'íšŒì‚¬ ì •ë³´':'Company Info',
      'ê¸°ë³¸ ì •ë³´':'Basic Info','ì¬ë¬´ í˜„í™©':'Financials','ëŒ€í‘œì´ì‚¬ ì´ë ¥':'CEO History',
      'íšŒì‚¬ëª… ë¼ë²¨':'Company name (use the same name for all employees)',
      'íšŒì‚¬ëª… ìˆ˜ì • ë¼ë²¨':'Company name (changes apply to all employees)',
      'ì„± *':'Last *','ì´ë¦„ *':'First *',
      'íŒ€ëª…':'Team','ë‹´ë‹¹ì ì´ë¦„':'Contact Name',
      'íŒ€ëª… placeholder':'Sales Team',
      'ë³‘í•© ë¼ë²¨':'Select company to merge (the one to remove)',
      'ëŒ€í‘œ ì „í™”':'Main Phone','íŒ©ìŠ¤':'Fax',
      'ì¬ë¬´ ì•ˆë‚´':'Enter annual financial data. Unit: million KRW',
      'ì¬ë¬´ ë‹¨ìœ„ ì•ˆë‚´':'* Amount in millions / Leave blank if unknown',
      'ì—°ë„ ì¶”ê°€':'ï¼‹ Add Year',
      'CEO ì•ˆë‚´':'Manage CEO history in reverse chronological order.',
      'Supabase ì—°ë™ ëª¨ë‹¬':'ğŸ—„ Supabase Sync',
      'íŒŒì¼ ëª¨ë‹¬ ì œëª©':'ğŸ—‚ Import Contacts from File',
      'ì—°ë½ì²˜ ì‚­ì œ':'Delete Contact','íšŒì‚¬ ë³‘í•©':'Merge Companies','í™œë™ ì‚­ì œ':'Delete Activity',
      'ìš°ë¦¬íŒ€ ì„¤ëª…':'Record which team in your organization handles this company.',
      'ë³‘í•© ì„¤ëª…':'Use this if the same company has been registered under different names.',
      'ì£¼ì†Œ ì•ˆë‚´':'â„¹ Saved company address applied. Changes will reflect across the company.',
      'ìœ í˜• *':'Type *',
      'ì´ë©”ì¼ th':'Email',
    },
    ja: {
      'ìŠ¤ë§ˆíŠ¸ ê³ ê°ê´€ë¦¬ ì‹œìŠ¤í…œ':'ã‚¹ãƒãƒ¼ãƒˆé¡§å®¢ç®¡ç†',
      'ì—°ë½ì²˜':'é€£çµ¡å…ˆ','ì „ì²´ í™œë™':'å…¨æ´»å‹•','íŒŒì¼ ê°€ì ¸ì˜¤ê¸°':'ãƒ•ã‚¡ã‚¤ãƒ«å–è¾¼',
      'í™œë™ ìœ í˜• ê´€ë¦¬':'æ´»å‹•ã‚¿ã‚¤ãƒ—','Supabase ì—°ë™':'Supabaseé€£æº',
      'ì‚¬ìš© ê°€ì´ë“œ':'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ‰','ë¼ì´ì„ ìŠ¤ ì •ë³´':'ãƒ©ã‚¤ã‚»ãƒ³ã‚¹',
      'íšŒì‚¬':'ä¼šç¤¾','í™œë™':'æ´»å‹•','ì´ë¦„, íšŒì‚¬ ê²€ìƒ‰...':'åå‰ãƒ»ä¼šç¤¾ã§æ¤œç´¢...',
      'ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.':'åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚','íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.':'ä¼šç¤¾åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
      'ë¨¼ì € ë‹´ë‹¹ìë¥¼ ì¶”ê°€í•˜ì„¸ìš”.':'å…ˆã«æ‹…å½“è€…ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚',
      'ë‹´ë‹¹ìë¥¼ ì„ íƒí•˜ì„¸ìš”.':'æ‹…å½“è€…ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚',
      'ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš”.':'æ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
      'API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤.':'APIã‚­ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“ã€‚','API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.':'APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
      'ì˜¬ë°”ë¥¸ API í‚¤':'æ­£ã—ã„APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
      'íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.':'å…ˆã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚',
      'CSV íŒŒì¼ì€ 1ê°œì”©':'CSVã¯1ãƒ•ã‚¡ã‚¤ãƒ«ãšã¤å‡¦ç†ã•ã‚Œã¾ã™ã€‚',
      'íŒŒì¼ ì´ˆê³¼':'ãƒ•ã‚¡ã‚¤ãƒ«ãŒ10MBã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚',
      'í™œë™ ì—°ê²° ì˜¤ë¥˜':'é€£çµ¡å…ˆãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚',
      'ì¶”ì¶œëœ ì •ë³´ ì—†ìŒ':'æƒ…å ±ãŒæŠ½å‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚',
      'ì¶”ì¶œëœ ì—°ë½ì²˜ ì—†ìŒ':'é€£çµ¡å…ˆã‚„æ´»å‹•ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚',
      'ë³‘í•© ì•ˆ í•¨':'â€” çµ±åˆã—ãªã„ â€”','ë™ê¸°í™” ì™„ë£Œ':'åŒæœŸå®Œäº† Â· ',
      'ì•„ì§ ë™ê¸°í™” ì•ˆ ë¨':'æœªåŒæœŸ','ê°œ íŒŒì¼':'ä»¶ãƒ•ã‚¡ã‚¤ãƒ«',
      'í˜„ì¬í‚¤':'(ç¾åœ¨: ','ì´ë¦„ ì—†ìŒ':'åå‰ãªã—',
      'ì‹ ê·œ':'æ–°è¦','ì´':'è¨ˆ','ëª…':'ä»¶','ê±´':'ä»¶',
      'ë‹´ë‹¹ì ì¶”ê°€':'ï¼‹ æ‹…å½“è€…è¿½åŠ ','í™œë™ ì—†ìŒ':'æ´»å‹•ãªã—',
      'ì—°ë½ì²˜ ì—†ìŒ':'é€£çµ¡å…ˆãªã—','íšŒì‚¬ ì „ì²´ í™œë™':'ä¼šç¤¾ã®æ´»å‹•',
      'íŒ€ ë¯¸ë“±ë¡':'ãƒãƒ¼ãƒ æœªç™»éŒ² â€” ä¼šç¤¾è¨­å®šã§æ‹…å½“è€…ã‚’è¿½åŠ ã™ã‚‹ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™',
      'ëŒ€í‘œì´ì‚¬':'ä»£è¡¨å–ç· å½¹','ìƒˆ ì—°ë½ì²˜':'æ–°è¦é€£çµ¡å…ˆ','ì—°ë½ì²˜ ìˆ˜ì •':'é€£çµ¡å…ˆç·¨é›†',
      'í™œë™ ì¶”ê°€':'æ´»å‹•è¿½åŠ ','í™œë™ ìˆ˜ì •':'æ´»å‹•ç·¨é›†',
      'ì €ì¥':'ä¿å­˜','ì·¨ì†Œ':'ã‚­ãƒ£ãƒ³ã‚»ãƒ«','ìˆ˜ì •':'ç·¨é›†','ì‚­ì œ':'å‰Šé™¤','í™•ì¸':'ç¢ºèª','ë‹«ê¸°':'é–‰ã˜ã‚‹',
      'ì—°ë„':'å¹´åº¦','ì¸ì›':'äººå“¡','ë§¤ì¶œ':'å£²ä¸Š','ì˜ì—…ì´ìµ':'å–¶æ¥­åˆ©ç›Š',
      'ìˆœì´ìµ':'ç´”åˆ©ç›Š','ìì‚°':'è³‡ç”£','ë¶€ì±„':'è² å‚µ',
      'ì¸ì›(ëª…)':'äººå“¡(å)','ë§¤ì¶œ(M)':'å£²ä¸Š(M)',
      'ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...':'èª­è¾¼ä¸­...','ì €ì¥ ì¤‘...':'ä¿å­˜ä¸­...',
      'ì €ì¥ë¨':'ä¿å­˜æ¸ˆ','ë¡œì»¬ ì €ì¥ ëª¨ë“œ':'ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰',
      'ë¡œì»¬ ì €ì¥ ëª¨ë“œ_sync':'ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ Â· ğŸ—„ ã‚¯ãƒªãƒƒã‚¯ã§åŒæœŸ',
      'íŒŒì¼ ë¶„ì„ ì¤‘...':'ãƒ•ã‚¡ã‚¤ãƒ«è§£æä¸­...',
      'ë¶„æ ì‹œì‘':'ğŸ” è§£æé–‹å§‹','CSV ë¶„ì„í•˜ê¸°':'â¡ CSVè§£æ',
      'CSV ì½ëŠ” ì¤‘':'ğŸ“Š CSVèª­è¾¼ä¸­...','CSV íŒŒì‹± ì¤‘':'ğŸ“Š CSVè§£æä¸­...',
      'ëª… ì¶”ê°€ ì™„ë£Œ':'ä»¶è¿½åŠ å®Œäº†ï¼',
      'ì¶”ê°€':'è¿½åŠ ','ì¤‘ë³µ ê±´ë„ˆëœ€':'é‡è¤‡ã‚¹ã‚­ãƒƒãƒ—','ë¹ˆ í–‰ ê±´ë„ˆëœ€':'ç©ºè¡Œã‚¹ã‚­ãƒƒãƒ—',
      'í–‰ ê°ì§€ ë©”ì‹œì§€':'è¡Œæ¤œå‡º Â· åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚',
      'ì €ì¥ëìŠµë‹ˆë‹¤':'âœ… ä¿å­˜ã—ã¾ã—ãŸã€‚Supabaseã‹ã‚‰èª­è¾¼ä¸­...',
      'URLê³¼ Key ì…ë ¥':'URLã¨Keyã‚’å…ˆã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
      'ë‚ ì§œ':'æ—¥ä»˜','ìœ í˜•':'ç¨®åˆ¥','ë‚´ìš©':'å†…å®¹','ê¸ˆì•¡':'é‡‘é¡','ë‹´ë‹¹ì':'æ‹…å½“è€…',
      'í™œë™ì´ ì—†ìŠµë‹ˆë‹¤':'æ´»å‹•ãŒã‚ã‚Šã¾ã›ã‚“',
      'ì˜¤ëŠ˜':'æœ¬æ—¥','ì´ë™ë©ë‹ˆë‹¤':'ãŒç§»å‹•ã•ã‚Œã¾ã™ã€‚ä¿å­˜æ™‚ã«é©ç”¨ã€‚',
      'ì „ì²´ Në…„':'å…¨{n}å¹´','ì´ Nëª…':'è¨ˆ{n}å',
      '+ ì—°ë½ì²˜':'+ é€£çµ¡å…ˆ',
      'ì—°ë½ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤':'é€£çµ¡å…ˆãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚\nï¼‹ãƒœã‚¿ãƒ³ã§è¿½åŠ ã¾ãŸã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–ã‚Šè¾¼ã‚“ã§ãã ã•ã„ã€‚',
      'ê°œ íŒŒì¼ ì„ íƒë¨':'ä»¶ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ¸ˆã¿',
      'ê°€ì ¸ì˜¤ëŠ” ì¤‘...':'ã‚¤ãƒ³ãƒãƒ¼ãƒˆä¸­...',
      'í–‰ ì²˜ë¦¬ ì‹œì‘':'è¡Œå‡¦ç†é–‹å§‹',
      'CSV íŒŒì‹± ì˜¤ë¥˜':'CSVãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼',
      'íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤':'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã€‚',
      'ìœ í˜• ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”':'ã‚¿ã‚¤ãƒ—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
      'ì „ì²´ í•„í„°':'å…¨ä½“',
      'ë§ˆì§€ë§‰ ë™ê¸°í™”':'æœ€çµ‚åŒæœŸ: ',
      'URL Key ì…ë ¥ ê²½ê³ ':'âš  URLã¨APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
      'Supabase URL ê²½ê³ ':'âš  Supabase URLã§ã¯ãªã„ã‚ˆã†ã§ã™ã€‚',
      'URL Key ë¨¼ì €':'âš  URLã¨Keyã‚’å…ˆã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
      'ì§„ë‹¨ ì¤‘':'ğŸ” è¨ºæ–­ä¸­...',
      'ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤':'è¿½åŠ ã•ã‚Œã¾ã—ãŸï¼',
      'íŒŒì¼ í¬ê¸°':'ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º',
      'CEO placeholder ì´ë¦„':'å±±ç”°å¤ªéƒ',
      'CEO placeholder í˜„ì¬':'ç¾åœ¨',
      'CEO placeholder ë©”ëª¨':'ãƒ¡ãƒ¢',
      'â† ëª©ë¡ìœ¼ë¡œ':'â† ä¸€è¦§ã¸',
      'íšŒì‚¬ ë³´ê¸°':'ä¼šç¤¾ã‚’è¦‹ã‚‹',
      'ëª¨ë“  í™œë™ ë‚´ì—­':'å…¨æ´»å‹•å±¥æ­´ (æ–°ç€é †)',
      'ì†Œì† íšŒì‚¬':'æ‰€å±ä¼šç¤¾',
      'ê°œì¸ ì •ë³´':'å€‹äººæƒ…å ±',
      'ê°œì¸ ì—°ë½ì²˜':'é€£çµ¡å…ˆæƒ…å ±',
      'ì£¼ì†Œ (íšŒì‚¬ ê³µìœ )':'ä½æ‰€ (å…±æœ‰)',
      'ë©”ëª¨':'ãƒ¡ãƒ¢',
      'íšŒì‚¬ëª…':'ä¼šç¤¾å',
      'ìš°ë¦¬ íŒ€ ë‹´ë‹¹ì':'æ‹…å½“ãƒãƒ¼ãƒ ',
      'ë‹¤ë¥¸ íšŒì‚¬ì™€ ë³‘í•©':'ä»–ç¤¾ã¨çµ±åˆ',
      'ëŒ€í‘œ ì—°ë½ì²˜':'ä»£è¡¨é€£çµ¡å…ˆ',
      'ì£¼ì†Œ':'ä½æ‰€',
      'ìƒˆ ìœ í˜• ì¶”ê°€':'æ–°ã‚¿ã‚¤ãƒ—è¿½åŠ ',
      'ë°œì£¼':'ç™ºæ³¨','ê²¬ì ':'è¦‹ç©','ë°©ë¬¸':'è¨ªå•','í†µí™”':'é€šè©±','ê¸°íƒ€':'ãã®ä»–',
      'ì´ë©”ì¼':'ãƒ¡ãƒ¼ãƒ«','ë¶€ì„œ':'éƒ¨ç½²','ì§ì±…':'å½¹è·','ì„±':'å§“','ì´ë¦„':'å',
      'ì‚¬ë¬´ì‹¤':'ä¼šç¤¾','íœ´ëŒ€í°':'æºå¸¯','ì¶”ê°€ì—°ë½ì²˜':'è¿½åŠ ',
      'ì·¨ì„ì—°ë„':'å°±ä»»å¹´','í‡´ì„ì—°ë„':'é€€ä»»å¹´','ë¹„ê³ ':'å‚™è€ƒ',
      'ì—†ì•¨ íšŒì‚¬':'å‰Šé™¤','í•©ì¹  íšŒì‚¬':'çµ±åˆå…ˆ',
      'í™œë™ í•¨ê»˜ ì‚­ì œ':'ä»¶ã®æ´»å‹•ã‚‚å‰Šé™¤ã•ã‚Œã¾ã™',
      'Supabase ìë™ë™ê¸°í™” ì•ˆë‚´':'Supabaseé€£æºæ™‚ã¯è‡ªå‹•åŒæœŸã•ã‚Œã¾ã™ã€‚',
      'ìˆœì°¨ ë¶„ì„':'é †æ¬¡å‡¦ç†','ê°ì§€ ìœ í˜•':'æ¤œå‡ºã‚¿ã‚¤ãƒ—',
      'ëŒ€ìš©ëŸ‰ íŒŒì‹± ëª¨ë“œ':'å¤§å®¹é‡ç›´æ¥ãƒ‘ãƒ¼ã‚¹ãƒ¢ãƒ¼ãƒ‰',
      'í–‰ ì²˜ë¦¬ ì‹œì‘':'è¡Œå‡¦ç†é–‹å§‹','PDF ë¬¸ì„œ':'PDF',
      'ì´ë¯¸ì§€':'ç”»åƒ','í…ìŠ¤íŠ¸ íŒŒì¼':'ãƒ†ã‚­ã‚¹ãƒˆ',
      'ì‚¬ìš© ì•ˆ í•¨':'â€” ãªã— â€”','CRM í•„ë“œ':'CRMãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰','ë¯¸ë¦¬ë³´ê¸°':'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼',
      'ì—†ìŒ':'ãªã—',
      'Claude API í‚¤ ì„¤ì •':'Claude APIã‚­ãƒ¼è¨­å®š',
      'íŒŒì¼ ì—…ë¡œë“œ':'ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰',
      'ì¶”ì¶œëœ ì—°ë½ì²˜ í™•ì¸ ë° ìˆ˜ì •':'æŠ½å‡ºã•ã‚ŒãŸé€£çµ¡å…ˆã®ç¢ºèªãƒ»ç·¨é›†',
      'ğŸ“Š CSV ì»¬ëŸ¼ ë§¤í•‘ í™•ì¸':'ğŸ“Š CSVåˆ—ãƒãƒƒãƒ”ãƒ³ã‚°ç¢ºèª',
      'ê³µí†µ':'å…±é€š','ë‹´ë‹¹':'æ‹…å½“','âœ‚ï¸ ìˆ˜ì •':'âœ‚ï¸ ç·¨é›†',
      'ë…„':'å¹´','ì „ì²´':'å…¨ä½“','í˜„ì¬':'ç¾åœ¨',
  
      'ğŸ‘¥ íŒ€':'ğŸ‘¥ ãƒãƒ¼ãƒ ',
      'ì €ì¥ ì‹¤íŒ¨':'ä¿å­˜å¤±æ•—',
      'ëŒ€í‘œì „í™” ì—†ìŒ':'ä»£è¡¨é›»è©±ãªã—',
      'íšŒì‚¬ ë¯¸ì§€ì •':'ä¼šç¤¾æœªæŒ‡å®š',
      'âœ ìˆ˜ì •':'âœ ç·¨é›†',
      'ğŸ—‘ ì‚­ì œ':'ğŸ—‘ å‰Šé™¤',
      'ï¼‹ ì¶”ê°€':'ï¼‹ è¿½åŠ ',
      'ï¼‹ í™œë™':'ï¼‹ æ´»å‹•',
      'í–‰':'è¡Œ',
      'ì²˜ë¦¬ ì‹œì‘':'å‡¦ç†é–‹å§‹',
      'ìë™ ì—°ê²° ì•ˆë‚´':'(æ´»å‹•ã¯é€£çµ¡å…ˆä¿å­˜å¾Œã«è‡ªå‹•é€£çµ)',
          'PINì„ ì…ë ¥í•˜ì„¸ìš”':'PINã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
      'ì ê¸ˆ ìƒíƒœ':'ãƒ­ãƒƒã‚¯ä¸­',
      'ë¶„ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”':'åˆ†å¾Œã«å†è©¦è¡Œã—ã¦ãã ã•ã„',
      'PIN ì˜¤ë¥˜':'PINèª¤ã‚Š',
      'íšŒ ë‚¨ìŒ':'å›æ®‹ã‚Š',
      'PIN ì´ˆê¸°í™” í™•ì¸':'PINã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nãƒ‡ãƒ¼ã‚¿ã¯ä¿æŒã•ã‚Œã¾ã™ã€‚',
      'PIN ë³€ê²½':'PINå¤‰æ›´',
      'PIN ì„¤ì •':'PINè¨­å®š',
      'í˜„ì¬ PINì„ ì…ë ¥í•˜ì„¸ìš”':'ç¾åœ¨ã®PINã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
      'ìƒˆ PIN 4ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”':'æ–°ã—ã„4æ¡ã®PINã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
      'PINì„ í•œ ë²ˆ ë” ì…ë ¥í•˜ì„¸ìš”':'ç¢ºèªã®ãŸã‚å†åº¦å…¥åŠ›ã—ã¦ãã ã•ã„',
      'í˜„ì¬ PINì´ í‹€ë ¸ìŠµë‹ˆë‹¤':'ç¾åœ¨ã®PINãŒé•ã„ã¾ã™',
      'PINì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤':'PINãŒä¸€è‡´ã—ã¾ã›ã‚“',
      'PINì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤':'âœ“ PINã‚’è¨­å®šã—ã¾ã—ãŸ',
      'PIN ì ê¸ˆì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?':'PINãƒ­ãƒƒã‚¯ã‚’è§£é™¤ã—ã¾ã™ã‹ï¼Ÿ',
      'PIN ì ê¸ˆ':'PINãƒ­ãƒƒã‚¯',
      'ì…ë ¥ì í˜„í™©':'å…¥åŠ›è€…çŠ¶æ³',
      'ì‚¬ìš©ì ê´€ë¦¬':'ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†',
      'ê³„ì •':'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ',
      'AI ë¶„ì„ ì¤‘ ì•ˆë‚´':'Claude AIãŒé€£çµ¡å…ˆæƒ…å ±ã‚’æŠ½å‡ºã—ã¦ã„ã¾ã™',
      'PDF ê²°ê³¼ ì•ˆë‚´':'å†…å®¹ã‚’ç¢ºèªã—ã€å¿…è¦ãªã‚‰ç·¨é›†å¾Œã«ä¿å­˜ã—ã¦ãã ã•ã„ã€‚',
      'sk- ì‹œì‘ ì˜¤ë¥˜':'âš  sk- ã§å§‹ã¾ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™',
      'ë³µì‚¬ë¨':'âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼',
      'SQL ë³µì‚¬':'ğŸ“‹ SQLã‚’ã‚³ãƒ”ãƒ¼',
      'ì•„ë˜ëŠ” íŒŒì¼ ë‚´ìš©ì…ë‹ˆë‹¤':'ä»¥ä¸‹ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã§ã™:',
      'í™•ì¸ ì‚¬í•­':'ç¢ºèªäº‹é …:',
      'APIí‚¤ ì‹œì‘ í™•ì¸':'APIã‚­ãƒ¼ãŒsk-ant-ã§å§‹ã¾ã‚‹ã“ã¨ã‚’ç¢ºèª',
      'ëŒ€í‘œì „í™” ì—†ìŒ':'ä»£è¡¨é›»è©±ãªã—',
      'ì—°ë½ì²˜ ì‚­ì œ ê²½ê³ ':'ã“ã®é€£çµ¡å…ˆã¨é–¢é€£æ´»å‹•ãŒã™ã¹ã¦å‰Šé™¤ã•ã‚Œã¾ã™ã€‚å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚',
      'ë³‘í•© ê²½ê³ ':'çµ±åˆå¾Œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚',
      'ë³‘í•© ì‹¤í–‰':'çµ±åˆå®Ÿè¡Œ',
      'ë‚ ì§œ *':'æ—¥ä»˜ *','ê¸ˆì•¡':'é‡‘é¡','ì œëª©':'ä»¶å','ë‚´ìš©':'å†…å®¹',
      'ìœ í˜• ê´€ë¦¬ ì•ˆë‚´':'ã‚¿ã‚¤ãƒ—ã‚’è¿½åŠ ã¾ãŸã¯ä¸¦ã³æ›¿ãˆã§ãã¾ã™ã€‚',
      'ê¸°ë³¸ ìœ í˜• ì•ˆë‚´':'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¿ã‚¤ãƒ—ï¼ˆç™ºæ³¨ãƒ»è¦‹ç©ãƒ»è¨ªå•ãƒ»é€šè©±ãƒ»ãã®ä»–ï¼‰ã¯å‰Šé™¤ã§ãã¾ã›ã‚“ã€‚',
      'ìƒ‰ìƒ':'ã‚«ãƒ©ãƒ¼',
      'í™œë™ ì‚­ì œ ê²½ê³ ':'ã“ã®æ´»å‹•ã¯å‰Šé™¤ã™ã‚‹ã¨å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚',
      'ì €ì¥ í›„ ê³„ì†':'ä¿å­˜ã—ã¦ç¶šã‘ã‚‹',
      'ëŒ€ìš©ëŸ‰ CSV':'å¤§å®¹é‡CSV','ë„ ì§€ì›í•©ë‹ˆë‹¤':'ã‚‚ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚',
      'í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œ':'ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰',
      'ë¶„ì„ ì‹¤íŒ¨':'è§£æå¤±æ•—',
      'CSV ë§¤í•‘ ì•ˆë‚´':'è‡ªå‹•æ¤œå‡ºã•ã‚ŒãŸãƒãƒƒãƒ”ãƒ³ã‚°ã§ã™ã€‚å¿…è¦ã«å¿œã˜ã¦å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚',
      'ì¶”ê°€ íŒŒì¼ ê°€ì ¸ì˜¤ê¸°':'ã•ã‚‰ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–è¾¼',
      'ì‹œì‘í•˜ê¸° â†’':'ã¯ã˜ã‚ã‚‹ â†’',
      'ì—°ë™ í•´ì œ':'é€£æºè§£é™¤',
      'ì´ë©”ì¼ ë¼ë²¨':'ãƒ¡ãƒ¼ãƒ«',
      // ì‹ ê·œ ì¶”ê°€
      'íšŒì‚¬ ì •ë³´':'ä¼šç¤¾æƒ…å ±',
      'ê¸°ë³¸ ì •ë³´':'åŸºæœ¬æƒ…å ±','ì¬ë¬´ í˜„í™©':'è²¡å‹™çŠ¶æ³','ëŒ€í‘œì´ì‚¬ ì´ë ¥':'ä»£è¡¨å–ç· å½¹å±¥æ­´',
      'íšŒì‚¬ëª… ë¼ë²¨':'ä¼šç¤¾åï¼ˆåŒã˜ä¼šç¤¾ã®ç¤¾å“¡ã¯åŒã˜åå‰ã‚’å…¥åŠ›ï¼‰',
      'íšŒì‚¬ëª… ìˆ˜ì • ë¼ë²¨':'ä¼šç¤¾åï¼ˆå¤‰æ›´ã™ã‚‹ã¨æ‰€å±ç¤¾å“¡å…¨ä½“ã«åæ˜ ï¼‰',
      'ì„± *':'å§“ *','ì´ë¦„ *':'å *',
      'íŒ€ëª…':'ãƒãƒ¼ãƒ å','ë‹´ë‹¹ì ì´ë¦„':'æ‹…å½“è€…å',
      'íŒ€ëª… placeholder':'å–¶æ¥­1ãƒãƒ¼ãƒ ',
      'ë³‘í•© ë¼ë²¨':'çµ±åˆã™ã‚‹ä¼šç¤¾ã‚’é¸æŠï¼ˆå‰Šé™¤ã™ã‚‹æ–¹ï¼‰',
      'ëŒ€í‘œ ì „í™”':'ä»£è¡¨é›»è©±','íŒ©ìŠ¤':'FAX',
      'ì¬ë¬´ ì•ˆë‚´':'å¹´åº¦åˆ¥è²¡å‹™ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚å˜ä½ï¼šç™¾ä¸‡å††',
      'ì¬ë¬´ ë‹¨ìœ„ ì•ˆë‚´':'* é‡‘é¡å˜ä½ï¼šç™¾ä¸‡å†† / ç©ºæ¬„ã¯æœªå…¥åŠ›ã¨ã—ã¦å‡¦ç†',
      'ì—°ë„ ì¶”ê°€':'ï¼‹ å¹´åº¦è¿½åŠ ',
      'CEO ì•ˆë‚´':'ä»£è¡¨å–ç· å½¹ã®å¤‰æ›´å±¥æ­´ã‚’æ–°ã—ã„é †ã«ç®¡ç†ã—ã¾ã™ã€‚',
      'Supabase ì—°ë™ ëª¨ë‹¬':'ğŸ—„ Supabaseé€£æº',
      'íŒŒì¼ ëª¨ë‹¬ ì œëª©':'ğŸ—‚ ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰é€£çµ¡å…ˆã‚’å–è¾¼',
      'ì—°ë½ì²˜ ì‚­ì œ':'é€£çµ¡å…ˆå‰Šé™¤','íšŒì‚¬ ë³‘í•©':'ä¼šç¤¾çµ±åˆ','í™œë™ ì‚­ì œ':'æ´»å‹•å‰Šé™¤',
      'ìš°ë¦¬íŒ€ ì„¤ëª…':'ã“ã®ä¼šç¤¾ã‚’æ‹…å½“ã™ã‚‹è‡ªç¤¾ãƒãƒ¼ãƒ ã®æƒ…å ±ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚',
      'ë³‘í•© ì„¤ëª…':'åŒã˜ä¼šç¤¾ãŒåˆ¥ã®åå‰ã§ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹å ´åˆã«çµ±åˆã—ã¾ã™ã€‚',
      'ì£¼ì†Œ ì•ˆë‚´':'â„¹ ç™»éŒ²æ¸ˆã¿ã®ä¼šç¤¾ä½æ‰€ãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚å¤‰æ›´ã™ã‚‹ã¨å…¨ç¤¾å“¡ã«åæ˜ ã•ã‚Œã¾ã™ã€‚',
      'ìœ í˜• *':'ç¨®åˆ¥ *',
      'ì´ë©”ì¼ th':'ãƒ¡ãƒ¼ãƒ«',
    },
    zh: {
      'ìŠ¤ë§ˆíŠ¸ ê³ ê°ê´€ë¦¬ ì‹œìŠ¤í…œ':'æ™ºèƒ½å®¢æˆ·ç®¡ç†',
      'ì—°ë½ì²˜':'è”ç³»äºº','ì „ì²´ í™œë™':'å…¨éƒ¨æ´»åŠ¨','íŒŒì¼ ê°€ì ¸ì˜¤ê¸°':'å¯¼å…¥æ–‡ä»¶',
      'í™œë™ ìœ í˜• ê´€ë¦¬':'æ´»åŠ¨ç±»å‹','Supabase ì—°ë™':'SupabaseåŒæ­¥',
      'ì‚¬ìš© ê°€ì´ë“œ':'ä½¿ç”¨æŒ‡å—','ë¼ì´ì„ ìŠ¤ ì •ë³´':'è®¸å¯è¯',
      'íšŒì‚¬':'å…¬å¸','í™œë™':'æ´»åŠ¨','ì´ë¦„, íšŒì‚¬ ê²€ìƒ‰...':'æœç´¢å§“åã€å…¬å¸...',
      'ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.':'è¯·è¾“å…¥å§“åã€‚','íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.':'è¯·è¾“å…¥å…¬å¸åç§°ã€‚',
      'ë¨¼ì € ë‹´ë‹¹ìë¥¼ ì¶”ê°€í•˜ì„¸ìš”.':'è¯·å…ˆæ·»åŠ è”ç³»äººã€‚',
      'ë‹´ë‹¹ìë¥¼ ì„ íƒí•˜ì„¸ìš”.':'è¯·é€‰æ‹©è”ç³»äººã€‚',
      'ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš”.':'è¯·è¾“å…¥æ—¥æœŸã€‚',
      'API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤.':'æœªæ‰¾åˆ°APIå¯†é’¥ã€‚','API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.':'è¯·è¾“å…¥APIå¯†é’¥ã€‚',
      'ì˜¬ë°”ë¥¸ API í‚¤':'è¯·è¾“å…¥æ­£ç¡®çš„APIå¯†é’¥ã€‚',
      'íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.':'è¯·å…ˆé€‰æ‹©æ–‡ä»¶ã€‚',
      'CSV íŒŒì¼ì€ 1ê°œì”©':'CSVæ–‡ä»¶æ¯æ¬¡å¤„ç†ä¸€ä¸ªã€‚',
      'íŒŒì¼ ì´ˆê³¼':'æ–‡ä»¶è¶…è¿‡10MBã€‚',
      'í™œë™ ì—°ê²° ì˜¤ë¥˜':'æœªé€‰æ‹©è”ç³»äººï¼Œè¯·å…ˆå‹¾é€‰è”ç³»äººã€‚',
      'ì¶”ì¶œëœ ì •ë³´ ì—†ìŒ':'æœªæå–åˆ°ä»»ä½•ä¿¡æ¯ã€‚',
      'ì¶”ì¶œëœ ì—°ë½ì²˜ ì—†ìŒ':'æœªæ‰¾åˆ°è”ç³»äººæˆ–æ´»åŠ¨ä¿¡æ¯ã€‚',
      'ë³‘í•© ì•ˆ í•¨':'â€” ä¸åˆå¹¶ â€”','ë™ê¸°í™” ì™„ë£Œ':'åŒæ­¥å®Œæˆ Â· ',
      'ì•„ì§ ë™ê¸°í™” ì•ˆ ë¨':'å°šæœªåŒæ­¥','ê°œ íŒŒì¼':'ä¸ªæ–‡ä»¶',
      'í˜„ì¬í‚¤':'(å½“å‰: ','ì´ë¦„ ì—†ìŒ':'æ— åç§°',
      'ì‹ ê·œ':'æ–°å¢','ì´':'å…±','ëª…':'æ¡','ê±´':'æ¡',
      'ë‹´ë‹¹ì ì¶”ê°€':'ï¼‹ æ·»åŠ è”ç³»äºº','í™œë™ ì—†ìŒ':'æš‚æ— æ´»åŠ¨',
      'ì—°ë½ì²˜ ì—†ìŒ':'æ— è”ç³»æ–¹å¼','íšŒì‚¬ ì „ì²´ í™œë™':'å…¬å¸æ´»åŠ¨',
      'íŒ€ ë¯¸ë“±ë¡':'æœªåˆ†é…å›¢é˜Ÿ â€” åœ¨å…¬å¸è®¾ç½®ä¸­æ·»åŠ è´Ÿè´£äººåå°†æ˜¾ç¤ºç­›é€‰å™¨',
      'ëŒ€í‘œì´ì‚¬':'æ³•äººä»£è¡¨','ìƒˆ ì—°ë½ì²˜':'æ–°å»ºè”ç³»äºº','ì—°ë½ì²˜ ìˆ˜ì •':'ç¼–è¾‘è”ç³»äºº',
      'í™œë™ ì¶”ê°€':'æ·»åŠ æ´»åŠ¨','í™œë™ ìˆ˜ì •':'ç¼–è¾‘æ´»åŠ¨',
      'ì €ì¥':'ä¿å­˜','ì·¨ì†Œ':'å–æ¶ˆ','ìˆ˜ì •':'ç¼–è¾‘','ì‚­ì œ':'åˆ é™¤','í™•ì¸':'ç¡®è®¤','ë‹«ê¸°':'å…³é—­',
      'ì—°ë„':'å¹´åº¦','ì¸ì›':'äººæ•°','ë§¤ì¶œ':'è¥æ”¶','ì˜ì—…ì´ìµ':'è¥ä¸šåˆ©æ¶¦',
      'ìˆœì´ìµ':'å‡€åˆ©æ¶¦','ìì‚°':'èµ„äº§','ë¶€ì±„':'è´Ÿå€º',
      'ì¸ì›(ëª…)':'äººæ•°(å)','ë§¤ì¶œ(M)':'è¥æ”¶(M)',
      'ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...':'åŠ è½½ä¸­...','ì €ì¥ ì¤‘...':'ä¿å­˜ä¸­...',
      'ì €ì¥ë¨':'å·²ä¿å­˜','ë¡œì»¬ ì €ì¥ ëª¨ë“œ':'æœ¬åœ°æ¨¡å¼',
      'ë¡œì»¬ ì €ì¥ ëª¨ë“œ_sync':'æœ¬åœ°æ¨¡å¼ Â· ç‚¹å‡»ğŸ—„åŒæ­¥',
      'íŒŒì¼ ë¶„ì„ ì¤‘...':'æ–‡ä»¶è§£æä¸­...',
      'ë¶„ì„ ì‹œì‘':'ğŸ” å¼€å§‹åˆ†æ','CSV ë¶„ì„í•˜ê¸°':'â¡ è§£æCSV',
      'CSV ì½ëŠ” ì¤‘':'ğŸ“Š è¯»å–CSVä¸­...','CSV íŒŒì‹± ì¤‘':'ğŸ“Š è§£æCSVä¸­...',
      'ëª… ì¶”ê°€ ì™„ë£Œ':'æ¡è”ç³»äººå·²æ·»åŠ ï¼',
      'ì¶”ê°€':'å·²æ·»åŠ ','ì¤‘ë³µ ê±´ë„ˆëœ€':'è·³è¿‡é‡å¤','ë¹ˆ í–‰ ê±´ë„ˆëœ€':'è·³è¿‡ç©ºè¡Œ',
      'í–‰ ê°ì§€ ë©”ì‹œì§€':'è¡Œå·²æ£€æµ‹ Â· è¯·ç¡®è®¤åˆ—æ˜ å°„ã€‚',
      'ì €ì¥ëìŠµë‹ˆë‹¤':'âœ… å·²ä¿å­˜ï¼Œæ­£åœ¨ä»SupabaseåŠ è½½...',
      'URLê³¼ Key ì…ë ¥':'è¯·å…ˆè¾“å…¥URLå’ŒKeyã€‚',
      'ë‚ ì§œ':'æ—¥æœŸ','ìœ í˜•':'ç±»å‹','ë‚´ìš©':'å†…å®¹','ê¸ˆì•¡':'é‡‘é¢','ë‹´ë‹¹ì':'è”ç³»äºº',
      'í™œë™ì´ ì—†ìŠµë‹ˆë‹¤':'æš‚æ— æ´»åŠ¨è®°å½•',
      'ì˜¤ëŠ˜':'ä»Šæ—¥','ì´ë™ë©ë‹ˆë‹¤':'å°†è¢«ç§»åŠ¨ã€‚ä¿å­˜æ—¶ç”Ÿæ•ˆã€‚',
      'ì „ì²´ Në…„':'å…¨{n}å¹´','ì´ Nëª…':'å…±{n}å',
      '+ ì—°ë½ì²˜':'+ è”ç³»äºº',
      'ì—°ë½ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤':'æš‚æ— è”ç³»äººã€‚\nç‚¹å‡»ï¼‹æ·»åŠ æˆ–å¯¼å…¥æ–‡ä»¶ã€‚',
      'ê°œ íŒŒì¼ ì„ íƒë¨':'ä¸ªæ–‡ä»¶å·²é€‰æ‹©',
      'ê°€ì ¸ì˜¤ëŠ” ì¤‘...':'å¯¼å…¥ä¸­...',
      'í–‰ ì²˜ë¦¬ ì‹œì‘':'è¡Œå¾…å¤„ç†',
      'CSV íŒŒì‹± ì˜¤ë¥˜':'CSVè§£æé”™è¯¯',
      'íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤':'æ— æ³•è¯»å–æ–‡ä»¶ã€‚',
      'ìœ í˜• ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”':'è¯·è¾“å…¥ç±»å‹åç§°ã€‚',
      'ì „ì²´ í•„í„°':'å…¨éƒ¨',
      'ë§ˆì§€ë§‰ ë™ê¸°í™”':'æœ€ååŒæ­¥: ',
      'URL Key ì…ë ¥ ê²½ê³ ':'âš  è¯·è¾“å…¥URLå’ŒAPIå¯†é’¥ã€‚',
      'Supabase URL ê²½ê³ ':'âš  è¿™ä¸æ˜¯Supabaseé¡¹ç›®URLã€‚',
      'URL Key ë¨¼ì €':'âš  è¯·å…ˆè¾“å…¥URLå’ŒKeyã€‚',
      'ì§„ë‹¨ ì¤‘':'ğŸ” è¯Šæ–­ä¸­...',
      'ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤':'å·²æ·»åŠ ï¼',
      'íŒŒì¼ í¬ê¸°':'æ–‡ä»¶å¤§å°',
      'CEO placeholder ì´ë¦„':'å¼ ä¸‰',
      'CEO placeholder í˜„ì¬':'è‡³ä»Š',
      'CEO placeholder ë©”ëª¨':'å¤‡æ³¨',
      'â† ëª©ë¡ìœ¼ë¡œ':'â† è¿”å›åˆ—è¡¨',
      'íšŒì‚¬ ë³´ê¸°':'æŸ¥çœ‹å…¬å¸',
      'ëª¨ë“  í™œë™ ë‚´ì—­':'å…¨éƒ¨æ´»åŠ¨è®°å½• (æœ€æ–°ä¼˜å…ˆ)',
      'ì†Œì† íšŒì‚¬':'æ‰€å±å…¬å¸',
      'ê°œì¸ ì •ë³´':'ä¸ªäººä¿¡æ¯',
      'ê°œì¸ ì—°ë½ì²˜':'è”ç³»æ–¹å¼',
      'ì£¼ì†Œ (íšŒì‚¬ ê³µìœ )':'åœ°å€ (å…±äº«)',
      'ë©”ëª¨':'å¤‡æ³¨',
      'íšŒì‚¬ëª…':'å…¬å¸åç§°',
      'ìš°ë¦¬ íŒ€ ë‹´ë‹¹ì':'æˆ‘æ–¹è´Ÿè´£äºº',
      'ë‹¤ë¥¸ íšŒì‚¬ì™€ ë³‘í•©':'ä¸å…¶ä»–å…¬å¸åˆå¹¶',
      'ëŒ€í‘œ ì—°ë½ì²˜':'ä¸»è¦è”ç³»äºº',
      'ì£¼ì†Œ':'åœ°å€',
      'ìƒˆ ìœ í˜• ì¶”ê°€':'æ·»åŠ æ–°ç±»å‹',
      'ë°œì£¼':'å‘è´§','ê²¬ì ':'æŠ¥ä»·','ë°©ë¬¸':'æ‹œè®¿','í†µí™”':'é€šè¯','ê¸°íƒ€':'å…¶ä»–',
      'ì´ë©”ì¼':'é‚®ç®±','ë¶€ì„œ':'éƒ¨é—¨','ì§ì±…':'èŒä½','ì„±':'å§“','ì´ë¦„':'å',
      'ì‚¬ë¬´ì‹¤':'å…¬å¸','íœ´ëŒ€í°':'æ‰‹æœº','ì¶”ê°€ì—°ë½ì²˜':'å…¶ä»–',
      'ì·¨ì„ì—°ë„':'å°±ä»»å¹´','í‡´ì„ì—°ë„':'ç¦»ä»»å¹´','ë¹„ê³ ':'å¤‡æ³¨',
      'ì—†ì•¨ íšŒì‚¬':'åˆ é™¤æ–¹','í•©ì¹  íšŒì‚¬':'ä¿ç•™æ–¹',
      'í™œë™ í•¨ê»˜ ì‚­ì œ':'æ¡æ´»åŠ¨ä¹Ÿå°†ä¸€å¹¶åˆ é™¤',
      'Supabase ìë™ë™ê¸°í™” ì•ˆë‚´':'å·²è¿æ¥Supabaseæ—¶å°†è‡ªåŠ¨åŒæ­¥ã€‚',
      'ìˆœì°¨ ë¶„ì„':'é€ä¸€å¤„ç†','ê°ì§€ ìœ í˜•':'æ£€æµ‹ç±»å‹',
      'ëŒ€ìš©ëŸ‰ íŒŒì‹± ëª¨ë“œ':'å¤§æ–‡ä»¶ç›´æ¥è§£ææ¨¡å¼',
      'í–‰ ì²˜ë¦¬ ì‹œì‘':'è¡Œå¾…å¤„ç†','PDF ë¬¸ì„œ':'PDF',
      'ì´ë¯¸ì§€':'å›¾ç‰‡','í…ìŠ¤íŠ¸ íŒŒì¼':'æ–‡æœ¬',
      'ì‚¬ìš© ì•ˆ í•¨':'â€” æ—  â€”','CRM í•„ë“œ':'CRMå­—æ®µ','ë¯¸ë¦¬ë³´ê¸°':'é¢„è§ˆ',
      'ì—†ìŒ':'æ— ',
      'Claude API í‚¤ ì„¤ì •':'Claude APIå¯†é’¥è®¾ç½®',
      'íŒŒì¼ ì—…ë¡œë“œ':'æ–‡ä»¶ä¸Šä¼ ',
      'ì¶”ì¶œëœ ì—°ë½ì²˜ í™•ì¸ ë° ìˆ˜ì •':'ç¡®è®¤å¹¶ç¼–è¾‘æå–çš„è”ç³»äºº',
      'ğŸ“Š CSV ì»¬ëŸ¼ ë§¤í•‘ í™•ì¸':'ğŸ“Š CSVåˆ—æ˜ å°„ç¡®è®¤',
      'ê³µí†µ':'å…±ç”¨','ë‹´ë‹¹':'è´Ÿè´£','âœ‚ï¸ ìˆ˜ì •':'âœ‚ï¸ ç¼–è¾‘',
      'ë…„':'å¹´','ì „ì²´':'å…¨éƒ¨','í˜„ì¬':'è‡³ä»Š',
  
      'ğŸ‘¥ íŒ€':'ğŸ‘¥ å›¢é˜Ÿ',
      'ì €ì¥ ì‹¤íŒ¨':'ä¿å­˜å¤±è´¥',
      'ëŒ€í‘œì „í™” ì—†ìŒ':'æ— ä¸»ç”µè¯',
      'íšŒì‚¬ ë¯¸ì§€ì •':'æœªæŒ‡å®šå…¬å¸',
      'âœ ìˆ˜ì •':'âœ ç¼–è¾‘',
      'ğŸ—‘ ì‚­ì œ':'ğŸ—‘ åˆ é™¤',
      'ï¼‹ ì¶”ê°€':'ï¼‹ æ·»åŠ ',
      'ï¼‹ í™œë™':'ï¼‹ æ´»åŠ¨',
      'í–‰':'è¡Œ',
      'ì²˜ë¦¬ ì‹œì‘':'å¼€å§‹å¤„ç†',
      'ìë™ ì—°ê²° ì•ˆë‚´':'(æ´»åŠ¨åœ¨ä¿å­˜è”ç³»äººåè‡ªåŠ¨å…³è”)',
          'PINì„ ì…ë ¥í•˜ì„¸ìš”':'è¯·è¾“å…¥PINç ',
      'ì ê¸ˆ ìƒíƒœ':'å·²é”å®š',
      'ë¶„ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”':'åˆ†é’Ÿåé‡è¯•',
      'PIN ì˜¤ë¥˜':'PINé”™è¯¯',
      'íšŒ ë‚¨ìŒ':'æ¬¡å‰©ä½™',
      'PIN ì´ˆê¸°í™” í™•ì¸':'é‡ç½®PINç ï¼Ÿæ•°æ®å°†ä¿ç•™ã€‚',
      'PIN ë³€ê²½':'ä¿®æ”¹PIN',
      'PIN ì„¤ì •':'è®¾ç½®PIN',
      'í˜„ì¬ PINì„ ì…ë ¥í•˜ì„¸ìš”':'è¯·è¾“å…¥å½“å‰PINç ',
      'ìƒˆ PIN 4ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”':'è¯·è¾“å…¥æ–°çš„4ä½PINç ',
      'PINì„ í•œ ë²ˆ ë” ì…ë ¥í•˜ì„¸ìš”':'è¯·å†æ¬¡ç¡®è®¤PINç ',
      'í˜„ì¬ PINì´ í‹€ë ¸ìŠµë‹ˆë‹¤':'å½“å‰PINç é”™è¯¯',
      'PINì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤':'ä¸¤æ¬¡PINç ä¸ä¸€è‡´',
      'PINì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤':'âœ“ PINç å·²è®¾ç½®',
      'PIN ì ê¸ˆì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?':'è§£é™¤PINé”å®šï¼Ÿæ•°æ®å°†ä¿ç•™ã€‚',
      'PIN ì ê¸ˆ':'PINé”å®š',
      'ì…ë ¥ì í˜„í™©':'è¾“å…¥ç»Ÿè®¡',
      'ì‚¬ìš©ì ê´€ë¦¬':'ç”¨æˆ·ç®¡ç†',
      'ê³„ì •':'è´¦æˆ·',
      'AI ë¶„ì„ ì¤‘ ì•ˆë‚´':'Claude AIæ­£åœ¨æå–è”ç³»äººä¿¡æ¯',
      'PDF ê²°ê³¼ ì•ˆë‚´':'è¯·ç¡®è®¤æå–å†…å®¹ï¼Œå¦‚éœ€ä¿®æ”¹åä¿å­˜ã€‚åªæœ‰å‹¾é€‰é¡¹æ‰ä¼šæ·»åŠ ã€‚',
      'sk- ì‹œì‘ ì˜¤ë¥˜':'âš  å¯†é’¥å¿…é¡»ä»¥sk-å¼€å¤´',
      'ë³µì‚¬ë¨':'âœ… å·²å¤åˆ¶ï¼',
      'SQL ë³µì‚¬':'ğŸ“‹ å¤åˆ¶SQL',
      'ì•„ë˜ëŠ” íŒŒì¼ ë‚´ìš©ì…ë‹ˆë‹¤':'ä»¥ä¸‹æ˜¯æ–‡ä»¶å†…å®¹:',
      'í™•ì¸ ì‚¬í•­':'æ£€æŸ¥äº‹é¡¹:',
      'APIí‚¤ ì‹œì‘ í™•ì¸':'ç¡®è®¤APIå¯†é’¥ä»¥sk-ant-å¼€å¤´',
      'ëŒ€í‘œì „í™” ì—†ìŒ':'æ— ä»£è¡¨ç”µè¯',
      'ì—°ë½ì²˜ ì‚­ì œ ê²½ê³ ':'è¯¥è”ç³»äººåŠç›¸å…³æ´»åŠ¨å°†å…¨éƒ¨åˆ é™¤ï¼Œæ— æ³•æ¢å¤ã€‚',
      'ë³‘í•© ê²½ê³ ':'åˆå¹¶åæ— æ³•æ’¤é”€ã€‚',
      'ë³‘í•© ì‹¤í–‰':'æ‰§è¡Œåˆå¹¶',
      'ë‚ ì§œ *':'æ—¥æœŸ *','ê¸ˆì•¡':'é‡‘é¢','ì œëª©':'æ ‡é¢˜','ë‚´ìš©':'å†…å®¹',
      'ìœ í˜• ê´€ë¦¬ ì•ˆë‚´':'å¯æ·»åŠ ç±»å‹æˆ–è°ƒæ•´é¡ºåºã€‚',
      'ê¸°ë³¸ ìœ í˜• ì•ˆë‚´':'é»˜è®¤ç±»å‹ï¼ˆå‘è´§/æŠ¥ä»·/æ‹œè®¿/é€šè¯/å…¶ä»–ï¼‰ä¸å¯åˆ é™¤ã€‚',
      'ìƒ‰ìƒ':'é¢œè‰²',
      'í™œë™ ì‚­ì œ ê²½ê³ ':'æ­¤æ´»åŠ¨åˆ é™¤åæ— æ³•æ¢å¤ã€‚',
      'ì €ì¥ í›„ ê³„ì†':'ä¿å­˜å¹¶ç»§ç»­',
      'ëŒ€ìš©ëŸ‰ CSV':'å¤§æ–‡ä»¶CSV','ë„ ì§€ì›í•©ë‹ˆë‹¤':'ä¹Ÿå—æ”¯æŒã€‚',
      'í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œ':'ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶ä¸Šä¼ ',
      'ë¶„ì„ ì‹¤íŒ¨':'è§£æå¤±è´¥',
      'CSV ë§¤í•‘ ì•ˆë‚´':'å·²è‡ªåŠ¨æ£€æµ‹æ˜ å°„å…³ç³»ï¼Œå¦‚éœ€ä¿®æ”¹è¯·é€šè¿‡ä¸‹æ‹‰èœå•æ›´æ”¹ã€‚',
      'ì¶”ê°€ íŒŒì¼ ê°€ì ¸ì˜¤ê¸°':'ç»§ç»­å¯¼å…¥æ–‡ä»¶',
      'ì‹œì‘í•˜ê¸° â†’':'å¼€å§‹ä½¿ç”¨ â†’',
      'ì—°ë™ í•´ì œ':'æ–­å¼€è¿æ¥',
      'ì´ë©”ì¼ ë¼ë²¨':'é‚®ç®±',
      // ì‹ ê·œ ì¶”ê°€
      'íšŒì‚¬ ì •ë³´':'å…¬å¸ä¿¡æ¯',
      'ê¸°ë³¸ ì •ë³´':'åŸºæœ¬ä¿¡æ¯','ì¬ë¬´ í˜„í™©':'è´¢åŠ¡çŠ¶å†µ','ëŒ€í‘œì´ì‚¬ ì´ë ¥':'æ³•äººä»£è¡¨å†å²',
      'íšŒì‚¬ëª… ë¼ë²¨':'å…¬å¸åç§°ï¼ˆåŒå…¬å¸å‘˜å·¥è¾“å…¥ç›¸åŒåç§°ï¼‰',
      'íšŒì‚¬ëª… ìˆ˜ì • ë¼ë²¨':'å…¬å¸åç§°ï¼ˆä¿®æ”¹åå°†è‡ªåŠ¨åæ˜ åˆ°æ‰€æœ‰å‘˜å·¥ï¼‰',
      'ì„± *':'å§“ *','ì´ë¦„ *':'å *',
      'íŒ€ëª…':'å›¢é˜Ÿåç§°','ë‹´ë‹¹ì ì´ë¦„':'è´Ÿè´£äººå§“å',
      'íŒ€ëª… placeholder':'é”€å”®ä¸€ç»„',
      'ë³‘í•© ë¼ë²¨':'é€‰æ‹©è¦åˆå¹¶çš„å…¬å¸ï¼ˆè¦åˆ é™¤çš„é‚£ä¸ªï¼‰',
      'ëŒ€í‘œ ì „í™”':'æ€»æœºç”µè¯','íŒ©ìŠ¤':'ä¼ çœŸ',
      'ì¬ë¬´ ì•ˆë‚´':'è¯·è¾“å…¥å¹´åº¦è´¢åŠ¡æ•°æ®ã€‚å•ä½ï¼šç™¾ä¸‡å…ƒ',
      'ì¬ë¬´ ë‹¨ìœ„ ì•ˆë‚´':'* é‡‘é¢å•ä½ï¼šç™¾ä¸‡å…ƒ / ç©ºç™½è§†ä¸ºæœªå¡«',
      'ì—°ë„ ì¶”ê°€':'ï¼‹ æ·»åŠ å¹´åº¦',
      'CEO ì•ˆë‚´':'æŒ‰æœ€æ–°é¡ºåºç®¡ç†æ³•äººä»£è¡¨å˜æ›´å†å²ã€‚',
      'Supabase ì—°ë™ ëª¨ë‹¬':'ğŸ—„ SupabaseåŒæ­¥',
      'íŒŒì¼ ëª¨ë‹¬ ì œëª©':'ğŸ—‚ ä»æ–‡ä»¶å¯¼å…¥è”ç³»äºº',
      'ì—°ë½ì²˜ ì‚­ì œ':'åˆ é™¤è”ç³»äºº','íšŒì‚¬ ë³‘í•©':'åˆå¹¶å…¬å¸','í™œë™ ì‚­ì œ':'åˆ é™¤æ´»åŠ¨',
      'ìš°ë¦¬íŒ€ ì„¤ëª…':'è®°å½•è´Ÿè´£è¯¥å…¬å¸çš„æˆ‘æ–¹å›¢é˜Ÿä¿¡æ¯ã€‚',
      'ë³‘í•© ì„¤ëª…':'å½“åŒä¸€å…¬å¸ä»¥ä¸åŒåç§°æ³¨å†Œæ—¶å¯è¿›è¡Œåˆå¹¶ã€‚',
      'ì£¼ì†Œ ì•ˆë‚´':'â„¹ å·²åº”ç”¨æ³¨å†Œçš„å…¬å¸åœ°å€ã€‚ä¿®æ”¹åå°†åæ˜ åˆ°æ•´ä¸ªå…¬å¸ã€‚',
      'ìœ í˜• *':'ç±»å‹ *',
      'ì´ë©”ì¼ th':'é‚®ç®±',
    },
  };
  // â”€â”€ Safe localStorage (iOS Safari iframe / Private mode / SecurityError fallback) â”€â”€
  const _memStore = {};
  var _lsAvailable = (function(){
    try {
      var t = '__crm_test__';
      localStorage.setItem(t, '1');
      localStorage.removeItem(t);
      return true;
    } catch(e) { return false; }
  })();
  const safeStorage = {
    getItem: function(k){
      if(_lsAvailable){ try { return localStorage.getItem(k); } catch(e){ _lsAvailable=false; } }
      return _memStore[k] !== undefined ? _memStore[k] : null;
    },
    setItem: function(k, v){
      if(_lsAvailable){ try { localStorage.setItem(k, v); return; } catch(e){ _lsAvailable=false; } }
      _memStore[k] = String(v);
    },
    removeItem: function(k){
      if(_lsAvailable){ try { localStorage.removeItem(k); return; } catch(e){ _lsAvailable=false; } }
      delete _memStore[k];
    }
  };
  
  let _lang = safeStorage.getItem('crm_lang') || 'ko';
  
  function i18n(key){ var d=(I18N[_lang]||I18N.ko); return d[key]!==undefined?d[key]:key; }
  
  function setLang(lang){
    _lang = lang;
    safeStorage.setItem('crm_lang', lang);
    // data-i18n ì •ì  í…ìŠ¤íŠ¸ êµì²´
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      el.textContent = i18n(el.getAttribute('data-i18n'));
    });
    document.querySelectorAll('[data-i18n-placeholder]').forEach(el=>{
      el.placeholder = i18n(el.getAttribute('data-i18n-placeholder'));
    });
    const sel = document.getElementById('langSelect');
    if(sel) sel.value = lang;
    // ëª¨ë“  ë™ì  ë·° ë¬´ì¡°ê±´ ì¬ë Œë” (í˜„ì¬ ë³´ì´ëŠ” ë·°ì™€ ìƒê´€ì—†ì´)
    renderStats();
    renderContacts();
    renderAllActs();
    if(typeof refreshFilterBar      === 'function') refreshFilterBar();
    if(typeof refreshTeamFilterBars === 'function') refreshTeamFilterBars();
    if(typeof injectTypeStyles      === 'function') injectTypeStyles();
    if(typeof refreshTypeSelect     === 'function') refreshTypeSelect();
    // ìƒì„¸ ë·°ê°€ ì—´ë ¤ìˆìœ¼ë©´ ì¬ë Œë”
    const dView = document.getElementById('detailView');
    if(dView && dView.classList.contains('open') && currentCid) showDetail(currentCid);
  }
  
  function initLang(){ setLang(_lang); }
  let pdfBase64 = null;
  let pdfFileType = null;
  let pdfExtracted = [];
  let pdfActivities = [];
  // ë‹¤ì¤‘ íŒŒì¼ í
  let _pdfQueue = [];
  let _pdfQueueIdx = 0;
  let _pdfAllExtracted = [];
  let _pdfAllActivities = [];
  
  
  
  // â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let contacts  = JSON.parse(safeStorage.getItem('crm_contacts')  || '[]');
  let activities= JSON.parse(safeStorage.getItem('crm_activities')|| '[]');
  let companies = JSON.parse(safeStorage.getItem('crm_companies') || '{}');
  
  // â”€â”€ SUPABASE ì—°ë™ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let sbUrl   = safeStorage.getItem('crm_sb_url')   || '';
  let sbKey   = safeStorage.getItem('crm_sb_key')   || '';
  let sbSyncing    = false;
  let sbPendingSave= false;
  let sbLastSync   = safeStorage.getItem('crm_sb_last_sync') || '';
  
  function sbIsConnected(){ return !!(sbUrl && sbKey); }
  
  function sbHeaders(){
    return {
      'Content-Type':  'application/json',
      'apikey':        sbKey,
      'Authorization': 'Bearer ' + sbKey,
      'Prefer':        'return=minimal'
    };
  }
  
  // ìƒíƒœ í‘œì‹œ
  function sbUpdateStatus(state, msg){
    const el = document.getElementById('gsSyncStatus');
    if(!el) return;
    const icons  = {ok:'âœ…', syncing:'ğŸ”„', error:'âš ï¸', offline:'ğŸ’¾'};
    const colors = {ok:'var(--accent3)', syncing:'var(--accent4)', error:'var(--accent2)', offline:'var(--muted)'};
    // Realtime ë°°ì§€ í¬í•¨
    const rtHtml = sbIsConnected()
      ? ` <span class="sb-rt-badge" style="font-size:10px;margin-left:4px;color:var(--muted)">â—‹</span>`
      : '';
    el.innerHTML = `<span style="color:${colors[state]}">${icons[state]} ${msg}</span>${rtHtml}`;
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SUPABASE â€” í˜ì´ì§€ë„¤ì´ì…˜ + ì„œë²„ì‚¬ì´ë“œ ê²€ìƒ‰ + Realtime ë™ì‹œì ‘ì†
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  const SB_PAGE     = 200;   // contacts í˜ì´ì§€ í¬ê¸°
  const SB_ACT_PAGE = 500;   // activities í˜ì´ì§€ í¬ê¸°
  let   _sbRtChannel = null; // Realtime ì±„ë„
  
  // â”€â”€ í—¬í¼: í˜ì´ì§€ë„¤ì´ì…˜ìœ¼ë¡œ ì „ì²´ rows ê°€ì ¸ì˜¤ê¸°
  async function sbFetchAll(table, params, pageSize){
    const h = { 'apikey': sbKey, 'Authorization': 'Bearer ' + sbKey,
                 'Range-Unit': 'items', 'Prefer': 'count=none' };
    let all = [], offset = 0;
    while(true){
      const range = `${offset}-${offset+pageSize-1}`;
      const url = `${sbUrl}/rest/v1/${table}?${params}&limit=${pageSize}&offset=${offset}`;
      const res = await fetch(url, { headers: {...h, 'Range': range} });
      if(!res.ok){ const t=await res.text(); throw new Error(`[${table}] fetch ì‹¤íŒ¨ (${res.status}): ${t.slice(0,120)}`); }
      const rows = await res.json();
      if(!Array.isArray(rows)||rows.length===0) break;
      all = all.concat(rows);
      if(rows.length < pageSize) break;
      offset += pageSize;
      // ì§„í–‰ í‘œì‹œ
      sbUpdateStatus('syncing', `${table} ${all.length.toLocaleString()}í–‰ ë¡œë”© ì¤‘...`);
    }
    return all;
  }
  
  // â”€â”€ upsert (ë¶„í•  ì „ì†¡)
  async function sbUpsert(table, rows){
    if(!rows.length) return;
    const h = { 'Content-Type':'application/json', 'apikey':sbKey,
                 'Authorization':'Bearer '+sbKey, 'Prefer':'resolution=merge-duplicates,return=minimal' };
    const CHUNK = 200;
    for(let i=0;i<rows.length;i+=CHUNK){
      const res = await fetch(`${sbUrl}/rest/v1/${table}`, {
        method:'POST', headers:h,
        body: JSON.stringify(rows.slice(i,i+CHUNK))
      });
      if(!res.ok){ const e=await res.text(); throw new Error(`[${table}] upsert ì‹¤íŒ¨ (${res.status}): ${e.slice(0,120)}`); }
    }
  }
  
  // â”€â”€ ê°œë³„ row upsert (ë‹¨ê±´ ì €ì¥)
  async function sbUpsertOne(table, row){
    const h = { 'Content-Type':'application/json', 'apikey':sbKey,
                 'Authorization':'Bearer '+sbKey, 'Prefer':'resolution=merge-duplicates,return=minimal' };
    const res = await fetch(`${sbUrl}/rest/v1/${table}`, {
      method:'POST', headers:h, body: JSON.stringify([row])
    });
    if(!res.ok){ const e=await res.text(); throw new Error(`[${table}] upsert ì‹¤íŒ¨ (${res.status}): ${e.slice(0,120)}`); }
  }
  
  // â”€â”€ ì‚­ì œ
  async function sbDeleteById(table, id){
    const h = { 'apikey':sbKey, 'Authorization':'Bearer '+sbKey, 'Prefer':'return=minimal' };
    const res = await fetch(`${sbUrl}/rest/v1/${table}?id=eq.${encodeURIComponent(id)}`, {
      method:'DELETE', headers:h
    });
    if(!res.ok && res.status!==404){ const t=await res.text(); console.warn(`[${table}] delete ê²½ê³  (${res.status}):`,t.slice(0,80)); }
  }
  
  async function sbDeleteAll(table){
    const h = { 'apikey':sbKey, 'Authorization':'Bearer '+sbKey, 'Prefer':'return=minimal' };
    const res = await fetch(`${sbUrl}/rest/v1/${table}?id=neq.`, { method:'DELETE', headers:h });
    if(!res.ok && res.status!==404){ const t=await res.text(); console.warn(`[${table}] ì‚­ì œ ê²½ê³  (${res.status}):`,t.slice(0,80)); }
  }
  
  // â”€â”€ ì „ì²´ ë¶ˆëŸ¬ì˜¤ê¸° (ì´ˆê¸° ë¡œë“œ â€” í˜ì´ì§€ë„¤ì´ì…˜)
  async function sbLoad(){
    if(!sbIsConnected()) return;
    sbUpdateStatus('syncing', i18n('ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...'));
    try {
      // contacts ì „ì²´ í˜ì´ì§€ë„¤ì´ì…˜
      const dbContacts = await sbFetchAll('contacts', 'select=*&order=created_at.asc', SB_PAGE);
  
      // activities ì „ì²´ í˜ì´ì§€ë„¤ì´ì…˜
      const dbActivities = await sbFetchAll('activities', 'select=*&order=date.desc', SB_ACT_PAGE);
  
      // companies + types (ì‘ì€ í…Œì´ë¸” â€” ë‹¨ìˆœ fetch)
      const [rCo, rT] = await Promise.all([
        fetch(`${sbUrl}/rest/v1/companies?select=*&limit=10000`, { headers:{ 'apikey':sbKey,'Authorization':'Bearer '+sbKey } }),
        fetch(`${sbUrl}/rest/v1/types?select=*&limit=100`,        { headers:{ 'apikey':sbKey,'Authorization':'Bearer '+sbKey } }),
      ]);
      const dbCompanies = rCo.ok ? await rCo.json() : [];
      const dbTypes     = rT.ok  ? await rT.json()  : [];
  
      console.log(`[sbLoad] contacts:${dbContacts.length} activities:${dbActivities.length}`);
  
      contacts   = dbContacts.map(sbRowToContact);
      activities = dbActivities.map(sbRowToActivity);
  
      if(Array.isArray(dbCompanies)&&dbCompanies.length){
        companies = {};
        dbCompanies.forEach(r=>{ try{ companies[r.name]=JSON.parse(r.data||'{}'); }catch(e){} });
      }
      if(Array.isArray(dbTypes)&&dbTypes.length){
        try{
          const parsed=JSON.parse(dbTypes[0].data);
          if(Array.isArray(parsed)&&parsed.length){
            actTypes=parsed;
            safeStorage.setItem('crm_types',JSON.stringify(actTypes));
            rebuildTypeMaps(); injectTypeStyles(); refreshTypeSelect(); refreshFilterBar();
          }
        }catch(e){ console.warn('[sbLoad] types íŒŒì‹± ì˜¤ë¥˜:',e); }
      }
  
      _idxDirty = true;
      localPersist();
      sbLastSync = new Date().toLocaleString('ko-KR');
      safeStorage.setItem('crm_sb_last_sync', sbLastSync);
      sbUpdateStatus('ok', `âœ“ ${contacts.length.toLocaleString()}ëª… Â· ${activities.length.toLocaleString()}ê±´ Â· ${sbLastSync}`);
      renderStats(); renderContacts(); refreshTeamFilterBars();
  
      // Realtime êµ¬ë… ì‹œì‘ (30ëª… ë™ì‹œì ‘ì† ì§€ì›)
      _sbStartRealtime();
  
    } catch(err){
      console.error('[sbLoad] ì˜¤ë¥˜:', err);
      sbUpdateStatus('error', err.message);
    }
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SMART SAVE â€” ë³€ê²½ë¶„ë§Œ ì €ì¥ (ì „ì²´ ì‚­ì œâ†’ì¬ì‚½ì… íê¸°)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  // ë³€ê²½ ì¶”ì ìš© Set
  let _dirtyContacts   = new Set(); // ìˆ˜ì •/ì¶”ê°€ëœ contact id
  let _dirtyActivities = new Set(); // ìˆ˜ì •/ì¶”ê°€ëœ activity id
  let _delContacts     = new Set(); // ì‚­ì œëœ contact id
  let _delActivities   = new Set(); // ì‚­ì œëœ activity id
  
  function markContactDirty(id)   { _dirtyContacts.add(id); }
  function markActivityDirty(id)  { _dirtyActivities.add(id); }
  function markContactDeleted(id) { _delContacts.add(id);   _dirtyContacts.delete(id); }
  function markActivityDeleted(id){ _delActivities.add(id); _dirtyActivities.delete(id); }
  
  async function sbSave(){
    if(!sbIsConnected()){ localPersist(); return; }
    if(sbSyncing){ sbPendingSave=true; return; }
    sbSyncing=true;
    sbUpdateStatus('syncing', i18n('ì €ì¥ ì¤‘...'));
    localPersist();
  
    try {
      // â‘  ì‚­ì œ
      for(const id of _delContacts)   await sbDeleteById('contacts',   id);
      for(const id of _delActivities) await sbDeleteById('activities', id);
  
      // â‘¡ ë³€ê²½/ì¶”ê°€ upsert
      const cRows = [..._dirtyContacts].map(id=>contacts.find(c=>c.id===id)).filter(Boolean).map(contactToSbRow);
      const aRows = [..._dirtyActivities].map(id=>activities.find(a=>a.id===id)).filter(Boolean).map(activityToSbRow);
      if(cRows.length) await sbUpsert('contacts',   cRows);
      if(aRows.length) await sbUpsert('activities', aRows);
  
      // â‘¢ companies (í¬ê¸° ì‘ìŒ â€” ì „ì²´ ê°±ì‹  ìœ ì§€)
      const coRows = Object.entries(companies).map(([name,data])=>({name, data:JSON.stringify(data)}));
      if(coRows.length){ await sbDeleteAll('companies'); await sbUpsert('companies', coRows); }
  
      // â‘£ types
      await fetch(`${sbUrl}/rest/v1/types?id=eq.1`,{method:'DELETE',headers:{'apikey':sbKey,'Authorization':'Bearer '+sbKey,'Prefer':'return=minimal'}});
      await fetch(`${sbUrl}/rest/v1/types`,{method:'POST',headers:{'Content-Type':'application/json','apikey':sbKey,'Authorization':'Bearer '+sbKey,'Prefer':'return=minimal'},body:JSON.stringify([{id:1,data:JSON.stringify(actTypes)}])});
  
      // â‘¤ dirty í´ë¦¬ì–´
      _dirtyContacts.clear(); _dirtyActivities.clear();
      _delContacts.clear();   _delActivities.clear();
  
      sbLastSync = new Date().toLocaleString('ko-KR');
      safeStorage.setItem('crm_sb_last_sync', sbLastSync);
      sbUpdateStatus('ok', `âœ“ ${sbLastSync}`);
      console.log(`[sbSave] ì™„ë£Œ contacts:${cRows.length} acts:${aRows.length}`);
  
    } catch(err){
      console.error('[sbSave] ì˜¤ë¥˜:', err);
      sbUpdateStatus('error', i18n('ì €ì¥ ì‹¤íŒ¨')+': '+err.message);
    } finally {
      sbSyncing=false;
      if(sbPendingSave){ sbPendingSave=false; sbSave(); }
    }
  }
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // REALTIME â€” 30ëª… ë™ì‹œì ‘ì† (Supabase Realtime WebSocket)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  let _sbRtWs       = null;
  let _sbRtReconnT  = null;
  let _sbRtEnabled  = false;
  let _sbRtHeartT   = null;
  
  function _sbStartRealtime(){
    if(!sbIsConnected() || _sbRtEnabled) return;
    _sbRtEnabled = true;
    _sbRtConnect();
  }
  
  function _sbStopRealtime(){
    _sbRtEnabled = false;
    clearTimeout(_sbRtReconnT);
    clearInterval(_sbRtHeartT);
    if(_sbRtWs){ try{ _sbRtWs.close(); }catch(e){} _sbRtWs=null; }
  }
  
  function _sbRtConnect(){
    if(!_sbRtEnabled || !sbIsConnected()) return;
  
    // Supabase Realtime WebSocket URL
    const wsUrl = sbUrl.replace('https://','wss://').replace('http://','ws://')
                  + '/realtime/v1/websocket?apikey=' + encodeURIComponent(sbKey) + '&vsn=1.0.0';
    try {
      _sbRtWs = new WebSocket(wsUrl);
    } catch(e) {
      console.warn('[Realtime] WebSocket ìƒì„± ì‹¤íŒ¨:', e.message);
      _sbRtScheduleReconnect();
      return;
    }
  
    _sbRtWs.onopen = function(){
      console.log('[Realtime] ì—°ê²°ë¨');
      _sbUpdateRtBadge(true);
  
      // Phoenix heartbeat (30ì´ˆ)
      clearInterval(_sbRtHeartT);
      let _heartRef = 1;
      _sbRtHeartT = setInterval(function(){
        if(_sbRtWs && _sbRtWs.readyState===1){
          _sbRtWs.send(JSON.stringify({topic:'phoenix',event:'heartbeat',payload:{},ref:String(_heartRef++)}));
        }
      }, 30000);
  
      // contacts êµ¬ë…
      _sbRtWs.send(JSON.stringify({
        topic: 'realtime:public:contacts',
        event: 'phx_join',
        payload: { config:{ broadcast:{self:false}, presence:{key:''}, postgres_changes:[{event:'*',schema:'public',table:'contacts'}] } },
        ref: '1'
      }));
      // activities êµ¬ë…
      _sbRtWs.send(JSON.stringify({
        topic: 'realtime:public:activities',
        event: 'phx_join',
        payload: { config:{ broadcast:{self:false}, presence:{key:''}, postgres_changes:[{event:'*',schema:'public',table:'activities'}] } },
        ref: '2'
      }));
      // companies êµ¬ë…
      _sbRtWs.send(JSON.stringify({
        topic: 'realtime:public:companies',
        event: 'phx_join',
        payload: { config:{ broadcast:{self:false}, presence:{key:''}, postgres_changes:[{event:'*',schema:'public',table:'companies'}] } },
        ref: '3'
      }));
    };
  
    _sbRtWs.onmessage = function(e){
      try { _sbRtHandleMsg(JSON.parse(e.data)); } catch(err){}
    };
  
    _sbRtWs.onclose = function(e){
      console.log('[Realtime] ì—°ê²° ëŠê¹€', e.code);
      _sbUpdateRtBadge(false);
      clearInterval(_sbRtHeartT);
      if(_sbRtEnabled) _sbRtScheduleReconnect();
    };
  
    _sbRtWs.onerror = function(){
      console.warn('[Realtime] WebSocket ì˜¤ë¥˜');
      _sbUpdateRtBadge(false);
    };
  }
  
  function _sbRtScheduleReconnect(){
    clearTimeout(_sbRtReconnT);
    _sbRtReconnT = setTimeout(_sbRtConnect, 5000); // 5ì´ˆ í›„ ì¬ì—°ê²°
  }
  
  // Realtime ì´ë²¤íŠ¸ ì²˜ë¦¬
  let _sbRtPendingRefresh = false;
  function _sbRtHandleMsg(msg){
    const ev = msg.event;
    if(ev === 'phx_reply' || ev === 'heartbeat' || ev === 'phx_close') return;
  
    const payload = msg.payload || {};
    const type    = payload.type;    // INSERT / UPDATE / DELETE
    const table   = payload.table;
    const rec     = payload.record;
    const old     = payload.old_record;
  
    if(!type || !table) return;
  
    let changed = false;
  
    if(table === 'contacts'){
      if(type === 'INSERT' || type === 'UPDATE'){
        const c = sbRowToContact(rec);
        const idx = contacts.findIndex(x=>x.id===c.id);
        if(idx>=0) contacts[idx]=c; else contacts.unshift(c);
        changed = true;
      } else if(type === 'DELETE'){
        const id = old&&old.id;
        if(id){ contacts = contacts.filter(x=>x.id!==id); changed=true; }
      }
    } else if(table === 'activities'){
      if(type === 'INSERT' || type === 'UPDATE'){
        const a = sbRowToActivity(rec);
        const idx = activities.findIndex(x=>x.id===a.id);
        if(idx>=0) activities[idx]=a; else activities.push(a);
        changed = true;
      } else if(type === 'DELETE'){
        const id = old&&old.id;
        if(id){ activities = activities.filter(x=>x.id!==id); changed=true; }
      }
    } else if(table === 'companies'){
      if(type === 'INSERT' || type === 'UPDATE'){
        try{ companies[rec.name]=JSON.parse(rec.data||'{}'); }catch(e){}
        changed = true;
      } else if(type === 'DELETE'){
        if(old&&old.name) delete companies[old.name];
        changed = true;
      }
    }
  
    if(changed){
      _idxDirty = true;
      // ë””ë°”ìš´ìŠ¤ (50ms ë‚´ ì—¬ëŸ¬ ì´ë²¤íŠ¸ ë¬¶ì–´ì„œ 1íšŒ ë Œë”)
      if(!_sbRtPendingRefresh){
        _sbRtPendingRefresh = true;
        setTimeout(function(){
          _sbRtPendingRefresh = false;
          _idxDirty = true;
          localPersist();
          renderStats();
          renderContacts();
          if(currentCid) showDetail(currentCid);
          sbLastSync = new Date().toLocaleString('ko-KR');
          sbUpdateStatus('ok', `âœ“ ì‹¤ì‹œê°„ ë™ê¸°í™” Â· ${contacts.length.toLocaleString()}ëª…`);
          _sbUpdateRtBadge(true);
          // í† ìŠ¤íŠ¸ ì•Œë¦¼
          _showRtToast(type, table, rec||old);
        }, 50);
      }
    }
  }
  
  // Realtime ì—°ê²° ìƒíƒœ ë°°ì§€
  function _sbUpdateRtBadge(connected){
    const els = document.querySelectorAll('.sb-rt-badge');
    els.forEach(el=>{
      el.textContent = connected ? 'â— ì‹¤ì‹œê°„' : 'â—‹ ì˜¤í”„ë¼ì¸';
      el.style.color = connected ? 'var(--accent3)' : 'var(--muted)';
    });
  }
  
  // ì‹¤ì‹œê°„ ë³€ê²½ í† ìŠ¤íŠ¸
  let _rtToastTimer = null;
  function _showRtToast(type, table, rec){
    let el = document.getElementById('_rtToast');
    if(!el){
      el = document.createElement('div');
      el.id = '_rtToast';
      el.style.cssText = 'position:fixed;bottom:70px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:8px 16px;font-size:12px;color:var(--text);box-shadow:0 4px 20px rgba(0,0,0,0.3);z-index:9999;opacity:0;transition:all 0.3s;pointer-events:none;white-space:nowrap';
      document.body.appendChild(el);
    }
    const tableMap = {contacts:'ì—°ë½ì²˜', activities:'í™œë™', companies:'íšŒì‚¬ì •ë³´'};
    const typeMap  = {INSERT:'ì¶”ê°€ë¨', UPDATE:'ìˆ˜ì •ë¨', DELETE:'ì‚­ì œë¨'};
    const who = rec && (rec.last||rec.company||rec.name||rec.title) ? (rec.last||'')+(rec.first||'')+(rec.company||rec.name||rec.title||'') : '';
    el.textContent = `ğŸ”„ ${tableMap[table]||table} ${who?'"'+who+'" ':''} ${typeMap[type]||type}`;
    el.style.opacity = '1';
    el.style.transform = 'translateX(-50%) translateY(0)';
    clearTimeout(_rtToastTimer);
    _rtToastTimer = setTimeout(()=>{
      el.style.opacity = '0';
      el.style.transform = 'translateX(-50%) translateY(20px)';
    }, 2500);
  }
  
  
  
  // â”€â”€ ë°ì´í„° ë³€í™˜ í—¬í¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function contactToSbRow(c){
    return {
      id: c.id, company: c.company||'', dept: c.dept||'',
      position: c.position||'', last: c.last||'', first: c.first||'',
      email: c.email||'', office: c.office||'', mobile: c.mobile||'',
      extra: c.extra||'', address: c.address||'', memo: c.memo||'',
      created_at: c.createdAt || new Date().toISOString(),
      created_by: c.createdBy||''
    };
  }
  function sbRowToContact(r){
    return {
      id: r.id, company: r.company, dept: r.dept, position: r.position,
      last: r.last, first: r.first, email: r.email, office: r.office,
      mobile: r.mobile, extra: r.extra, address: r.address, memo: r.memo,
      createdAt: r.created_at, createdBy: r.created_by||''
    };
  }
  function activityToSbRow(a){
    return {
      id: a.id, contact_id: a.contactId, type: a.type||'other',
      date: a.date||'', title: a.title||'', content: a.content||'',
      amount: a.amount||'', created_at: a.createdAt||new Date().toISOString(),
      created_by: a.createdBy||''
    };
  }
  function sbRowToActivity(r){
    return {
      id: r.id, contactId: r.contact_id, type: r.type,
      date: r.date, title: r.title, content: r.content,
      amount: r.amount, createdAt: r.created_at,
      createdBy: r.created_by||''
    };
  }
  
  // â”€â”€ ë¡œì»¬ ì €ì¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function localPersist(){
    _idxDirty = true; // ì¸ë±ìŠ¤ ë¬´íš¨í™”
    safeStorage.setItem('crm_contacts',  JSON.stringify(contacts));
    safeStorage.setItem('crm_activities',JSON.stringify(activities));
    safeStorage.setItem('crm_companies', JSON.stringify(companies));
  }
  
  function persist(opts){
    // opts: { cId, aId, delC, delA }
    // ë³€ê²½ ì¶”ì  (ìŠ¤ë§ˆíŠ¸ saveìš©)
    opts = opts || {};
    if(opts.cId)  markContactDirty(opts.cId);
    if(opts.aId)  markActivityDirty(opts.aId);
    if(opts.delC) markContactDeleted(opts.delC);
    if(opts.delA) markActivityDeleted(opts.delA);
    // opts ì—†ì´ í˜¸ì¶œëœ ê²½ìš°(CSV import ë“±) ì „ì²´ dirty ì²˜ë¦¬
    if(!opts.cId && !opts.aId && !opts.delC && !opts.delA){
      contacts.forEach(c=>markContactDirty(c.id));
      activities.forEach(a=>markActivityDirty(a.id));
    }
    localPersist();
    renderStats();
    refreshTeamFilterBars();
    if(sbIsConnected()) sbSave();
  }
  
  let editCid = null;       // editing contact id
  let editCoName = null;    // editing company name
  let actCid = null;        // activity target contact id
  let currentCid = null;    // currently viewed contact
  
  let viewMode = 'group';
  let expanded = new Set();
  
  // â”€â”€ í™œë™ ìœ í˜• (ì‚¬ìš©ì ì •ì˜ ê°€ëŠ¥) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const DEFAULT_TYPES = [
    {id:'order', get label(){ return i18n('ë°œì£¼')||'ë°œì£¼'; }, emoji:'ğŸ“¦', color:'#43e97b'},
    {id:'quote', get label(){ return i18n('ê²¬ì ')||'ê²¬ì '; }, emoji:'ğŸ“„', color:'#f7971e'},
    {id:'visit', get label(){ return i18n('ë°©ë¬¸')||'ë°©ë¬¸'; }, emoji:'ğŸ¤', color:'#ff6b6b'},
    {id:'call',  get label(){ return i18n('í†µí™”')||'í†µí™”'; }, emoji:'ğŸ“', color:'#4f7cff'},
    {id:'other', get label(){ return i18n('ê¸°íƒ€')||'ê¸°íƒ€'; }, emoji:'ğŸ“Œ', color:'#7986cb'},
  ];
  
  function loadTypes(){
    try { return JSON.parse(safeStorage.getItem('crm_types')) || DEFAULT_TYPES; }
    catch(e){ return DEFAULT_TYPES; }
  }
  function saveTypes(types){ safeStorage.setItem('crm_types',JSON.stringify(types)); }
  
  let actTypes = loadTypes();
  
  function buildTypeMaps(){
    const TL={}, TE={}, TB={}, TD={};
    actTypes.forEach(t=>{
      TL[t.id] = t.label;
      TE[t.id] = t.emoji;
      TB[t.id] = 'badge-type-'+t.id;
      TD[t.id] = 'dot-type-'+t.id;
    });
    return {TL,TE,TB,TD};
  }
  let {TL,TE,TB,TD} = buildTypeMaps();
  
  function rebuildTypeMaps(){
    const maps = buildTypeMaps();
    Object.assign(TL, maps.TL); Object.keys(TL).forEach(k=>{ if(!maps.TL[k]) delete TL[k]; });
    Object.assign(TE, maps.TE); Object.keys(TE).forEach(k=>{ if(!maps.TE[k]) delete TE[k]; });
    Object.assign(TB, maps.TB); Object.keys(TB).forEach(k=>{ if(!maps.TB[k]) delete TB[k]; });
    Object.assign(TD, maps.TD); Object.keys(TD).forEach(k=>{ if(!maps.TD[k]) delete TD[k]; });
  }
  
  function injectTypeStyles(){
    let s = document.getElementById('dynamicTypeStyles');
    if(!s){ s=document.createElement('style'); s.id='dynamicTypeStyles'; document.head.appendChild(s); }
    s.textContent = actTypes.map(t=>{
      const hex = t.color||'#7986cb';
      const r=parseInt(hex.slice(1,3),16), g=parseInt(hex.slice(3,5),16), b=parseInt(hex.slice(5,7),16);
      return `.badge-type-${t.id}{background:rgba(${r},${g},${b},0.15);color:${hex}}
  .dot-type-${t.id}{background:rgba(${r},${g},${b},0.15);color:${hex};border:1px solid ${hex}}`;
    }).join('\n');
  }
  
  function uid() { return Date.now().toString(36)+Math.random().toString(36).slice(2); }
  function esc(s){ return (s||'').replace(/\\/g,'\\\\').replace(/'/g,"\\'"); }
  function ac(s){ // avatar color
    const c=['#4f7cff','#ff6b6b','#43e97b','#f7971e','#a855f7','#06b6d4','#f43f5e','#84cc16'];
    let h=0; for(let ch of (s||''))h=(h*31+ch.charCodeAt(0))%c.length; return c[h];
  }
  function fmtMoney(s){ return Number((s||'').toString().replace(/[^0-9]/g,'')||0).toLocaleString(); }
  
  // â”€â”€ NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function nav(p){
    document.getElementById('contactsView').style.display   = p==='contacts'   ? '' : 'none';
    document.getElementById('activitiesView').style.display = p==='activities' ? '' : 'none';
    var adminViewEl = document.getElementById('adminView');
    if(adminViewEl) adminViewEl.style.display = p==='admin' ? '' : 'none';
    document.getElementById('detailView').classList.remove('open');
    // PC ì‚¬ì´ë“œë°”
    document.getElementById('navContacts').classList.toggle('active', p==='contacts');
    document.getElementById('navActivities').classList.toggle('active', p==='activities');
    var navAdmin = document.getElementById('navAdmin');
    if(navAdmin) navAdmin.classList.toggle('active', p==='admin');
    // ëª¨ë°”ì¼ íƒ­ë°”
    const mTabC=document.getElementById('mTabContacts'), mTabA=document.getElementById('mTabActivities');
    if(mTabC) mTabC.classList.toggle('active', p==='contacts');
    if(mTabA) mTabA.classList.toggle('active', p==='activities');
    // ì—°ë½ì²˜ íƒ­ì¼ ë•Œë§Œ ê²€ìƒ‰/ë·°í† ê¸€ topbar í‘œì‹œ
    const topbar = document.getElementById('mainTopbar');
    if(topbar) topbar.style.display = p==='contacts' ? '' : 'none';
  
    currentCid = null;
    if(p==='contacts')   renderContacts();
    if(p==='activities') renderAllActs();
    if(p==='admin')      renderAdminView();
  }
  function backToList(){
    document.getElementById('detailView').classList.remove('open');
    document.getElementById('contactsView').style.display='';
    currentCid=null; renderContacts();
  }
  function setViewMode(m){
    viewMode=m;
    document.querySelectorAll('.toggle-btn').forEach(b=>b.classList.remove('active'));
    document.getElementById('vBtn-'+m).classList.add('active');
    renderContacts();
  }
  // â”€â”€ í•„í„° ìƒíƒœ (Set ê¸°ë°˜ ë‹¤ì¤‘ì„ íƒ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let actFilter    = new Set(); // í™œë™ ìœ í˜• í•„í„° (ë¹ˆ Set = ì „ì²´)
  let teamFilter   = new Set(); // ì—°ë½ì²˜ íŒ€ í•„í„°
  let actTeamFilter= new Set(); // í™œë™ íŒ€ í•„í„°
  
  // Set í•„í„° í† ê¸€ í—¬í¼
  function toggleFilter(set, val){
    if(val==='all'){ set.clear(); return; }
    if(set.has(val)) set.delete(val);
    else set.add(val);
  }
  // Set í•„í„° ì ìš© í—¬í¼: arrì„ í•„í„°ë§ (ë¹ˆ Set = ì „ì²´)
  function applySetFilter(arr, set, keyFn){
    if(!set.size) return arr;
    return arr.filter(item => set.has(keyFn(item)));
  }
  // ì¹© active ë™ê¸°í™”
  function syncChips(barSelector, set){
    document.querySelectorAll(barSelector+' .filter-chip').forEach(b=>{
      const v = b.dataset.val;
      if(v==='all') b.classList.toggle('active', set.size===0);
      else          b.classList.toggle('active', set.has(v));
    });
  }
  
  // íŒ€ ëª©ë¡ ì¶”ì¶œ (companiesì—ì„œ ourTeam ê°’ë“¤)
  function getTeamList(){
    return [...new Set(
      Object.values(companies)
        .map(c=>c.ourTeam||'')
        .filter(Boolean)
    )].sort();
  }
  
  // íŒ€ í•„í„°ê°€ ì ìš©ë  íšŒì‚¬ ëª©ë¡ ë°˜í™˜
  function getCosByTeam(teamSet){
    if(!teamSet || !teamSet.size) return null;
    return Object.entries(companies)
      .filter(([,ci])=>teamSet.has(ci.ourTeam||''))
      .map(([name])=>name);
  }
  
  function setActFilter(f, btn){
    toggleFilter(actFilter, f);
    syncChips('#actFilterBar', actFilter);
    renderAllActs();
  }
  
  function setTeamFilter(f, btn){
    toggleFilter(teamFilter, f);
    syncChips('#teamFilterBar', teamFilter);
    renderContacts();
  }
  
  function setActTeamFilter(f, btn){
    toggleFilter(actTeamFilter, f);
    syncChips('#actTeamFilterBar', actTeamFilter);
    renderAllActs();
  }
  
  function refreshTeamFilterBars(){
    const teams = getTeamList();
    const makeChips = (barId, set, fnName) => {
      const bar = document.getElementById(barId);
      if(!bar) return;
      if(!teams.length){
        bar.style.display='';
        bar.innerHTML = `<span style="font-size:11px;color:var(--muted);padding:2px 6px">${i18n('íŒ€ ë¯¸ë“±ë¡')}</span>`;
        return;
      }
      bar.style.display='';
      bar.innerHTML = `<span style="font-size:10px;color:var(--muted);font-family:IBM Plex Mono,monospace;align-self:center;margin-right:4px;white-space:nowrap">${i18n('ğŸ‘¥ íŒ€')}</span>`
        + `<button class="filter-chip${set.size===0?' active':''}" data-val="all" onclick="${fnName}('all',this)">${i18n('ì „ì²´')}</button>`
        + teams.map(t=>`<button class="filter-chip${set.has(t)?' active':''}" data-val="${t.replace(/"/g,'&quot;')}" onclick="${fnName}('${t.replace(/'/g,"\\'")}',this)">ğŸ‘¥ ${t}</button>`).join('');
    };
    makeChips('teamFilterBar',    teamFilter,    'setTeamFilter');
    makeChips('actTeamFilterBar', actTeamFilter, 'setActTeamFilter');
  }
  
  // â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // â”€â”€ ì¸ë±ìŠ¤ ìºì‹œ (O(NÂ²) â†’ O(1) ì¡°íšŒ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // contacts/activities ë³€ê²½ ì‹œ rebuildIndex() í˜¸ì¶œ
  let _idxCoToIds   = {};  // company â†’ Set<contactId>
  let _idxIdToActs  = {};  // contactId â†’ activity[]
  let _idxCoToActs  = {};  // company â†’ activity[] (ì •ë ¬ë¨)
  let _idxDirty     = true;
  
  function rebuildIndex(){
    _idxCoToIds  = {};
    _idxIdToActs = {};
    _idxCoToActs = {};
  
    // contacts ì¸ë±ì‹±
    for(const c of contacts){
      const co = (c.company||'').trim();
      if(co){ (_idxCoToIds[co] = _idxCoToIds[co]||new Set()).add(c.id); }
      _idxIdToActs[c.id] = [];
    }
  
    // activities ì¸ë±ì‹± + ì •ë ¬
    const sorted = [...activities].sort((a,b)=>b.date.localeCompare(a.date));
    for(const a of sorted){
      if(_idxIdToActs[a.contactId]) _idxIdToActs[a.contactId].push(a);
    }
  
    // íšŒì‚¬ë³„ í™œë™ ìºì‹œ
    for(const co of Object.keys(_idxCoToIds)){
      const ids = _idxCoToIds[co];
      _idxCoToActs[co] = sorted.filter(a=>ids.has(a.contactId));
    }
    _idxDirty = false;
  }
  
  function _ensureIndex(){
    if(_idxDirty) rebuildIndex();
  }
  
  function coActivities(coName){
    _ensureIndex();
    return _idxCoToActs[coName] || [];
  }
  
  function contactActivities(contactId){
    _ensureIndex();
    return _idxIdToActs[contactId] || [];
  }
  
  // â”€â”€ RENDER CONTACTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // â”€â”€ ê°€ìƒ ìŠ¤í¬ë¡¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let _vsOffset   = 0;   // í˜„ì¬ ë Œë”ëœ íšŒì‚¬ ìˆ˜
  let _vsObserver = null;
  
  function _vsObserve(){
    if(_vsObserver) _vsObserver.disconnect();
    const sentinel = document.getElementById('_vssentinel') ||
                     document.getElementById('_vssentinel'.replace('ss','s'));
    const el = document.getElementById('_vssentinel') || document.querySelector('#_vssentinel');
    const target = document.getElementById('_vssentinel');
    if(!target) return;
    _vsObserver = new IntersectionObserver(function(entries){
      if(entries[0].isIntersecting){
        _vsOffset += 20;
        renderContacts();
      }
    }, { threshold: 0.1 });
    _vsObserver.observe(target);
  }
  
  // â”€â”€ ê²€ìƒ‰ ë””ë°”ìš´ì‹± (200ms) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let _renderTimer = null;
  function _debouncedRender(){
    clearTimeout(_renderTimer);
    _renderTimer = setTimeout(renderContacts, 200);
  }
  
  function renderContacts(){
    // ê²€ìƒ‰ì–´/í•„í„° ë³€ê²½ ê°ì§€ â†’ ì˜¤í”„ì…‹ ë¦¬ì…‹
    const _newQ = (document.getElementById('searchInput')||{}).value||'';
    if(typeof _lastRenderQ !== 'undefined' && _lastRenderQ !== _newQ) _vsOffset = 0;
    _lastRenderQ = _newQ;
    const q = _newQ.trim();
  
    // Supabase ì—°ê²° + ê²€ìƒ‰ì–´ ìˆì„ ë•Œ â†’ ì„œë²„ì‚¬ì´ë“œ ê²€ìƒ‰
    if(sbIsConnected() && q.length >= 2){
      _sbSearch(q); return;
    }
  
    // ë¡œì»¬ í•„í„° (ê²€ìƒ‰ì–´ ì—†ìŒ or ë¡œì»¬ëª¨ë“œ)
    let list = q
      ? contacts.filter(c=>{ const s=(c.company+c.last+c.first+c.email+c.mobile+c.office).toLowerCase(); return s.includes(q.toLowerCase()); })
      : contacts;
  
    // íŒ€ í•„í„°
    if(teamFilter.size){
      const cos = getCosByTeam(teamFilter);
      if(cos) list = list.filter(c => cos.includes(c.company||''));
    }
    document.getElementById('viewSub').textContent = i18n('ì´ Nëª…').replace('{n}',list.length);
    if(viewMode==='list')  { renderFlatList(list); return; }
    if(viewMode==='glist') { renderGroupList(list); return; }
    renderGroupView(list);
  }
  
  // ì„œë²„ì‚¬ì´ë“œ ê²€ìƒ‰ (Supabase ilike)
  let _sbSearchTimer = null;
  async function _sbSearch(q){
    const enc = encodeURIComponent('%'+q+'%');
    const filter = `or=(company.ilike.${enc},last.ilike.${enc},first.ilike.${enc},email.ilike.${enc},mobile.ilike.${enc})`;
    const url = `${sbUrl}/rest/v1/contacts?select=*&${filter}&limit=500&order=created_at.asc`;
    try {
      const res = await fetch(url, { headers:{'apikey':sbKey,'Authorization':'Bearer '+sbKey} });
      if(!res.ok) throw new Error('ê²€ìƒ‰ ì‹¤íŒ¨');
      let list = (await res.json()).map(sbRowToContact);
      // íŒ€ í•„í„° ì ìš©
      if(teamFilter.size){
        const cos = getCosByTeam(teamFilter);
        if(cos) list = list.filter(c=>cos.includes(c.company||''));
      }
      document.getElementById('viewSub').textContent = i18n('ì´ Nëª…').replace('{n}',list.length) + ' ğŸ”';
      if(viewMode==='list')  { renderFlatList(list); return; }
      if(viewMode==='glist') { renderGroupList(list); return; }
      renderGroupView(list);
    } catch(e){
      console.warn('[sbSearch] ì‹¤íŒ¨, ë¡œì»¬ ê²€ìƒ‰ìœ¼ë¡œ í´ë°±:', e.message);
      // ë¡œì»¬ í´ë°±
      const ql = q.toLowerCase();
      let list = contacts.filter(c=>{ const s=(c.company+c.last+c.first+c.email+c.mobile+c.office).toLowerCase(); return s.includes(ql); });
      document.getElementById('viewSub').textContent = i18n('ì´ Nëª…').replace('{n}',list.length);
      if(viewMode==='list')  { renderFlatList(list); return; }
      if(viewMode==='glist') { renderGroupList(list); return; }
      renderGroupView(list);
    }
  }
  
  function renderGroupView(list){
    const groups={};
    for(const c of list){ const k=(c.company||'').trim()||'__none__'; (groups[k]=groups[k]||[]).push(c); }
    const named = Object.keys(groups).filter(k=>k!=='__none__').sort();
    const none  = groups['__none__']||[];
    let html='';
    let _coIdx=0;
  
    // ê°€ìƒ ìŠ¤í¬ë¡¤: ì²˜ìŒì—” ì²« CHUNKê°œë§Œ ë Œë”, ë‚˜ë¨¸ì§€ëŠ” ìŠ¤í¬ë¡¤ ì‹œ ì¶”ê°€
    const VSCROLL_CHUNK = 20;
    const _namedToRender = named.slice(0, _vsOffset + VSCROLL_CHUNK);
    const _hasMore = named.length > _namedToRender.length;
  
    for(const co of _namedToRender){
      const _cid='co'+(_coIdx++);
      const members = groups[co];
      const ci = companies[co]||{};
      const coActs = coActivities(co);
      // typeë³„ ì¹´ìš´íŠ¸ ë¯¸ë¦¬ ì§‘ê³„ (ë£¨í”„ ë‚´ ì¬filter ì œê±°)
      const typeCount = {};
      for(const a of coActs) typeCount[a.type] = (typeCount[a.type]||0)+1;
      const types = actTypes.map(t=>t.id).filter(id=>typeCount[id]>0);
      const isExp = expanded.has(co);
      const col = ac(co);
      const preview = coActs.slice(0,5);
  
      html+=`
      <div class="company-group${isExp?'':' collapsed'}" id="cg-${CSS.escape(co)}">
        <div class="company-header" onclick="toggleCo('${esc(co)}')">
          <div class="company-logo" style="background:linear-gradient(135deg,${col},${col}bb)">${co[0]}</div>
          <div class="company-info">
            <div class="company-name">${co}</div>
            <div class="company-meta">
              <span>ğŸ‘¤ ${members.length}${i18n('ëª…')}</span>
              ${ci.phone?`<span>â˜ ${ci.phone}</span>`:''}
              ${coActs.length?`<span>ğŸ“‹ ${coActs.length}${i18n('ê±´')}</span>`:''}
            </div>
          </div>
          <div class="company-badges">${types.map(t=>`<span class="activity-badge ${TB[t]}">${TE[t]} ${typeCount[t]||0}</span>`).join('')}</div>
          <span class="company-toggle">â–¾</span>
        </div>
        <div class="company-body">
          <!-- shared bar -->
          <div class="shared-bar">
            <span class="shared-tag">${i18n('ê³µí†µ')}</span>
            ${ci.phone?'<span>â˜ '+ci.phone+'</span>':i18n('ëŒ€í‘œì „í™” ì—†ìŒ')+'</span>'}
            ${ci.fax?`<span>ğŸ“  ${ci.fax}</span>`:''}
            ${ci.address?'<span>ğŸ“ '+ci.address+'</span>':'<span>ğŸ“ '+i18n('ì—†ìŒ')+'</span>'}
            ${ci.ourName?`<span style="color:var(--accent3)">ğŸ‘¤ ${i18n('ë‹´ë‹¹')} ${ci.ourTeam?ci.ourTeam+' ':''}<strong>${ci.ourName}</strong></span>`:''}
            <button class="shared-edit-btn" onclick="openCompanyModal('${esc(co)}')">${i18n('âœ ìˆ˜ì •')}</button>
          </div>
          <!-- ì¬ë¬´ ìš”ì•½ (1ì¤„ + í¼ì¹˜ê¸°) -->
          ${(()=>{
            const fin=(ci.finance||[]).slice().sort((a,b)=>Number(b.year)-Number(a.year));
            if(!fin.length) return '';
            const r=fin[0];
            const fmtFin=v=>v?(Number(v.toString().replace(/[^0-9.-]/g,''))||0).toLocaleString()+'M':'â€”';
            const profitVal=Number((r.net_profit||'').toString().replace(/[^0-9.-]/g,'')||0);
            const coId=_cid;
            const chips=[
              r.headcount?`<div class="fin-chip"><span class="fin-chip-label">${i18n('ì¸ì›')}</span><span class="fin-chip-value neu">${r.headcount}${i18n('ëª…')}</span></div>`:'',
              r.revenue?`<div class="fin-chip"><span class="fin-chip-label">${i18n('ë§¤ì¶œ')}</span><span class="fin-chip-value neu">${fmtFin(r.revenue)}</span></div>`:'',
              r.op_profit?`<div class="fin-chip"><span class="fin-chip-label">${i18n('ì˜ì—…ì´ìµ')}</span><span class="fin-chip-value ${Number((r.op_profit||'').toString().replace(/[^0-9.-]/g,''))||0>=0?'pos':'neg'}">${fmtFin(r.op_profit)}</span></div>`:'',
              r.net_profit?`<div class="fin-chip"><span class="fin-chip-label">${i18n('ìˆœì´ìµ')}</span><span class="fin-chip-value ${profitVal>=0?'pos':'neg'}">${fmtFin(r.net_profit)}</span></div>`:'',
              r.assets?`<div class="fin-chip"><span class="fin-chip-label">${i18n('ìì‚°')}</span><span class="fin-chip-value neu">${fmtFin(r.assets)}</span></div>`:'',
              r.liabilities?`<div class="fin-chip"><span class="fin-chip-label">${i18n('ë¶€ì±„')}</span><span class="fin-chip-value neg">${fmtFin(r.liabilities)}</span></div>`:'',
            ].filter(Boolean).join('');
            const allRows=fin.map(yr=>{
              const fv=v=>v?(Number(v.toString().replace(/[^0-9.-]/g,''))||0).toLocaleString():'â€”';
              return `<tr>
                <td>${yr.year}</td>
                <td>${yr.headcount?yr.headcount+i18n('ëª…'):'â€”'}</td>
                <td>${fv(yr.revenue)}</td>
                <td class="${Number((yr.op_profit||'').toString().replace(/[^0-9.-]/g,'')||0)>=0?'pos':'neg'}">${fv(yr.op_profit)}</td>
                <td class="${Number((yr.net_profit||'').toString().replace(/[^0-9.-]/g,'')||0)>=0?'pos':'neg'}">${fv(yr.net_profit)}</td>
                <td>${fv(yr.assets)}</td>
                <td>${fv(yr.liabilities)}</td>
              </tr>`;
            }).join('');
            return `<div class="fin-summary" id="fin-wrap-${coId}">
              <div class="fin-summary-preview" onclick="toggleFinDetail('${coId}')">
                <span style="font-size:10px;color:var(--muted);font-family:IBM Plex Mono,monospace;padding-right:10px;border-right:1px solid var(--border);flex-shrink:0">${r.year}${i18n('ë…„')}</span>
                ${chips}
              </div>
              <button class="fin-expand-btn" id="fin-btn-${coId}" onclick="toggleFinDetail('${coId}')">${i18n('ì „ì²´')} ${fin.length}${i18n('ë…„')} â–¾</button>
            </div>
            <div class="fin-detail" id="fin-detail-${coId}">
              <table class="fin-table">
                <thead><tr>${['ì—°ë„','ì¸ì›','ë§¤ì¶œ(M)','ì˜ì—…ì´ìµ','ìˆœì´ìµ','ìì‚°','ë¶€ì±„'].map(k=>`<th>${i18n(k)}</th>`).join('')}</tr></thead>
                <tbody>${allRows}</tbody>
              </table>
            </div>`;
          })()}
          <!-- ëŒ€í‘œì´ì‚¬ (1ì¤„ + í¼ì¹˜ê¸°) -->
          ${(()=>{
            const ceos=(ci.ceoHistory||[]).slice().sort((a,b)=>{
              const ya=Number((a.from||'0').toString().replace(/[^0-9]/g,''));
              const yb=Number((b.from||'0').toString().replace(/[^0-9]/g,''));
              return yb-ya;
            });
            if(!ceos.length) return '';
            const cur=ceos.find(ceo=>!ceo.to||ceo.to===i18n('í˜„ì¬'))||ceos[0];
            const coId=_cid;
            const allRows=ceos.map(ceo=>`<div class="ceo-row-item">
              <span class="ceo-row-name">${ceo.name}</span>
              <span class="ceo-row-period">${ceo.from||''}${ceo.from&&(ceo.to||i18n('í˜„ì¬'))?' ~ '+(ceo.to||i18n('í˜„ì¬')):ceo.to?'~ '+ceo.to:''}</span>
              ${ceo.memo?`<span class="ceo-row-memo">${ceo.memo}</span>`:''}
            </div>`).join('');
            return `<div class="ceo-bar" id="ceo-bar-${coId}" onclick="toggleCeoDetail('${coId}')">
              <span>ğŸ‘” ${i18n('ëŒ€í‘œì´ì‚¬')}</span>
              <span class="ceo-bar-name">${cur.name}</span>
              ${cur.from?`<span style="font-size:11px;font-family:IBM Plex Mono,monospace;color:var(--accent)">${cur.from} ~ ${cur.to&&cur.to&&cur.to!==i18n('í˜„ì¬')?cur.to:i18n('í˜„ì¬')}</span>`:''}
              ${ceos.length>1?`<span style="font-size:11px;color:var(--muted)">${i18n('ì´')} ${ceos.length}${i18n('ëª…')}</span>`:''}
              <span class="ceo-bar-arrow">â–¾</span>
            </div>
            <div class="ceo-detail" id="ceo-detail-${coId}">
              ${allRows}
            </div>`;
          })()}
          <!-- members -->
          <div class="members-row">
            ${members.map(c=>personCard(c)).join('')}
            <button class="add-card" onclick="openAddContact('${esc(co)}')">${i18n('ë‹´ë‹¹ì ì¶”ê°€')}</button>
          </div>
          <!-- timeline -->
          <div class="co-timeline-section">
            <div class="co-timeline-head">
              <span class="co-timeline-label">ğŸ“‹ ${i18n('íšŒì‚¬ ì „ì²´ í™œë™')} (${coActs.length}${i18n('ê±´')})</span>
              <button class="btn btn-primary btn-xs" onclick="openActModal_co('${esc(co)}')">${i18n('ï¼‹ ì¶”ê°€')}</button>
            </div>
            ${coActs.length===0
              ? `<div style="font-size:12px;color:var(--muted);text-align:center;padding:12px">${i18n('í™œë™ ì—†ìŒ')}</div>`
              : `<div class="acts-filter" id="coActsFilter-${CSS.escape(co)}"></div>
                 <div id="tl-${CSS.escape(co)}"></div>`
            }
          </div>
        </div>
      </div>`;
    }
  
    if(none.length){
      html+=`<div style="margin-top:16px">
        <div class="ungrouped-label">${i18n('íšŒì‚¬ ë¯¸ì§€ì •')} (${none.length}${i18n('ëª…')})</div>
        <div class="ungrouped-grid">${none.map(c=>personCard(c,true)).join('')}</div>
      </div>`;
    }
  
    if(!named.length&&!none.length) html=`<div class="empty-state"><div class="empty-icon">ğŸ‘¥</div><p>${i18n('ì—°ë½ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤')}</p></div>`;
    if(_hasMore) html += `<div id="_vssentinel" style="height:1px;margin-bottom:40px"></div>`;
    document.getElementById('mainGrid').innerHTML=html;
    if(_hasMore) _vsObserve();
  
    // íšŒì‚¬ë³„ í™œë™ í•„í„° ì´ˆê¸°í™” (ì¸ë±ìŠ¤ ìºì‹œ ì§ì ‘ ì‚¬ìš©, coActivities ì¬í˜¸ì¶œ ì—†ìŒ)
    _namedToRender.forEach(co=>{
      const filterBar = document.getElementById('coActsFilter-'+CSS.escape(co));
      if(!filterBar) return;
      const allActs = coActivities(co); // ì´ë¯¸ ìºì‹œë¨ â†’ O(1)
      if(!allActs.length) return;
      filterBar.innerHTML =
        `<button class="filter-chip active" data-val="all" onclick="setCoActFilter('${esc(co)}',this,'all')">${i18n('ì „ì²´')}</button>`
        + actTypes.map(t=>{
            const cnt = allActs.filter(a=>a.type===t.id).length;
            return cnt ? `<button class="filter-chip" data-val="${t.id}" onclick="setCoActFilter('${esc(co)}',this,'${t.id}')">${t.emoji} ${t.label}</button>` : '';
          }).join('');
      if(!_coActFilters[co]) _coActFilters[co] = new Set();
      _renderCoActs(co);
    });
  }
  
  const _coActFilters = {}; // co â†’ Set
  function setCoActFilter(co, btn, f){
    if(!_coActFilters[co]) _coActFilters[co] = new Set();
    toggleFilter(_coActFilters[co], f);
    const filterBar = document.getElementById('coActsFilter-'+CSS.escape(co));
    if(filterBar) filterBar.querySelectorAll('.filter-chip').forEach(b=>{
      const v = b.dataset.val || b.getAttribute('onclick')?.match(/'([^']+)',this\)$/)?.[1] || '';
      if(v==='all') b.classList.toggle('active', _coActFilters[co].size===0);
      else b.classList.toggle('active', _coActFilters[co].has(v));
    });
    _renderCoActs(co);
  }
  function _renderCoActs(co){
    const tl = document.getElementById('tl-'+CSS.escape(co));
    if(!tl) return;
    const set = _coActFilters[co] || new Set();
    const all = coActivities(co);
    const filtered = set.size===0 ? all : all.filter(a=>set.has(a.type));
    tl.innerHTML = filtered.length===0
      ? `<div style="font-size:12px;color:var(--muted);text-align:center;padding:12px">${i18n('í™œë™ì´ ì—†ìŠµë‹ˆë‹¤')}</div>`
      : `<div class="timeline">${filtered.map(a=>tlItem(a,{showWho:true})).join('')}</div>`;
  }
  
  function personCard(c, standalone=false){
    const acts=activities.filter(a=>a.contactId===c.id);
    const types=actTypes.map(t=>t.id).filter(id=>acts.some(a=>a.type===id));
    const init=(c.last||c.first||'?')[0];
    const bg=ac(c.last+c.first);
    const title=[c.dept,c.position].filter(Boolean).join(' / ');
    return `<div class="person-card" onclick="showDetail('${c.id}')">
      <div class="person-head">
        <div class="avatar" style="background:${bg}">${init}</div>
        <div>
          <div class="person-name">${c.last}${c.first}</div>
          <div class="person-dept">${title||'&mdash;'}</div>
        </div>
      </div>
      <div class="person-contacts">
        ${c.mobile
          ? `<span><span class="pc-label">${i18n('í•¸ë“œí°')}</span>${c.mobile}</span>`
          : c.office ? `<span><span class="pc-label">${i18n('ì§í†µ')}</span>${c.office}</span>` : ''}
        ${c.email?`<span><span class="pc-label">${i18n('ì´ë©”ì¼')}</span>${c.email}</span>`:''}
        ${!c.mobile&&!c.office&&!c.email?`<span style="opacity:.4">${i18n('ì—°ë½ì²˜ ì—†ìŒ')}</span>`:''}
      </div>
      ${types.length?`<div class="person-badges">${types.map(t=>`<span class="activity-badge ${TB[t]}">${TE[t]} ${acts.filter(a=>a.type===t).length}</span>`).join('')}</div>`:''}
    </div>`;
  }
  
  // â”€â”€ ì ‘ì´ì‹ íƒ€ì„ë¼ì¸ ì•„ì´í…œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function tlItem(a, opts){
    // opts: { showWho, fromDetail }
    opts = opts || {};
    const c = contacts.find(x=>x.id===a.contactId);
    const isAmountType = (a.type==='order'||a.type==='quote');
    const amountBadge  = (isAmountType && a.amount)
      ? `<span class="tl-amount-badge">â‚©${fmtMoney(a.amount)}</span>` : '';
    const whoHtml = opts.showWho && c
      ? `<div class="tl-who" onclick="showDetail('${c.id}')">ğŸ‘¤ ${c.last}${c.first}${c.company?' <span style="color:var(--muted)">Â· '+c.company+'</span>':''}</div>` : '';
  
    const titlePreview = a.title
      ? `<span class="tl-title-preview">${a.title}</span>` : '';
  
    return `<div class="timeline-item">
      <div class="timeline-dot ${TD[a.type]||'dot-call'}">${TE[a.type]||'â€¢'}</div>
      <div class="tl-body">
        <div class="tl-summary" onclick="tlToggle(this)">
          <div class="tl-summary-left">
            <span class="tl-type">${TL[a.type]||a.type}</span>
            ${titlePreview}
          </div>
          <div class="tl-summary-right">
            ${amountBadge}
            <span class="tl-date">${a.date}</span>
            <span class="tl-chevron">â–¶</span>
          </div>
        </div>
        <div class="tl-detail">
          ${whoHtml}
          ${a.title?`<div style="font-size:13px;font-weight:600;margin-bottom:4px">${a.title}</div>`:''}
          ${a.content?`<div class="tl-text">${a.content}</div>`:''}
          ${a.amount?`<div class="tl-amount">â‚© ${fmtMoney(a.amount)}</div>`:''}
          ${a.createdBy?`<div class="tl-creator">âœ ${a.createdBy}</div>`:''}
          <div class="tl-actions">
            <button class="tl-act-btn" onclick="openEditAct('${a.id}')">${i18n('âœ ìˆ˜ì •')}</button>
            <button class="tl-act-btn danger" onclick="delAct('${a.id}',${opts.fromDetail?'true':'false'})">${i18n('ğŸ—‘ ì‚­ì œ')}</button>
          </div>
        </div>
      </div>
    </div>`;
  }
  
  function tlToggle(summaryEl){
    const detail  = summaryEl.nextElementSibling;
    const chevron = summaryEl.querySelector('.tl-chevron');
    const isOpen  = detail.classList.toggle('open');
    if(chevron) chevron.style.transform = isOpen ? 'rotate(90deg)' : '';
  }
  
  // â”€â”€ í™œë™ í•„í„° ë Œë” í—¬í¼ (ê°œì¸/íšŒì‚¬ ìƒì„¸ìš©) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderActsFilter(containerId, filterSet, onChangeFn){
    const bar = document.getElementById(containerId);
    if(!bar) return;
    bar.innerHTML =
      `<button class="filter-chip${filterSet.size===0?' active':''}" data-val="all" onclick="${onChangeFn}('all',this)">${i18n('ì „ì²´')}</button>`
      + actTypes.map(t=>`<button class="filter-chip${filterSet.has(t.id)?' active':''}" data-val="${t.id}" onclick="${onChangeFn}('${t.id}',this)">${t.emoji} ${t.label}</button>`).join('');
  }
  
  // ê°œì¸ ìƒì„¸ í™œë™ í•„í„°
  let detailActFilter = new Set();
  function setDetailActFilter(f, btn){
    toggleFilter(detailActFilter, f);
    syncChips('#detailActsFilter', detailActFilter);
    if(currentCid) _renderDetailActs(currentCid);
  }
  
  // íšŒì‚¬ ìƒì„¸ í™œë™ í•„í„°
  let coDetailActFilter = new Set();
  function setCoDetailActFilter(f, btn){
    toggleFilter(coDetailActFilter, f);
    syncChips('#coDetailActsFilter', coDetailActFilter);
    _renderCoDetailActs();
  }
  let _currentCoDetail = '';
  
  function _renderDetailActs(id){
    const allActs = contactActivities(id);
    const filtered = detailActFilter.size===0 ? allActs : allActs.filter(a=>detailActFilter.has(a.type));
    const el = document.getElementById('detailActsList');
    if(!el) return;
    el.innerHTML = filtered.length===0
      ? `<div class="empty-state"><div class="empty-icon">ğŸ“‹</div><p>${detailActFilter.size===0?i18n('í™œë™ì´ ì—†ìŠµë‹ˆë‹¤'):i18n('í™œë™ì´ ì—†ìŠµë‹ˆë‹¤')}</p></div>`
      : `<div class="timeline">${filtered.map(a=>tlItem(a,{fromDetail:true})).join('')}</div>`;
  }
  
  function _renderCoDetailActs(){
    const allActs = coActivities(_currentCoDetail);
    const filtered = coDetailActFilter.size===0 ? allActs : allActs.filter(a=>coDetailActFilter.has(a.type));
    const el = document.getElementById('coDetailActsList');
    if(!el) return;
    el.innerHTML = filtered.length===0
      ? `<div class="empty-state" style="padding:20px"><div class="empty-icon">ğŸ“‹</div><p>${coDetailActFilter.size===0?i18n('í™œë™ì´ ì—†ìŠµë‹ˆë‹¤'):i18n('í™œë™ì´ ì—†ìŠµë‹ˆë‹¤')}</p></div>`
      : `<div class="timeline">${filtered.map(a=>tlItem(a,{showWho:true})).join('')}</div>`;
  }
  
  function showAll(co){
    _renderCoActs(co);
  }
  
  function toggleFinDetail(coId){
    const el  = document.getElementById('fin-detail-'+coId);
    const btn = document.getElementById('fin-btn-'+coId);
    if(!el) return;
    const open = el.classList.toggle('open');
    if(btn){
      btn.textContent = btn.textContent.replace(open?'â–¾':'â–´', open?'â–´':'â–¾');
      btn.style.color = open ? 'var(--accent3)' : '';
    }
  }
  function toggleCeoDetail(coId){
    const el  = document.getElementById('ceo-detail-'+coId);
    const bar = document.getElementById('ceo-bar-'+coId);
    if(!el) return;
    el.classList.toggle('open');
    if(bar) bar.classList.toggle('open');
  }
  function toggleCo(co){
    const el=document.getElementById('cg-'+CSS.escape(co));
    if(!el) return;
    if(el.classList.contains('collapsed')){ el.classList.remove('collapsed'); expanded.add(co); }
    else { el.classList.add('collapsed'); expanded.delete(co); }
  }
  
  // â”€â”€ GROUP LIST VIEW (íšŒì‚¬ë³„ ëª©ë¡) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderGroupList(list){
    const groups={};
    for(const c of list){ const k=(c.company||'').trim()||'__none__'; (groups[k]=groups[k]||[]).push(c); }
    const named=Object.keys(groups).filter(k=>k!=='__none__').sort();
    const none=groups['__none__']||[];
    let html='';
  
    for(const co of named){
      const members=groups[co];
      const ci=companies[co]||{};
      const coActs=coActivities(co);
      const types=actTypes.map(t=>t.id).filter(id=>coActs.some(a=>a.type===id));
      const isExp=expanded.has(co);
      const col=ac(co);
  
      html+=`
      <div class="company-group${isExp?'':' collapsed'}" id="cg-${CSS.escape(co)}">
        <div class="company-header" onclick="toggleCo('${esc(co)}')">
          <div class="company-logo" style="background:linear-gradient(135deg,${col},${col}bb)">${co[0]}</div>
          <div class="company-info">
            <div class="company-name">${co}</div>
            <div class="company-meta">
              <span>ğŸ‘¤ ${members.length}${i18n('ëª…')}</span>
              ${ci.phone?`<span>â˜ ${ci.phone}</span>`:''}
              ${coActs.length?`<span>ğŸ“‹ ${coActs.length} ${i18n('ê±´')}</span>`:''}}
            </div>
          </div>
          <div class="company-badges">${types.map(t=>`<span class="activity-badge ${TB[t]}">${TE[t]} ${coActs.filter(a=>a.type===t).length}</span>`).join('')}</div>
          <button class="shared-edit-btn" style="margin-right:4px" onclick="event.stopPropagation();openCompanyModal('${esc(co)}')">âœ</button>
          <span class="company-toggle">â–¾</span>
        </div>
        <div class="company-body">
          <div class="shared-bar">
            <span class="shared-tag">${i18n('ê³µí†µ')}</span>
            ${ci.phone?'<span>â˜ '+ci.phone+'</span>':i18n('ëŒ€í‘œì „í™” ì—†ìŒ')}
            ${ci.fax?`<span>ğŸ“  ${ci.fax}</span>`:''}
            ${ci.address?'<span>ğŸ“ '+ci.address+'</span>':'<span style="opacity:.4">'+i18n('ì£¼ì†Œ ì—†ìŒ')+'</span>'}
            <button class="shared-edit-btn" onclick="openAddContact('${esc(co)}')">${i18n('ë‹´ë‹¹ì ì¶”ê°€')}</button>
          </div>
          <div class="list-wrap" style="margin:0;border-radius:0;border-left:none;border-right:none;border-bottom:none">
            <table class="list-table">
              <thead><tr>
                <th style="width:130px">${i18n('ì´ë¦„')}</th>
                <th style="width:160px">${i18n('ì§í•¨')}</th>
                <th style="width:150px">${i18n('í•¸ë“œí°')}</th>
                <th style="width:150px">ì´ë©”ì¼</th>
                <th style="width:110px">${i18n("í™œë™")}</th>
              </tr></thead>
              <tbody>
                ${members.map(c=>personListRow(c)).join('')}
              </tbody>
            </table>
          </div>
        </div>
      </div>`;
    }
  
    if(none.length){
      html+=`<div style="margin-top:16px">
        <div class="ungrouped-label">${i18n('íšŒì‚¬ ë¯¸ì§€ì •')} (${none.length}${i18n('ëª…')})</div>
        <div class="list-wrap">
          <table class="list-table">
            <thead><tr><th style="width:130px">${i18n('ì´ë¦„')}</th><th style="width:160px">${i18n('ì§í•¨')}</th><th style="width:150px">${i18n('í•¸ë“œí°')}</th><th style="width:150px">${i18n('ì´ë©”ì¼')}</th><th style="width:110px">${i18n('í™œë™')}</th></tr></thead>
            <tbody>${none.map(c=>personListRow(c)).join('')}</tbody>
          </table>
        </div>
      </div>`;
    }
  
    if(!named.length&&!none.length) html=`<div class="empty-state"><div class="empty-icon">ğŸ‘¥</div><p>${i18n('ì—°ë½ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤')}</p></div>`;
    document.getElementById('mainGrid').innerHTML=html;
  }
  
  // â”€â”€ FLAT LIST VIEW (ì „ì²´ ëª©ë¡) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderFlatList(list){
    // sort by company then name
    const sorted=[...list].sort((a,b)=>{
      const ca=(a.company||'ã…¿').localeCompare(b.company||'ã…¿','ko');
      if(ca!==0) return ca;
      return (a.last+a.first).localeCompare(b.last+b.first,'ko');
    });
  
    if(!sorted.length){
      document.getElementById('mainGrid').innerHTML=`<div class="empty-state"><div class="empty-icon">ğŸ‘¥</div><p>${i18n('ì—°ë½ì²˜ê°€ ì—†ìŠµë‹ˆë‹¤')}</p></div>`;
      return;
    }
  
    // Group header rows mixed in
    let rows=''; let lastCo=null;
    for(const c of sorted){
      const co=(c.company||'').trim();
      if(co && co!==lastCo){
        const ci=companies[co]||{};
        const cnt=list.filter(x=>x.company===co).length;
        rows+=`<tr class="co-row" onclick="setViewMode('group');setTimeout(()=>{expanded.add('${esc(co)}');const el=document.getElementById('cg-'+CSS.escape('${esc(co)}'));if(el){el.classList.remove('collapsed');el.scrollIntoView({behavior:'smooth',block:'start'});}},80)">
          <td colspan="6" style="padding:9px 16px">
            <div style="display:flex;align-items:center;gap:10px">
              <div style="width:26px;height:26px;border-radius:6px;background:${ac(co)};display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#fff;flex-shrink:0">${co[0]}</div>
              <span>${co}</span>
              <span style="font-size:11px;color:var(--muted);font-weight:400">${cnt}${i18n("ëª…")}${ci.phone?' Â· â˜ '+ci.phone:''}</span>
            </div>
          </td>
        </tr>`;
        lastCo=co;
      }
      rows+=personListRow(c, co?true:false);
    }
  
    document.getElementById('mainGrid').innerHTML=`
      <div class="list-wrap">
        <table class="list-table">
          <thead><tr>
            <th style="width:130px">${i18n('ì´ë¦„')}</th>
            <th style="width:160px">${i18n('ì§í•¨')}</th>
            <th style="width:150px">${i18n('í•¸ë“œí°')}</th>
            <th style="width:180px">${i18n('ì´ë©”ì¼')}</th>
            <th style="width:110px">${i18n("í™œë™")}</th>
          </tr></thead>
          <tbody>${rows}</tbody>
        </table>
      </div>`;
  }
  
  // â”€â”€ PERSON LIST ROW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function personListRow(c, indented=true){
    const acts=activities.filter(a=>a.contactId===c.id);
    const types=actTypes.map(t=>t.id).filter(id=>acts.some(a=>a.type===id));
    const bg=ac(c.last+c.first);
    const init=(c.last||c.first||'?')[0];
    const title=[c.dept,c.position].filter(Boolean).join(' / ')||'â€”';
    // í•¸ë“œí° ì—†ìœ¼ë©´ ì§í†µ í‘œì‹œ
    const phoneVal = c.mobile || c.office || '';
    const emailVal = c.email || '';
    return `<tr onclick="showDetail('${c.id}')" style="cursor:pointer">
      <td style="padding-left:${indented?26:14}px">
        <div style="display:flex;align-items:center;gap:8px">
          <div style="width:28px;height:28px;border-radius:50%;background:${bg};display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:#fff;flex-shrink:0">${init}</div>
          <span style="font-weight:500">${c.last}${c.first}</span>
        </div>
      </td>
      <td style="color:var(--muted);font-size:12px">${title}</td>
      <td style="font-family:IBM Plex Mono,monospace;font-size:12px;color:var(--text)">${phoneVal||'<span style="opacity:.3">â€”</span>'}</td>
      <td style="font-family:IBM Plex Mono,monospace;font-size:12px;color:var(--text)">${emailVal||'<span style="opacity:.3">â€”</span>'}</td>
      <td>${types.map(t=>`<span class="activity-badge ${TB[t]}">${TE[t]}${acts.filter(a=>a.type===t).length}</span>`).join(' ')||'<span style="color:var(--border);font-size:11px">â€”</span>'}</td>
    </tr>`;
  }
  
  // â”€â”€ DETAIL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  
// ì—°ë½ì²˜ ìƒì„¸ ì…ë ¥ì HTML ìƒì„± (ë°±í‹± ì¤‘ì²© ë°©ì§€ìš©)
function _detailCreatorHtml(c){
  if(!c.createdBy && !c.createdAt) return '';
  var parts = [];
  if(c.createdBy){
    parts.push('<span>\u270d \uc785\ub825: <b style="color:var(--text)">' + c.createdBy + '</b></span>');
  }
  if(c.createdAt){
    var d = new Date(c.createdAt).toLocaleDateString('ko-KR');
    parts.push('<span style="opacity:.6">\ud83d\udcc5 ' + d + '</span>');
  }
  return '<div style="font-size:11px;color:var(--muted);padding:6px 0 0;display:flex;gap:12px;flex-wrap:wrap">'
    + parts.join('') + '</div>';
}

function showDetail(id){
    currentCid=id;
    const c=contacts.find(x=>x.id===id);
    if(!c) return;
    const acts=contactActivities(id);
    const bg=ac(c.last+c.first);
    const init=(c.last||c.first||'?')[0];
    const ci=c.company?(companies[c.company]||{}):{};
  
    const memoVal = c.memo||ci.memo||'';
    const info=[
      {l:i18n('ì´ë©”ì¼'),      v:c.email||'â€”',                   cls:''},
      {l:i18n('íœ´ëŒ€í°'),      v:c.mobile||'â€”',                  cls:''},
      {l:i18n('ì‚¬ë¬´ì‹¤'),      v:c.office||'â€”',                  cls:''},
      {l:i18n('ì¶”ê°€ ì—°ë½ì²˜'),  v:c.extra||'â€”',                  cls:''},
      {l:i18n('ì£¼ì†Œ'),        v:ci.address||c.address||'â€”',     cls:'wide'},
      {l:i18n('ë©”ëª¨'), v:`<textarea id="detailMemoArea" rows="3" onblur="saveMemoInline('${id}')" style="width:100%;background:transparent;border:none;resize:vertical;font-size:13px;line-height:1.8;color:var(--text);font-family:inherit;outline:none;padding:0">${memoVal}</textarea>`, cls:'full'},
    ];
  
    document.getElementById('detailContent').innerHTML=`
      <div class="detail-header">
        <div class="detail-avatar" style="background:${bg}">${init}</div>
        <div>
          <div class="detail-name">${c.last}${c.first}</div>
          <div class="detail-sub">${c.company||''}${c.dept?' Â· '+c.dept:''}${c.position?' / '+c.position:''}</div>
        </div>
        <div class="detail-actions">
          <button class="btn btn-outline btn-sm" onclick="openEditContact('${id}')">${i18n('âœ ìˆ˜ì •')}</button>
          <button class="btn btn-primary btn-sm" onclick="openActModal_contact('${id}')">${i18n('ï¼‹ í™œë™')}</button>
          <button class="btn btn-danger btn-sm" onclick="delContact('${id}')">ğŸ—‘</button>
        </div>
      </div>
      ${_detailCreatorHtml(c)}
      <div class="info-grid">
        ${info.map(i=>`<div class="info-card${i.cls?' '+i.cls:''}"><div class="info-card-label">${i.l}</div><div class="info-card-value">${i.v}</div></div>`).join('')}
      </div>
      <div class="acts-section">
        <div class="acts-head"><span class="acts-title">${i18n('í™œë™')} (${acts.length})</span>
          <button class="btn btn-primary btn-sm" onclick="openActModal_contact('${id}')">${i18n('ï¼‹ ì¶”ê°€')}</button>
        </div>
        <div class="acts-filter" id="detailActsFilter"></div>
        <div id="detailActsList"></div>
      </div>`;
  
    // Company back button
    const coBtn=document.getElementById('detailCoBtn');
    if(c.company){
      coBtn.style.display='';
      coBtn.onclick=()=>{
        backToList();
        setTimeout(()=>{
          expanded.add(c.company);
          const el=document.getElementById('cg-'+CSS.escape(c.company));
          if(el){ el.classList.remove('collapsed'); el.scrollIntoView({behavior:'smooth',block:'start'}); }
        },80);
      };
    } else coBtn.style.display='none';
  
    // í™œë™ í•„í„° ì´ˆê¸°í™” ë° ë Œë”
    detailActFilter = new Set();
    renderActsFilter('detailActsFilter', detailActFilter, 'setDetailActFilter');
    _renderDetailActs(id);
  
    document.getElementById('contactsView').style.display='none';
    document.getElementById('detailView').classList.add('open');
  }
  
  // â”€â”€ ALL ACTIVITIES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderAllActs(){
    let allSorted = [...activities].sort((a,b)=>b.date.localeCompare(a.date));
    // ìœ í˜• í•„í„° (ë‹¤ì¤‘ì„ íƒ)
    if(actFilter.size) allSorted = allSorted.filter(a=>actFilter.has(a.type));
    // íŒ€ í•„í„° (ë‹¤ì¤‘ì„ íƒ)
    if(actTeamFilter.size){
      const cos = getCosByTeam(actTeamFilter);
      if(cos){
        const cids = contacts.filter(c=>cos.includes(c.company||'')).map(c=>c.id);
        allSorted = allSorted.filter(a=>cids.includes(a.contactId));
      }
    }
    const acts = allSorted;
    const div = document.getElementById('allActsContent');
    const total = activities.length;
  
    // ê±´ìˆ˜ í‘œì‹œ
    const subEl = document.getElementById('actsSub');
    if(subEl){
      let desc = actFilter.size===0 ? i18n('ì „ì²´')
        : [...actFilter].map(f=>TL[f]||f).join('+');
      if(actTeamFilter.size) desc += ` Â· ğŸ‘¥ ${[...actTeamFilter].join('+')}`;
      subEl.textContent = `${desc} ${acts.length}${i18n('ê±´')} / ${i18n('ì „ì²´')} ${total}${i18n('ê±´')}`;
    }
  
    if(!acts.length){ div.innerHTML=`<div class="empty-state"><div class="empty-icon">ğŸ“‹</div><p>${actFilter.size===0?i18n('í™œë™ì´ ì—†ìŠµë‹ˆë‹¤'):i18n('í™œë™ì´ ì—†ìŠµë‹ˆë‹¤')}</p></div>`; return; }
    div.innerHTML=`<div class="timeline">${acts.map(a=>tlItem(a,{showWho:true})).join('')}</div>`;
  }
  
  // â”€â”€ CONTACT MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function refreshCoSuggestions(){
    const dl=document.getElementById('coSuggestions');
    dl.innerHTML=[...new Set(contacts.map(c=>c.company).filter(Boolean))].map(n=>`<option value="${n}">`).join('');
  }
  function onCompanyInput(){
    const co=document.getElementById('f_company').value.trim();
    const ci=companies[co];
    const notice=document.getElementById('addrNotice');
    const addrInput=document.getElementById('f_address');
    if(co&&ci&&ci.address){ notice.style.display=''; addrInput.value=ci.address; addrInput.style.borderColor='var(--accent)'; }
    else { notice.style.display='none'; addrInput.style.borderColor=''; }
  }
  
  function openAddContact(preCo){
    editCid=null;
    document.getElementById('cModalTitle').textContent=i18n('ìƒˆ ì—°ë½ì²˜');
    ['f_dept','f_position','f_last','f_first','f_email','f_office','f_mobile','f_extra','f_address','f_memo']
      .forEach(id=>document.getElementById(id).value='');
    document.getElementById('f_company').value=preCo||'';
    document.getElementById('addrNotice').style.display='none';
    refreshCoSuggestions();
    if(preCo) onCompanyInput();
    document.getElementById('contactModal').classList.add('open');
  }
  function openEditContact(id){
    editCid=id;
    const c=contacts.find(x=>x.id===id);
    document.getElementById('cModalTitle').textContent=i18n('ì—°ë½ì²˜ ìˆ˜ì •');
    document.getElementById('f_company').value=c.company||'';
    document.getElementById('f_dept').value=c.dept||'';
    document.getElementById('f_position').value=c.position||'';
    document.getElementById('f_last').value=c.last||'';
    document.getElementById('f_first').value=c.first||'';
    document.getElementById('f_email').value=c.email||'';
    document.getElementById('f_office').value=c.office||'';
    document.getElementById('f_mobile').value=c.mobile||'';
    document.getElementById('f_extra').value=c.extra||'';
    document.getElementById('f_address').value=c.address||'';
    document.getElementById('f_memo').value=c.memo||'';
    document.getElementById('addrNotice').style.display='none';
    refreshCoSuggestions();
    document.getElementById('contactModal').classList.add('open');
  }
  function saveContact(){
    const last=document.getElementById('f_last').value.trim();
    const first=document.getElementById('f_first').value.trim();
    if(!last&&!first){ alert(i18n('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.')); return; }
    const co=document.getElementById('f_company').value.trim();
    const addr=document.getElementById('f_address').value.trim();
    // Sync address to company info
    if(co&&addr){ if(!companies[co]) companies[co]={}; if(!companies[co].address) companies[co].address=addr; }
    const data={company:co, dept:document.getElementById('f_dept').value.trim(),
      position:document.getElementById('f_position').value.trim(), last, first,
      email:document.getElementById('f_email').value.trim(), office:document.getElementById('f_office').value.trim(),
      mobile:document.getElementById('f_mobile').value.trim(), extra:document.getElementById('f_extra').value.trim(),
      address:addr, memo:document.getElementById('f_memo').value.trim()};
    if(editCid){ const i=contacts.findIndex(x=>x.id===editCid); contacts[i]={...contacts[i],...data}; persist({cId:editCid}); closeModal('contactModal'); showDetail(editCid); }
    else { const _newCid = uid();
      contacts.unshift({id:_newCid,createdAt:new Date().toISOString(),createdBy:_curUserName(),...data});
      persist({cId:_newCid}); closeModal('contactModal'); renderContacts(); }
  }
  function delContact(id){
    const c = contacts.find(x=>x.id===id);
    if(!c) return;
    const actCnt = activities.filter(a=>a.contactId===id).length;
    document.getElementById('delContactInfo').innerHTML =
      `<strong>${c.last}${c.first}</strong>${c.company?' Â· '+c.company:''}<br>
       <span style="font-size:12px;color:var(--muted)">${actCnt} ${i18n('ê±´')} ${i18n('í™œë™ í•¨ê»˜ ì‚­ì œ')}.</span>`;
    document.getElementById('delContactConfirmBtn').onclick = ()=>{
      const _actIds = activities.filter(a=>a.contactId===id).map(a=>a.id);
      contacts = contacts.filter(x=>x.id!==id);
      activities = activities.filter(a=>a.contactId!==id);
      const _delOpts = {delC:id};
      _actIds.forEach(aid=>markActivityDeleted(aid));
      persist(_delOpts);
      closeModal('delContactModal');
      backToList();
    };
    document.getElementById('delContactModal').classList.add('open');
  }
  
  // â”€â”€ COMPANY MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let _finRows=[];  // [{year,headcount,revenue,op_profit,net_profit,assets,liabilities}]
  let _ceoRows=[];  // [{from,to,name,memo}]
  
  function switchCoTab(tab){
    ['basic','finance','ceo'].forEach(t=>{
      document.getElementById('coTab-'+t).classList.toggle('active',t===tab);
      document.getElementById('coPanel-'+t).style.display=t===tab?'':'none';
    });
  }
  
  function addFinanceRow(data={}){
    const yr=data.year||(new Date().getFullYear());
    _finRows.push({...{year:yr,headcount:'',revenue:'',op_profit:'',net_profit:'',assets:'',liabilities:''},...data});
    renderFinTable();
  }
  function renderFinTable(){
    // sort by year desc
    _finRows.sort((a,b)=>Number(b.year)-Number(a.year));
    const tbody=document.getElementById('finBody');
    tbody.innerHTML=_finRows.map((r,i)=>`
      <tr>
        <td><input class="fin-year" value="${r.year}" onchange="_finRows[${i}].year=this.value" onblur="renderFinTable()" placeholder="2024"></td>
        <td><input class="fin-input" value="${r.headcount}" onchange="_finRows[${i}].headcount=this.value" placeholder="â€”"></td>
        <td><input class="fin-input" value="${r.revenue}" onchange="_finRows[${i}].revenue=this.value" placeholder="â€”"></td>
        <td><input class="fin-input" value="${r.op_profit}" onchange="_finRows[${i}].op_profit=this.value" placeholder="â€”"></td>
        <td><input class="fin-input" value="${r.net_profit}" onchange="_finRows[${i}].net_profit=this.value" placeholder="â€”"></td>
        <td><input class="fin-input" value="${r.assets}" onchange="_finRows[${i}].assets=this.value" placeholder="â€”"></td>
        <td><input class="fin-input" value="${r.liabilities}" onchange="_finRows[${i}].liabilities=this.value" placeholder="â€”"></td>
        <td><button class="fin-del" onclick="_finRows.splice(${i},1);renderFinTable()">âœ•</button></td>
      </tr>`).join('');
  }
  
  function addCeoRow(data={}){
    _ceoRows.unshift({...{from:'',to:'',name:'',memo:''},...data});
    renderCeoList();
  }
  function renderCeoList(){
    const div=document.getElementById('ceoList');
    if(!_ceoRows.length){
      div.innerHTML=`<div style="text-align:center;padding:24px;color:var(--muted);font-size:13px">${i18n('ëŒ€í‘œì´ì‚¬')+ ' ' + i18n('í™œë™ì´ ì—†ìŠµë‹ˆë‹¤')}</div>`;
      return;
    }
    div.innerHTML=`
      <div class="ceo-header"><span>${i18n('ì·¨ì„ì—°ë„')||'From'}</span><span>${i18n('ì´ë¦„')||'Name'}</span><span>${i18n('í‡´ì„ì—°ë„')||'To'}</span><span>${i18n('ë¹„ê³ ')||'Note'}</span><span></span></div>
      ${_ceoRows.map((r,i)=>`
      <div class="ceo-row">
        <input class="ceo-input" value="${r.from}" onchange="_ceoRows[${i}].from=this.value" placeholder="2020">
        <input class="ceo-input" value="${r.name}" onchange="_ceoRows[${i}].name=this.value" placeholder="í™ê¸¸ë™">
        <input class="ceo-input" value="${r.to}" onchange="_ceoRows[${i}].to=this.value" placeholder="${i18n('CEO placeholder í˜„ì¬')}">
        <input class="ceo-input" value="${r.memo}" onchange="_ceoRows[${i}].memo=this.value" placeholder="${i18n('CEO placeholder ë©”ëª¨')}">
        <button class="ceo-del" onclick="_ceoRows.splice(${i},1);renderCeoList()">âœ•</button>
      </div>`).join('')}`;
  }
  
  function openCompanyModal(co){
    editCoName=co;
    const ci=companies[co]||{};
    document.getElementById('coModalTitle').textContent=co;
    document.getElementById('co_name').value=co;
    document.getElementById('co_phone').value=ci.phone||'';
    document.getElementById('co_fax').value=ci.fax||'';
    document.getElementById('co_address').value=ci.address||'';
    document.getElementById('co_memo').value=ci.memo||'';
    document.getElementById('co_our_team').value=ci.ourTeam||'';
    document.getElementById('co_our_name').value=ci.ourName||'';
    document.getElementById('co_our_memo').value=ci.ourMemo||'';
  
    // ì¬ë¬´ ë°ì´í„° ë¡œë“œ
    _finRows=(ci.finance||[]).map(r=>({...r}));
    renderFinTable();
    if(!_finRows.length) addFinanceRow({year:new Date().getFullYear()});
  
    // ëŒ€í‘œì´ì‚¬ ì´ë ¥ ë¡œë“œ
    _ceoRows=(ci.ceoHistory||[]).map(r=>({...r}));
    renderCeoList();
  
    // ë³‘í•© ëŒ€ìƒ ëª©ë¡
    const sel=document.getElementById('co_merge_target');
    const allCos=[...new Set(contacts.map(c=>c.company).filter(Boolean))].sort();
    sel.innerHTML=`<option value="">${i18n('ë³‘í•© ì•ˆ í•¨')}</option>`
      +allCos.filter(n=>n!==co).map(n=>{
        const cnt=contacts.filter(c=>c.company===n).length;
        return `<option value="${n.replace(/"/g,'&quot;')}">${n} (${cnt} ${i18n('ëª…')})</option>`;
      }).join('');
    sel.value='';
    document.getElementById('co_merge_preview').style.display='none';
    sel.onchange=()=>{
      const target=sel.value;
      const prev=document.getElementById('co_merge_preview');
      if(!target){ prev.style.display='none'; return; }
      const cnt=contacts.filter(c=>c.company===target).length;
      prev.style.display='';
      prev.textContent=`âš  "${target}" ${i18n('ì´')} ${cnt}${i18n('ëª…')} â†’ "${co}" ${i18n('ì´ë™ë©ë‹ˆë‹¤')}`;
    };
  
    switchCoTab('basic');
    document.getElementById('companyModal').classList.add('open');
  }
  
  function saveCompany(){
    if(!editCoName) return;
    const newName=document.getElementById('co_name').value.trim();
    const mergeTarget=document.getElementById('co_merge_target').value;
    if(!newName){ alert(i18n('íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.')); return; }
  
    // â‘  ë³‘í•© â€” confirm ëŒ€ì‹  ì „ìš© ëª¨ë‹¬
    if(mergeTarget){
      const cnt=contacts.filter(c=>c.company===mergeTarget).length;
      document.getElementById('mergeConfirmInfo').innerHTML=
        `<div>${i18n('ì—†ì•¨ íšŒì‚¬')||'Remove'}&nbsp;&nbsp;<strong style="color:var(--accent2)">${mergeTarget}</strong> <span style="color:var(--muted)">(${cnt} ${i18n('ëª…')})</span></div>
         <div>${i18n('í•©ì¹  íšŒì‚¬')||'Keep'}&nbsp;&nbsp;<strong style="color:var(--accent3)">${newName}</strong></div>
         <div style="margin-top:8px;font-size:12px;color:var(--muted)">â†’ ${cnt} ${i18n('ëª…')} ${i18n('ì´ë™ë©ë‹ˆë‹¤')}.</div>`;
      document.getElementById('mergeConfirmBtn').onclick=()=>{
        closeModal('mergeConfirmModal');
        _doSaveCompany(newName, mergeTarget);
      };
      document.getElementById('mergeConfirmModal').classList.add('open');
      return;
    }
  
    _doSaveCompany(newName, null);
  }
  
  function _doSaveCompany(newName, mergeTarget){
    // â‘  ë³‘í•©
    if(mergeTarget){
      contacts.forEach(c=>{ if(c.company===mergeTarget) c.company=newName; });
      // ë³‘í•© ëŒ€ìƒ í™œë™ë„ ì´ì „
      const mergedInfo = companies[mergeTarget]||{};
      delete companies[mergeTarget];
      // ì¬ë¬´/ëŒ€í‘œì´ì‚¬ ë°ì´í„° ë³‘í•© (ê¸°ì¡´ ë°ì´í„° ë³´ì¡´)
      if(!companies[newName]) companies[newName]={};
      if(mergedInfo.finance?.length && !companies[newName].finance?.length)
        companies[newName].finance = mergedInfo.finance;
      if(mergedInfo.ceoHistory?.length && !companies[newName].ceoHistory?.length)
        companies[newName].ceoHistory = mergedInfo.ceoHistory;
    }
  
    // â‘¡ íšŒì‚¬ëª… ë³€ê²½
    if(newName!==editCoName){
      contacts.forEach(c=>{ if(c.company===editCoName) c.company=newName; });
      const oldInfo=companies[editCoName]||{};
      delete companies[editCoName];
      if(!companies[newName]) companies[newName]={};
      companies[newName]={...oldInfo,...companies[newName]};
    }
  
    // â‘¢ ê³µí†µ ì •ë³´ ì €ì¥
    if(!companies[newName]) companies[newName]={};
    companies[newName].phone     = document.getElementById('co_phone').value.trim();
    companies[newName].fax       = document.getElementById('co_fax').value.trim();
    companies[newName].address   = document.getElementById('co_address').value.trim();
    companies[newName].memo      = document.getElementById('co_memo').value.trim();
    companies[newName].ourTeam   = document.getElementById('co_our_team').value.trim();
    companies[newName].ourName   = document.getElementById('co_our_name').value.trim();
    companies[newName].ourMemo   = document.getElementById('co_our_memo').value.trim();
    companies[newName].finance   = _finRows.filter(r=>r.year).map(r=>({
      year:r.year, headcount:r.headcount, revenue:r.revenue,
      op_profit:r.op_profit, net_profit:r.net_profit,
      assets:r.assets, liabilities:r.liabilities
    }));
    companies[newName].ceoHistory= _ceoRows.filter(r=>r.name);
  
    persist();
    closeModal('companyModal');
    renderContacts();
  }
  
  // â”€â”€ ACTIVITY MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let editActId = null;
  
  function openActModal_contact(cid){
    editActId = null;
    actCid = cid;
    const c = contacts.find(x=>x.id===cid);
    document.getElementById('actModalTitle').textContent = i18n('í™œë™ ì¶”ê°€');
    document.getElementById('actWhoSection').style.display = '';
    document.getElementById('actWho').innerHTML = `${c?c.last+c.first:''} ${c&&c.company?'<span style="font-size:12px;color:var(--muted)">Â· '+c.company+'</span>':''}`;
    _resetActForm();
    document.getElementById('activityModal').classList.add('open');
  }
  
  function openActModal_co(co){
    const members = contacts.filter(c=>(c.company||'').trim()===co);
    if(!members.length){ alert(i18n('ë¨¼ì € ë‹´ë‹¹ìë¥¼ ì¶”ê°€í•˜ì„¸ìš”.')); return; }
    editActId = null;
    actCid = members[0].id;
    document.getElementById('actModalTitle').textContent = i18n('í™œë™ ì¶”ê°€');
    document.getElementById('actWhoSection').style.display = '';
    if(members.length===1){
      const c = members[0];
      document.getElementById('actWho').innerHTML = `${c.last+c.first} <span style="font-size:12px;color:var(--muted)">Â· ${co}</span>`;
      _resetActForm();
      document.getElementById('activityModal').classList.add('open');
    } else {
      document.getElementById('actWho').innerHTML =
        `<select id="actPicker" onchange="actCid=this.value" style="background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--text);padding:5px 8px;font-family:inherit;font-size:13px;outline:none;width:100%">
          ${members.map(m=>`<option value="${m.id}">${m.last}${m.first} (${m.dept||m.position||''})</option>`).join('')}
        </select>`;
      _resetActForm();
      document.getElementById('activityModal').classList.add('open');
    }
  }
  
  function openEditAct(id){
    const a = activities.find(x=>x.id===id);
    if(!a) return;
    editActId = id;
    actCid = a.contactId;
    const c = contacts.find(x=>x.id===a.contactId);
    document.getElementById('actModalTitle').textContent = i18n('í™œë™ ìˆ˜ì •');
    document.getElementById('actWhoSection').style.display = '';
    document.getElementById('actWho').innerHTML = c ? `${c.last}${c.first} <span style="font-size:12px;color:var(--muted)">Â· ${c.company||''}</span>` : '';
    document.getElementById('a_type').value   = a.type  || 'other';
    document.getElementById('a_date').value   = a.date  || '';
    document.getElementById('a_title').value  = a.title || '';
    document.getElementById('a_content').value= a.content|| '';
    document.getElementById('a_amount').value = a.amount || '';
    document.getElementById('activityModal').classList.add('open');
  }
  
  function _resetActForm(){
    refreshTypeSelect();
    document.getElementById('a_date').value   = new Date().toISOString().slice(0,10);
    document.getElementById('a_type').value   = actTypes[0]?.id || 'order';
    ['a_title','a_content','a_amount'].forEach(id=>document.getElementById(id).value='');
  }
  
  function saveActivity(){
    const picker = document.getElementById('actPicker');
    if(picker) actCid = picker.value;
    if(!actCid){ alert(i18n('ë‹´ë‹¹ìë¥¼ ì„ íƒí•˜ì„¸ìš”.')); return; }
    const date = document.getElementById('a_date').value;
    if(!date){ alert(i18n('ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš”.')); return; }
    const data = {
      contactId: actCid,
      type:    document.getElementById('a_type').value,
      date,
      title:   document.getElementById('a_title').value.trim(),
      content: document.getElementById('a_content').value.trim(),
      amount:  document.getElementById('a_amount').value.trim(),
    };
    if(editActId){
      // ìˆ˜ì •
      const idx = activities.findIndex(a=>a.id===editActId);
      if(idx>-1){ activities[idx] = {...activities[idx], ...data}; markActivityDirty(editActId); }
    } else {
      // ì‹ ê·œ
      const _newAid = uid();
      activities.push({id:_newAid, createdAt:new Date().toISOString(), createdBy:_curUserName(), ...data});
      markActivityDirty(_newAid);
    }
    editActId = null;
    persist();
    closeModal('activityModal');
    if(currentCid) showDetail(currentCid); else renderContacts();
  }
  
  function delAct(id, fromDetail=false){
    const a = activities.find(x=>x.id===id);
    if(!a) return;
    const c = contacts.find(x=>x.id===a.contactId);
    const typeLabel = {visit:`ğŸ¤ ${i18n('ë°©ë¬¸')||'Visit'}`, call:`ğŸ“ ${i18n('í†µí™”')||'Call'}`, quote:`ğŸ“„ ${i18n('ê²¬ì ')||'Quote'}`, order:`ğŸ“¦ ${i18n('ë°œì£¼')||'Order'}`, other:`ğŸ“Œ ${i18n('ê¸°íƒ€')||'Other'}`};
    document.getElementById('delActInfo').innerHTML = `
      <div style="display:flex;flex-direction:column;gap:4px">
        <div><span style="color:var(--muted);font-size:11px;font-family:IBM Plex Mono,monospace">ìœ í˜•</span>&nbsp;&nbsp;${typeLabel[a.type]||a.type}</div>
        <div><span style="color:var(--muted);font-size:11px;font-family:IBM Plex Mono,monospace">ë‚ ì§œ</span>&nbsp;&nbsp;${a.date}</div>
        ${a.title?`<div><span style="color:var(--muted);font-size:11px;font-family:IBM Plex Mono,monospace">ì œëª©</span>&nbsp;&nbsp;${a.title}</div>`:''}
        ${a.content?`<div><span style="color:var(--muted);font-size:11px;font-family:IBM Plex Mono,monospace">${i18n('ë‚´ìš©')}</span>&nbsp;&nbsp;<span style="color:var(--muted)">${a.content.length>50?a.content.slice(0,50)+'â€¦':a.content}</span></div>`:''}
        ${c?`<div><span style="color:var(--muted);font-size:11px;font-family:IBM Plex Mono,monospace">${i18n('ë‹´ë‹¹ì')}</span>&nbsp;&nbsp;${c.last}${c.first}${c.company?' Â· '+c.company:''}</div>`:''}
      </div>`;
    document.getElementById('delActConfirmBtn').onclick = ()=>{
      activities = activities.filter(x=>x.id!==id);
      persist({delA:id});
      closeModal('delActModal');
      if(fromDetail && currentCid) showDetail(currentCid);
      else { renderContacts(); renderAllActs(); }
    };
    document.getElementById('delActModal').classList.add('open');
  }
  
  // â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function closeModal(id){
    const el = document.getElementById(id);
    if(!el) return;
    el.classList.remove('open');
    if(id==='onboardingModal'){
      const chk = document.getElementById('onboardingSkip');
      if(chk && chk.checked) safeStorage.setItem('crm_onboarding_skip','1');
    }
  }
  document.querySelectorAll('.modal-overlay').forEach(o=>{ o.addEventListener('click',e=>{ if(e.target===o) o.classList.remove('open'); }); });
  
  function renderStats(){
    const today = new Date();
    const todayStr = today.toISOString().slice(0,10);
    const weekAgo = new Date(today);
    weekAgo.setDate(weekAgo.getDate() - 6);
    const weekAgoStr = weekAgo.toISOString().slice(0,10);
  
    // ìµœê·¼ 7ì¼ ì‹ ê·œ ê±´ìˆ˜
    const cos = [...new Set(contacts.map(c=>c.company).filter(Boolean))];
    const weekCos = [...new Set(
      contacts.filter(c=>(c.createdAt||'').slice(0,10)>=weekAgoStr).map(c=>c.company).filter(Boolean)
    )];
    const weekContacts = contacts.filter(c=>(c.createdAt||'').slice(0,10)>=weekAgoStr).length;
    const weekActs     = activities.filter(a=>(a.createdAt||'').slice(0,10)>=weekAgoStr).length;
  
    // ë‹¹ì¼ ì‹ ê·œ (ë°°ì§€ìš©)
    const newContacts = contacts.filter(c=>(c.createdAt||'').slice(0,10)===todayStr).length;
    const newActs     = activities.filter(a=>(a.createdAt||'').slice(0,10)===todayStr).length;
  
    // ì‚¬ì´ë“œë°” ë°°ì§€
    const cBadge  = document.getElementById('todayContacts');
    const aBadge  = document.getElementById('todayActivities');
    const mcBadge = document.getElementById('mTodayContacts');
    const maBadge = document.getElementById('mTodayActivities');
    [cBadge, mcBadge].forEach(b=>{ if(b){ b.textContent='+'+newContacts; b.style.display=newContacts>0?'inline-block':'none'; }});
    [aBadge, maBadge].forEach(b=>{ if(b){ b.textContent='+'+newActs;     b.style.display=newActs>0?'inline-block':'none'; }});
  
    const fmtDate = s => s.slice(5).replace('-','/');  // 01/19 í˜•ì‹
  
    const typeRows = null;
  
    document.getElementById('sidebarStats').innerHTML=`
      <div style="font-size:9px;color:var(--border);font-family:IBM Plex Mono,monospace;margin-bottom:5px;text-align:right">${fmtDate(weekAgoStr)} ~ ${fmtDate(todayStr)}&nbsp;${i18n('ì‹ ê·œ')}</div>
      <div class="stat-row"><span>${i18n('íšŒì‚¬')}</span><span style="color:var(--accent)">${weekCos.length}</span></div>
      <div class="stat-row"><span>${i18n('ì—°ë½ì²˜')}</span><span style="color:var(--accent)">${weekContacts}</span></div>
      <div class="stat-row"><span>${i18n('í™œë™')}</span><span style="color:var(--accent)">${weekActs}</span></div>`;
  }
  
  // â”€â”€ ë‹¤êµ­ì–´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  
  function _loadNextPdfFile(){
    if(_pdfQueueIdx >= _pdfQueue.length){
      // ëª¨ë“  íŒŒì¼ ë¡œë”© ì™„ë£Œ â†’ ë¶„ì„ ë²„íŠ¼ í™œì„±í™”
      const names = _pdfQueue.map(f=>f.name).join(', ');
      const nameEl = document.getElementById('pdfFileName');
      nameEl.innerHTML = `ğŸ—‚ <strong>${_pdfQueue.length}${i18n('ê°œ íŒŒì¼')}</strong>: ${names}`;
      nameEl.style.display = '';
      document.getElementById('pdfFileTypeNote').innerHTML =
        `<span style="color:var(--accent)">${_pdfQueue.length}${i18n('ê°œ íŒŒì¼ ì„ íƒë¨')} â€” ${i18n('ìˆœì°¨ ë¶„ì„')}</span>`;
      document.getElementById('pdfFileTypeNote').style.display = '';
      document.getElementById('dropIcon').textContent = 'ğŸ—‚';
      const btn = document.getElementById('pdfAnalyzeBtn');
      btn.disabled = false;
      btn.textContent = `ğŸ” ${_pdfQueue.length}${i18n('ê°œ íŒŒì¼')}`;
      btn.onclick = pdfAnalyzeAll;
      return;
    }
    const file = _pdfQueue[_pdfQueueIdx];
    const ft = detectFileType(file);
    if(_pdfQueueIdx === 0){ pdfFileType = ft; }
    const reader = new FileReader();
    if(ft.kind === 'text'){
      reader.onload = e => {
        try { _pdfQueue[_pdfQueueIdx]._b64 = btoa(unescape(encodeURIComponent(e.target.result))); }
        catch(ex){ _pdfQueue[_pdfQueueIdx]._b64 = btoa(e.target.result); }
        _pdfQueue[_pdfQueueIdx]._ft = ft;
        _pdfQueueIdx++;
        _loadNextPdfFile();
      };
      reader.readAsText(file, 'UTF-8');
    } else {
      reader.onload = e => {
        _pdfQueue[_pdfQueueIdx]._b64 = e.target.result.split(',')[1];
        _pdfQueue[_pdfQueueIdx]._ft = ft;
        _pdfQueueIdx++;
        _loadNextPdfFile();
      };
      reader.readAsDataURL(file);
    }
  }
  
  async function pdfAnalyzeAll(){
    const apiKey = safeStorage.getItem('crm_api_key');
    if(!apiKey){ alert(i18n('API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤.')); pdfShowStep(0); return; }
    _pdfAllExtracted = [];
    _pdfAllActivities = [];
  
    for(let i=0; i<_pdfQueue.length; i++){
      const file = _pdfQueue[i];
      const ft = file._ft || detectFileType(file);
      const b64 = file._b64;
      const loadMsg = document.getElementById('pdfLoadingMsg');
      if(loadMsg) loadMsg.textContent = `${ft.icon} ${file.name} ${i18n('íŒŒì¼ ë¶„ì„ ì¤‘...')} (${i+1}/${_pdfQueue.length})`;
      pdfShowStep(2);
      try {
        const result = await _callPdfApi(b64, ft, apiKey);
        // íŒŒì¼ ì¶œì²˜ë¥¼ ê° í•­ëª©ì— íƒœê¹…
        (result.contacts||[]).forEach(c=>{ c._srcFile = file.name; });
        (result.activities||[]).forEach(a=>{ a._srcFile = file.name; });
        _pdfAllExtracted.push(...(result.contacts||[]));
        _pdfAllActivities.push(...(result.activities||[]));
      } catch(err){
        console.warn(`[${file.name}] ë¶„ì„ ì‹¤íŒ¨:`, err.message);
      }
    }
  
    pdfExtracted = _pdfAllExtracted;
    pdfActivities = _pdfAllActivities;
    if(!pdfExtracted.length && !pdfActivities.length){
      document.getElementById('pdfErrorMsg').innerHTML = i18n('ì¶”ì¶œëœ ì—°ë½ì²˜ ì—†ìŒ');
      pdfShowStep(4); return;
    }
    renderPdfResults();
    pdfShowStep(3);
  }
  
  function pdfShowStep(n){
    for(let i=0;i<=7;i++){
      const el = document.getElementById('pdfStep'+i);
      if(el) el.style.display = i===n ? '' : 'none';
    }
  }
  
  function openPdfModal(){
    pdfBase64 = null;
    pdfFileType = null;
    pdfExtracted = [];
    pdfActivities = [];
    _csvFile = null;
    _csvRawRows = []; _csvHeaders = []; _csvMapping = {};
    document.getElementById('pdfFileInput').value='';
    document.getElementById('pdfFileName').style.display='none';
    document.getElementById('pdfFileTypeNote').style.display='none';
    const analyzeBtn = document.getElementById('pdfAnalyzeBtn');
    analyzeBtn.disabled = true;
    analyzeBtn.textContent = i18n('ë¶„ì„ ì‹œì‘');
    analyzeBtn.onclick = pdfAnalyze;
    document.getElementById('dropIcon').textContent='ğŸ—‚';
    const key = safeStorage.getItem('crm_api_key');
    // í‚¤ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
    const prev = document.getElementById('keyPreview');
    if(prev && key) prev.textContent = i18n('í˜„ì¬í‚¤') + key.slice(0,12) + '...';
    pdfShowStep(key ? 1 : 0);
    document.getElementById('pdfModal').classList.add('open');
  }
  
  function pdfSaveKey(){
    const key = document.getElementById('pdfApiKey').value.trim();
    if(!key){ alert(i18n('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.')); return; }
    if(!key.startsWith('sk-')){ alert(i18n('ì˜¬ë°”ë¥¸ API í‚¤')); return; }
    safeStorage.setItem('crm_api_key', key);
    pdfShowStep(1);
  }
  
  function pdfChangeKey(){
    const key = safeStorage.getItem('crm_api_key')||'';
    const input = document.getElementById('pdfApiKey');
    input.value = key;
    input.type = 'password';
    const prev = document.getElementById('keyPreview');
    if(prev && key) prev.textContent = i18n('í˜„ì¬í‚¤') + key.slice(0,12) + '...';
    pdfShowStep(0);
  }
  
  // íŒŒì¼ ìœ í˜• ê°ì§€
  function detectFileType(file){
    const name = file.name.toLowerCase();
    const mime = file.type;
    if(mime==='application/pdf' || name.endsWith('.pdf'))
      return {kind:'pdf', mediaType:'application/pdf', icon:'ğŸ“„', label:i18n('PDF ë¬¸ì„œ')||'PDF'};
    if(['image/jpeg','image/jpg','image/png','image/webp','image/gif'].includes(mime) ||
       /\.(jpg|jpeg|png|webp|gif)$/.test(name))
      return {kind:'image', mediaType: mime||'image/jpeg', icon:'ğŸ–¼', label:i18n('ì´ë¯¸ì§€')||'Image'};
    if(mime==='text/plain' || name.endsWith('.txt'))
      return {kind:'text', mediaType:'text/plain', icon:'ğŸ“', label:i18n('í…ìŠ¤íŠ¸ íŒŒì¼')||'Text'};
    if(mime==='text/csv' || name.endsWith('.csv'))
      return {kind:'text', mediaType:'text/csv', icon:'ğŸ“Š', label:'CSV'};
    if(/\.(xls|xlsx)$/.test(name))
      return {kind:'text', mediaType:'text/plain', icon:'ğŸ“Š', label:'Excel'};
    if(/\.(doc|docx)$/.test(name))
      return {kind:'text', mediaType:'text/plain', icon:'ğŸ“‹', label:'Word'};
    return {kind:'text', mediaType:'text/plain', icon:'ğŸ“', label:i18n('íŒŒì¼ ê°€ì ¸ì˜¤ê¸°')||'File'};
  }
  
  
  
  // ë©”ëª¨ ì¸ë¼ì¸ ì €ì¥
  function saveMemoInline(cid){
    const ta = document.getElementById('detailMemoArea');
    if(!ta) return;
    const c = contacts.find(x=>x.id===cid);
    if(!c) return;
    c.memo = ta.value;
    persist();
  }
  
  function onPdfSelected(input){
    const files = Array.from(input.files);
    if(!files.length) return;
  
    // CSV íŒŒì¼ì´ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ CSV ì „ìš© í”Œë¡œìš°ë¡œ
    const csvFile = files.find(f=>f.name.toLowerCase().endsWith('.csv') || f.type==='text/csv');
    if(csvFile){
      if(files.length > 1) alert(i18n('CSV íŒŒì¼ì€ 1ê°œì”©'));
      _csvFile = csvFile;
      const sizeMB = (csvFile.size/1024/1024).toFixed(1);
      const nameEl = document.getElementById('pdfFileName');
      nameEl.innerHTML = `ğŸ“Š <strong>${csvFile.name}</strong> <span style="color:var(--muted)">(${sizeMB}MB Â· CSV)</span>`;
      nameEl.style.display = '';
      document.getElementById('pdfFileTypeNote').innerHTML =
        `${i18n('ê°ì§€ ìœ í˜•')}: <span style="color:var(--accent3)">CSV â€” ${i18n('ëŒ€ìš©ëŸ‰ íŒŒì‹± ëª¨ë“œ')}</span>`;
      document.getElementById('pdfFileTypeNote').style.display = '';
      document.getElementById('dropIcon').textContent = 'ğŸ“Š';
      const btn = document.getElementById('pdfAnalyzeBtn');
      btn.disabled = false;
      btn.textContent = i18n('CSV ë¶„ì„í•˜ê¸°');
      btn.onclick = csvParse;
      return;
    }
  
    // ë¹„CSV: ë‹¤ì¤‘ íŒŒì¼ ì²˜ë¦¬
    const oversized = files.filter(f=>f.size > 10*1024*1024);
    if(oversized.length){
      alert(oversized.map(f=>f.name).join(', ') + '\n' + i18n('íŒŒì¼ ì´ˆê³¼'));
      return;
    }
  
    // ë‹¤ì¤‘ íŒŒì¼ì´ë©´ íì— ì €ì¥í•˜ê³  ìˆœì°¨ ì²˜ë¦¬
    _pdfQueue = files;
    _pdfQueueIdx = 0;
    _pdfAllExtracted = [];
    _pdfAllActivities = [];
    _loadNextPdfFile();
  }
  
  // Drag & drop support (ë‹¤ì¤‘ íŒŒì¼)
  (function(){
    const dz = document.getElementById('pdfDropzone');
    if(!dz) return;
    dz.addEventListener('dragover', e=>{ e.preventDefault(); dz.classList.add('drag'); });
    dz.addEventListener('dragleave', ()=> dz.classList.remove('drag'));
    dz.addEventListener('drop', e=>{
      e.preventDefault(); dz.classList.remove('drag');
      const fi = document.getElementById('pdfFileInput');
      const dt = new DataTransfer();
      Array.from(e.dataTransfer.files).forEach(f=>dt.items.add(f));
      fi.files = dt.files;
      onPdfSelected(fi);
    });
  })();
  
  const PDF_PROMPT = `ì´ íŒŒì¼ì—ì„œ ì—°ë½ì²˜ ì •ë³´ì™€ ê±°ë˜/í™œë™ ë‚´ì—­ì„ ëª¨ë‘ ì¶”ì¶œí•´ì£¼ì„¸ìš”.
  ë°˜ë“œì‹œ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”. ë‹¤ë¥¸ ì„¤ëª… í…ìŠ¤íŠ¸ ì—†ì´ JSONë§Œ:
  
  {
    "contacts": [
      {
        "company": "íšŒì‚¬ëª…", "dept": "ë¶€ì„œ", "position": "ì§ì±…",
        "last": "ì„±", "first": "ì´ë¦„", "email": "ì´ë©”ì¼ì£¼ì†Œ",
        "office": "ì‚¬ë¬´ì‹¤ì „í™”", "mobile": "íœ´ëŒ€í°",
        "extra": "íŒ©ìŠ¤ ë“± ì¶”ê°€ì—°ë½ì²˜", "address": "ì£¼ì†Œ", "memo": "ê¸°íƒ€ì •ë³´"
      }
    ],
    "activities": [
      {
        "date": "YYYY-MM-DD",
        "type": "visit ë˜ëŠ” call ë˜ëŠ” quote ë˜ëŠ” order ë˜ëŠ” other",
        "title": "í•œ ì¤„ ì œëª©", "content": "ìƒì„¸ ë‚´ìš©",
        "amount": "ê¸ˆì•¡(ìˆ«ìë§Œ, ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´)"
      }
    ]
  }
  
  ê·œì¹™:
  - ëª…í•¨ ì´ë¯¸ì§€ë¼ë©´ ëª…í•¨ì— ë³´ì´ëŠ” ëª¨ë“  ì •ë³´ë¥¼ ì¶”ì¶œí•˜ì„¸ìš”.
  - ì—¬ëŸ¬ ëª…í•¨ì´ ìˆìœ¼ë©´ ê°ê° ë¶„ë¦¬í•´ì„œ ì¶”ì¶œí•˜ì„¸ìš”.
  - í•œêµ­ ì´ë¦„ì€ ì„±(last)ê³¼ ì´ë¦„(first)ì„ ë¶„ë¦¬. ì˜ˆ: ê¹€ì² ìˆ˜ â†’ last:"ê¹€", first:"ì² ìˆ˜"
  - ë‚ ì§œëŠ” ë°˜ë“œì‹œ YYYY-MM-DD í˜•ì‹. ì˜ˆ: 2024.06.26 â†’ "2024-06-26"
  - ê±°ë˜ ìœ í˜• ë§¤í•‘: ë°©ë¬¸â†’visit, í†µí™”â†’call, ê²¬ì â†’quote, ë°œì£¼â†’order, ê¸°íƒ€â†’other
  - ê¸ˆì•¡: ìˆ«ìë§Œ. ì˜ˆ: "3880ë§Œ" â†’ "38800000"
  - ì—†ëŠ” í•­ëª©ì€ ë¹ˆ ë¬¸ìì—´("")ë¡œ ë‘ì„¸ìš”.
  - JSON ì™¸ ë‹¤ë¥¸ í…ìŠ¤íŠ¸ëŠ” ì ˆëŒ€ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”.`;
  
  async function _callPdfApi(b64, ft, apiKey){
    let contentParts;
    if(ft.kind === 'image'){
      contentParts = [
        { type:'image', source:{ type:'base64', media_type: ft.mediaType, data: b64 } },
        { type:'text', text: PDF_PROMPT }
      ];
    } else if(ft.kind === 'text'){
      let textContent = '';
      try { textContent = decodeURIComponent(escape(atob(b64))); }
      catch(e){ textContent = atob(b64); }
      contentParts = [{ type:'text', text: i18n('ì•„ë˜ëŠ” íŒŒì¼ ë‚´ìš©ì…ë‹ˆë‹¤')+'\n\n' + textContent + '\n\n' + PDF_PROMPT }];
    } else {
      contentParts = [
        { type:'document', source:{ type:'base64', media_type:'application/pdf', data: b64 } },
        { type:'text', text: PDF_PROMPT }
      ];
    }
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method:'POST',
      headers:{
        'Content-Type':'application/json',
        'x-api-key': apiKey,
        'anthropic-version':'2023-06-01',
        'anthropic-dangerous-direct-browser-access':'true'
      },
      body: JSON.stringify({ model:'claude-opus-4-6', max_tokens:4000, messages:[{ role:'user', content: contentParts }] })
    });
    let data;
    try { data = await response.json(); }
    catch(e){ throw new Error('ì„œë²„ ì‘ë‹µ íŒŒì‹± ì˜¤ë¥˜ (HTTP ' + response.status + ')'); }
    if(!response.ok){
      const errMsg = data?.error?.message || JSON.stringify(data);
      if(response.status===401) throw new Error('API í‚¤ ì˜¤ë¥˜: ' + errMsg);
      if(response.status===429) throw new Error('ìš”ì²­ í•œë„ ì´ˆê³¼. ì ì‹œ í›„ ì¬ì‹œë„í•´ì£¼ì„¸ìš”.');
      throw new Error('API ì˜¤ë¥˜ (' + response.status + '): ' + errMsg);
    }
    const raw = data.content?.find(b=>b.type==='text')?.text || '';
    if(!raw) throw new Error('AI ì‘ë‹µì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
    const jsonMatch = raw.match(/\{[\s\S]*\}/);
    if(!jsonMatch) throw new Error('JSON íŒŒì‹± ì‹¤íŒ¨: ' + raw.slice(0,200));
    try { return JSON.parse(jsonMatch[0]); }
    catch(e){ throw new Error('JSON íŒŒì‹± ì˜¤ë¥˜: ' + raw.slice(0,200)); }
  }
  
  async function pdfAnalyze(){
    // ë‹¤ì¤‘ íŒŒì¼ ëª¨ë“œ
    if(_pdfQueue.length > 0){ await pdfAnalyzeAll(); return; }
    // ë‹¨ì¼ íŒŒì¼ ëª¨ë“œ (ë ˆê±°ì‹œ)
    if(!pdfBase64){ alert(i18n('íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.')); return; }
    const apiKey = safeStorage.getItem('crm_api_key');
    if(!apiKey){ alert(i18n('API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤.')); pdfShowStep(0); return; }
    const ft = pdfFileType || {kind:'pdf', mediaType:'application/pdf', icon:'ğŸ“„', label:'íŒŒì¼'};
    const loadMsg = document.getElementById('pdfLoadingMsg');
    if(loadMsg) loadMsg.textContent = ft.icon + ' ' + ft.label + ' ' + i18n('íŒŒì¼ ë¶„ì„ ì¤‘...');
    pdfShowStep(2);
    try {
      const result = await _callPdfApi(pdfBase64, ft, apiKey);
      pdfExtracted  = result.contacts   || [];
      pdfActivities = result.activities || [];
      if(!pdfExtracted.length && !pdfActivities.length)
        throw new Error('ì¶”ì¶œëœ ì—°ë½ì²˜ë‚˜ í™œë™ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.\níŒŒì¼ì— ì—°ë½ì²˜ ê´€ë ¨ ë‚´ìš©ì´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
      renderPdfResults();
      pdfShowStep(3);
    } catch(err){
      const msg = (err.message||String(err)).replace(/\n/g,'<br>');
      document.getElementById('pdfErrorMsg').innerHTML =
        `<div style="background:rgba(255,107,107,0.1);border:1px solid rgba(255,107,107,0.3);border-radius:8px;padding:12px 14px;margin-bottom:12px;text-align:left;word-break:break-all">${msg}</div>
         <div style="font-size:11px;color:var(--muted);line-height:1.8;text-align:left">
           <b data-i18n="í™•ì¸ ì‚¬í•­">í™•ì¸ ì‚¬í•­:</b><br>
           â€¢ <span data-i18n="APIí‚¤ ì‹œì‘ í™•ì¸">API í‚¤ê°€ sk-ant- ë¡œ ì‹œì‘í•˜ëŠ”ì§€ í™•ì¸</span><br>
           â€¢ PDFê°€ ì•”í˜¸í™”ë˜ì–´ ìˆì§€ ì•Šì€ì§€ í™•ì¸<br>
           â€¢ ì´ë¯¸ì§€ëŠ” JPG Â· PNG Â· WEBP ê¶Œì¥<br>
           â€¢ íŒŒì¼ì´ ë„ˆë¬´ í¬ê±°ë‚˜ ì†ìƒë˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸
         </div>`;
      pdfShowStep(4);
    }
  }
  
  function pdfRetry(){
    pdfBase64=null; pdfExtracted=[]; pdfActivities=[]; pdfFileType=null;
    _pdfQueue=[]; _pdfQueueIdx=0; _pdfAllExtracted=[]; _pdfAllActivities=[];
    document.getElementById('pdfFileInput').value='';
    document.getElementById('pdfFileName').style.display='none';
    document.getElementById('pdfFileTypeNote').style.display='none';
    const btn = document.getElementById('pdfAnalyzeBtn');
    btn.disabled=true; btn.textContent=i18n('ë¶„ì„ ì‹œì‘'); btn.onclick=pdfAnalyze;
    document.getElementById('dropIcon').textContent='ğŸ—‚';
    pdfShowStep(1);
  }
  
  function esc2(s){ return (s||'').replace(/"/g,'&quot;').replace(/</g,'&lt;'); }
  
  function renderPdfResults(){
    const div = document.getElementById('pdfResults');
    const typeLabel = {};
    actTypes.forEach(t=>{ typeLabel[t.id] = t.emoji+' '+t.label; });
  
    // íŒŒì¼ë³„ë¡œ ê·¸ë£¹í•‘
    const fileGroups = [];
    const noSrc = '__single__';
    const seen = new Map(); // srcFile â†’ group index
  
    pdfExtracted.forEach((p,i)=>{
      const src = p._srcFile || noSrc;
      if(!seen.has(src)){ seen.set(src, fileGroups.length); fileGroups.push({src, contacts:[], activities:[]}); }
      fileGroups[seen.get(src)].contacts.push({...p, _idx:i});
    });
    pdfActivities.forEach((a,i)=>{
      const src = a._srcFile || noSrc;
      if(!seen.has(src)){ seen.set(src, fileGroups.length); fileGroups.push({src, contacts:[], activities:[]}); }
      fileGroups[seen.get(src)].activities.push({...a, _idx:i});
    });
  
    const multiFile = fileGroups.length > 1;
    let html = '';
  
    fileGroups.forEach((grp, gi)=>{
      // íŒŒì¼ êµ¬ë¶„ì„  (ë‹¤ì¤‘ íŒŒì¼ì¼ ë•Œë§Œ)
      if(multiFile){
        const fname = grp.src === noSrc ? 'íŒŒì¼' : grp.src;
        html += `<div style="display:flex;align-items:center;gap:8px;margin:${gi>0?'24px':0}px 0 10px">
          <div style="font-size:11px;font-family:IBM Plex Mono,monospace;color:var(--accent2);font-weight:600;white-space:nowrap">ğŸ“ ${fname}</div>
          <div style="flex:1;height:1px;background:var(--border)"></div>
          <div style="font-size:10px;color:var(--muted)">${grp.contacts.length} ${i18n('ëª…')} Â· ${i18n('í™œë™')} ${grp.activities.length} ${i18n('ê±´')}</div>
        </div>`;
      }
  
      // ì—°ë½ì²˜
      if(grp.contacts.length){
        if(!multiFile) html += `<div style="font-size:11px;font-family:IBM Plex Mono,monospace;color:var(--accent);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;padding-bottom:6px;border-bottom:1px solid var(--border)">ğŸ‘¤ ${i18n('ì—°ë½ì²˜')} (${grp.contacts.length} ${i18n('ëª…')})</div>`;
        html += grp.contacts.map(p=>{
          const i = p._idx;
          const name=(p.last||'')+(p.first||'')||i18n('ì´ë¦„ ì—†ìŒ');
          return `<div class="pdf-contact-card checked" id="pdfCard${i}">
            <div class="pdf-card-header">
              <input type="checkbox" class="pdf-card-check" id="pdfCheck${i}" checked onchange="document.getElementById('pdfCard${i}').classList.toggle('checked',this.checked)">
              <div class="pdf-card-name">${name}${p.company?` <span style="font-size:12px;color:var(--muted);font-weight:400">Â· ${p.company}</span>`:''}</div>
            </div>
            <div class="pdf-fields">
              <div class="pdf-field"><label>${i18n('íšŒì‚¬ëª…')||'Company'}</label><input id="pr${i}_company" value="${esc2(p.company)}"></div>
              <div class="pdf-field"><label>${i18n('ë¶€ì„œ')}</label><input id="pr${i}_dept" value="${esc2(p.dept)}"></div>
              <div class="pdf-field"><label>${i18n('ì§ì±…')}</label><input id="pr${i}_position" value="${esc2(p.position)}"></div>
              <div class="pdf-field"><label>${i18n('ì„±')||'Last'}</label><input id="pr${i}_last" value="${esc2(p.last)}"></div>
              <div class="pdf-field"><label>${i18n('ì´ë¦„')||'First'}</label><input id="pr${i}_first" value="${esc2(p.first)}"></div>
              <div class="pdf-field"><label>${i18n('ì´ë©”ì¼')}</label><input id="pr${i}_email" value="${esc2(p.email)}"></div>
              <div class="pdf-field"><label>${i18n('ì‚¬ë¬´ì‹¤')}</label><input id="pr${i}_office" value="${esc2(p.office)}"></div>
              <div class="pdf-field"><label>${i18n('íœ´ëŒ€í°')}</label><input id="pr${i}_mobile" value="${esc2(p.mobile)}"></div>
              <div class="pdf-field"><label>${i18n('ì¶”ê°€ì—°ë½ì²˜')||'Extra'}</label><input id="pr${i}_extra" value="${esc2(p.extra)}"></div>
              <div class="pdf-field full"><label>ì£¼ì†Œ</label><input id="pr${i}_address" value="${esc2(p.address)}"></div>
              <div class="pdf-field full"><label>${i18n('ë©”ëª¨')}</label><input id="pr${i}_memo" value="${esc2(p.memo)}"></div>
            </div>
          </div>`;
        }).join('');
      }
  
      // í™œë™
      if(grp.activities.length){
        html += `<div style="font-size:11px;font-family:IBM Plex Mono,monospace;color:var(--accent3);text-transform:uppercase;letter-spacing:1px;margin:${grp.contacts.length?'14px':0}px 0 8px;padding-bottom:6px;border-bottom:1px solid var(--border)">ğŸ“‹ ${i18n('í™œë™')} (${grp.activities.length} ${i18n('ê±´')})${multiFile?'':' â€” '+i18n('ìë™ ì—°ê²° ì•ˆë‚´')}</div>`;
        html += `<div style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:4px">
          <table style="width:100%;border-collapse:collapse;font-size:12px">
            <thead><tr style="background:var(--surface)">
              <th style="padding:8px 10px;width:28px;border-bottom:1px solid var(--border)"></th>
              <th style="padding:8px 10px;text-align:left;font-size:10px;color:var(--muted);font-family:IBM Plex Mono,monospace;font-weight:400;border-bottom:1px solid var(--border);width:100px">${i18n('ë‚ ì§œ')}</th>
              <th style="padding:8px 10px;text-align:left;font-size:10px;color:var(--muted);font-family:IBM Plex Mono,monospace;font-weight:400;border-bottom:1px solid var(--border);width:80px">${i18n('ìœ í˜•')}</th>
              <th style="padding:8px 10px;text-align:left;font-size:10px;color:var(--muted);font-family:IBM Plex Mono,monospace;font-weight:400;border-bottom:1px solid var(--border)">${i18n('ë‚´ìš©')}</th>
              <th style="padding:8px 10px;text-align:right;font-size:10px;color:var(--muted);font-family:IBM Plex Mono,monospace;font-weight:400;border-bottom:1px solid var(--border);width:90px">ê¸ˆì•¡</th>
            </tr></thead>
            <tbody>
              ${grp.activities.map(a=>{
                const i = a._idx;
                const tl = typeLabel[a.type]||('ğŸ“Œ '+a.type);
                const amtDisp = a.amount ? 'â‚©'+Number(a.amount||0).toLocaleString() : '';
                return `<tr style="border-bottom:1px solid var(--border)">
                  <td style="padding:7px 10px"><input type="checkbox" id="paCheck${i}" checked style="accent-color:var(--accent3)"></td>
                  <td style="padding:7px 10px;font-family:IBM Plex Mono,monospace;color:var(--muted)">${a.date||''}</td>
                  <td style="padding:7px 10px">${tl}</td>
                  <td style="padding:7px 10px;color:var(--text)">${a.title||''}${a.content&&a.content!==a.title?`<div style="font-size:11px;color:var(--muted);margin-top:2px">${a.content}</div>`:''}</td>
                  <td style="padding:7px 10px;text-align:right;font-family:IBM Plex Mono,monospace;color:var(--accent3);font-size:11px">${amtDisp}</td>
                </tr>`;
              }).join('')}
            </tbody>
          </table>
        </div>`;
      }
    });
  
    div.innerHTML = html || `<div style="text-align:center;padding:24px;color:var(--muted)">${i18n('ì¶”ì¶œëœ ì •ë³´ ì—†ìŒ')}</div>`;
  }
  
  function pdfImportAll(){
    let addedContacts = 0, addedActs = 0;
    const newContactIds = [];
  
    // â‘  ì—°ë½ì²˜ ì €ì¥
    for(let i=0; i<pdfExtracted.length; i++){
      const chk = document.getElementById('pdfCheck'+i);
      if(!chk || !chk.checked) continue;
      const get = id => document.getElementById(`pr${i}_${id}`)?.value?.trim()||'';
      const last=get('last'), first=get('first');
      if(!last && !first) continue;
      const co=get('company'), addr=get('address');
      if(co && addr){ if(!companies[co]) companies[co]={}; if(!companies[co].address) companies[co].address=addr; }
      const newId = uid();
      contacts.unshift({ id:newId, createdAt:new Date().toISOString(),
        company:co, dept:get('dept'), position:get('position'), last, first,
        email:get('email'), office:get('office'), mobile:get('mobile'),
        extra:get('extra'), address:addr, memo:get('memo') });
      newContactIds.push(newId);
      addedContacts++;
    }
  
    // â‘¡ í™œë™ ì €ì¥ â€” ì²« ë²ˆì§¸ ì €ì¥ëœ ì—°ë½ì²˜ì— ì—°ê²°
    const targetId = newContactIds[0] || null;
    if(targetId && pdfActivities.length){
      for(let i=0; i<pdfActivities.length; i++){
        const chk = document.getElementById('paCheck'+i);
        if(!chk || !chk.checked) continue;
        const a = pdfActivities[i];
        activities.push({ id:uid(), contactId:targetId,
          type:a.type||'other', date:a.date||'',
          title:a.title||'', content:a.content||'', amount:a.amount||'',
          createdAt:new Date().toISOString() });
        addedActs++;
      }
    } else if(pdfActivities.length && !targetId){
      alert(i18n('í™œë™ ì—°ê²° ì˜¤ë¥˜'));
      return;
    }
  
    persist();
    closeModal('pdfModal');
    renderContacts();
    const msg = [addedContacts?`${i18n('ì—°ë½ì²˜')} ${addedContacts} ${i18n('ëª…')}`:'', addedActs?`${i18n('í™œë™')} ${addedActs} ${i18n('ê±´')}`:''].filter(Boolean).join(', ');
    if(msg) alert(`âœ… ${msg} ${i18n('ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤')}`);
  }
  
  
  // â”€â”€ CSV ëŒ€ìš©ëŸ‰ ê°€ì ¸ì˜¤ê¸° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let _csvRawRows = [];   // íŒŒì‹±ëœ ì „ì²´ í–‰ ë°°ì—´
  let _csvHeaders = [];   // ì›ë³¸ í—¤ë”
  let _csvMapping = {};   // CRMí•„ë“œ â†’ ì›ë³¸ì»¬ëŸ¼ëª…
  
  // Outlook CSV ì»¬ëŸ¼ëª… ìë™ ë§¤í•‘ í…Œì´ë¸” (í•œê¸€/ì˜ë¬¸ ëª¨ë‘)
  const CSV_AUTO_MAP = {
    last:     ['ì„±','Last Name','Lastname','ì„±(Last Name)','last_name'],
    first:    ['ì´ë¦„','First Name','Firstname','ì´ë¦„(First Name)','first_name'],
    company:  ['íšŒì‚¬','Company','íšŒì‚¬ ì´ë¦„','Company Name','organization'],
    dept:     ['ë¶€ì„œ','Department','Dept'],
    position: ['ì§í•¨','Job Title','Title','ì§ìœ„','Position'],
    email:    ['ì „ì ë©”ì¼ ì£¼ì†Œ','Email Address','Email','ì´ë©”ì¼','E-mail','email_1_value'],
    mobile:   ['íœ´ëŒ€í°','Mobile Phone','Mobile','Cell Phone','í•¸ë“œí°','phone_1_value'],
    office:   ['íšŒì‚¬ ì „í™”','Business Phone','Work Phone','ì§í†µ','ì‚¬ë¬´ì‹¤ ì „í™”','phone_2_value'],
    extra:    ['ê¸°íƒ€ ì „í™”','Other Phone','Home Phone','ì¶”ê°€ ì—°ë½ì²˜'],
    address:  ['íšŒì‚¬ ì£¼ì†Œ','Business Address','Address','ì£¼ì†Œ','Street'],
    memo:     ['ë©”ëª¨','Notes','Note','ë¹„ê³ '],
  };
  const CSV_FIELD_LABELS = {
    last:'ì„±', first:'ì´ë¦„', company:'íšŒì‚¬', dept:'ë¶€ì„œ', position:'ì§í•¨',
    email:'ì´ë©”ì¼', mobile:'í•¸ë“œí°', office:'ì§í†µ', extra:'ì¶”ê°€ì—°ë½ì²˜',
    address:'ì£¼ì†Œ', memo:'ë©”ëª¨',
  };
  
  // CSV ê´€ë ¨ ìƒíƒœ
  let _csvFile = null;
  
  function csvParse(){
    if(!_csvFile){ alert(i18n('íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.')); return; }
    // ë¶„ì„ ë²„íŠ¼ ì›ìƒë³µêµ¬ (ë‹¤ìŒ ë¹„CSV íŒŒì¼ì„ ìœ„í•´)
    const btn = document.getElementById('pdfAnalyzeBtn');
    if(btn){ btn.textContent = i18n('ë¶„ì„ ì‹œì‘'); btn.onclick = pdfAnalyze; }
  
    // ë¡œë”© í‘œì‹œ
    pdfShowStep(6);
    document.getElementById('csvProgressMsg').textContent = i18n('CSV ì½ëŠ” ì¤‘');
    document.getElementById('csvProgressBar').style.width = '10%';
    document.getElementById('csvProgressSub').textContent = `${i18n('íŒŒì¼ í¬ê¸°')}: ${(_csvFile.size/1024/1024).toFixed(1)}MB`;
  
    const processText = text => {
      document.getElementById('csvProgressMsg').textContent = i18n('CSV íŒŒì‹± ì¤‘');
      document.getElementById('csvProgressBar').style.width = '40%';
      setTimeout(()=>{
        try {
          const result = csvParseText(text);
          _csvHeaders = result.headers;
          _csvRawRows = result.rows;
          _csvMapping = csvAutoMap(_csvHeaders);
          document.getElementById('csvProgressBar').style.width = '100%';
          setTimeout(()=>{
            pdfShowStep(5);
            csvRenderMapping();
          }, 200);
        } catch(err){
          pdfShowStep(1);
          alert(i18n('CSV íŒŒì‹± ì˜¤ë¥˜') + ': ' + err.message);
        }
      }, 50);
    };
  
    const reader = new FileReader();
    reader.onload = e => processText(e.target.result);
    reader.onerror = () => {
      const r2 = new FileReader();
      r2.onload = e2 => processText(e2.target.result);
      r2.onerror = () => { pdfShowStep(1); alert(i18n('íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤')); };
      r2.readAsText(_csvFile, 'EUC-KR');
    };
    reader.readAsText(_csvFile, 'UTF-8');
  }
  
  // ê°„ë‹¨í•˜ê³  ê²¬ê³ í•œ CSV íŒŒì„œ (ë”°ì˜´í‘œ ì²˜ë¦¬ í¬í•¨)
  function csvParseText(text){
    // BOM ì œê±°
    if(text.charCodeAt(0) === 0xFEFF) text = text.slice(1);
    const lines = [];
    let cur = '', inQ = false;
    for(let i=0; i<text.length; i++){
      const ch = text[i];
      if(ch==='"'){
        if(inQ && text[i+1]==='"'){ cur+='"'; i++; }
        else inQ = !inQ;
      } else if((ch==='\n'||ch==='\r') && !inQ){
        if(ch==='\r' && text[i+1]==='\n') i++;
        lines.push(cur); cur='';
      } else cur+=ch;
    }
    if(cur) lines.push(cur);
  
    const parseLine = line => {
      const cells=[]; let c='', iq=false;
      for(let i=0;i<line.length;i++){
        const ch=line[i];
        if(ch==='"'){
          if(iq && line[i+1]==='"'){c+='"';i++;}
          else iq=!iq;
        } else if(ch===',' && !iq){ cells.push(c.trim()); c=''; }
        else c+=ch;
      }
      cells.push(c.trim()); return cells;
    };
  
    if(!lines.length) throw new Error('ë¹ˆ íŒŒì¼ì…ë‹ˆë‹¤.');
    const headers = parseLine(lines[0]);
    const rows = [];
    for(let i=1;i<lines.length;i++){
      if(!lines[i].trim()) continue;
      const cells = parseLine(lines[i]);
      const row = {};
      headers.forEach((h,j)=>{ row[h] = cells[j]||''; });
      rows.push(row);
    }
    return {headers, rows};
  }
  
  // ì»¬ëŸ¼ëª… ìë™ ë§¤í•‘
  function csvAutoMap(headers){
    const map = {};
    const lowers = headers.map(h=>h.toLowerCase().replace(/\s/g,''));
    Object.entries(CSV_AUTO_MAP).forEach(([field, candidates])=>{
      for(const c of candidates){
        const cl = c.toLowerCase().replace(/\s/g,'');
        const idx = lowers.findIndex(h=>h===cl || h.includes(cl) || cl.includes(h));
        if(idx>=0){ map[field] = headers[idx]; break; }
      }
    });
    return map;
  }
  
  // ë§¤í•‘ UI ë Œë”
  function csvRenderMapping(){
    const area = document.getElementById('csvMappingArea');
    const previewInfo = document.getElementById('csvPreviewInfo');
    previewInfo.textContent = `${_csvRawRows.length.toLocaleString()} ${i18n('í–‰ ê°ì§€ ë©”ì‹œì§€')}`;
  
    const opts = `<option value="">${i18n('ì‚¬ìš© ì•ˆ í•¨')||'â€” None â€”'}</option>`
      + _csvHeaders.map(h=>`<option value="${h.replace(/"/g,'&quot;')}">${h}</option>`).join('');
  
    let html = `<table style="width:100%;border-collapse:collapse;font-size:12px">
      <thead><tr>
        <th style="padding:6px 10px;text-align:left;background:var(--surface2);border-bottom:1px solid var(--border)">${i18n('CRM í•„ë“œ')||'CRM Field'} í•„ë“œ</th>
        <th style="padding:6px 10px;text-align:left;background:var(--surface2);border-bottom:1px solid var(--border)">CSV ì»¬ëŸ¼ ë§¤í•‘</th>
        <th style="padding:6px 10px;text-align:left;background:var(--surface2);border-bottom:1px solid var(--border)">${i18n('ë¯¸ë¦¬ë³´ê¸°')||'Preview'} (ì²« í–‰)</th>
      </tr></thead><tbody>`;
  
    Object.entries(CSV_FIELD_LABELS).forEach(([field, label])=>{
      const mapped = _csvMapping[field]||'';
      const preview = _csvRawRows[0]?.[mapped]||'';
      const sel = opts.replace(`value="${mapped}"`,`value="${mapped}" selected`);
      html += `<tr style="border-bottom:1px solid var(--border)">
        <td style="padding:6px 10px;font-weight:600;color:var(--accent);white-space:nowrap">${label}</td>
        <td style="padding:6px 10px">
          <select onchange="_csvMapping['${field}']=this.value;csvUpdatePreview()" style="background:var(--surface2);border:1px solid var(--border);border-radius:5px;color:var(--text);font-size:11px;padding:3px 6px;width:100%">
            ${sel}
          </select>
        </td>
        <td style="padding:6px 10px;color:var(--muted);font-size:11px;font-family:IBM Plex Mono,monospace;max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${preview||'â€”'}</td>
      </tr>`;
    });
    html += '</tbody></table>';
    area.innerHTML = html;
  }
  
  function csvUpdatePreview(){
    // ë¯¸ë¦¬ë³´ê¸° ê°’ë§Œ ê°±ì‹ 
    document.querySelectorAll('#csvMappingArea tbody tr').forEach((tr, idx)=>{
      const field = Object.keys(CSV_FIELD_LABELS)[idx];
      const mapped = _csvMapping[field]||'';
      const preview = _csvRawRows[0]?.[mapped]||'';
      const td = tr.querySelectorAll('td')[2];
      if(td) td.textContent = preview||'â€”';
    });
  }
  
  async function csvImport(){
    pdfShowStep(6);
    document.getElementById('csvProgressBar').style.width = '0%';
    document.getElementById('csvProgressMsg').textContent = i18n('ê°€ì ¸ì˜¤ëŠ” ì¤‘...');
    document.getElementById('csvProgressSub').textContent = `${i18n('ì´')} ${_csvRawRows.length.toLocaleString()}${i18n('í–‰')} ${i18n('ì²˜ë¦¬ ì‹œì‘')}`;
    await new Promise(r=>setTimeout(r,50));
  
    const total = _csvRawRows.length;
    let added = 0, skipped = 0, dupCount = 0;
  
    // ê¸°ì¡´ ì—°ë½ì²˜ ì´ë©”ì¼Â·ì´ë¦„ Set (ì¤‘ë³µ ê²€ì‚¬ìš©)
    const existEmails = new Set(contacts.map(c=>c.email||'').filter(Boolean).map(e=>e.toLowerCase()));
    const existNames  = new Set(contacts.map(c=>(c.last+c.first).replace(/\s/g,'')).filter(Boolean));
  
    const CHUNK = 500; // ë¸Œë¼ìš°ì € ë¸”ë¡œí‚¹ ë°©ì§€ìš© ì²­í¬
    for(let i=0; i<total; i++){
      const row = _csvRawRows[i];
      const get = field => {
        const col = _csvMapping[field];
        return col ? (row[col]||'').trim() : '';
      };
  
      // ì´ë¦„ ì²˜ë¦¬: ì„±/ì´ë¦„ ë¶„ë¦¬ or ì „ì²´ ì´ë¦„ì—ì„œ ë¶„ë¦¬
      let last  = get('last');
      let first = get('first');
      if(!last && !first){
        // full name ì»¬ëŸ¼ ì‹œë„
        const fullCols = ['Full Name','ì´ë¦„','Name','ì„±ëª…','DisplayName','display_name'];
        let full = '';
        for(const fc of fullCols){
          if(row[fc]){ full = row[fc].trim(); break; }
        }
        if(full){
          const parts = full.split(/\s+/);
          if(parts.length>=2){ last=parts[0]; first=parts.slice(1).join(' '); }
          else { last=full; }
        }
      }
  
      const email   = get('email').toLowerCase();
      const company = get('company');
      const mobile  = get('mobile');
      const office  = get('office');
  
      // ì¤‘ë³µ ì²´í¬ (ì´ë©”ì¼ ë˜ëŠ” ì´ë¦„)
      const nameKey = (last+first).replace(/\s/g,'');
      if(email && existEmails.has(email)){ dupCount++; skipped++; continue; }
      if(!email && nameKey && existNames.has(nameKey)){ dupCount++; skipped++; continue; }
      if(!last && !first && !email && !mobile && !office){ skipped++; continue; }
  
      const newId = uid();
      const co = company.trim();
      contacts.push({
        id: newId,
        createdAt: new Date().toISOString(),
        company: co,
        dept:     get('dept'),
        position: get('position'),
        last:     last  || '',
        first:    first || '',
        email:    get('email'),
        office:   office,
        mobile:   mobile,
        extra:    get('extra'),
        address:  get('address'),
        memo:     get('memo'),
      });
      if(co && !companies[co]) companies[co] = {};
      if(email) existEmails.add(email);
      if(nameKey) existNames.add(nameKey);
      added++;
  
      // ì§„í–‰ë°” ì—…ë°ì´íŠ¸ (ë§¤ CHUNKë§ˆë‹¤ UI ì–‘ë³´)
      if(i % CHUNK === 0){
        const pct = Math.round((i/total)*100);
        document.getElementById('csvProgressBar').style.width = pct+'%';
        document.getElementById('csvProgressMsg').textContent = `${i18n('ê°€ì ¸ì˜¤ëŠ” ì¤‘...')} (${i.toLocaleString()} / ${total.toLocaleString()})`;
        document.getElementById('csvProgressSub').textContent = `${i18n('ì¶”ê°€')}: ${added.toLocaleString()}${i18n('ëª…')} Â· ${i18n('ì¤‘ë³µ ê±´ë„ˆëœ€')}: ${dupCount.toLocaleString()}${i18n('ê±´')}`;
        await new Promise(r=>setTimeout(r,0)); // UI ì—…ë°ì´íŠ¸ ì–‘ë³´
      }
    }
  
    // ì €ì¥
    document.getElementById('csvProgressBar').style.width = '100%';
    document.getElementById('csvProgressMsg').textContent = i18n('ì €ì¥ ì¤‘...');
    await new Promise(r=>setTimeout(r,30));
    persist();
    renderContacts();
    refreshTeamFilterBars();
  
    // ì™„ë£Œ í™”ë©´
    pdfShowStep(7);
    document.getElementById('csvDoneMsg').textContent = `${added.toLocaleString()}${i18n('ëª… ì¶”ê°€ ì™„ë£Œ')}`;
    document.getElementById('csvDoneSub').innerHTML =
      `${i18n('ì´')} ${total.toLocaleString()} ${i18n('í–‰ ì²˜ë¦¬ ì‹œì‘')}<br>`
      + (dupCount ? `${i18n('ì¤‘ë³µ ê±´ë„ˆëœ€')}: ${dupCount.toLocaleString()}${i18n('ê±´')}<br>` : '')
      + (skipped-dupCount ? `${i18n('ë¹ˆ í–‰ ê±´ë„ˆëœ€')}: ${(skipped-dupCount).toLocaleString()}${i18n('ê±´')}<br>` : '')
      + `<br>${i18n('Supabase ìë™ë™ê¸°í™” ì•ˆë‚´')}`;
  }
  
  // â”€â”€ TYPE MANAGER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const DEFAULT_TYPE_IDS = ['order','quote','visit','call','other'];
  let _editTypes = [];
  
  function openTypeModal(){
    _editTypes = actTypes.map(t=>({...t}));
    renderTypeList();
    document.getElementById('typeModal').classList.add('open');
  }
  
  function renderTypeList(){
    const div = document.getElementById('typeList');
    div.innerHTML = _editTypes.map((t,i)=>{
      const isDef = DEFAULT_TYPE_IDS.includes(t.id);
      return `<div style="display:grid;grid-template-columns:36px 60px 1fr 120px auto;gap:8px;align-items:center;margin-bottom:8px">
        <div style="display:flex;flex-direction:column;gap:2px">
          ${i>0?`<button onclick="_editTypes.splice(${i}-1,0,_editTypes.splice(${i},1)[0]);renderTypeList()" style="background:none;border:1px solid var(--border);border-radius:4px;color:var(--muted);cursor:pointer;font-size:10px;padding:1px 4px;line-height:1">â–²</button>`:'<span></span>'}
          ${i<_editTypes.length-1?`<button onclick="_editTypes.splice(${i}+1,0,_editTypes.splice(${i},1)[0]);renderTypeList()" style="background:none;border:1px solid var(--border);border-radius:4px;color:var(--muted);cursor:pointer;font-size:10px;padding:1px 4px;line-height:1">â–¼</button>`:'<span></span>'}
        </div>
        <input value="${t.emoji}" maxlength="2" ${isDef?'readonly':''} onchange="_editTypes[${i}].emoji=this.value" style="padding:6px;background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:16px;text-align:center;outline:none;width:100%;${isDef?'opacity:.6':''}">
        <input value="${t.label}" ${isDef?'readonly':''} onchange="_editTypes[${i}].label=this.value" style="padding:6px 9px;background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:13px;font-family:inherit;outline:none;width:100%;${isDef?'opacity:.6':''}">
        <div style="display:flex;align-items:center;gap:6px">
          <input type="color" value="${t.color||'#7986cb'}" onchange="_editTypes[${i}].color=this.value" style="width:32px;height:28px;border:1px solid var(--border);border-radius:5px;background:var(--bg);cursor:pointer;padding:2px">
          <div style="width:20px;height:20px;border-radius:50%;background:${t.color||'#7986cb'}"></div>
        </div>
        ${isDef
          ? `<span style="font-size:11px;color:var(--muted);padding:0 8px">ê¸°ë³¸</span>`
          : `<button onclick="_editTypes.splice(${i},1);renderTypeList()" style="background:none;border:1px solid var(--border);border-radius:6px;color:var(--muted);cursor:pointer;font-size:13px;padding:4px 8px" onmouseover="this.style.borderColor='var(--danger)';this.style.color='var(--danger)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--muted)'">âœ•</button>`
        }
      </div>`;
    }).join('');
  }
  
  function addCustomType(){
    const emoji = document.getElementById('newTypeEmoji').value.trim()||'ğŸ”–';
    const label = document.getElementById('newTypeLabel').value.trim();
    const color = document.getElementById('newTypeColor').value;
    if(!label){ alert(i18n('ìœ í˜• ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”')); return; }
    const id = 'custom_'+Date.now();
    _editTypes.push({id, label, emoji, color});
    document.getElementById('newTypeEmoji').value='';
    document.getElementById('newTypeLabel').value='';
    renderTypeList();
  }
  
  function saveTypes_modal(){
    actTypes = _editTypes;
    saveTypes(actTypes);
    rebuildTypeMaps();
    injectTypeStyles();
    refreshTypeSelect();
    refreshFilterBar();
    closeModal('typeModal');
    renderContacts();
  }
  
  function refreshTypeSelect(){
    const sel = document.getElementById('a_type');
    if(!sel) return;
    const cur = sel.value;
    sel.innerHTML = actTypes.map(t=>`<option value="${t.id}">${t.emoji} ${t.label}</option>`).join('');
    if(actTypes.find(t=>t.id===cur)) sel.value=cur;
  }
  
  function refreshFilterBar(){
    const bar = document.getElementById('actFilterBar');
    if(!bar) return;
    bar.innerHTML = `<button class="filter-chip${actFilter.size===0?' active':''}" data-val="all" onclick="setActFilter('all',this)">${i18n('ì „ì²´ í•„í„°')}</button>`
      + actTypes.map(t=>`<button class="filter-chip${actFilter.has(t.id)?' active':''}" data-val="${t.id}" onclick="setActFilter('${t.id}',this)">${t.emoji} ${t.label}</button>`).join('');
  }
  
  // â”€â”€ SUPABASE ì„¤ì • ëª¨ë‹¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openGsModal(){
    const urlIn  = document.getElementById('sbUrlInput');
    const keyIn  = document.getElementById('sbKeyInput');
    const status = document.getElementById('sbCurrentStatus');
    const discBtn= document.getElementById('sbDisconnectBtn');
    const curUrl = document.getElementById('sbCurrentUrl');
    const lastSy = document.getElementById('sbLastSyncInfo');
  
    urlIn.value = sbUrl;
    keyIn.value = sbKey;
  
    if(sbIsConnected()){
      status.style.display  = '';
      discBtn.style.display = '';
      curUrl.textContent    = sbUrl;
      lastSy.textContent    = sbLastSync ? i18n('ë§ˆì§€ë§‰ ë™ê¸°í™”') + sbLastSync : i18n('ì•„ì§ ë™ê¸°í™” ì•ˆ ë¨');
    } else {
      status.style.display  = 'none';
      discBtn.style.display = 'none';
    }
    document.getElementById('sbStatusMsg').textContent = '';
    document.getElementById('gsModal').classList.add('open');
  }
  
  function sbSaveSettings(){
    const url = document.getElementById('sbUrlInput').value.trim().replace(/\/$/,'');
    const key = document.getElementById('sbKeyInput').value.trim();
    const msg = document.getElementById('sbStatusMsg');
  
    if(!url || !key){
      msg.style.color = 'var(--accent2)';
      msg.textContent = i18n('URL Key ì…ë ¥ ê²½ê³ ');
      return;
    }
    if(!url.includes('supabase.co')){
      msg.style.color = 'var(--accent2)';
      msg.textContent = i18n('Supabase URL ê²½ê³ ');
      return;
    }
  
    sbUrl = url;
    sbKey = key;
    safeStorage.setItem('crm_sb_url', sbUrl);
    safeStorage.setItem('crm_sb_key', sbKey);
    msg.style.color = 'var(--accent3)';
    msg.textContent = i18n('ì €ì¥ëìŠµë‹ˆë‹¤');
    setTimeout(()=>{
      closeModal('gsModal');
      // ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ë³µê·€ (ì²« ê´€ë¦¬ì ê³„ì • í•„ìš” ì•ˆë‚´)
      var ov=document.getElementById('loginOverlay');
      if(ov) ov.classList.remove('hidden');
      // Supabase ìƒíƒœ ë°” ê°±ì‹ 
      _updateSbStatusBar();
      // ì´ˆê¸° ê´€ë¦¬ì ê³„ì • ìë™ ìƒì„± (ìµœì´ˆ 1íšŒ)
      _initFirstAdmin();
    }, 800);
  }
  
  function sbDisconnect(){
    _sbStopRealtime();
    sbUrl = ''; sbKey = '';
    safeStorage.removeItem('crm_sb_url');
    safeStorage.removeItem('crm_sb_key');
    sbUpdateStatus('offline', i18n('ë¡œì»¬ ì €ì¥ ëª¨ë“œ'));
    closeModal('gsModal');
  }
  
  function sbManualLoad(){
    if(!sbUrl || !sbKey){
      document.getElementById('sbStatusMsg').textContent = i18n('URLê³¼ Key ì…ë ¥');
      return;
    }
    closeModal('gsModal');
    sbLoad();
  }
  
  // â”€â”€ ì—°ê²° ì§„ë‹¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function sbDiagnose(){
    const msg = document.getElementById('sbStatusMsg');
    const url = (document.getElementById('sbUrlInput').value||'').trim().replace(/\/$/,'') || sbUrl;
    const key = (document.getElementById('sbKeyInput').value||'').trim() || sbKey;
  
    if(!url || !key){
      msg.style.color='var(--accent2)';
      msg.innerHTML=i18n('URL Key ë¨¼ì €');
      return;
    }
    msg.style.color='var(--muted)';
    msg.innerHTML=i18n('ì§„ë‹¨ ì¤‘');
  
    const results = [];
    const h = { 'apikey': key, 'Authorization': 'Bearer ' + key };
  
    // 1. contacts ì½ê¸°
    try {
      const r = await fetch(`${url}/rest/v1/contacts?select=id&limit=1`, {headers:h});
      if(r.ok){ const d=await r.json(); results.push(`âœ… contacts ì—°ê²° ì„±ê³µ (DBë‚´ ${d.length}í–‰)`); }
      else { const t=await r.text(); results.push(`âŒ contacts ì‹¤íŒ¨ (${r.status}): ${t.slice(0,100)}`); }
    } catch(e){ results.push(`âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${e.message}`); }
  
    // 2. activities ì½ê¸°
    try {
      const r = await fetch(`${url}/rest/v1/activities?select=id&limit=1`, {headers:h});
      if(r.ok){ const d=await r.json(); results.push(`âœ… activities ì—°ê²° ì„±ê³µ (DBë‚´ ${d.length}í–‰)`); }
      else { const t=await r.text(); results.push(`âŒ activities ì‹¤íŒ¨ (${r.status}): ${t.slice(0,100)}`); }
    } catch(e){ results.push(`âŒ activities ì˜¤ë¥˜: ${e.message}`); }
  
    // 3. ì“°ê¸° í…ŒìŠ¤íŠ¸
    try {
      const testId = '__test__'+Date.now();
      const r = await fetch(`${url}/rest/v1/contacts`, {
        method:'POST',
        headers:{...h,'Content-Type':'application/json','Prefer':'return=minimal'},
        body: JSON.stringify([{id:testId,company:'__ì§„ë‹¨__',last:'í…Œ',first:'ìŠ¤íŠ¸',dept:'',position:'',email:'',office:'',mobile:'',extra:'',address:'',memo:'',created_at:new Date().toISOString()}])
      });
      if(r.ok||r.status===201){
        results.push('âœ… ì“°ê¸° ê¶Œí•œ í™•ì¸');
        await fetch(`${url}/rest/v1/contacts?id=eq.${testId}`,{method:'DELETE',headers:{...h,'Prefer':'return=minimal'}});
      } else {
        const t=await r.text();
        results.push(`âŒ ì“°ê¸° ê¶Œí•œ ì—†ìŒ (${r.status}): ${t.slice(0,100)}`);
        results.push('â†’ Supabase SQL Editorì—ì„œ SQLì„ ë‹¤ì‹œ ì‹¤í–‰í•´ì£¼ì„¸ìš”');
      }
    } catch(e){ results.push(`âŒ ì“°ê¸° í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${e.message}`); }
  
    msg.style.color = results.every(r=>r.startsWith('âœ…')) ? 'var(--accent3)' : 'var(--accent2)';
    msg.innerHTML = results.join('<br>');
  }
  
  // â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function _crmInit(){
    try {
      rebuildIndex(); // ì¸ë±ìŠ¤ ìµœì´ˆ ë¹Œë“œ
      injectTypeStyles();
      refreshTypeSelect();
      refreshFilterBar();
      refreshTeamFilterBars();
      renderStats();
      renderContacts();
      initLang();
      _pinInit();
  
      // Supabase ì—°ë™ ì‹œ ìë™ ë™ê¸°í™”
      if(sbIsConnected()){
        sbUpdateStatus('syncing', i18n('ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...'));
        sbLoad();
      } else {
        sbUpdateStatus('offline', i18n('ë¡œì»¬ ì €ì¥ ëª¨ë“œ_sync'));
      }
    } catch(err) {
      // ì—ëŸ¬ë¥¼ í™”ë©´ì— í‘œì‹œ (cross-origin "Script error." ëŒ€ì‹  ì‹¤ì œ ë‚´ìš© ì¶œë ¥)
      var msg = err && err.message ? err.message : String(err);
      var stack = err && err.stack ? err.stack.slice(0, 300) : '';
      var el = document.getElementById('_crmErrBox');
      if(!el){
        el = document.createElement('div');
        el.id = '_crmErrBox';
        el.style.cssText = 'position:fixed;bottom:60px;left:0;right:0;background:#c0392b;color:#fff;padding:10px 14px;font-size:12px;font-family:monospace;z-index:99999;white-space:pre-wrap;word-break:break-all';
        document.body.appendChild(el);
      }
      el.textContent = 'âš  Init Error: ' + msg + (stack ? '\n' + stack : '');
      console.error('CRM Init Error:', err);
    }
  }
  
  // â”€â”€ ì•± ì‹œì‘ ì§„ì…ì : ë¡œê·¸ì¸ í™”ë©´ ë¨¼ì €
  function _appStart(){
    _updateSbStatusBar();
    if(!sbIsConnected()){
      return; // ë¡œê·¸ì¸ í™”ë©´ ìœ ì§€ â€” sbStatusBarê°€ "ë¯¸ì—°ê²°" í‘œì‹œ
    }
    // ì„¸ì…˜ ë³µì› ì‹œë„
    if(_restoreSession()){
      document.getElementById('loginOverlay').classList.add('hidden');
      _afterLogin();
      return;
    }
    // ì„¸ì…˜ ì—†ìœ¼ë©´ ë¡œê·¸ì¸ í™”ë©´ ìœ ì§€ + admin ê³„ì • ìë™ ìƒì„± ì²´í¬ (500ms í›„)
    setTimeout(_initFirstAdmin, 500);
  }
  
  // Supabase ì—°ê²° ìƒíƒœ ë°” ì—…ë°ì´íŠ¸
  function _updateSbStatusBar(){
    var dot=document.getElementById('sbStatusDot');
    var txt=document.getElementById('sbStatusText');
    if(!dot||!txt) return;
    if(sbIsConnected()){
      dot.textContent='â—'; dot.style.color='var(--accent3)';
      var shortUrl=sbUrl.replace('https://','').split('.')[0];
      txt.textContent='Supabase ì—°ê²°ë¨: '+shortUrl+'.supabase.co';
      txt.style.color='var(--accent3)';
    } else {
      dot.textContent='â—‹'; dot.style.color='var(--accent2)';
      txt.textContent='Supabase ë¯¸ì—°ê²° â€” ì—¬ê¸°ë¥¼ ëˆŒëŸ¬ ì„¤ì •';
      txt.style.color='var(--accent2)';
    }
  }
  
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', _appStart);
  } else {
    _appStart();
  }
  
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // PIN LOCK SYSTEM
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const PIN_KEY          = 'crm_pin_hash';
  const PIN_FAIL_KEY     = 'crm_pin_fails';
  const PIN_LOCKED_UNTIL = 'crm_pin_locked_until';
  const PIN_AUTO_LOCK_KEY= 'crm_pin_auto_lock'; // ìë™ì ê¸ˆ ë¶„ ë‹¨ìœ„ (0=ë¹„í™œì„±)
  const AUTO_LOCK_MIN    = 10; // ê¸°ë³¸ 10ë¶„
  
  // SHA-256 í•´ì‹œ (SubtleCrypto, iOS 10+ ì§€ì›)
  // ìˆœìˆ˜ JS í•´ì‹œ (crypto.subtle ë¶ˆí•„ìš” â€” í™˜ê²½ ë…ë¦½ì , ë™ê¸° ì‹¤í–‰)
  // djb2 ë³€í˜• + salt â†’ 4ìë¦¬ PIN ë³´í˜¸ì— ì¶©ë¶„
  function _pinHash(pin){
    var salt = 'RelaCRM_2025';
    var str = salt + pin + salt.split('').reverse().join('');
    var h = 5381;
    for(var i = 0; i < str.length; i++){
      h = ((h << 5) + h) ^ str.charCodeAt(i);
      h = h >>> 0; // unsigned 32bit
    }
    return 'crm_' + ('00000000' + h.toString(16)).slice(-8);
  }
  
  // async ë˜í¼ â€” ê¸°ì¡´ await í˜¸ì¶œë¶€ í˜¸í™˜ì„± ìœ ì§€ (ì¦‰ì‹œ resolve)
  function _sha256(str){ return Promise.resolve(_pinHash(str)); }
  function _checkCrypto(){ return Promise.resolve(); }
  
  // â”€â”€ ìƒíƒœ ë³€ìˆ˜
  var _pinBuffer    = '';   // í˜„ì¬ ì…ë ¥ì¤‘ì¸ PIN
  var _pinUnlocked  = false;// í˜„ì¬ ì ê¸ˆ í•´ì œ ìƒíƒœ
  var _pinLastActive= Date.now();
  var _autoLockTimer= null;
  
  // â”€â”€ ìë™ì ê¸ˆ íƒ€ì´ë¨¸
  function _pinResetAutoLock(){
    _pinLastActive = Date.now();
    var mins = parseInt(safeStorage.getItem(PIN_AUTO_LOCK_KEY)||'0');
    if(!mins || !_pinUnlocked) return;
    clearTimeout(_autoLockTimer);
    _autoLockTimer = setTimeout(function(){
      if(_pinUnlocked && _pinIsEnabled()){
        _pinLockNow();
      }
    }, mins * 60 * 1000);
  }
  
  function _pinIsEnabled(){
    return !!safeStorage.getItem(PIN_KEY);
  }
  
  function _pinLockNow(){
    _pinUnlocked = false;
    _pinBuffer = '';
    _showPinOverlay('lock');
  }
  
  // â”€â”€ ì ê¸ˆ ì˜¤ë²„ë ˆì´ í‘œì‹œ
  function _showPinOverlay(mode){
    var overlay = document.getElementById('pinOverlay');
    if(!overlay) return;
    overlay.classList.remove('hidden','hiding');
    _pinBuffer = '';
    _updatePinDots('pinDots', 0);
    var msg = document.getElementById('pinMsg');
    var sub = document.getElementById('pinSubtitle');
    var forgotLink = document.getElementById('pinForgotLink');
  
    // ì ê¸ˆ ìƒíƒœ í™•ì¸
    var lockedUntil = parseInt(safeStorage.getItem(PIN_LOCKED_UNTIL)||'0');
    if(lockedUntil > Date.now()){
      var secs = Math.ceil((lockedUntil - Date.now())/1000);
      _showPinLockedState(secs);
      return;
    }
  
    if(sub) sub.textContent = i18n('PINì„ ì…ë ¥í•˜ì„¸ìš”');
    if(msg){ msg.textContent=''; msg.className='pin-msg'; }
    if(forgotLink) forgotLink.style.display = 'none';
    var pad = document.getElementById('pinPad');
    if(pad) pad.style.display = 'grid';
  }
  
  function _showPinLockedState(secs){
    var pad = document.getElementById('pinPad');
    var sub = document.getElementById('pinSubtitle');
    var msg = document.getElementById('pinMsg');
    var forgotLink = document.getElementById('pinForgotLink');
    if(pad) pad.style.display = 'none';
    if(sub) sub.textContent = 'ğŸ”’ ' + i18n('ì ê¸ˆ ìƒíƒœ');
    if(forgotLink) forgotLink.style.display = 'block';
  
    var mins = Math.ceil(secs/60);
    if(msg){
      msg.textContent = mins + i18n('ë¶„ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”');
      msg.className = 'pin-msg err';
    }
  
    // ì¹´ìš´íŠ¸ë‹¤ìš´
    var interval = setInterval(function(){
      var lockedUntil = parseInt(safeStorage.getItem(PIN_LOCKED_UNTIL)||'0');
      var remaining = lockedUntil - Date.now();
      if(remaining <= 0){
        clearInterval(interval);
        safeStorage.removeItem(PIN_LOCKED_UNTIL);
        safeStorage.removeItem(PIN_FAIL_KEY);
        _showPinOverlay('lock');
      } else {
        var m = Math.ceil(remaining/1000/60);
        if(msg) msg.textContent = m + i18n('ë¶„ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”');
      }
    }, 10000);
  }
  
  // â”€â”€ PIN ì…ë ¥ ì²˜ë¦¬ (ì ê¸ˆ í™”ë©´)
  function _pinPress(d){
    var lockedUntil = parseInt(safeStorage.getItem(PIN_LOCKED_UNTIL)||'0');
    if(lockedUntil > Date.now()) return;
    if(_pinBuffer.length >= 4) return;
    _pinBuffer += d;
    _updatePinDots('pinDots', _pinBuffer.length);
    if(_pinBuffer.length === 4) _pinVerify();
  }
  
  function _pinBackspace(){
    if(_pinBuffer.length > 0){
      _pinBuffer = _pinBuffer.slice(0,-1);
      _updatePinDots('pinDots', _pinBuffer.length);
    }
  }
  
  async function _pinVerify(){
    var hash = await _sha256(_pinBuffer);
    var stored = safeStorage.getItem(PIN_KEY);
    if(hash === stored){
      // ì„±ê³µ
      safeStorage.removeItem(PIN_FAIL_KEY);
      safeStorage.removeItem(PIN_LOCKED_UNTIL);
      _pinUnlocked = true;
      _pinBuffer = '';
      var overlay = document.getElementById('pinOverlay');
      var msg = document.getElementById('pinMsg');
      if(msg){ msg.textContent = 'âœ“'; msg.className = 'pin-msg ok'; }
      setTimeout(function(){
        if(overlay){ overlay.classList.add('hiding'); }
        setTimeout(function(){
          if(overlay){ overlay.classList.add('hidden'); overlay.classList.remove('hiding'); }
          _pinResetAutoLock();
        }, 350);
      }, 300);
    } else {
      // ì‹¤íŒ¨
      var fails = parseInt(safeStorage.getItem(PIN_FAIL_KEY)||'0') + 1;
      safeStorage.setItem(PIN_FAIL_KEY, String(fails));
      _pinBuffer = '';
      _pinErrorAnim('pinDots');
      var msg = document.getElementById('pinMsg');
      var remaining = 5 - fails;
      if(fails >= 5){
        // 30ë¶„ ì ê¸ˆ
        var until = Date.now() + 30*60*1000;
        safeStorage.setItem(PIN_LOCKED_UNTIL, String(until));
        _showPinLockedState(30*60);
      } else {
        if(msg){
          msg.textContent = i18n('PIN ì˜¤ë¥˜') + ' Â· ' + remaining + i18n('íšŒ ë‚¨ìŒ');
          msg.className = 'pin-msg err';
        }
        setTimeout(function(){
          _updatePinDots('pinDots',0);
          if(msg){ msg.textContent=''; msg.className='pin-msg'; }
        }, 800);
      }
    }
  }
  
  function _pinForgot(){
    if(!confirm(i18n('PIN ì´ˆê¸°í™” í™•ì¸'))) return;
    safeStorage.removeItem(PIN_KEY);
    safeStorage.removeItem(PIN_FAIL_KEY);
    safeStorage.removeItem(PIN_LOCKED_UNTIL);
    _pinUnlocked = true;
    var overlay = document.getElementById('pinOverlay');
    if(overlay){ overlay.classList.add('hidden'); }
    _updatePinToggle();
  }
  
  // â”€â”€ PIN ì„¤ì • ëª¨ë‹¬
  var _setupStep   = 'new';  // 'new' | 'confirm' | 'change_old'
  var _setupFirst  = '';
  var _setupBuffer = '';
  
  function openPinSetup(){
    var hasPin = _pinIsEnabled();
    _setupBuffer = '';
    _setupFirst  = '';
    var title = document.getElementById('pinSetupTitle');
    var deleteRow = document.getElementById('pinSetupDeleteRow');
    var setupMsg = document.getElementById('pinSetupMsg');
    var sub = document.getElementById('pinSetupTitle');
  
    if(hasPin){
      _setupStep = 'change_old';
      if(title) title.textContent = 'ğŸ” ' + i18n('PIN ë³€ê²½');
      if(deleteRow) deleteRow.style.display = 'block';
      if(setupMsg){ setupMsg.textContent = i18n('í˜„ì¬ PINì„ ì…ë ¥í•˜ì„¸ìš”'); setupMsg.className='pin-msg warn'; }
    } else {
      _setupStep = 'new';
      if(title) title.textContent = 'ğŸ” ' + i18n('PIN ì„¤ì •');
      if(deleteRow) deleteRow.style.display = 'none';
      if(setupMsg){ setupMsg.textContent = i18n('ìƒˆ PIN 4ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”'); setupMsg.className='pin-msg'; }
    }
    _updatePinDots('pinSetupDots', 0);
    document.getElementById('pinSetupModal').classList.add('open');
  }
  
  function _setupPinPress(d){
    if(_setupBuffer.length >= 4) return;
    _setupBuffer += d;
    _updatePinDots('pinSetupDots', _setupBuffer.length);
    if(_setupBuffer.length === 4) _handleSetupFull();
  }
  function _setupPinBackspace(){
    if(_setupBuffer.length > 0){
      _setupBuffer = _setupBuffer.slice(0,-1);
      _updatePinDots('pinSetupDots', _setupBuffer.length);
    }
  }
  
  async function _handleSetupFull(){
    var msg = document.getElementById('pinSetupMsg');
  
    if(_setupStep === 'change_old'){
      // í˜„ì¬ PIN í™•ì¸
      var hash = await _sha256(_setupBuffer);
      if(hash !== safeStorage.getItem(PIN_KEY)){
        _setupBuffer = '';
        _pinErrorAnim('pinSetupDots');
        if(msg){ msg.textContent = i18n('í˜„ì¬ PINì´ í‹€ë ¸ìŠµë‹ˆë‹¤'); msg.className='pin-msg err'; }
        setTimeout(function(){ _updatePinDots('pinSetupDots',0); if(msg){msg.textContent=i18n('í˜„ì¬ PINì„ ì…ë ¥í•˜ì„¸ìš”');msg.className='pin-msg warn';} }, 900);
      } else {
        _setupStep = 'new';
        _setupBuffer = '';
        _updatePinDots('pinSetupDots',0);
        if(msg){ msg.textContent = i18n('ìƒˆ PIN 4ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”'); msg.className='pin-msg'; }
      }
      return;
    }
  
    if(_setupStep === 'new'){
      _setupFirst = _setupBuffer;
      _setupBuffer = '';
      _setupStep = 'confirm';
      _updatePinDots('pinSetupDots',0);
      if(msg){ msg.textContent = i18n('PINì„ í•œ ë²ˆ ë” ì…ë ¥í•˜ì„¸ìš”'); msg.className='pin-msg warn'; }
      return;
    }
  
    if(_setupStep === 'confirm'){
      if(_setupBuffer !== _setupFirst){
        _setupBuffer = '';
        _setupFirst  = '';
        _setupStep   = 'new';
        _pinErrorAnim('pinSetupDots');
        if(msg){ msg.textContent = i18n('PINì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤'); msg.className='pin-msg err'; }
        setTimeout(function(){ _updatePinDots('pinSetupDots',0); if(msg){msg.textContent=i18n('ìƒˆ PIN 4ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”');msg.className='pin-msg';} }, 900);
        return;
      }
      // ì €ì¥
      var hash = await _sha256(_setupBuffer);
      safeStorage.setItem(PIN_KEY, hash);
      safeStorage.setItem(PIN_AUTO_LOCK_KEY, String(AUTO_LOCK_MIN));
      _pinUnlocked = true;
      if(msg){ msg.textContent = i18n('PINì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤'); msg.className='pin-msg ok'; }
      _updatePinToggle();
      setTimeout(function(){ closeModal('pinSetupModal'); }, 900);
    }
  }
  
  function _pinDelete(){
    if(!confirm(i18n('PIN ì ê¸ˆì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'))) return;
    safeStorage.removeItem(PIN_KEY);
    safeStorage.removeItem(PIN_FAIL_KEY);
    safeStorage.removeItem(PIN_LOCKED_UNTIL);
    safeStorage.removeItem(PIN_AUTO_LOCK_KEY);
    _updatePinToggle();
    closeModal('pinSetupModal');
  }
  
  // â”€â”€ ë„ìš°ë¯¸ í•¨ìˆ˜
  function _updatePinDots(containerId, filled){
    for(var i=0;i<4;i++){
      var d = document.getElementById(containerId === 'pinDots' ? 'pd'+i : 'psd'+i);
      if(d){ d.className = 'pin-dot' + (i<filled?' filled':''); }
    }
  }
  
  function _pinErrorAnim(containerId){
    for(var i=0;i<4;i++){
      var d = document.getElementById(containerId === 'pinDots' ? 'pd'+i : 'psd'+i);
      if(d){ d.className = 'pin-dot filled error'; }
    }
  }
  
  function _updatePinToggle(){
    var btn = document.getElementById('pinToggleBtn');
    if(btn) btn.className = 'pin-toggle' + (_pinIsEnabled() ? ' on' : '');
  }
  
  // â”€â”€ í™œë™ ê°ì§€ â†’ ìë™ì ê¸ˆ ë¦¬ì…‹
  ['click','touchstart','keydown'].forEach(function(ev){
    document.addEventListener(ev, function(){ if(_pinUnlocked) _pinResetAutoLock(); }, {passive:true});
  });
  
  // â”€â”€ PIN ì²´í¬ ì´ˆê¸°í™” (ì•± ì‹œì‘ ì‹œ)
  function _pinInit(){
    // ì´ì „ ë²„ì „(SHA-256/fallback)ìœ¼ë¡œ ì €ì¥ëœ PINì€ ìƒˆ í•´ì‹œì™€ ë§ì§€ ì•Šìœ¼ë¯€ë¡œ í´ë¦¬ì–´
    var storedPin = safeStorage.getItem(PIN_KEY);
    if(storedPin && !storedPin.startsWith('crm_')){
      safeStorage.removeItem(PIN_KEY);
      safeStorage.removeItem(PIN_FAIL_KEY);
      safeStorage.removeItem(PIN_LOCKED_UNTIL);
    }
    _updatePinToggle();
    if(_pinIsEnabled()){
      _showPinOverlay('lock');
    } else {
      _pinUnlocked = true;
    }
  }
  
  function openHelpModal(){
    closeModal('onboardingModal');
    document.getElementById('helpModal').classList.add('open');
  }
  function openLicenseModal(){
    document.getElementById('licenseModal').classList.add('open');
  }
  
  // ì˜¨ë³´ë”©: ì²« ì‹¤í–‰ ë˜ëŠ” ë¯¸ìŠ¤í‚µ ì‹œ í‘œì‹œ
  (function(){
    try {
      var skip = safeStorage.getItem('crm_onboarding_skip');
      if(!skip){
        var om = document.getElementById('onboardingModal');
        if(om) om.classList.add('open');
      }
    } catch(e) { console.warn('onboarding check error:', e); }
  })();
  </script>
  <!-- â”€â”€ ì‚¬ìš© ê°€ì´ë“œ ëª¨ë‹¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="modal-overlay" id="helpModal">
    <div class="modal" style="width:680px;max-height:88vh;overflow-y:auto">
      <button class="modal-close" onclick="closeModal('helpModal')">âœ•</button>
      <div class="modal-title">â“ ì‚¬ìš© ê°€ì´ë“œ</div>
      <div style="padding:0 2px">
  
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px">
          <div style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:16px">
            <div style="font-size:15px;margin-bottom:6px">ğŸ—‚ íŒŒì¼ ê°€ì ¸ì˜¤ê¸°</div>
            <div style="font-size:12px;color:var(--muted);line-height:1.9">
              ëª…í•¨ ì‚¬ì§„, PDF ë¬¸ì„œë¥¼ ì—…ë¡œë“œí•˜ë©´<br>
              AIê°€ ìë™ìœ¼ë¡œ ì—°ë½ì²˜ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.<br>
              ì—¬ëŸ¬ íŒŒì¼ì„ í•œ ë²ˆì— ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
              <span style="color:var(--accent)">â†’ Claude API í‚¤ í•„ìš”</span>
            </div>
          </div>
          <div style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:16px">
            <div style="font-size:15px;margin-bottom:6px">ğŸ“Š CSV ê°€ì ¸ì˜¤ê¸°</div>
            <div style="font-size:12px;color:var(--muted);line-height:1.9">
              Outlook, Gmail ì£¼ì†Œë¡ì„ CSVë¡œ ë‚´ë³´ë‚¸ í›„<br>
              íŒŒì¼ ê°€ì ¸ì˜¤ê¸°ì—ì„œ CSVë¥¼ ì„ íƒí•˜ë©´<br>
              ëŒ€ìš©ëŸ‰ë„ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.<br>
              <span style="color:var(--accent3)">â†’ API í‚¤ ë¶ˆí•„ìš”, íŒŒì¼ í¬ê¸° ë¬´ì œí•œ</span>
            </div>
          </div>
          <div style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:16px">
            <div style="font-size:15px;margin-bottom:6px">ğŸ—„ í´ë¼ìš°ë“œ ë™ê¸°í™”</div>
            <div style="font-size:12px;color:var(--muted);line-height:1.9">
              Supabaseì™€ ì—°ë™í•˜ë©´ ì—¬ëŸ¬ ê¸°ê¸°ì—ì„œ<br>
              ë°ì´í„°ë¥¼ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
              <a href="https://supabase.com" target="_blank" style="color:var(--accent)">supabase.com</a>ì—ì„œ ë¬´ë£Œ ê³„ì • ìƒì„± í›„<br>
              Project URLê³¼ API Keyë¥¼ ì…ë ¥í•˜ì„¸ìš”.
            </div>
          </div>
          <div style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:16px">
            <div style="font-size:15px;margin-bottom:6px">ğŸ’¾ ë°ì´í„° ì €ì¥</div>
            <div style="font-size:12px;color:var(--muted);line-height:1.9">
              Supabase ë¯¸ì—°ë™ ì‹œ ë¸Œë¼ìš°ì € ë¡œì»¬ì—<br>
              ìë™ ì €ì¥ë©ë‹ˆë‹¤. ë¸Œë¼ìš°ì € ë°ì´í„°ë¥¼<br>
              ì§€ìš°ë©´ ì‚­ì œë˜ë¯€ë¡œ Supabase ì—°ë™ì„<br>
              ê¶Œì¥í•©ë‹ˆë‹¤.
            </div>
          </div>
        </div>
  
        <div style="font-size:12px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px">Claude API í‚¤ ë°œê¸‰ ë°©ë²•</div>
        <div style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:14px 16px;font-size:12px;color:var(--muted);line-height:2">
          1. <a href="https://console.anthropic.com" target="_blank" style="color:var(--accent)">console.anthropic.com</a> ì ‘ì† í›„ ê°€ì…<br>
          2. ìš°ì¸¡ ìƒë‹¨ â†’ API Keys ë©”ë‰´ í´ë¦­<br>
          3. Create Key ë²„íŠ¼ í´ë¦­ â†’ í‚¤ ë³µì‚¬<br>
          4. RelaCRM â†’ íŒŒì¼ ê°€ì ¸ì˜¤ê¸° â†’ ğŸ”‘ API í‚¤ ì…ë ¥ë€ì— ë¶™ì—¬ë„£ê¸°<br>
          <span style="color:var(--accent2)">âš  API í‚¤ëŠ” ë³¸ì¸ë§Œ ì‚¬ìš©í•˜ì„¸ìš”. íƒ€ì¸ì—ê²Œ ê³µìœ í•˜ì§€ ë§ˆì„¸ìš”.</span>
        </div>
  
        <div style="font-size:12px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin:16px 0 10px">Supabase ì—°ë™ ë°©ë²•</div>
        <div style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:14px 16px;font-size:12px;color:var(--muted);line-height:2">
          1. <a href="https://supabase.com" target="_blank" style="color:var(--accent)">supabase.com</a> ì ‘ì† â†’ ë¬´ë£Œ ê°€ì… â†’ ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±<br>
          2. SQL Editorì—ì„œ ì•„ë˜ 3ê°œ í…Œì´ë¸” ìƒì„± (ì¢Œì¸¡ ğŸ—„ ë²„íŠ¼ â†’ SQL ë³µì‚¬ ë²„íŠ¼ ì‚¬ìš©)<br>
          3. Settings â†’ API â†’ Project URLê³¼ anon public Key ë³µì‚¬<br>
          4. RelaCRM â†’ ğŸ—„ Supabase ì—°ë™ ë©”ë‰´ì— ì…ë ¥
        </div>
  
      </div>
      <div class="modal-actions" style="margin-top:16px">
        <button class="btn btn-primary" onclick="closeModal('helpModal')" data-i18n="í™•ì¸">í™•ì¸</button>
      </div>
    </div>
  </div>
  
  <!-- â”€â”€ ë¼ì´ì„ ìŠ¤ ëª¨ë‹¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="modal-overlay" id="licenseModal">
    <div class="modal" style="width:560px">
      <button class="modal-close" onclick="closeModal('licenseModal')">âœ•</button>
      <div class="modal-title">ğŸ“„ ë¼ì´ì„ ìŠ¤ ì •ë³´</div>
      <div style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:18px 20px;font-size:12px;line-height:2;color:var(--muted)">
        <div style="font-size:15px;font-weight:700;color:var(--text);margin-bottom:12px">RelaCRM v1.0</div>
  
        <div style="color:var(--text);font-weight:600;margin-bottom:4px">âœ… í—ˆìš©</div>
        <div style="margin-bottom:12px">
          â€¢ ê°œì¸ ë° ìƒì—…ì  ëª©ì ìœ¼ë¡œ ììœ ë¡­ê²Œ ì‚¬ìš©<br>
          â€¢ ë°ì´í„° ìˆ˜ì •, í™œë™ ìœ í˜• ì»¤ìŠ¤í„°ë§ˆì´ì§•<br>
          â€¢ ìì²´ ì„œë²„/Supabaseì— ì—°ë™í•˜ì—¬ ì‚¬ìš©<br>
          â€¢ íŒ€ ë‚´ ê³µìœ  ë° ì—…ë¬´ í™œìš©
        </div>
  
        <div style="color:var(--accent2);font-weight:600;margin-bottom:4px">âŒ ê¸ˆì§€</div>
        <div style="margin-bottom:12px">
          â€¢ ì´ ì†Œí”„íŠ¸ì›¨ì–´ ìì²´ë¥¼ ì¬íŒë§¤Â·ì¬ë°°í¬<br>
          â€¢ ì†ŒìŠ¤ì½”ë“œì—ì„œ ë¼ì´ì„ ìŠ¤ ê³ ì§€ ì œê±°<br>
          â€¢ ì—­ì„¤ê³„ í›„ ë³„ë„ ì œí’ˆìœ¼ë¡œ ì¶œì‹œ
        </div>
  
        <div style="border-top:1px solid var(--border);padding-top:12px;font-size:11px;color:var(--border)">
          ë³¸ ì†Œí”„íŠ¸ì›¨ì–´ëŠ” í˜„ì¬ ìƒíƒœ("AS IS")ë¡œ ì œê³µë©ë‹ˆë‹¤.<br>
          ë°ì´í„° ì†ì‹¤ì— ëŒ€í•œ ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìœ¼ë©°,<br>
          Supabase ì—°ë™ ë˜ëŠ” ì£¼ê¸°ì  ë°±ì—…ì„ ê¶Œì¥í•©ë‹ˆë‹¤.<br><br>
          Â© 2025 RelaCRM. All rights reserved.
        </div>
      </div>
      <div class="modal-actions" style="margin-top:16px">
        <button class="btn btn-primary" onclick="closeModal('licenseModal')" data-i18n="í™•ì¸">í™•ì¸</button>
      </div>
    </div>
  </div>
  
  <!-- â”€â”€ ì˜¨ë³´ë”© ëª¨ë‹¬ (ì²« ì‹¤í–‰ì‹œ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="modal-overlay" id="onboardingModal">
    <div class="modal" style="width:580px;text-align:center">
      <div style="font-size:48px;margin-bottom:8px">â–¸</div>
      <div style="font-size:22px;font-weight:700;margin-bottom:4px">Rela<span style="color:var(--muted);font-weight:400">CRM</span>ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤</div>
      <div style="font-size:13px;color:var(--muted);margin-bottom:24px">ìŠ¤ë§ˆíŠ¸ ê³ ê°ê´€ë¦¬ ì‹œìŠ¤í…œ Â· v1.0</div>
  
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:24px;text-align:left">
        <div style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:14px">
          <div style="font-size:22px;margin-bottom:8px">ğŸ—‚</div>
          <div style="font-size:13px;font-weight:600;margin-bottom:4px">AI ëª…í•¨ ë¶„ì„</div>
          <div style="font-size:11px;color:var(--muted);line-height:1.7">ëª…í•¨ ì‚¬ì§„Â·PDFë¥¼ AIê°€ ìë™ìœ¼ë¡œ ì—°ë½ì²˜ë¡œ ì¶”ì¶œí•©ë‹ˆë‹¤</div>
        </div>
        <div style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:14px">
          <div style="font-size:22px;margin-bottom:8px">ğŸ“Š</div>
          <div style="font-size:13px;font-weight:600;margin-bottom:4px">ëŒ€ìš©ëŸ‰ CSV</div>
          <div style="font-size:11px;color:var(--muted);line-height:1.7">OutlookÂ·Gmail ì£¼ì†Œë¡ì„ í¬ê¸° ì œí•œ ì—†ì´ ê°€ì ¸ì˜µë‹ˆë‹¤</div>
        </div>
        <div style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:14px">
          <div style="font-size:22px;margin-bottom:8px">ğŸ—„</div>
          <div style="font-size:13px;font-weight:600;margin-bottom:4px">í´ë¼ìš°ë“œ ë™ê¸°í™”</div>
          <div style="font-size:11px;color:var(--muted);line-height:1.7">Supabase ì—°ë™ìœ¼ë¡œ ì—¬ëŸ¬ ê¸°ê¸°ì—ì„œ ë°ì´í„°ë¥¼ ê³µìœ í•©ë‹ˆë‹¤</div>
        </div>
      </div>
  
      <div style="background:rgba(79,124,255,0.08);border:1px solid rgba(79,124,255,0.2);border-radius:10px;padding:14px 16px;font-size:12px;color:var(--muted);line-height:1.9;text-align:left;margin-bottom:20px">
        <span style="color:var(--accent);font-weight:600">ì‹œì‘ ì „ ì¤€ë¹„ì‚¬í•­</span><br>
        â€¢ <strong style="color:var(--text)">AI íŒŒì¼ ë¶„ì„</strong>ì„ ì‚¬ìš©í•˜ë ¤ë©´ Claude API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤
          (<a href="https://console.anthropic.com" target="_blank" style="color:var(--accent)">console.anthropic.com</a>ì—ì„œ ë¬´ë£Œ ë°œê¸‰)<br>
        â€¢ <strong style="color:var(--text)">CSV ê°€ì ¸ì˜¤ê¸°</strong>ëŠ” API í‚¤ ì—†ì´ë„ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤<br>
        â€¢ <strong style="color:var(--text)">ë°ì´í„° ì˜êµ¬ ë³´ì¡´</strong>ì„ ì›í•˜ë©´ Supabase ì—°ë™ì„ ê¶Œì¥í•©ë‹ˆë‹¤
      </div>
  
      <div style="display:flex;gap:10px;justify-content:center">
        <button class="btn btn-outline" onclick="openHelpModal();closeModal('onboardingModal')">â“ ìì„¸í•œ ê°€ì´ë“œ ë³´ê¸°</button>
        <button class="btn btn-primary" onclick="closeModal('onboardingModal')" style="padding:10px 32px" data-i18n="ì‹œì‘í•˜ê¸° â†’">ì‹œì‘í•˜ê¸° â†’</button>
      </div>
      <div style="margin-top:12px">
        <label style="font-size:11px;color:var(--muted);cursor:pointer">
          <input type="checkbox" id="onboardingSkip" style="accent-color:var(--accent);vertical-align:middle;margin-right:4px">
          ë‹¤ì‹œ ë³´ì§€ ì•Šê¸°
        </label>
      </div>
    </div>
  </div>
  
  
  <!-- â”€â”€ PIN LOCK OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="pinOverlay" class="hidden">
    <div class="pin-logo">â–¸ RelaCRM</div>
    <div class="pin-subtitle" id="pinSubtitle">PINì„ ì…ë ¥í•˜ì„¸ìš”</div>
    <div class="pin-dots" id="pinDots">
      <div class="pin-dot" id="pd0"></div>
      <div class="pin-dot" id="pd1"></div>
      <div class="pin-dot" id="pd2"></div>
      <div class="pin-dot" id="pd3"></div>
    </div>
    <div class="pin-pad" id="pinPad">
      <button class="pin-btn" onclick="_pinPress('1')">1</button>
      <button class="pin-btn" onclick="_pinPress('2')">2</button>
      <button class="pin-btn" onclick="_pinPress('3')">3</button>
      <button class="pin-btn" onclick="_pinPress('4')">4</button>
      <button class="pin-btn" onclick="_pinPress('5')">5</button>
      <button class="pin-btn" onclick="_pinPress('6')">6</button>
      <button class="pin-btn" onclick="_pinPress('7')">7</button>
      <button class="pin-btn" onclick="_pinPress('8')">8</button>
      <button class="pin-btn" onclick="_pinPress('9')">9</button>
      <button class="pin-btn empty"></button>
      <button class="pin-btn" onclick="_pinPress('0')">0</button>
      <button class="pin-btn del" onclick="_pinBackspace()">âŒ«</button>
    </div>
    <div class="pin-msg" id="pinMsg"></div>
    <div class="pin-link" id="pinForgotLink" onclick="_pinForgot()" style="display:none">PINì„ ìŠìœ¼ì…¨ë‚˜ìš”? (ë°ì´í„° ì´ˆê¸°í™”)</div>
  </div>
  
  <!-- PIN ì„¤ì • ëª¨ë‹¬ -->
  <div class="modal-overlay" id="pinSetupModal">
    <div class="modal" style="max-width:340px">
      <button class="modal-close" onclick="closeModal('pinSetupModal')">âœ•</button>
      <div class="modal-title" id="pinSetupTitle">ğŸ” PIN ì„¤ì •</div>
      <div style="padding:0 4px">
        <div id="pinSetupDots" style="display:flex;gap:14px;justify-content:center;margin:20px 0">
          <div class="pin-dot" id="psd0"></div>
          <div class="pin-dot" id="psd1"></div>
          <div class="pin-dot" id="psd2"></div>
          <div class="pin-dot" id="psd3"></div>
        </div>
        <div class="pin-msg" id="pinSetupMsg" style="text-align:center;margin-bottom:12px"></div>
        <div class="pin-pad" style="margin:0 auto 16px">
          <button class="pin-btn" onclick="_setupPinPress('1')">1</button>
          <button class="pin-btn" onclick="_setupPinPress('2')">2</button>
          <button class="pin-btn" onclick="_setupPinPress('3')">3</button>
          <button class="pin-btn" onclick="_setupPinPress('4')">4</button>
          <button class="pin-btn" onclick="_setupPinPress('5')">5</button>
          <button class="pin-btn" onclick="_setupPinPress('6')">6</button>
          <button class="pin-btn" onclick="_setupPinPress('7')">7</button>
          <button class="pin-btn" onclick="_setupPinPress('8')">8</button>
          <button class="pin-btn" onclick="_setupPinPress('9')">9</button>
          <button class="pin-btn empty"></button>
          <button class="pin-btn" onclick="_setupPinPress('0')">0</button>
          <button class="pin-btn del" onclick="_setupPinBackspace()">âŒ«</button>
        </div>
        <div id="pinSetupDeleteRow" style="display:none;margin-top:8px">
          <button class="btn btn-outline" style="width:100%;color:var(--accent2);border-color:var(--accent2)" onclick="_pinDelete()">ğŸ”“ PIN ì ê¸ˆ í•´ì œ</button>
        </div>
      </div>
    </div>
  </div>
  
  
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ë¡œê·¸ì¸ í™”ë©´ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="loginOverlay">
    <div class="login-card">
      <div class="login-logo">â–¸ Rela<span style="font-weight:400;color:var(--text)">CRM</span></div>
      <div class="login-sub" id="loginSubtitle">ìŠ¤ë§ˆíŠ¸ ê³ ê°ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
  
      <!-- Supabase ì—°ê²° ìƒíƒœ ë°” (í•­ìƒ ë…¸ì¶œ) -->
      <div id="sbStatusBar" onclick="document.getElementById('loginOverlay').classList.add('hidden');openGsModal();"
        style="display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:8px;
               border:1px solid var(--border);margin-bottom:16px;cursor:pointer;
               background:var(--surface2);transition:border-color .15s"
        onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--border)'">
        <span id="sbStatusDot" style="font-size:11px">â—‹</span>
        <span id="sbStatusText" style="font-size:12px;color:var(--muted);flex:1">Supabase ì—°ë™ í™•ì¸ ì¤‘...</span>
        <span style="font-size:10px;color:var(--muted)">ì„¤ì • â€º</span>
      </div>
  
      <div class="login-field">
        <label>ì‚¬ìš©ì ì´ë¦„</label>
        <input class="login-input" id="loginName" type="text" placeholder="ì´ë¦„ ì…ë ¥"
               autocomplete="username"
               onkeydown="if(event.key==='Enter')document.getElementById('loginPw').focus()">
      </div>
      <div class="login-field">
        <label>ë¹„ë°€ë²ˆí˜¸</label>
        <div style="position:relative">
          <input class="login-input" id="loginPw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
                 autocomplete="current-password" style="padding-right:42px"
                 onkeydown="if(event.key==='Enter')_doLogin()">
          <button onclick="var i=document.getElementById('loginPw');i.type=i.type==='password'?'text':'password'"
            style="position:absolute;right:10px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--muted);cursor:pointer;font-size:15px;padding:4px">ğŸ‘</button>
        </div>
      </div>
      <button class="login-btn" id="loginBtn" onclick="_doLogin()">ë¡œê·¸ì¸</button>
      <div class="login-msg" id="loginMsg"></div>
  
      <!-- ë¬¸ì œ í•´ê²° ì˜ì—­ -->
      <div style="margin-top:16px;padding-top:14px;border-top:1px solid var(--border)">
        <button onclick="var a=document.getElementById('loginFixArea');a.style.display=a.style.display==='none'?'block':'none'"
          style="width:100%;background:none;border:none;color:var(--border);font-size:11px;cursor:pointer;font-family:IBM Plex Mono,monospace;text-align:center;padding:4px">
          â–¸ ë¡œê·¸ì¸ ë¬¸ì œ í•´ê²°
        </button>
        <div id="loginFixArea" style="display:none;margin-top:10px">
          <button onclick="_runLoginDiag()"
            style="width:100%;padding:9px;background:none;border:1px solid var(--border);border-radius:8px;
                   color:var(--muted);font-size:12px;cursor:pointer;font-family:IBM Plex Mono,monospace;margin-bottom:6px">
            ğŸ”§ ì—°ê²° ì§„ë‹¨ ì‹¤í–‰
          </button>
          <button onclick="_resetAdminAccount()"
            style="width:100%;padding:9px;background:none;border:1px solid var(--accent2);border-radius:8px;
                   color:var(--accent2);font-size:12px;cursor:pointer;font-family:IBM Plex Mono,monospace;margin-bottom:6px">
            ğŸ”‘ admin ê³„ì • ì´ˆê¸°í™” (PW: admin1234)
          </button>
          <div id="loginDiagResult"
            style="font-size:11px;color:var(--muted);margin-top:6px;line-height:1.8;
                   font-family:IBM Plex Mono,monospace;white-space:pre-wrap;word-break:break-all;
                   background:var(--bg);padding:10px;border-radius:6px;display:none"></div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ì‚¬ìš©ì ê´€ë¦¬ ëª¨ë‹¬ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="modal-overlay" id="userMgmtModal">
    <div class="modal" style="width:500px;max-height:82vh;overflow-y:auto">
      <button class="modal-close" onclick="closeModal('userMgmtModal')">âœ•</button>
      <div class="modal-title">ğŸ‘¥ ì‚¬ìš©ì ê´€ë¦¬</div>
  
      <!-- ì‚¬ìš©ì ëª©ë¡ -->
      <div id="userMgmtList" style="margin-bottom:18px"></div>
  
      <!-- ì‹ ê·œ ì¶”ê°€ -->
      <div style="background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:14px">
        <div style="font-size:11px;font-weight:700;color:var(--accent);margin-bottom:12px;font-family:IBM Plex Mono,monospace;text-transform:uppercase;letter-spacing:.5px">ï¼‹ ìƒˆ ì‚¬ìš©ì ì¶”ê°€</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px">
          <div>
            <label style="font-size:11px;color:var(--muted);display:block;margin-bottom:4px">ì´ë¦„</label>
            <input id="newUserName" class="login-input" placeholder="í™ê¸¸ë™" style="font-size:13px;padding:8px 10px">
          </div>
          <div>
            <label style="font-size:11px;color:var(--muted);display:block;margin-bottom:4px">ë¹„ë°€ë²ˆí˜¸ (4ì ì´ìƒ)</label>
            <input id="newUserPw" class="login-input" type="password" placeholder="ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸" style="font-size:13px;padding:8px 10px">
          </div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
          <div>
            <label style="font-size:11px;color:var(--muted);display:block;margin-bottom:4px">ì—­í• </label>
            <select id="newUserRole" style="width:100%;background:var(--bg);border:1px solid var(--border);color:var(--text);padding:8px 10px;border-radius:8px;font-size:13px;outline:none">
              <option value="user">ì¼ë°˜ ì‚¬ìš©ì</option>
              <option value="admin">ê´€ë¦¬ì</option>
            </select>
          </div>
          <div style="display:flex;align-items:flex-end">
            <button class="btn btn-primary" style="width:100%;padding:9px" onclick="_addUser()">ì¶”ê°€</button>
          </div>
        </div>
        <div id="userMgmtMsg" style="font-size:12px;color:var(--accent2);min-height:16px;margin-top:8px"></div>
      </div>
  
      <!-- ë‚´ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ -->
      <div style="background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:16px">
        <div style="font-size:11px;font-weight:700;color:var(--muted);margin-bottom:12px;font-family:IBM Plex Mono,monospace;text-transform:uppercase;letter-spacing:.5px">ğŸ”‘ ë‚´ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</div>
        <div style="display:grid;grid-template-columns:1fr 1fr auto;gap:10px;align-items:flex-end">
          <div>
            <label style="font-size:11px;color:var(--muted);display:block;margin-bottom:4px">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label>
            <input id="pwChangeCur" class="login-input" type="password" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸" style="font-size:13px;padding:8px 10px">
          </div>
          <div>
            <label style="font-size:11px;color:var(--muted);display:block;margin-bottom:4px">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
            <input id="pwChangeNew" class="login-input" type="password" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ (4ì ì´ìƒ)" style="font-size:13px;padding:8px 10px">
          </div>
          <button class="btn btn-outline btn-sm" onclick="_changeMyPw()" style="height:36px;white-space:nowrap">ë³€ê²½</button>
        </div>
        <div id="pwChangeMsg" style="font-size:12px;min-height:16px;margin-top:8px"></div>
      </div>
    </div>
  </div>
  
  </body>
  </html>
</main>
